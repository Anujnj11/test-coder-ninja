(self.webpackChunkninja_coder_app=self.webpackChunkninja_coder_app||[]).push([[926],{2907:(H,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.IContainerRuntime=void 0,q.IContainerRuntime="IContainerRuntime"},3842:function(H,q,v){"use strict";var R=this&&this.__createBinding||(Object.create?function(M,l,E,k){void 0===k&&(k=E),Object.defineProperty(M,k,{enumerable:!0,get:function(){return l[E]}})}:function(M,l,E,k){void 0===k&&(k=E),M[k]=l[E]}),B=this&&this.__exportStar||function(M,l){for(var E in M)"default"!==E&&!Object.prototype.hasOwnProperty.call(l,E)&&R(l,M,E)};Object.defineProperty(q,"__esModule",{value:!0}),B(v(2907),q)},8193:(H,q)=>{"use strict";var R;Object.defineProperty(q,"__esModule",{value:!0}),q.VisibilityState=q.FlushMode=void 0,(R=q.FlushMode||(q.FlushMode={}))[R.Immediate=0]="Immediate",R[R.TurnBased=1]="TurnBased",q.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}},6959:(H,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.IFluidDataStoreFactory=void 0,q.IFluidDataStoreFactory="IFluidDataStoreFactory"},8169:(H,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.IFluidDataStoreRegistry=void 0,q.IFluidDataStoreRegistry="IFluidDataStoreRegistry"},6560:(H,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0}),q.gcBlobKey=void 0,q.gcBlobKey="gc"},7665:function(H,q,v){"use strict";var R=this&&this.__createBinding||(Object.create?function(M,l,E,k){void 0===k&&(k=E),Object.defineProperty(M,k,{enumerable:!0,get:function(){return l[E]}})}:function(M,l,E,k){void 0===k&&(k=E),M[k]=l[E]}),B=this&&this.__exportStar||function(M,l){for(var E in M)"default"!==E&&!Object.prototype.hasOwnProperty.call(l,E)&&R(l,M,E)};Object.defineProperty(q,"__esModule",{value:!0}),B(v(6959),q),B(v(8169),q),B(v(8193),q),B(v(6560),q),B(v(1306),q),B(v(9992),q)},1306:(H,q)=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0})},9992:(H,q)=>{"use strict";var R;Object.defineProperty(q,"__esModule",{value:!0}),q.totalBlobSizePropertyName=q.blobCountPropertyName=q.channelsTreeName=q.CreateSummarizerNodeSource=void 0,(R=q.CreateSummarizerNodeSource||(q.CreateSummarizerNodeSource={}))[R.FromSummary=0]="FromSummary",R[R.FromAttach=1]="FromAttach",R[R.Local=2]="Local",q.channelsTreeName=".channels",q.blobCountPropertyName="BlobCount",q.totalBlobSizePropertyName="TotalBlobSize"},926:(H,q,v)=>{"use strict";v.r(q),v.d(q,{InterviewModule:()=>Td});var R={};v.r(R),v.d(R,{Decoder:()=>mo,Encoder:()=>Jl,PacketType:()=>lt,protocol:()=>$l});var B=v(6895),M=v(5263),l=v(5861),E=(()=>{return(u=E||(E={})).NoOp="noop",u.ClientJoin="join",u.ClientLeave="leave",u.Propose="propose",u.Reject="reject",u.Summarize="summarize",u.SummaryAck="summaryAck",u.SummaryNack="summaryNack",u.Operation="op",u.RemoteHelp="remoteHelp",u.NoClient="noClient",u.RoundTrip="tripComplete",u.Control="control",E;var u})(),z=v(5343);function S(u,e){if(!u)throw new Error("number"==typeof e?`0x${e.toString(16).padStart(3,"0")}`:e)}function K(u,e){switch(e){case"base64":return z.fromByteArray(u);case"utf8":case"utf-8":case void 0:return(new TextDecoder).decode(u);default:throw new Error("invalid/unsupported encoding")}}const X=(u,e)=>ce.from(u,e).buffer,ne=(u,e)=>ce.from(u).toString(e);function ae(u){return u instanceof ArrayBuffer||"object"==typeof u&&null!==u&&"number"==typeof u.byteLength&&"function"==typeof u.slice&&void 0===u.byteOffset&&void 0===u.buffer}class ce extends Uint8Array{toString(e){return K(this,e)}static from(e,t,n){if("string"==typeof e)return ce.fromString(e,t);if(null!==e&&"object"==typeof e&&ae(e.buffer))return S(0===e.byteOffset,0),S(e.byteLength===e.buffer.byteLength,1),ce.fromArrayBuffer(e.buffer,t,n);if(ae(e))return ce.fromArrayBuffer(e,t,n);throw new TypeError}static fromArrayBuffer(e,t,n){const i=t??0,o=n??e.byteLength-i;if(i<0||i>e.byteLength||o<0||o+i>e.byteLength)throw new RangeError;return new ce(e,i,o)}static fromString(e,t){switch(t){case"base64":{const n=this.sanitizeBase64(e),i=z.toByteArray(n);return new ce(i.buffer)}case"utf8":case"utf-8":case void 0:{const n=(new TextEncoder).encode(e);return new ce(n.buffer)}default:throw new Error("invalid/unsupported encoding")}}static isBuffer(e){throw new Error("unimplemented")}static sanitizeBase64(e){let t=e;return t=t.split("=")[0],t=t.replace(/[^\w+-/]/g,""),t.length%4!=0&&(t+=["","===","==","="][t.length%4]),t}}function V(u,e){return Te.apply(this,arguments)}function Te(){return(Te=(0,l.Z)(function*(u,e){const t=yield u.readBlob(e),n=ne(t,"utf8");return JSON.parse(n)})).apply(this,arguments)}var Ie,Me=new Uint8Array(16);function Be(){if(!Ie&&!(Ie=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ie(Me)}const se=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,te=function ge(u){return"string"==typeof u&&se.test(u)};for(var pe=[],Ae=0;Ae<256;++Ae)pe.push((Ae+256).toString(16).substr(1));const Pe=function ie(u,e,t){var n=(u=u||{}).random||(u.rng||Be)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return function ue(u){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=(pe[u[e+0]]+pe[u[e+1]]+pe[u[e+2]]+pe[u[e+3]]+"-"+pe[u[e+4]]+pe[u[e+5]]+"-"+pe[u[e+6]]+pe[u[e+7]]+"-"+pe[u[e+8]]+pe[u[e+9]]+"-"+pe[u[e+10]]+pe[u[e+11]]+pe[u[e+12]]+pe[u[e+13]]+pe[u[e+14]]+pe[u[e+15]]).toLowerCase();if(!te(t))throw TypeError("Stringified UUID is invalid");return t}(n)};var we=(()=>{return(u=we||(we={})).Detached="Detached",u.Attaching="Attaching",u.Attached="Attached",we;var u})(),de=(()=>{return(u=de||(de={})).NotBound="NotBound",u.Binding="Binding",u.Bound="Bound",de;var u})(),be=v(7665),at=v(9069);class Ke extends at.EventEmitter{constructor(){super(),this.addListener=super.addListener.bind(this),this.on=super.on.bind(this),this.once=super.once.bind(this),this.prependListener=super.prependListener.bind(this),this.prependOnceListener=super.prependOnceListener.bind(this),this.removeListener=super.removeListener.bind(this),this.off=super.off.bind(this)}}class Je extends Ke{constructor(e){super(),this.errorHandler=e}emit(e,...t){try{return super.emit(e,...t)}catch(n){return this.errorHandler(e,n),!0}}}class Ut{send(e){}}class _e{send(e){}sendTelemetryEvent(e,t){}sendErrorEvent(e,t){}sendPerformanceEvent(e,t){}}const Re=window.performance;class tt{constructor(e){this.valueGenerator=e,this._evaluated=!1}get evaluated(){return this._evaluated}get value(){return this._evaluated||(this._evaluated=!0,this._value=this.valueGenerator()),this._value}}const Xe=new tt(()=>He(Pt())),Ot={getRawConfig:()=>{}},He=u=>null!=u?new ot({getRawConfig:e=>{var t,n;try{return null===(n=At(null!==(t=u.getItem(e))&&void 0!==t?t:void 0))||void 0===n?void 0:n.raw}catch{}}}):Ot;function nt(u){switch(u){case"boolean":case"number":case"string":return!0;default:return!1}}function At(u){let t,e=u;if("string"==typeof u)try{e=JSON.parse(u),t={raw:u,string:u}}catch{}if(void 0===e)return t;const n=typeof e;if(nt(n))return Object.assign(Object.assign({},t),{raw:u,[n]:e});if(Array.isArray(e)){const i=typeof e[0];if(!nt(i))return t;for(const o of e)if(typeof o!==i)return t;return Object.assign(Object.assign({},t),{raw:u,[`${i}[]`]:e})}return t}const Pt=()=>{try{return null!==sessionStorage?sessionStorage:void 0}catch{return}};class ot{constructor(...e){this.configCache=new Map,this.orderedBaseProviders=[];const t=new Set,n=[...e];for(;n.length>0;){const i=n.shift();void 0!==i&&Zt(i)&&!t.has(i)&&(t.add(i),i instanceof ot?n.push(...i.orderedBaseProviders):this.orderedBaseProviders.push(i))}}getBoolean(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}getNumber(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}getString(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}getBooleanArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}getNumberArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}getStringArray(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}getRawConfig(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.raw}getCacheEntry(e){if(!this.configCache.has(e)){for(const t of this.orderedBaseProviders){const n=At(t?.getRawConfig(e));if(void 0!==n)return this.configCache.set(e,n),n}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}function Nt(u){const e=u;return Zt(e?.config)&&void 0!==e?.logger}function gt(u){return Nt(u)?u:xt(u,Xe.value)}function xt(u,...e){if(Nt(u))throw new Error("Logger is already a monitoring context");const t=u;return t.config=new ot(...e),t.logger=u,t}function Zt(u){return"function"==typeof u?.getRawConfig}const on=u=>"function"==typeof u?.getTelemetryProperties&&"function"==typeof u?.addTelemetryProperties,ut=u=>"string"==typeof u?.errorInstanceId;function $t(u){return"string"==typeof u?.errorType&&"string"==typeof u?.message&&ut(u)&&on(u)}function st(u){return"string"==typeof u?.errorType&&"string"==typeof u?.message&&on(u)}const Nn=u=>null!==u&&!Array.isArray(u)&&"object"==typeof u;function fn(u,e){const i={message:"string"==typeof u?.message?u.message:String(u)};if(Nn(u)){const{errorType:o,stack:h,name:w}=u;"string"==typeof o&&(i.errorType=o),"string"==typeof h&&(i.stack=((o,h)=>{if(!e)return o;const w=o.split("\n");return w.shift(),void 0!==h&&w.unshift(h),w.join("\n")})(h,"string"==typeof w?w:void 0))}return i}const lr=u=>"function"==typeof u?.getTelemetryProperties;function Rt(u,e={}){var t;if(st(u)&&function Ln(u){void 0===u.errorInstanceId&&(u.errorInstanceId=Pe())}(u),$t(u))return u.addTelemetryProperties(null!==(t=e.props)&&void 0!==t?t:{}),u;const{message:n,stack:i}=fn(u,!1),o=new rs({message:n,stack:i});if("object"==typeof u&&null!==u){const{canRetry:w,retryAfterSeconds:D}=u;Object.assign(Rt,{canRetry:w,retryAfterSeconds:D})}"object"!=typeof u&&o.addTelemetryProperties({typeofError:typeof u});const h=lr(u)?u.getTelemetryProperties():{};return o.addTelemetryProperties(Object.assign(Object.assign(Object.assign({},h),e.props),{untrustedOrigin:1})),o}let nr;function Kn(){const u=new Error("<<generated stack>>");if(void 0===nr&&(nr=void 0!==u.stack),nr)return u;try{throw u}catch(e){return e}}function hr(u,e){const{message:t,stack:n}=fn(u,!1),i=e(t);return void 0!==n&&Pr(i,n),Nr(u)&&i.addTelemetryProperties({untrustedOrigin:1}),ut(u)&&(i.overwriteErrorInstanceId(u.errorInstanceId),i.addTelemetryProperties({innerErrorInstanceId:u.errorInstanceId})),lr(u)&&i.addTelemetryProperties(u.getTelemetryProperties()),i}function Gn(u,e,t){const n=hr(u,e),i=n.errorInstanceId;return t.sendTelemetryEvent({eventName:"WrapError",errorInstanceId:i,wrappedByErrorInstanceId:i},u),n}function Pr(u,e){try{Object.assign(u,{stack:e})}catch{u.addTelemetryProperties({stack2:e})}}function Nr(u){return!st(u)||1===u.getTelemetryProperties().untrustedOrigin&&u.errorType===rs.normalizedErrorType}function Ei(u){return"object"!=typeof u?.value&&"string"==typeof u?.tag}class bt extends Error{constructor(e,t,n=new Set){super(e),this.omitPropsFromLogging=n,this._errorInstanceId=Pe(),this.fluidErrorCode="-",n.add("omitPropsFromLogging"),n.add("_errorInstanceId"),t&&this.addTelemetryProperties(t)}get errorInstanceId(){return this._errorInstanceId}overwriteErrorInstanceId(e){this._errorInstanceId=e}addTelemetryProperties(e){!function xr(u,e){for(const t of Object.keys(e))void 0===u[t]&&(u[t]=e[t])}(this,e)}getTelemetryProperties(){const e=function Qr(u,e){const t={};for(const n of Object.keys(u)){if(e.has(n))continue;const i=u[n];switch(typeof i){case"string":case"number":case"boolean":case"undefined":t[n]=i;break;default:t[n]=Ei(i)?i:"REDACTED (arbitrary object)"}}return t}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}let rs=(()=>{class u extends bt{constructor(t){super(t.message),this.errorType=u.normalizedErrorType,void 0!==t.stack&&Pr(this,t.stack)}}return u.normalizedErrorType="genericError",u})();var Tt=(()=>{return(u=Tt||(Tt={})).PackageData="PackageData",u.CodeArtifact="CodeArtifact",u.UserData="UserData",Tt;var u})();let Xt=(()=>{class u{constructor(t,n){this.namespace=t,this.properties=n}static formatTick(t){return Math.floor(t)}static numberFromString(t){if(null==t)return;const n=Number(t);return Number.isNaN(n)?t:n}static sanitizePkgName(t){return t.replace("@","").replace("/","-")}static prepareErrorObject(t,n,i){const{message:o,errorType:h,stack:w}=fn(n,!0);if(t.stack=w,t.error=o,t.errorType=h,lr(n)){const D=n.getTelemetryProperties();for(const _ of Object.keys(D))void 0===t[_]&&(t[_]=D[_])}void 0===t.stack&&i&&(t.stack=function Ci(){return Kn().stack}())}sendTelemetryEvent(t,n){var i;this.sendTelemetryEventCore(Object.assign(Object.assign({},t),{category:null!==(i=t.category)&&void 0!==i?i:"generic"}),n)}sendTelemetryEventCore(t,n){const i=Object.assign({},t);void 0!==n&&u.prepareErrorObject(i,n,!1),"number"==typeof i.duration&&(i.duration=u.formatTick(i.duration)),this.send(i)}sendErrorEvent(t,n){this.sendTelemetryEventCore(Object.assign(Object.assign({error:t.eventName},t),{category:"error"}),n)}sendPerformanceEvent(t,n){var i;const o=Object.assign(Object.assign({},t),{category:null!==(i=t.category)&&void 0!==i?i:"performance"});this.sendTelemetryEventCore(o,n)}prepareEvent(t){const n="error"===t.category||void 0!==t.error,i=Object.assign({},t);if(void 0!==this.namespace&&(i.eventName=`${this.namespace}${u.eventNamespaceSeparator}${i.eventName}`),this.properties){const o=[];o.push(this.properties.all),n&&o.push(this.properties.error);for(const h of o)if(void 0!==h)for(const w of Object.keys(h)){if(void 0!==t[w])continue;const D=h[w],_="function"==typeof D?D():D;void 0!==_&&(i[w]=_)}}return i}}return u.eventNamespaceSeparator=":",u})();class na{constructor(e){this.logger=e}send(e){const t={category:e.category,eventName:e.eventName};for(const n of Object.keys(e)){const i=e[n],{value:o,tag:h}="object"==typeof i?i:{value:i,tag:void 0};switch(h){case void 0:case Tt.PackageData:t[n]=o;break;case Tt.UserData:t[n]="REDACTED (UserData)";break;default:t[n]="REDACTED (unknown tag)"}}this.logger.send(t)}}class rt extends Xt{constructor(e,t,n){super(t,n),this.baseLogger=e,Nt(e)&&xt(this,new ot(e.config))}static create(e,t,n){if(e instanceof rt){const i={};for(const h of[e.properties,n])void 0!==h&&(void 0!==h.all&&(i.all=Object.assign(Object.assign({},i.all),h.all)),void 0!==h.error&&(i.error=Object.assign(Object.assign({},i.error),h.error)));return new rt(e.baseLogger,void 0===e.namespace?t:void 0===t?e.namespace:`${e.namespace}${Xt.eventNamespaceSeparator}${t}`,i)}return new rt(e||new Ut,t,n)}send(e){this.baseLogger.send(this.prepareEvent(e))}}class ra extends Xt{constructor(e,t){super(e,t),this.loggers=[]}addLogger(e){null!=e&&this.loggers.push(e)}send(e){const t=this.prepareEvent(e);this.loggers.forEach(n=>{n.send(t)})}}class it{constructor(e,t,n={end:!0,cancel:"generic"}){this.logger=e,this.markers=n,this.startTime=Re.now(),this.event=Object.assign({},t),this.markers.start&&this.reportEvent("start"),"object"==typeof window&&null!=window&&window.performance&&(this.startMark=`${t.eventName}-start`,window.performance.mark(this.startMark))}static start(e,t,n){return new it(e,t,n)}static timedExec(e,t,n,i){const o=it.start(e,t,i);try{const h=n(o);return o.autoEnd(),h}catch(h){throw o.cancel(void 0,h),h}}static timedExecAsync(e,t,n,i){return(0,l.Z)(function*(){const o=it.start(e,t,i);try{const h=yield n(o);return o.autoEnd(),h}catch(h){throw o.cancel(void 0,h),h}})()}get duration(){return Re.now()-this.startTime}reportProgress(e,t="update"){this.reportEvent(t,e)}autoEnd(){this.event&&this.markers.end&&this.reportEvent("end"),this.performanceEndMark(),this.event=void 0}end(e){this.reportEvent("end",e),this.performanceEndMark(),this.event=void 0}performanceEndMark(){if(this.startMark&&this.event){const e=`${this.event.eventName}-end`;window.performance.mark(e),window.performance.measure(`${this.event.eventName}`,this.startMark,e),this.startMark=void 0}}cancel(e,t){void 0!==this.markers.cancel&&this.reportEvent("cancel",Object.assign({category:this.markers.cancel},e),t),this.event=void 0}reportEvent(e,t,n){if(!this.event)return;const i=Object.assign(Object.assign({},this.event),t);i.eventName=`${i.eventName}_${e}`,"start"!==e&&(i.duration=this.duration),this.logger.sendPerformanceEvent(i,n)}}class Ai{constructor(e,t,n,i=!1,o=new Map){this.eventBase=e,this.logger=t,this.sampleThreshold=n,this.includeAggregateMetrics=i,this.perBucketProperties=o,this.disposed=!1,this.measurementsMap=new Map}measure(e,t=""){var n,i,o;const h=Re.now(),w=e(),D=Re.now()-h;let _=this.measurementsMap.get(t);return void 0===_&&(_={count:0,duration:-1},this.measurementsMap.set(t,_)),_.count++,_.duration=D,this.includeAggregateMetrics&&(_.totalDuration=(null!==(n=_.totalDuration)&&void 0!==n?n:0)+D,_.minDuration=Math.min(null!==(i=_.minDuration)&&void 0!==i?i:D,D),_.maxDuration=Math.max(null!==(o=_.maxDuration)&&void 0!==o?o:0,D)),_.count>=this.sampleThreshold&&this.flushBucket(t),w}flushBucket(e){const t=this.measurementsMap.get(e);if(void 0!==t&&0!==t.count){const n=this.perBucketProperties.get(e),i=Object.assign(Object.assign(Object.assign({},this.eventBase),n),t);this.logger.sendPerformanceEvent(i),this.measurementsMap.delete(e)}}dispose(e){this.measurementsMap.forEach((t,n)=>this.flushBucket(n))}}var rr=(()=>{return(u=rr||(rr={})).genericError="genericError",u.throttlingError="throttlingError",u.dataCorruptionError="dataCorruptionError",u.dataProcessingError="dataProcessingError",u.usageError="usageError",u.clientSessionExpiredError="clientSessionExpiredError",rr;var u})();class qn extends bt{constructor(e,t,n){super(e,n,new Set(["error"])),this.error=t,this.errorType=rr.genericError}}class Ti extends bt{constructor(e,t,n){super(e,n),this.retryAfterSeconds=t,this.errorType=rr.throttlingError}static wrap(e,t,n){return Gn(e,o=>new Ti(o,t),n)}}class wt extends bt{constructor(e){super(e,{usageError:!0}),this.errorType="usageError"}}class ia extends bt{constructor(e,t){super(e,{timeoutMs:t}),this.expiryMs=t,this.errorType=rr.clientSessionExpiredError}}class zn extends bt{constructor(e,t){super(e,Object.assign(Object.assign({},t),{dataProcessingError:1})),this.errorType=rr.dataCorruptionError,this.canRetry=!1}}class Cn extends bt{constructor(e){super(e),this.errorType=rr.dataProcessingError,this.canRetry=!1}static create(e,t,n,i={}){const o=Cn.wrapIfUnrecognized(e,t,n);return o.addTelemetryProperties(i),o}static wrapIfUnrecognized(e,t,n){const o=Rt(e,{props:Object.assign({dataProcessingError:1,dataProcessingCodepath:t},void 0===n?void 0:dr(n))});if(!Nr(o))return o;const h=hr(o,w=>new Cn(w));return h.addTelemetryProperties(o.getTelemetryProperties()),h}}const dr=u=>({messageClientId:u.clientId,messageSequenceNumber:u.sequenceNumber,messageClientSequenceNumber:u.clientSequenceNumber,messageReferenceSequenceNumber:u.referenceSequenceNumber,messageMinimumSequenceNumber:u.minimumSequenceNumber,messageTimestamp:u.timestamp});function Rr(u,e){if(""===u)return void 0===e?"":e.absolutePath;{let t=u.startsWith("/")?u.slice(1):u;return t=t.endsWith("/")?t.slice(0,-1):t,void 0===e?`/${t}`:`${"/"===e.absolutePath?"":e.absolutePath}/${t}`}}var Mt=(()=>{return(u=Mt||(Mt={})).cache="fluid-cache",u.clientDetails="fluid-client-details",u.loadMode="loadMode",u.reconnect="fluid-reconnect",u.sequenceNumber="fluid-sequence-number",u.version="version",Mt;var u})();function En(u,e="Unreachable Case"){throw new Error(e)}class Xr{constructor(e){this.startTick=e,this.lastTick=e}static start(){const e=Re.now();return new Xr(e)}trace(){const e=Re.now(),t={totalTimeElapsed:e-this.startTick,duration:e-this.lastTick,tick:e};return this.lastTick=e,t}}const is="connected",ss="disconnected";function Fi(u,e,t,n){try{t?e.emit(is,n):e.emit(ss)}catch(i){u.sendErrorEvent({eventName:"RaiseConnectedEventError"},i)}}var fr=(()=>{return(u=fr||(fr={})).summarizingClient="fluid-client-summarizer",u.createNew="createNew",fr;var u})();function Ir(u){return u.type===E.Operation||u.type===E.Summarize}var Yr=(()=>{return(u=Yr||(Yr={})).FluidDataStoreOp="component",u.Attach="attach",u.ChunkedOp="chunkedOp",u.BlobAttach="blobAttach",u.Rejoin="rejoin",u.Alias="alias",u.Operation="op",Yr;var u})();function Or(u){return!!Object.values(Yr).includes(u.type)}var Le=(()=>{return(u=Le||(Le={})).Tree=1,u.Blob=2,u.Handle=3,u.Attachment=4,Le;var u})();class jt{constructor(){this.completed=!1,this.p=new Promise((e,t)=>{this.res=e,this.rej=t})}get isCompleted(){return this.completed}get promise(){return this.p}resolve(e){void 0!==this.res&&(this.completed=!0,this.res(e))}reject(e){void 0!==this.rej&&(this.completed=!0,this.rej(e))}}class Wn{constructor(e){this.execute=e}get[Symbol.toStringTag](){return this.getPromise()[Symbol.toStringTag]}then(e,t){var n=arguments,i=this;return(0,l.Z)(function*(){return i.getPromise().then(...n)})()}catch(e){var t=arguments,n=this;return(0,l.Z)(function*(){return n.getPromise().catch(...t)})()}finally(e){var t=arguments,n=this;return(0,l.Z)(function*(){return n.getPromise().finally(...t)})()}getPromise(){var e=this;return(0,l.Z)(function*(){return void 0===e.result&&(e.result=e.execute()),e.result})()}}function as(u){return u.replace(/\/+$/g,"")}function Mr(u){const e={};for(const[t,n]of Object.entries(u.gcNodes))e[t]=Array.from(n);return{gcNodes:e}}function os(u){const e=new Map;if(void 0===u.gcData)return e;const t=u.gcData.gcNodes;delete t["/"];for(const[i,o]of Object.entries(t)){S(i.startsWith("/"),686);const h=i.split("/")[1];let w=i.slice(h.length+1);""===w&&(w="/");let D=e.get(h);void 0===D&&(D={gcData:{gcNodes:{}},usedRoutes:[]}),S(void 0!==D.gcData,687),D.gcData.gcNodes[w]=[...new Set(o)],e.set(h,D)}if(void 0===u.usedRoutes)return e;const n=u.usedRoutes.filter(i=>""!==i&&"/"!==i);for(const i of n){S(i.startsWith("/"),688);const o=i.split("/")[1],h=i.slice(o.length+1),w=e.get(o);S(void 0!==w?.usedRoutes,689),w.usedRoutes.push(h),e.set(o,w)}return e}function us(u){const e=u.filter(n=>""!==n&&"/"!==n),t=new Map;for(const n of e){S(n.startsWith("/"),408);const i=n.split("/")[1],o=n.slice(i.length+1),h=t.get(i);void 0!==h?h.push(o):t.set(i,[o])}return t}function ca(u,e){var t;const n={};for(const[i,o]of Object.entries(u.gcNodes))n[i]={outboundRoutes:Array.from(o.outboundRoutes),unreferencedTimestampMs:o.unreferencedTimestampMs};for(const[i,o]of Object.entries(e.gcNodes)){let h=n[i];void 0===h?h={outboundRoutes:Array.from(o.outboundRoutes),unreferencedTimestampMs:o.unreferencedTimestampMs}:(void 0!==o.unreferencedTimestampMs&&void 0!==h.unreferencedTimestampMs&&S(o.unreferencedTimestampMs===h.unreferencedTimestampMs,690),h={outboundRoutes:[...new Set([...o.outboundRoutes,...h.outboundRoutes])],unreferencedTimestampMs:null!==(t=o.unreferencedTimestampMs)&&void 0!==t?t:h.unreferencedTimestampMs}),n[i]=h}return{gcNodes:n}}class Di{constructor(){this.gcNodesSet={}}get gcNodes(){const e={};for(const[t,n]of Object.entries(this.gcNodesSet))e[t]=[...n];return e}addNode(e,t){this.gcNodesSet[e]=new Set(t)}prefixAndAddNodes(e,t){for(const[n,i]of Object.entries(t)){let o=n.replace(/^\/+/g,"");o=`/${e}/${o}`,o=as(o),this.gcNodesSet[o]=new Set(i)}}addNodes(e){for(const[t,n]of Object.entries(e))this.gcNodesSet[t]=new Set(n)}addRouteToAllNodes(e){for(const t of Object.values(this.gcNodesSet))t.add(e)}getGCData(){return{gcNodes:this.gcNodes}}}const la=u=>ce.from(u,"base64").toString("utf-8"),cs=u=>ce.from(u,"utf8").toString("base64");var _n=(()=>{return(u=_n||(_n={})).File="100644",u.Executable="100755",u.Directory="040000",u.Symlink="120000",_n;var u})(),sn=(()=>{return(u=sn||(sn={})).Blob="Blob",u.Tree="Tree",u.Attachment="Attachment",sn;var u})();function ha(u){const e=u.type===Le.Handle?u.handleType:u.type;switch(e){case Le.Blob:case Le.Attachment:return _n.File;case Le.Tree:return _n.Directory;default:En(0,`Unknown type: ${e}`)}}function ls(u){const e=u.type===Le.Handle?u.handleType:u.type;switch(e){case Le.Blob:case Le.Attachment:return"blob";case Le.Tree:return"tree";default:En(0,`Unknown type: ${e}`)}}function Pi(u,e=new Map,t=!1){const n={},i={id:u.sha,blobs:{},trees:{}};n[""]=i;for(const o of u.tree){const h=t?o.path.replace(/^\.app\//,""):o.path,w=h.lastIndexOf("/"),D=h.slice(0,Math.max(0,w)),_=h.slice(w+1),U=n[D];if("tree"===o.type){const Q={id:o.sha,blobs:{},commits:{},trees:{}};U.trees[decodeURIComponent(_)]=Q,n[h]=Q}else{if("blob"!==o.type)throw new Error("Unknown entry type!!");U.blobs[decodeURIComponent(_)]=o.sha,e.set(o.sha,`/${h}`)}}return i}class un{constructor(e,t,n="utf-8"){this.path=e,this.mode=_n.File,this.type=sn.Blob,this.value={contents:t,encoding:n}}}class da{constructor(e,t){this.path=e,this.value=t,this.mode=_n.Directory,this.type=sn.Tree}}class fa{constructor(e,t){this.path=e,this.id=t,this.mode=_n.File,this.type=sn.Attachment,this.value={id:t}}}function Vn(...u){const e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0};for(const t of u)e.treeNodeCount+=t.treeNodeCount,e.blobNodeCount+=t.blobNodeCount,e.handleNodeCount+=t.handleNodeCount,e.totalBlobSize+=t.totalBlobSize,e.unreferencedBlobSize+=t.unreferencedBlobSize;return e}function hs(u){return"string"==typeof u?function pa(u){let e=u.length;for(let t=u.length-1;t>=0;t--){const n=u.charCodeAt(t);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&t--}return e}(u):u.byteLength}function ds(u,e){switch(u.type){case Le.Tree:e.treeNodeCount++;for(const t of Object.values(u.tree))ds(t,e);return;case Le.Handle:return void e.handleNodeCount++;case Le.Blob:return e.blobNodeCount++,void(e.totalBlobSize+=hs(u.content));default:return}}function ei(u){const e=Vn();return ds(u,e),e}function An(u,e,t){u.summary.tree[e]={type:Le.Blob,content:t},u.stats.blobNodeCount++,u.stats.totalBlobSize+=hs(t)}class Mn{constructor(){this.attachmentCounter=0,this.summaryTree={},this.summaryStats=Vn(),this.summaryStats.treeNodeCount++}get summary(){return{type:Le.Tree,tree:Object.assign({},this.summaryTree)}}get stats(){return Object.assign({},this.summaryStats)}addBlob(e,t){An({summary:{type:Le.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}addHandle(e,t,n){this.summaryTree[e]={type:Le.Handle,handleType:t,handle:n},this.summaryStats.handleNodeCount++}addWithStats(e,t){this.summaryTree[e]=t.summary,this.summaryStats=Vn(this.summaryStats,t.stats)}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:Le.Attachment}}getSummaryTree(){return{summary:this.summary,stats:this.stats}}}function Fn(u,e=!1){if(u.id&&!e){const t=Vn();return t.handleNodeCount++,{summary:{handle:u.id,handleType:Le.Tree,type:Le.Handle},stats:t}}return function Ni(u,e=!1){const t=new Mn;for(const i of u.entries)switch(i.type){case sn.Blob:{const o=i.value;let h;h="base64"===o.encoding?ce.from(o.contents,"base64"):o.contents,t.addBlob(i.path,h);break}case sn.Tree:{const o=Fn(i.value,e);t.addWithStats(i.path,o);break}case sn.Attachment:t.addAttachment(i.value.id);break;default:throw new Error("Unexpected TreeEntry type")}const n=t.getSummaryTree();return n.summary.unreferenced=u.unreferenced,n}(u,e)}function ti(u){const e=new Mn;for(const[n,i]of Object.entries(u.blobs)){let o;if(void 0!==u.blobsContents){const h=u.blobsContents[i];void 0!==h&&(o=ne(h,"utf-8"))}else void 0!==u.blobs[i]&&(o=la(u.blobs[i]));void 0!==o&&e.addBlob(n,o)}for(const[n,i]of Object.entries(u.trees)){const o=ti(i);e.addWithStats(n,o)}const t=e.getSummaryTree();return t.summary.unreferenced=u.unreferenced,t}function ni(u){const e=[];for(const[t,n]of Object.entries(u.tree))switch(n.type){case Le.Blob:{let i,o="utf-8";"string"==typeof n.content?i=n.content:(i=K(n.content,"base64"),o="base64"),e.push(new un(t,i,o));break}case Le.Tree:e.push(new da(t,ni(n)));break;case Le.Attachment:e.push(new fa(t,n.id));break;case Le.Handle:throw new Error("Should not have Handle type in summary tree");default:En(0,"Unexpected summary tree type")}return{entries:e,unreferenced:u.unreferenced}}class fs{constructor(){this.telemetry=new Map}set(e,t,n){this.telemetry.set(`${e}${t}`,n)}get(e,t){return this.telemetry.get(`${e}${t}`)}serialize(){const e={};return this.telemetry.forEach((t,n)=>{e[n]=t}),JSON.stringify(e)}}const kr="_baseSummary",ps="_outstandingOps",$n=100;class pt{constructor(e){this.path=e}static create(e){return new pt(encodeURIComponent(e))}static createAndConcat(e){var t;let n=pt.create(null!==(t=e[0])&&void 0!==t?t:"");for(let i=1;i<e.length;i++)n=n.concat(pt.create(e[i]));return n}toString(){return this.path}concat(e){return new pt(`${this.path}/${e.path}`)}}class pr{constructor(e){this.summary=e}static createForRoot(e){return new pr({referenceSequenceNumber:e,basePath:void 0,localPath:pt.create("")})}get referenceSequenceNumber(){return this.summary.referenceSequenceNumber}get basePath(){return this.summary.basePath}get localPath(){return this.summary.localPath}get additionalPath(){return this.summary.additionalPath}set additionalPath(e){this.summary.additionalPath=e}get fullPath(){var e,t;return null!==(t=null===(e=this.basePath)||void 0===e?void 0:e.concat(this.localPath))&&void 0!==t?t:this.localPath}get fullPathForChildren(){return void 0!==this.additionalPath?this.fullPath.concat(this.additionalPath):this.fullPath}createForChild(e){return new pr({referenceSequenceNumber:this.referenceSequenceNumber,basePath:this.fullPathForChildren,localPath:pt.create(e)})}}function ga(u,e){let t=u;const n=[],i=[];for(let o=0;;o++){o>$n&&e.sendTelemetryEvent({eventName:"DecodeSummaryMaxDepth",maxDecodeDepth:$n});const h=t.blobs[ps],w=t.trees[kr];if(void 0===h&&void 0===w)return{baseSummary:t,pathParts:n,getOutstandingOps:D=>(0,l.Z)(function*(){let _=[];for(const U of i){const Q=yield D(U);if(_.length>0&&Q.length>0){const Y=_[_.length-1].sequenceNumber,ye=Q[0].sequenceNumber;if(ye<=Y)for(e.sendTelemetryEvent({eventName:"DuplicateOutstandingOps",message:`newEarliestSeq <= latestSeq in decodeSummary: ${ye} <= ${Y}`});Q.length>0&&Q[0].sequenceNumber<=Y;)Q.shift()}_=_.concat(Q)}return _})()};S(!!h,431),S(void 0!==w,432),t=w,n.push(kr),i.unshift(h)}}function ri(u){const e=u.trees[be.channelsTreeName];return void 0!==e?{childrenTree:e,childrenPathPart:be.channelsTreeName}:{childrenTree:u,childrenPathPart:void 0}}class Ve{constructor(e,t,n,i,o,h,w){var D;this.defaultLogger=e,this.summarizeInternalFn=t,this._changeSequenceNumber=i,this._latestSummary=o,this.initialSummary=h,this.wipSummaryLogger=w,this.children=new Map,this.pendingSummaries=new Map,this.outstandingOps=[],this.wipSkipRecursion=!1,this.canReuseHandle=null===(D=n.canReuseHandle)||void 0===D||D,this.throwOnError=!0,this.trackingSequenceNumber=this._changeSequenceNumber}get referenceSequenceNumber(){var e,t;return null!==(t=null===(e=this._latestSummary)||void 0===e?void 0:e.referenceSequenceNumber)&&void 0!==t?t:0}startSummary(e,t){S(void 0===this.wipSummaryLogger,415),S(void 0===this.wipReferenceSequenceNumber,416),this.wipSummaryLogger=t;for(const n of this.children.values())n.startSummary(e,this.wipSummaryLogger);this.wipReferenceSequenceNumber=e}summarize(e,t=!0,n){var i=this;return(0,l.Z)(function*(){if(S(i.isTrackingInProgress(),417),S(void 0!==i.wipSummaryLogger,418),i.canReuseHandle&&!e&&!i.hasChanged()){const o=i._latestSummary;if(void 0!==o){i.wipLocalPaths={localPath:o.localPath,additionalPath:o.additionalPath},i.wipSkipRecursion=!0;const h=Vn();return h.handleNodeCount++,{summary:{type:Le.Handle,handle:o.fullPath.path,handleType:Le.Tree},stats:h}}}try{const o=yield i.summarizeInternalFn(e,!0,n);return i.wipLocalPaths={localPath:pt.create(o.id)},void 0!==o.pathPartsForChildren&&(i.wipLocalPaths.additionalPath=pt.createAndConcat(o.pathPartsForChildren)),{summary:o.summary,stats:o.stats}}catch(o){if(i.throwOnError||i.trackingSequenceNumber<i._changeSequenceNumber)throw o;const h=i._latestSummary,w=i.initialSummary;let D,_;if(void 0!==h)D={fromSummary:!0,summaryNode:h},_=h.localPath;else{if(void 0===w?.summary)throw o;D={fromSummary:!1,initialSummary:w.summary},_=pt.create(w.id)}i.wipSummaryLogger.sendErrorEvent({eventName:"SummarizingWithBasePlusOps"},o);const U=function ma(u,e){let t=pt.create(kr);const n=new Mn;if(n.addBlob(ps,JSON.stringify(e)),u.fromSummary){const o=u.summaryNode;void 0!==o.additionalPath&&(t=t.concat(o.additionalPath)),n.addHandle(kr,Le.Tree,o.fullPath.path)}else n.addWithStats(kr,u.initialSummary);const i=n.getSummaryTree();return Object.assign(Object.assign({},i),{additionalPath:t})}(D,i.outstandingOps);return i.wipLocalPaths={localPath:_,additionalPath:U.additionalPath},i.wipSkipRecursion=!0,{summary:U.summary,stats:U.stats}}})()}completeSummary(e){this.completeSummaryCore(e,void 0,!1)}completeSummaryCore(e,t,n){S(void 0!==this.wipSummaryLogger,419),S(void 0!==this.wipReferenceSequenceNumber,420);let i=this.wipLocalPaths;if(n){const w=this._latestSummary;if(void 0===w)return void this.clearSummary();i={localPath:w.localPath,additionalPath:w.additionalPath}}S(!!i,421);const o=new pr(Object.assign(Object.assign({},i),{referenceSequenceNumber:this.wipReferenceSequenceNumber,basePath:t})),h=o.fullPathForChildren;for(const w of this.children.values())w.completeSummaryCore(e,h,this.wipSkipRecursion||n);this.pendingSummaries.set(e,o),this.clearSummary()}clearSummary(){this.wipReferenceSequenceNumber=void 0,this.wipLocalPaths=void 0,this.wipSkipRecursion=!1,this.wipSummaryLogger=void 0;for(const e of this.children.values())e.clearSummary()}refreshLatestSummary(e,t,n,i,o){var h=this;return(0,l.Z)(function*(){if(void 0!==e){const D=h.pendingSummaries.get(e);if(void 0!==D)return h.refreshLatestSummaryFromPending(e,D.referenceSequenceNumber),{latestSummaryUpdated:!0,wasSummaryTracked:!0}}if(h.referenceSequenceNumber>=t)return{latestSummaryUpdated:!1};const w=yield n();return yield h.refreshLatestSummaryFromSnapshot(t,w,void 0,pt.create(""),o,i),{latestSummaryUpdated:!0,wasSummaryTracked:!1,snapshot:w}})()}refreshLatestSummaryFromPending(e,t){const n=this.pendingSummaries.get(e);if(void 0!==n){S(t===n.referenceSequenceNumber,423),this.pendingSummaries.delete(e),this.refreshLatestSummaryCore(t),this._latestSummary=n;for(const i of this.children.values())i.refreshLatestSummaryFromPending(e,t)}else S(void 0===this._latestSummary,422)}refreshLatestSummaryFromSnapshot(e,t,n,i,o,h){var w=this;return(0,l.Z)(function*(){if(w.referenceSequenceNumber>=e)return;w.refreshLatestSummaryCore(e);const{baseSummary:D,pathParts:_}=ga(t,o);w._latestSummary=new pr({referenceSequenceNumber:e,basePath:n,localPath:i});const{childrenTree:U,childrenPathPart:Q}=ri(D);void 0!==Q&&_.push(Q),_.length>0&&(w._latestSummary.additionalPath=pt.createAndConcat(_));const Y=w._latestSummary.fullPathForChildren;yield Promise.all(Array.from(w.children).filter(([ye])=>void 0!==U.trees[ye]).map(function(){var ye=(0,l.Z)(function*([Fe,De]){return De.refreshLatestSummaryFromSnapshot(e,U.trees[Fe],Y,pt.create(Fe),o,h)});return function(Fe){return ye.apply(this,arguments)}}()))})()}refreshLatestSummaryCore(e){for(const[t,n]of this.pendingSummaries)n.referenceSequenceNumber<e&&this.pendingSummaries.delete(t);for(;this.outstandingOps.length>0&&this.outstandingOps[0].sequenceNumber<=e;)this.outstandingOps.shift()}loadBaseSummaryWithoutDifferential(e){const{childrenPathPart:t}=ri(e);void 0!==t&&void 0!==this._latestSummary&&(this._latestSummary.additionalPath=pt.create(t))}loadBaseSummary(e,t){var n=this;return(0,l.Z)(function*(){const i=ga(e,n.defaultLogger),o=yield i.getOutstandingOps(t),{childrenPathPart:h}=ri(i.baseSummary);return void 0!==h&&i.pathParts.push(h),i.pathParts.length>0&&void 0!==n._latestSummary&&(n._latestSummary.additionalPath=pt.createAndConcat(i.pathParts)),o.length>0&&S(o[o.length-1].sequenceNumber<=n.trackingSequenceNumber,425),{baseSummary:i.baseSummary,outstandingOps:o}})()}recordChange(e){const t=this.outstandingOps[this.outstandingOps.length-1];void 0!==t&&S(t.sequenceNumber<e.sequenceNumber,426),this.invalidate(e.sequenceNumber),this.trackingSequenceNumber=e.sequenceNumber,this.outstandingOps.push(e)}invalidate(e){e>this._changeSequenceNumber&&(this._changeSequenceNumber=e)}hasChanged(){return this._changeSequenceNumber>this.referenceSequenceNumber}get latestSummary(){return this._latestSummary}createChild(e,t,n,i={}){S(!this.children.has(t),427);const o=this.getCreateDetailsForChild(t,n),h=new Ve(this.defaultLogger,e,i,o.changeSequenceNumber,o.latestSummary,o.initialSummary,this.wipSummaryLogger);return this.maybeUpdateChildState(h),this.children.set(t,h),h}getChild(e){return this.children.get(e)}getCreateDetailsForChild(e,t){var n;let i,o,h;const w=this._latestSummary;switch(t.type){case be.CreateSummarizerNodeSource.FromAttach:if(void 0!==w&&t.sequenceNumber<=w.referenceSequenceNumber)o=w.createForChild(e);else{const D=Fn(t.snapshot);i={sequenceNumber:t.sequenceNumber,id:e,summary:D}}h=t.sequenceNumber;break;case be.CreateSummarizerNodeSource.FromSummary:void 0===this.initialSummary&&S(!!w,428);case be.CreateSummarizerNodeSource.Local:{const D=this.initialSummary;if(void 0!==D){let _,U;if(void 0!==D.summary){const{childrenTree:Q}=function va(u){const e=u.tree[be.channelsTreeName];return void 0!==e?{childrenTree:e,childrenPathPart:be.channelsTreeName}:{childrenTree:u,childrenPathPart:void 0}}(D.summary.summary);S(Q.type===Le.Tree,470),_=Q.tree[e]}t.type===be.CreateSummarizerNodeSource.FromSummary&&S(!!_,429),void 0!==_&&(S(_.type===Le.Tree,430),U={summary:_,stats:ei(_)}),i={sequenceNumber:D.sequenceNumber,id:e,summary:U}}o=w?.createForChild(e),h=null!==(n=w?.referenceSequenceNumber)&&void 0!==n?n:-1;break}default:En(0,`Unexpected CreateSummarizerNodeSource: ${t.type}`)}return{initialSummary:i,latestSummary:o,changeSequenceNumber:h}}maybeUpdateChildState(e){if(this.isTrackingInProgress()&&(e.wipReferenceSequenceNumber=this.wipReferenceSequenceNumber),void 0!==e._latestSummary)for(const[t,n]of this.pendingSummaries.entries()){const i=new pr({referenceSequenceNumber:n.referenceSequenceNumber,basePath:e._latestSummary.basePath,localPath:e._latestSummary.localPath});e.addPendingSummary(t,i)}}addPendingSummary(e,t){this.pendingSummaries.set(e,t)}isTrackingInProgress(){return void 0!==this.wipReferenceSequenceNumber}}class ya extends pr{constructor(e,t){super(t),this.serializedUsedRoutes=e}}class Ri extends Ve{constructor(e,t,n,i,o,h,w,D,_){super(e,function(){var U=(0,l.Z)(function*(Q,Y,ye){return t(Q,!0,ye)});return function(Q,Y,ye){return U.apply(this,arguments)}}(),n,i,o,h,w),this.summarizeFn=t,this.getGCDataFn=D,this.baseGCDetailsLoaded=!1,this.usedRoutes=[""],this.gcDisabled=!0===n.gcDisabled,this.baseGCDetailsP=new Wn((0,l.Z)(function*(){var U;return null!==(U=yield _?.())&&void 0!==U?U:{usedRoutes:[]}}))}getGCSummaryDetails(){return this.getBaseGCDetails()}getBaseGCDetails(){return{gcData:this.gcData,usedRoutes:this.usedRoutes,unrefTimestamp:this.unreferencedTimestampMs}}loadBaseGCDetails(){var e=this;return(0,l.Z)(function*(){var t;const n=yield e.baseGCDetailsP;e.baseGCDetailsLoaded||(e.baseGCDetailsLoaded=!0,void 0!==n.gcData&&(e.gcData=Mr(n.gcData)),e.referenceUsedRoutes=null===(t=n.usedRoutes)||void 0===t?void 0:t.sort(),e.unreferencedTimestampMs=n.unrefTimestamp)})()}summarize(e,t=!0,n){var i=()=>super.summarize,o=this;return(0,l.Z)(function*(){return!o.gcDisabled&&o.isTrackingInProgress()&&S(void 0!==o.wipSerializedUsedRoutes,433),t?i().call(o,e,!0,n):o.summarizeFn(e,t,n)})()}getGCData(e=!1){var t=this;return(0,l.Z)(function*(){if(S(!t.gcDisabled,434),S(void 0!==t.getGCDataFn,435),yield t.loadBaseGCDetails(),!e&&!t.hasDataChanged()&&void 0!==t.gcData)return Mr(t.gcData);const n=yield t.getGCDataFn(e);return t.gcData=Mr(n),n})()}startSummary(e,t){this.gcDisabled||S(void 0===this.wipSerializedUsedRoutes,436),super.startSummary(e,t)}completeSummaryCore(e,t,n){let i;if(this.gcDisabled||(i=this.wipSerializedUsedRoutes,S(void 0!==i,437)),super.completeSummaryCore(e,t,n),!this.gcDisabled){const o=this.pendingSummaries.get(e);if(void 0!==o){const h=new ya(i,o);this.pendingSummaries.set(e,h)}}}clearSummary(){this.wipSerializedUsedRoutes=void 0,super.clearSummary()}refreshLatestSummaryFromPending(e,t){if(!this.gcDisabled){const n=this.pendingSummaries.get(e);void 0!==n&&(this.referenceUsedRoutes=JSON.parse(n.serializedUsedRoutes))}return super.refreshLatestSummaryFromPending(e,t)}refreshLatestSummaryFromSnapshot(e,t,n,i,o,h){var w=()=>super.refreshLatestSummaryFromSnapshot,D=this;return(0,l.Z)(function*(){if(!D.gcDisabled){const _=t.blobs[be.gcBlobKey];if(void 0!==_){const U=yield h(_);if(D.referenceSequenceNumber>=e)return;D.referenceUsedRoutes=U.usedRoutes}}return w().call(D,e,t,n,i,o,h)})()}createChild(e,t,n,i={},o,h){var w;S(!this.children.has(t),438);const D=this.getCreateDetailsForChild(t,n),_=new Ri(this.defaultLogger,e,Object.assign(Object.assign({},i),{gcDisabled:null!==(w=i.gcDisabled)&&void 0!==w?w:this.gcDisabled}),D.changeSequenceNumber,D.latestSummary,D.initialSummary,this.wipSummaryLogger,o,h);return this.maybeUpdateChildState(_),this.children.set(t,_),_}deleteChild(e){this.children.delete(e)}getChild(e){return this.children.get(e)}isReferenced(){return this.usedRoutes.includes("")||this.usedRoutes.includes("/")}updateUsedRoutes(e,t){this.usedRoutes=e.sort(),!this.gcDisabled&&this.isTrackingInProgress()&&(this.wipSerializedUsedRoutes=JSON.stringify(this.usedRoutes)),this.isReferenced()?this.unreferencedTimestampMs=void 0:void 0===this.unreferencedTimestampMs&&(this.unreferencedTimestampMs=t)}hasChanged(){return this.hasDataChanged()||this.hasUsedStateChanged()}hasDataChanged(){return super.hasChanged()}hasUsedStateChanged(){return!this.gcDisabled&&(void 0===this.referenceUsedRoutes||JSON.stringify(this.usedRoutes)!==JSON.stringify(this.referenceUsedRoutes))}}class Un{constructor(e){this.request=e;const t=this.request.url.indexOf("?");this.query=t>=0?this.request.url.substring(t):""}static getPathParts(e){const t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce((n,i)=>(void 0!==i&&i.length>0&&n.push(decodeURIComponent(i)),n),[])}static create(e){return e instanceof Un?e:new Un(e)}get url(){return this.request.url}get headers(){return this.request.headers}get pathParts(){return void 0===this.requestPathParts&&(this.requestPathParts=Un.getPathParts(this.url)),this.requestPathParts}isLeaf(e){return""===this.query&&this.pathParts.length===e}createSubRequest(e){const t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:`/${this.query}`,headers:this.headers};const n=`/${this.pathParts.slice(e).join("/")}`;return{url:""===this.query?n:`${n}/${this.query}`,headers:this.headers}}}function Br(u){if(null!==u&&"object"==typeof u&&!0===u.errorFromRequestFluidObject){const n=u;return{mimeType:"text/plain",status:n.code,value:n.message,get stack(){return n.stack}}}const t=Kn();return{mimeType:"text/plain",status:500,value:`${u}`,get stack(){var n;return null!==(n=u?.stack)&&void 0!==n?n:t.stack}}}function ii(u,e){const t=u.value,n=Kn();return{errorFromRequestFluidObject:!0,message:t,name:"Error",code:u.status,get stack(){var o;return null!==(o=u.stack)&&void 0!==o?o:n.stack}}}function jr(u,e){return Ii.apply(this,arguments)}function Ii(){return(Ii=(0,l.Z)(function*(u,e){const t="string"==typeof e?{url:e}:e,n=yield u.request(t);if(200!==n.status||"fluid/object"!==n.mimeType)throw ii(n);return S(n.value,410),n.value})).apply(this,arguments)}const kn=u=>gs(404,"not found",u);function gs(u,e,t){var n;S(200!==u,411);const i=null===(n=t.url)||void 0===n?void 0:n.split("?")[0],o=Kn();return{mimeType:"text/plain",status:u,value:void 0===i?e:`${e}: ${i}`,get stack(){return o.stack}}}function Vt(){return(Vt=(0,l.Z)(function*(u,e){const t=u.trees[".protocol"].blobs.attributes;return(yield e(t)).sequenceNumber})).apply(this,arguments)}class xa{constructor(e,t,n){this.path=e,this.runtime=t,this.routeContext=n,this.absolutePath=Rr(e,this.routeContext)}get IFluidHandleContext(){return this}attachGraph(){throw new Error("can't attach container runtime form within container!")}get isAttached(){return this.runtime.attachState!==we.Detached}resolveHandle(e){var t=this;return(0,l.Z)(function*(){return t.runtime.resolveHandle(e)})()}}class Oi{constructor(e){this.map=new Map;for(const t of e){if(this.map.has(t[0]))throw new wt("Duplicate entry names exist");this.map.set(t[0],t[1])}}get IFluidDataStoreRegistry(){return this}get(e){var t=this;return(0,l.Z)(function*(){if(t.map.has(e))return t.map.get(e)})()}}var Dn=(()=>{return(u=Dn||(Dn={})).genericError="genericError",u.genericNetworkError="genericNetworkError",u.authorizationError="authorizationError",u.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError",u.throttlingError="throttlingError",u.offlineError="offlineError",u.unsupportedClientProtocolVersion="unsupportedClientProtocolVersion",u.writeError="writeError",u.fetchFailure="fetchFailure",u.incorrectServerResponse="incorrectServerResponse",u.fileOverwrittenInStorage="fileOverwrittenInStorage",u.deltaStreamConnectionForbidden="deltaStreamConnectionForbidden",u.locationRedirection="locationRedirection",Dn;var u})();const vn="summarizer";let _i=(()=>{class u extends Ke{constructor(t,n,i,o,h){super(),this.logger=t,this.summaryCollection=n,this.clientElection=i,this.maxOpsSinceLastSummary=o,this.electionEnabled=h,this.lastReportedSeq=0,this.summaryCollection.on("default",({sequenceNumber:w})=>{var D,_,U;const Q=this.electedClientId;if(void 0===Q)return void(this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(w));let Y=this.clientElection.electionSequenceNumber;if(w-(null!==(D=this.lastSummaryAckSeqForClient)&&void 0!==D?D:Y)>this.maxOpsSinceLastSummary){const Fe=w-this.lastReportedSeq;if(Fe>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"ElectedClientNotSummarizing",electedClientId:Q,lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:Y,nextElectedClientId:null===(_=this.clientElection.peekNextElectedClient())||void 0===_?void 0:_.clientId,electionEnabled:this.electionEnabled}),this.lastReportedSeq=w),this.electionEnabled){const De=this.electedParentId;this.clientElection.incrementElectedClient(w),Y=this.clientElection.electionSequenceNumber,w>(null!==(U=this.lastSummaryAckSeqForClient)&&void 0!==U?U:Y)&&Fe>this.maxOpsSinceLastSummary&&this.logger.sendErrorEvent({eventName:"UnexpectedElectionSequenceNumber",lastSummaryAckSeqForClient:this.lastSummaryAckSeqForClient,electionSequenceNumber:Y,sequenceNumber:w,previousClientId:Q,previousParentId:De,electedParentId:this.electedParentId,electedClientId:this.electedClientId,opsSinceLastReport:Fe,maxOpsSinceLastSummary:o})}}}),this.summaryCollection.on(E.SummaryAck,w=>{this.lastSummaryAckSeqForClient=w.sequenceNumber}),this.clientElection.on("election",(w,D)=>{this.lastSummaryAckSeqForClient=void 0,void 0===w&&this.clientElection.eligibleCount>0&&this.clientElection.resetElectedClient(D),this.emit("electedSummarizerChanged")})}get electedClientId(){var t;return null===(t=this.clientElection.electedClient)||void 0===t?void 0:t.clientId}get electedParentId(){var t;return null===(t=this.clientElection.electedParent)||void 0===t?void 0:t.clientId}serialize(){var t;const{electedClientId:n,electedParentId:i,electionSequenceNumber:o}=this.clientElection.serialize();return{electedClientId:n,electedParentId:i,electionSequenceNumber:null!==(t=this.lastSummaryAckSeqForClient)&&void 0!==t?t:o}}static isClientEligible(t){const n=t.client.details;return void 0===n||u.clientDetailsPermitElection(n)}}return u.clientDetailsPermitElection=e=>e.capabilities.interactive||e.type===vn,u})();class Cr{constructor(e,t,n){this.value=e,this.path=t,this.routeContext=n,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=Rr(t,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.routeContext.isAttached}get visible(){return this.isAttached||this.locallyVisible}get(){var e=this;return(0,l.Z)(function*(){return e.value})()}attachGraph(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}bind(e){this.visible?e.attachGraph():this.pendingHandlesToMakeVisible.add(e)}}class wa extends Cr{get(){return(0,l.Z)(function*(){throw Error("Do not try to get a summarizer object from the handle. Reference it directly.")})()}attach(){}bind(e){}}class gr{constructor(e,t,n=(()=>Date.now())){this.defaultTimeout=e,this.defaultHandler=t,this.getCurrentTick=n}get hasTimer(){return!!this.runningState}start(e=this.defaultTimeout,t=this.defaultHandler){this.startCore(e,t,e)}clear(){this.runningState&&(clearTimeout(this.runningState.timeout),this.runningState=void 0)}restart(e,t){var n,i;if(this.runningState){const o=e??this.runningState.intendedDuration,h=null!==(i=t??(null===(n=this.runningState.restart)||void 0===n?void 0:n.handler))&&void 0!==i?i:this.runningState.handler,w=this.calculateRemainingTime(this.runningState);o<w?this.start(o,h):o===w?(this.runningState.handler=h,this.runningState.restart=void 0,this.runningState.intendedDuration=o):this.runningState.restart={startTick:this.getCurrentTick(),duration:o,handler:h}}else this.start(e,t)}startCore(e,t,n){this.clear(),this.runningState={startTick:this.getCurrentTick(),duration:e,intendedDuration:n,handler:t,timeout:setTimeout(()=>this.handler(),e)}}handler(){S(!!this.runningState,10);const e=this.runningState.restart;if(void 0!==e){const t=this.calculateRemainingTime(e);this.startCore(t,()=>e.handler(),e.duration)}else{const t=this.runningState.handler;this.clear(),t()}}calculateRemainingTime(e){const t=this.getCurrentTick()-e.startTick;return e.duration-t}}class ft{constructor(e,t){this.timer=new gr(e,()=>this.wrapHandler(t))}get hasTimer(){return this.timer.hasTimer}start(e,t){var n=this;return(0,l.Z)(function*(){return n.clear(),n.deferred=new jt,n.timer.start(e,t?()=>n.wrapHandler(t):void 0),n.deferred.promise})()}clear(){this.timer.clear(),this.deferred&&(this.deferred.resolve({timerResult:"cancel"}),this.deferred=void 0)}wrapHandler(e){e(),S(!!this.deferred,11),this.deferred.resolve({timerResult:"timeout"}),this.deferred=void 0}}const ms=function(){var u=(0,l.Z)(function*(e){return new Promise(t=>setTimeout(()=>t(),e))});return function(t){return u.apply(this,arguments)}}();class Ca{constructor(e,t){this.lastOpSequenceNumber=e,this._lastAttempt=t,this._lastSuccessfulSummary=Object.assign({},t)}get lastAttempt(){return this._lastAttempt}get lastSuccessfulSummary(){return this._lastSuccessfulSummary}updateWithLastSummaryAckInfo(e){this._lastAttempt=e,this._lastSuccessfulSummary=Object.assign({},e)}recordAttempt(e){this._lastAttempt={refSequenceNumber:e??this.lastOpSequenceNumber,summaryTime:Date.now()}}markLastAttemptAsSuccessful(){this._lastSuccessfulSummary=Object.assign({},this.lastAttempt)}}class Ea{constructor(e,t,n,i){this.heuristicData=e,this.configuration=t,this.trySummarize=n,this.logger=i,this.idleTimer=new gr(this.configuration.idleTime,()=>this.trySummarize("idle")),this.minOpsForLastSummaryAttempt=this.configuration.minOpsForLastSummaryAttempt}get opsSinceLastAck(){return this.heuristicData.lastOpSequenceNumber-this.heuristicData.lastSuccessfulSummary.refSequenceNumber}run(){const e=Date.now()-this.heuristicData.lastSuccessfulSummary.summaryTime,t=this.opsSinceLastAck;e>this.configuration.maxTime?(this.idleTimer.clear(),this.trySummarize("maxTime")):t>this.configuration.maxOps?(this.idleTimer.clear(),this.trySummarize("maxOps")):this.idleTimer.restart()}shouldRunLastSummary(){const e=this.opsSinceLastAck,t=this.minOpsForLastSummaryAttempt;return this.logger.sendTelemetryEvent({eventName:"ShouldRunLastSummary",opsSinceLastAck:e,minOpsForLastSummaryAttempt:t}),e>=t}dispose(){this.idleTimer.clear()}}var Mi,Jn=(()=>{return(u=Jn||(Jn={}))[u.Offline=0]="Offline",u[u.Online=1]="Online",u[u.Unknown=2]="Unknown",Jn;var u})();function ki(){return"object"==typeof navigator&&null!==navigator&&"boolean"==typeof navigator.onLine?navigator.onLine?Jn.Online:Jn.Offline:Jn.Unknown}class Bi extends bt{constructor(e,t,n){super(e,n),this.canRetry=t,this.errorType=Dn.genericNetworkError}}const vs="deltaStreamConnectionForbidden";class si extends bt{constructor(e,t){super(e,Object.assign(Object.assign({},t),{statusCode:400})),this.errorType=si.errorType,this.canRetry=!1}}si.errorType=null!==(Mi=Dn[vs])&&void 0!==Mi?Mi:vs;class Qn extends bt{constructor(e,t,n,i){super(e,i,new Set(["claims","tenantId"])),this.claims=t,this.tenantId=n,this.errorType=Dn.authorizationError,this.canRetry=!1}}class Aa extends bt{constructor(e,t,n,i){super(e,i),this.errorType=t,this.canRetry=n}}class ai extends Aa{constructor(e,t,n){super(e,t,!1,n),this.errorType=t}}class Ta extends bt{constructor(e,t,n){super(e,n),this.retryAfterSeconds=t,this.errorType=Dn.throttlingError,this.canRetry=!0}}function Er(u,e,t){return void 0!==e.retryAfterMs&&e.canRetry?new Ta(u,e.retryAfterMs/1e3,t):new Bi(u,e.canRetry,t)}const Lr=u=>!0===u?.canRetry,ji=u=>u?.retryAfterSeconds,Ne=u=>void 0!==u?.retryAfterSeconds?1e3*u.retryAfterSeconds:void 0;function d(u,e,t){return ys.apply(this,arguments)}function ys(){return(ys=(0,l.Z)(function*(u,e,t){const n=[u.then(i=>({result:"done",value:i})),e.then(({timerResult:i})=>({result:i}))];return void 0!==t&&n.push(t.waitCancelled.then(()=>({result:"cancelled"}))),Promise.race(n)})).apply(this,arguments)}const Hr={submitSummaryFailure:"Error while generating, uploading, or submitting summary",summaryOpWaitTimeout:"Timeout while waiting for summarize op broadcast",summaryAckWaitTimeout:"Timeout while waiting for summaryAck/summaryNack op",summaryNack:"Server rejected summary via summaryNack op",disconnect:"Summary cancelled due to summarizer or main client disconnect"};class en{constructor(){this.summarySubmitted=new jt,this.summaryOpBroadcasted=new jt,this.receivedSummaryAckOrNack=new jt}fail(e,t,n,i){S(!this.receivedSummaryAckOrNack.isCompleted,606);const o={success:!1,message:e,data:void 0,error:t,retryAfterSeconds:i};this.summarySubmitted.resolve(o),this.summaryOpBroadcasted.resolve(o),this.receivedSummaryAckOrNack.resolve(Object.assign(Object.assign({},o),{data:n}))}build(){return{summarySubmitted:this.summarySubmitted.promise,summaryOpBroadcasted:this.summaryOpBroadcasted.promise,receivedSummaryAckOrNack:this.receivedSummaryAckOrNack.promise}}}class Da{constructor(e,t,n,i,o,h,w){this.pendingAckTimer=e,this.heuristicData=t,this.submitSummaryCallback=n,this.raiseSummarizingError=i,this.successfulSummaryCallback=o,this.summaryWatcher=h,this.logger=w,this.summarizeTimer=new gr(2e4,()=>this.summarizeTimerHandler(2e4,1))}summarize(e,t,n,i=new en){return this.summarizeCore(e,t,i,n).catch(o=>{const h="UnexpectedSummarizeError";this.logger.sendErrorEvent(Object.assign({eventName:h},e),o),i.fail(h,o)}),i.build()}summarizeCore(e,t,n,i){var o=this;return(0,l.Z)(function*(){const{refreshLatestAck:h,fullTree:w}=t,D=rt.create(o.logger,void 0,{all:e});let Q={fullTree:w,timeSinceLastAttempt:Date.now()-o.heuristicData.lastAttempt.summaryTime,timeSinceLastSummary:Date.now()-o.heuristicData.lastSuccessfulSummary.summaryTime};const Y=it.start(D,Object.assign({eventName:"Summarize",refreshLatestAck:h},Q)),Fe=(Ee,ke,ze,We)=>{o.raiseSummarizingError(Hr[Ee]);const $e=ji(ke),dt=i.cancelled||ke?.errorType===Dn.offlineError?"generic":"error";Y.cancel(Object.assign(Object.assign({},ze),{reason:Ee,category:dt,retryAfterSeconds:$e}),ke),n.fail((Ee=>`${Ee}: ${Hr[Ee]}`)(Ee),ke,We,$e)};let De;o.summarizeTimer.start();try{De=yield o.submitSummaryCallback({fullTree:w,refreshLatestAck:h,summaryLogger:D,cancellationToken:i});const Ee=De.referenceSequenceNumber,ke=Ee-o.heuristicData.lastSuccessfulSummary.refSequenceNumber;if(Q=Object.assign(Object.assign({},Q),{referenceSequenceNumber:Ee,minimumSequenceNumber:De.minimumSequenceNumber,opsSinceLastAttempt:Ee-o.heuristicData.lastAttempt.refSequenceNumber,opsSinceLastSummary:ke}),"base"!==De.stage&&(Q=Object.assign(Object.assign(Object.assign({},Q),De.summaryStats),{generateDuration:De.generateDuration}),"generate"!==De.stage&&(Q=Object.assign(Object.assign({},Q),{handle:De.handle,uploadDuration:De.uploadDuration}),"upload"!==De.stage&&(Q=Object.assign(Object.assign({},Q),{clientSequenceNumber:De.clientSequenceNumber})))),"submit"!==De.stage)return Fe("submitSummaryFailure",De.error,Q);if(!w&&!De.forcedFullTree){const{summarizedDataStoreCount:ze,gcStateUpdatedDataStoreCount:We=0}=De.summaryStats;ze>We+ke&&D.sendErrorEvent({eventName:"IncrementalSummaryViolation",summarizedDataStoreCount:ze,gcStateUpdatedDataStoreCount:We,opsSinceLastSummary:ke})}Y.reportEvent("generate",Object.assign({},Q)),n.summarySubmitted.resolve({success:!0,data:De})}catch(Ee){return Fe("submitSummaryFailure",Ee)}finally{o.heuristicData.recordAttempt(De?.referenceSequenceNumber),o.summarizeTimer.clear()}try{const Ee=o.pendingAckTimer.start(),ke=o.summaryWatcher.watchSummary(De.clientSequenceNumber),ze=yield d(ke.waitBroadcast(),Ee,i);if("cancelled"===ze.result)return Fe("disconnect");if("done"!==ze.result)return Fe("summaryOpWaitTimeout");const We=ze.value,$e=Date.now()-o.heuristicData.lastAttempt.summaryTime;n.summaryOpBroadcasted.resolve({success:!0,data:{summarizeOp:We,broadcastDuration:$e}}),o.heuristicData.lastAttempt.summarySequenceNumber=We.sequenceNumber,D.sendTelemetryEvent({eventName:"Summarize_Op",duration:$e,referenceSequenceNumber:We.referenceSequenceNumber,summarySequenceNumber:We.sequenceNumber,handle:We.contents.handle});const dt=yield d(ke.waitAckNack(),Ee,i);if("cancelled"===dt.result)return Fe("disconnect");if("done"!==dt.result)return Fe("summaryAckWaitTimeout");const Dt=dt.value;o.pendingAckTimer.clear();const qt=Date.now()-o.heuristicData.lastAttempt.summaryTime;if(Q=Object.assign({ackWaitDuration:qt,ackNackSequenceNumber:Dt.sequenceNumber,summarySequenceNumber:Dt.contents.summaryProposal.summarySequenceNumber},Q),Dt.type!==E.SummaryAck){S(Dt.type===E.SummaryNack,628);const St=Dt.contents,Gt=St?.message,hn=St?.retryAfter,dn=new bt(`Received summaryNack: ${Gt}`,{retryAfterSeconds:hn});return S(ji(dn)===hn,607),Fe("summaryNack",dn,Object.assign(Object.assign({},Q),{nackRetryAfter:hn}),{summaryNackOp:Dt,ackNackDuration:qt})}o.heuristicData.markLastAttemptAsSuccessful(),o.successfulSummaryCallback(),Y.end(Object.assign(Object.assign({},Q),{handle:Dt.contents.handle})),n.receivedSummaryAckOrNack.resolve({success:!0,data:{summaryAckOp:Dt,ackNackDuration:qt}})}finally{o.pendingAckTimer.clear()}})()}summarizeTimerHandler(e,t){if(this.logger.sendPerformanceEvent({eventName:"SummarizeTimeout",timeoutTime:e,timeoutCount:t}),t<5){const n=2*e;this.summarizeTimer.start(n,()=>this.summarizeTimerHandler(n,t+1))}}dispose(){this.summarizeTimer.clear()}}var Hi=function(u,e){var t={};for(var n in u)Object.prototype.hasOwnProperty.call(u,n)&&e.indexOf(n)<0&&(t[n]=u[n]);if(null!=u&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(u);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(u,n[i])&&(t[n[i]]=u[n[i]])}return t};class ir{constructor(e,t,n,i,o,h,w,D,_){this.summaryWatcher=t,this.configuration=n,this.submitSummaryCallback=i,this.heuristicData=o,this.raiseSummarizingError=h,this.summaryCollection=w,this.cancellationToken=D,this.stopSummarizerCallback=_,this.stopping=!1,this._disposed=!1,this.tryWhileSummarizing=!1,this.summarizeCount=0,this.totalSuccessfulAttempts=0,this.tryGetCorrelatedLogger=Y=>this.heuristicData.lastAttempt.refSequenceNumber===Y?this.logger:void 0,this.logger=rt.create(e,"Running",{all:{summarizeCount:()=>this.summarizeCount,summarizerSuccessfulAttempts:()=>this.totalSuccessfulAttempts}}),"disableHeuristics"!==n.state&&(S("enabled"===this.configuration.state,746),this.heuristicRunner=new Ea(o,this.configuration,Y=>this.trySummarize(Y),this.logger)),S("disabled"!==this.configuration.state,747);const Q=Math.min(this.configuration.maxAckWaitTime,6e5);this.pendingAckTimer=new ft(Q,()=>{this.raiseSummarizingError("Pending summary ack not received in time"),this.logger.sendErrorEvent({eventName:"SummaryAckWaitTimeout",maxAckWaitTime:Q,referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber,timePending:Date.now()-this.heuristicData.lastAttempt.summaryTime})}),w.setPendingAckTimerTimeoutCallback(Q,()=>{this.pendingAckTimer.hasTimer&&(this.logger.sendTelemetryEvent({eventName:"MissingSummaryAckFoundByOps",referenceSequenceNumber:this.heuristicData.lastAttempt.refSequenceNumber,summarySequenceNumber:this.heuristicData.lastAttempt.summarySequenceNumber}),this.pendingAckTimer.clear())}),this.generator=new Da(this.pendingAckTimer,this.heuristicData,this.submitSummaryCallback,this.raiseSummarizingError,()=>{this.totalSuccessfulAttempts++},this.summaryWatcher,this.logger)}static start(e,t,n,i,o,h,w,D,_){return(0,l.Z)(function*(){var U;const Q=new ir(e,t,n,i,o,h,w,D,_);return yield Q.waitStart(),null===(U=Q.heuristicRunner)||void 0===U||U.run(),Q})()}get disposed(){return this._disposed}dispose(){var e;this.summaryWatcher.dispose(),null===(e=this.heuristicRunner)||void 0===e||e.dispose(),this.heuristicRunner=void 0,this.generator.dispose(),this.pendingAckTimer.clear(),this.disposeEnqueuedSummary(),this._disposed=!0,this.stopping=!0}handleSystemOp(e){switch(e.type){case E.ClientLeave:case E.ClientJoin:case E.Propose:return void this.handleOp(void 0,e);default:return}}handleOp(e,{sequenceNumber:t}){var h;void 0===e&&(this.heuristicData.lastOpSequenceNumber=t,this.tryRunEnqueuedSummary()||null===(h=this.heuristicRunner)||void 0===h||h.run())}waitStop(e){var t=this;return(0,l.Z)(function*(){var n;t.stopping||(t.stopping=!0,t.disposeEnqueuedSummary(),e&&!(null===(n=t.heuristicRunner)||void 0===n)&&n.shouldRunLastSummary()&&void 0===t.summarizingLock&&t.trySummarizeOnce({reason:"lastSummary"},{}),yield t.summarizingLock)})()}waitStart(){var e=this;return(0,l.Z)(function*(){const t=yield d(e.summaryWatcher.waitFlushed(),e.pendingAckTimer.start());e.pendingAckTimer.clear(),e.summaryCollection.unsetPendingAckTimerTimeoutCallback(),"done"===t.result&&void 0!==t.value&&e.heuristicData.updateWithLastSummaryAckInfo({refSequenceNumber:t.value.summaryOp.referenceSequenceNumber,summaryTime:Date.now(),summarySequenceNumber:t.value.summaryOp.sequenceNumber})})()}lockedRefreshSummaryAckAction(e){var t=this;return(0,l.Z)(function*(){S(void 0===t.refreshSummaryAckLock,"Refresh Summary Ack - Caller is responsible for checking lock");const n=new jt;return t.refreshSummaryAckLock=n.promise,e().finally(()=>{n.resolve(),t.refreshSummaryAckLock=void 0})})()}lockedSummaryAction(e){var t=this;return(0,l.Z)(function*(){S(void 0===t.summarizingLock,603);const n=new jt;return t.summarizingLock=n.promise,t.summarizeCount++,yield t.refreshSummaryAckLock,e().finally(()=>{var i;n.resolve(),t.summarizingLock=void 0;const o=t.tryWhileSummarizing;t.tryWhileSummarizing=!1,!t.stopping&&!t.tryRunEnqueuedSummary()&&o&&(null===(i=t.heuristicRunner)||void 0===i||i.run())})})()}trySummarizeOnce(e,t,n=this.cancellationToken,i=new en){var o=this;return this.lockedSummaryAction((0,l.Z)(function*(){return o.generator.summarize(e,t,n,i).receivedSummaryAckOrNack})).catch(h=>{}),i.build()}trySummarize(e,t=this.cancellationToken){var n=this;void 0===this.summarizingLock?this.lockedSummaryAction((0,l.Z)(function*(){const i=[{refreshLatestAck:!1,fullTree:!1},{refreshLatestAck:!0,fullTree:!1},{refreshLatestAck:!0,fullTree:!1,delaySeconds:120},{refreshLatestAck:!0,fullTree:!0,delaySeconds:600}];let o,D,h=0,w=0;for(let _=0;_<i.length;){if(n.cancellationToken.cancelled||++h>1&&"lastSummary"===e)return;w++;const U=i[_],{delaySeconds:Q=0}=U,Y=Hi(U,["delaySeconds"]),ye=o??Q,Fe=Object.assign({reason:e,summaryAttempts:h,summaryAttemptsPerPhase:w,summaryAttemptPhase:_+1},Y);ye>0&&(n.logger.sendPerformanceEvent(Object.assign({eventName:"SummarizeAttemptDelay",duration:ye,summaryNackDelay:void 0!==o},Fe)),yield ms(1e3*ye)),yield n.refreshSummaryAckLock;const Ee=yield n.generator.summarize(Fe,Y,t).receivedSummaryAckOrNack;if(Ee.success)return;o=Ee.retryAfterSeconds,(void 0===o||w>1)&&(_++,w=0),D=Ee}n.logger.sendErrorEvent({eventName:"FailToSummarize",reason:e,message:D?.message},D?.error),n.stopSummarizerCallback("failToSummarize")})).catch(i=>{this.logger.sendErrorEvent({eventName:"UnexpectedSummarizeError"},i)}):this.tryWhileSummarizing=!0}summarizeOnDemand(e=new en,t){var{reason:n}=t,i=Hi(t,["reason"]);if(this.stopping)return e.fail("RunningSummarizer stopped or disposed",void 0),e.build();if(void 0!==this.summarizingLock)throw new wt("Attempted to run an already-running summarizer on demand");return this.trySummarizeOnce({reason:`onDemand/${n}`},i,this.cancellationToken,e)}enqueueSummarize(e){var{reason:t,afterSequenceNumber:n=0,override:i=!1}=e,o=Hi(e,["reason","afterSequenceNumber","override"]);const h=`enqueue;${t}`;let w=!1;if(void 0!==this.enqueuedSummary){if(!i)return{alreadyEnqueued:!0};this.enqueuedSummary.resultsBuilder.fail("Aborted; overridden by another enqueue summarize attempt",void 0),this.enqueuedSummary=void 0,w=!0}this.enqueuedSummary={reason:h,afterSequenceNumber:n,options:o,resultsBuilder:new en};const D=this.enqueuedSummary.resultsBuilder.build();return this.tryRunEnqueuedSummary(),w?Object.assign(Object.assign({},D),{alreadyEnqueued:!0,overridden:!0}):D}tryRunEnqueuedSummary(){if(this.stopping)return this.disposeEnqueuedSummary(),!1;if(void 0===this.enqueuedSummary||this.heuristicData.lastOpSequenceNumber<this.enqueuedSummary.afterSequenceNumber||void 0!==this.summarizingLock)return!1;const{reason:e,resultsBuilder:t,options:n}=this.enqueuedSummary;return this.enqueuedSummary=void 0,this.trySummarizeOnce({reason:`enqueuedSummary/${e}`},n,this.cancellationToken,t),!0}disposeEnqueuedSummary(){void 0!==this.enqueuedSummary&&(this.enqueuedSummary.resultsBuilder.fail("RunningSummarizer stopped or disposed",void 0),this.enqueuedSummary=void 0)}}class Lt extends bt{constructor(e,t=!1){super(e),this.logged=t,this.errorType="summarizingError",this.canRetry=!0}static wrap(e,t=!1,n){return Gn(e,o=>new Lt(o,t),n)}}class mr extends at.EventEmitter{constructor(e,t,n,i,o,h,w){var D;super(),D=this,this.runtime=t,this.configurationGetter=n,this.internalsProvider=i,this.summaryCollection=h,this.runCoordinatorCreateFn=w,this._disposed=!1,this.starting=!1,this.stopDeferred=new jt,this.summarizeOnDemand=(..._)=>{var U;try{if(this._disposed||null!==(U=this.runningSummarizer)&&void 0!==U&&U.disposed)throw new wt("Summarizer is already disposed.");if(void 0!==this.runtime.summarizerClientId&&this.runtime.summarizerClientId!==this.runtime.clientId)throw new wt("On-demand summary attempted while an elected summarizer is present");const Q=new en;return this.runningSummarizer?this.runningSummarizer.summarizeOnDemand(Q,..._):(this.runCoordinatorCreateFn(this.runtime).then(ye=>{this.start(this.runtime.clientId,ye).then(function(){var De=(0,l.Z)(function*(Ee){Ee.summarizeOnDemand(Q,..._);const ke=yield Promise.race([D.stopDeferred.promise,ye.waitCancelled]);yield Ee.waitStop(!1),ye.stop(ke),D.close()});return function(Ee){return De.apply(this,arguments)}}()).catch(De=>{Q.fail("Failed to start summarizer",De)})}).catch(ye=>{Q.fail("Failed to create cancellation token",ye)}),Q.build())}catch(Q){throw Lt.wrap(Q,!1,this.logger)}},this.enqueueSummarize=(..._)=>{if(this._disposed||void 0===this.runningSummarizer||this.runningSummarizer.disposed)throw new wt("Summarizer is not running or already disposed.");return this.runningSummarizer.enqueueSummarize(..._)},this.logger=rt.create(this.runtime.logger,"Summarizer"),this.innerHandle=new wa(this,e,o)}get IFluidLoadable(){return this}get ISummarizer(){return this}get handle(){return this.innerHandle}static create(e,t){return(0,l.Z)(function*(){const n={headers:{[Mt.cache]:!1,[Mt.clientDetails]:{capabilities:{interactive:!1},type:vn},[fr.summarizingClient]:!0,[Mt.reconnect]:!1},url:t},i=yield e.resolve(n),o=yield jr(i,{url:"_summarizer"});if(void 0===o.ISummarizer)throw new wt("Fluid object does not implement ISummarizer");return o.ISummarizer})()}run(e){var t=this;return(0,l.Z)(function*(){try{return yield t.runCore(e)}catch(n){throw t.stop("summarizerException"),Lt.wrap(n,!1,t.logger)}finally{t.close()}})()}stop(e){this.stopDeferred.resolve(e)}close(){this.dispose(),this.runtime.closeFn()}runCore(e){var t=this;return(0,l.Z)(function*(){const n=yield t.runCoordinatorCreateFn(t.runtime),i=Promise.race([n.waitCancelled,t.stopDeferred.promise]);if(i.then(w=>{t.logger.sendTelemetryEvent({eventName:"StoppingSummarizer",onBehalfOf:e,reason:w})}),n.cancelled)return n.waitCancelled;const o=yield t.start(e,n),h=yield i;return yield o.waitStop(!n.cancelled&&mr.stopReasonCanRunLastSummary(h)),n.stop(h),h})()}static stopReasonCanRunLastSummary(e){return"parentNotConnected"===e}start(e,t){var n=this;return(0,l.Z)(function*(){if(n.runningSummarizer){if(n.runningSummarizer.disposed)throw new wt("Starting a disposed summarizer");return n.runningSummarizer}if(n.starting)throw new wt("Attempting to start a summarizer that is already starting");n.starting=!0,n.logger.sendTelemetryEvent({eventName:"RunningSummarizer",onBehalfOf:e,initSummarySeqNumber:n.runtime.deltaManager.initialSequenceNumber,config:JSON.stringify(n.configurationGetter())});const i=n.runtime.clientId;if(void 0===i)throw new wt("clientId should be defined if connected.");const o=yield ir.start(n.logger,n.summaryCollection.createWatcher(i),n.configurationGetter(),(0,l.Z)(function*(...h){return n.internalsProvider.submitSummary(...h)}),new Ca(n.runtime.deltaManager.lastSequenceNumber,{refSequenceNumber:n.runtime.deltaManager.initialSequenceNumber,summaryTime:Date.now()}),h=>{n._disposed||n.logger.sendErrorEvent({eventName:"summarizingError"},((u,e)=>new Lt(u,!0))(h))},n.summaryCollection,t,h=>t.stop(h));return n.runningSummarizer=o,n.starting=!1,n.handleSummaryAcks().catch(h=>{n.logger.sendErrorEvent({eventName:"HandleSummaryAckFatalError"},h)}),n.systemOpListener=h=>o.handleSystemOp(h),n.runtime.deltaManager.inbound.on("op",n.systemOpListener),n.opListener=(h,w)=>o.handleOp(h,w),n.runtime.on("batchEnd",n.opListener),o})()}dispose(){this.stop("summarizerClientDisconnected"),this._disposed=!0,this.runningSummarizer&&(this.runningSummarizer.dispose(),this.runningSummarizer=void 0),this.systemOpListener&&this.runtime.deltaManager.inbound.off("op",this.systemOpListener),this.opListener&&this.runtime.removeListener("batchEnd",this.opListener)}handleSummaryAcks(){var e=this;return(0,l.Z)(function*(){var t,n,i,o,h;let D,w=e.runtime.deltaManager.initialSequenceNumber;for(;e.runningSummarizer;){const _=null!==(t=e.runningSummarizer.tryGetCorrelatedLogger(w))&&void 0!==t?t:e.logger;try{D=void 0,D=yield e.summaryCollection.waitSummaryAck(w),w=D.summaryOp.referenceSequenceNumber;const U=D.summaryOp.contents.handle,Q=D.summaryAck.contents.handle;yield e.runningSummarizer.lockedRefreshSummaryAckAction((0,l.Z)(function*(){return e.internalsProvider.refreshLatestSummaryAck(U,Q,w,_).catch(function(){var Y=(0,l.Z)(function*(ye){if(!$t(ye)||ye.errorType!==Dn.fileNotFoundOrAccessDeniedError)throw ye;_.sendTelemetryEvent({eventName:"HandleSummaryAckErrorIgnored",referenceSequenceNumber:w,proposalHandle:U,ackHandle:Q},ye)});return function(ye){return Y.apply(this,arguments)}}())}))}catch(U){_.sendErrorEvent({eventName:"HandleSummaryAckError",referenceSequenceNumber:w,handle:null===(i=null===(n=D?.summaryOp)||void 0===n?void 0:n.contents)||void 0===i?void 0:i.handle,ackHandle:null===(h=null===(o=D?.summaryAck)||void 0===o?void 0:o.contents)||void 0===h?void 0:h.handle},U)}w++}})()}}var Jt=(()=>{return(u=Jt||(Jt={}))[u.Off=0]="Off",u[u.Starting=1]="Starting",u[u.Running=2]="Running",u[u.Stopping=3]="Stopping",Jt;var u})();let zr=(()=>{class u{constructor(t,n,i,o,h,w,{initialDelayMs:D=5e3,opsToBypassInitialDelay:_=4e3}={},U){this.clientElection=t,this.connectedState=n,this.summaryCollection=i,this.requestSummarizerFn=h,this.startThrottler=w,this.disableHeuristics=U,this.state=Jt.Off,this._disposed=!1,this.handleConnected=Q=>{this.latestClientId=Q,this.refreshSummarizer()},this.handleDisconnected=()=>{this.refreshSummarizer()},this.refreshSummarizer=()=>{const Q=this.getShouldSummarizeState();switch(this.state){case Jt.Off:return void(Q.shouldSummarize&&this.startSummarization());case Jt.Starting:return;case Jt.Running:return void(!1===Q.shouldSummarize&&this.stop(Q.stopReason));default:return}},this.summarizeOnDemand=(...Q)=>{if(void 0===this.summarizer)throw Error("No running summarizer client");return this.summarizer.summarizeOnDemand(...Q)},this.enqueueSummarize=(...Q)=>{if(void 0===this.summarizer)throw Error("No running summarizer client");return this.summarizer.enqueueSummarize(...Q)},this.logger=rt.create(o,"SummaryManager",{all:{clientId:()=>this.latestClientId}}),this.connectedState.on("connected",this.handleConnected),this.connectedState.on("disconnected",this.handleDisconnected),this.latestClientId=this.connectedState.clientId,this.opsToBypassInitialDelay=_,this.initialDelayMs=D}get disposed(){return this._disposed}get currentState(){return this.state}start(){this.clientElection.on("electedSummarizerChanged",this.refreshSummarizer),this.refreshSummarizer()}getShouldSummarizeState(){return this.connectedState.clientId!==this.clientElection.electedParentId||this.state!==Jt.Running&&this.connectedState.clientId!==this.clientElection.electedClientId?{shouldSummarize:!1,stopReason:"parentShouldNotSummarize"}:this.connectedState.connected?this.disposed?void S(!1,608):{shouldSummarize:!0}:{shouldSummarize:!1,stopReason:"parentNotConnected"}}startSummarization(){var t=this;S(this.state===Jt.Off,609),this.state=Jt.Starting,S(void 0===this.summarizer,610),this.delayBeforeCreatingSummarizer().then(function(){var n=(0,l.Z)(function*(i){if(i&&!1===t.getShouldSummarizeState().shouldSummarize)return"early exit";S(t.state===Jt.Starting,611),t.state=Jt.Running;const o=yield t.requestSummarizerFn();t.summarizer=o;const h=t.getShouldSummarizeState();if(!1===h.shouldSummarize)return t.state=Jt.Starting,o.stop(h.stopReason),"early exit after starting summarizer";const w=t.latestClientId;return it.timedExecAsync(t.logger,{eventName:"RunningSummarizer",attempt:t.startThrottler.numAttempts},(0,l.Z)(function*(){return o.run(w,t.disableHeuristics)}))});return function(i){return n.apply(this,arguments)}}()).then(n=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:n})}).catch(n=>{this.logger.sendTelemetryEvent({eventName:"EndingSummarizer",reason:"exception"},n),(this.getShouldSummarizeState().shouldSummarize||void 0!==this.summarizer)&&this.logger.sendTelemetryEvent({eventName:"SummarizerException",category:n?.errorType===Dn.offlineError?"generic":"error"},n)}).finally(()=>{var n;S(this.state!==Jt.Off,612),this.state=Jt.Off,null===(n=this.summarizer)||void 0===n||n.close(),this.summarizer=void 0,this.getShouldSummarizeState().shouldSummarize&&this.startSummarization()})}stop(t){var n;u.isStartingOrRunning(this.state)&&(this.state=Jt.Stopping,null===(n=this.summarizer)||void 0===n||n.stop(t))}delayBeforeCreatingSummarizer(){var t=this;return(0,l.Z)(function*(){let n=t.startThrottler.getDelay();t.logger.sendTelemetryEvent({eventName:"CreatingSummarizer",throttlerDelay:n,initialDelay:t.initialDelayMs,startThrottlerMaxDelayMs:t.startThrottler.maxDelayMs,opsSinceLastAck:t.summaryCollection.opsSinceLastAck,opsToBypassInitialDelay:t.opsToBypassInitialDelay});let i=!1;if(t.summaryCollection.opsSinceLastAck<t.opsToBypassInitialDelay&&(i=!0,n=Math.max(n,t.initialDelayMs)),n>0){let o,h;const w=()=>{t.summaryCollection.opsSinceLastAck>=t.opsToBypassInitialDelay&&(clearTimeout(o),h())},D=new Promise(U=>{o=setTimeout(()=>U(),n)}),_=new Promise(U=>{h=U});t.summaryCollection.addOpListener(w),yield Promise.race([D,_]),t.summaryCollection.removeOpListener(w)}return i})()}dispose(){this.clientElection.off("electedSummarizerChanged",this.refreshSummarizer),this.connectedState.off("connected",this.handleConnected),this.connectedState.off("disconnected",this.handleDisconnected),this._disposed=!0}}return u.isStartingOrRunning=e=>e===Jt.Starting||e===Jt.Running,u})(),mt=(()=>{class u{constructor(t,n){this.logger=n,this.processingTimeIncrement=10,this.currentAllowedProcessingTimeForTurn=u.processingTime,this.schedulingCount=0,this.deltaManager=t,this.deltaManager.inbound.on("idle",()=>{this.inboundQueueIdle()})}batchBegin(t){this.processingStartTime||(this.processingStartTime=Re.now()),void 0===this.schedulingLog&&this.schedulingCount%500==0&&(this.schedulingLog={opsRemainingToProcess:0,numberOfTurns:1,totalProcessingTime:0,numberOfBatchesProcessed:0,firstSequenceNumber:t.sequenceNumber,lastSequenceNumber:t.sequenceNumber,startTime:Re.now()})}batchEnd(t){if(this.schedulingLog&&(this.schedulingLog.numberOfBatchesProcessed++,this.schedulingLog.lastSequenceNumber=t.sequenceNumber,this.schedulingLog.opsRemainingToProcess=this.deltaManager.inbound.length),this.shouldRunScheduler()){const n=Re.now(),i=n-this.processingStartTime;i>this.currentAllowedProcessingTimeForTurn&&(this.deltaManager.inbound.pause(),this.currentAllowedProcessingTimeForTurn+=this.processingTimeIncrement,this.schedulingLog&&(this.schedulingLog.numberOfTurns++,this.schedulingLog.totalProcessingTime+=i),setTimeout(()=>{this.schedulingLog&&this.logger.sendTelemetryEvent({eventName:"InboundOpsPartialProcessingTime",duration:Xt.formatTick(i),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,opsRemainingToProcess:this.deltaManager.inbound.length,processingTime:Xt.formatTick(this.schedulingLog.totalProcessingTime),numberOfTurns:this.schedulingLog.numberOfTurns,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,timeToResume:Xt.formatTick(Re.now()-n)}),this.deltaManager.inbound.resume()}),this.processingStartTime=void 0)}}inboundQueueIdle(){if(this.schedulingLog){const t=Re.now();this.schedulingLog.totalProcessingTime+=t-this.processingStartTime,this.logger.sendTelemetryEvent({eventName:"InboundOpsProcessingTime",opsRemainingToProcess:this.schedulingLog.opsRemainingToProcess,numberOfTurns:this.schedulingLog.numberOfTurns,processingTime:Xt.formatTick(this.schedulingLog.totalProcessingTime),opsProcessed:this.schedulingLog.lastSequenceNumber-this.schedulingLog.firstSequenceNumber+1,batchesProcessed:this.schedulingLog.numberOfBatchesProcessed,duration:Xt.formatTick(t-this.schedulingLog.startTime),schedulingCount:this.schedulingCount}),this.schedulingLog=void 0}this.schedulingCount++,this.processingStartTime=void 0,this.currentAllowedProcessingTimeForTurn=u.processingTime}shouldRunScheduler(){return this.deltaManager.inbound.length>0}}return u.processingTime=50,u})();class Ho{constructor(e,t,n){this.clientId=e,this.deltaManager=t,this.pongCount=0,this.msnTrackingTimestamp=0,this.opProcessingTimes={},this.opPerfData={},this.firstConnection=!0,this.bootTime=Re.now(),this.connectionStartTime=0,this.gap=0,this.logger=rt.create(n,"OpPerf"),this.deltaManager.on("pong",i=>this.recordPingTime(i)),this.deltaManager.on("submitOp",i=>this.beforeOpSubmit(i)),this.deltaManager.on("op",i=>this.afterProcessingOp(i)),this.deltaManager.on("connect",(i,o)=>{this.clientId=i.clientId,void 0!==o&&(this.connectionOpSeqNumber=this.deltaManager.lastKnownSeqNumber,this.gap=o,this.connectionStartTime=Re.now(),this.gap<=0&&this.reportGettingUpToDate())}),this.deltaManager.on("disconnect",()=>{this.sequenceNumberForMsnTracking=void 0,this.clientSequenceNumberForLatencyStatistics=void 0,this.opProcessingTimes={},this.opPerfData={},this.connectionOpSeqNumber=void 0,this.firstConnection=!1,this.pongCount=0}),this.deltaManager.outbound.on("push",i=>{for(const o of i)o.type===E.Operation&&this.clientSequenceNumberForLatencyStatistics===o.clientSequenceNumber&&(S(void 0===this.opProcessingTimes.outboundPushEventTime,712),S(void 0===this.opPerfData.durationNetwork,713),this.opProcessingTimes.outboundPushEventTime=Date.now(),S(void 0===this.opPerfData.durationOutboundBatching,714),S(void 0!==this.opProcessingTimes.submitOpEventTime,715),this.opPerfData.durationOutboundBatching=this.opProcessingTimes.outboundPushEventTime-this.opProcessingTimes.submitOpEventTime)}),this.deltaManager.inbound.on("push",i=>{this.clientId===i.clientId&&i.type===E.Operation&&this.clientSequenceNumberForLatencyStatistics===i.clientSequenceNumber&&void 0!==this.opProcessingTimes.outboundPushEventTime&&(this.opProcessingTimes.inboundPushEventTime=Date.now(),this.opPerfData.durationNetwork=this.opProcessingTimes.inboundPushEventTime-this.opProcessingTimes.outboundPushEventTime,this.opProcessingTimes.outboundPushEventTime=void 0,this.opPerfData.lengthInboundQueue=this.deltaManager.inbound.length)}),this.deltaManager.inbound.on("idle",(i,o)=>{"number"==typeof i&&i>=100&&this.logger.sendPerformanceEvent({eventName:"GetDeltas_OpProcessing",count:i,duration:o})})}reportGettingUpToDate(){this.connectionOpSeqNumber=void 0,this.logger.sendPerformanceEvent({eventName:"ConnectionSpeed",duration:Re.now()-this.connectionStartTime,ops:this.gap,timeToConnect:this.firstConnection?Xt.formatTick(this.connectionStartTime-this.bootTime):void 0,firstConnection:this.firstConnection})}recordPingTime(e){this.pingLatency=e,this.pongCount%100==0&&this.deltaManager.active&&this.logger.sendPerformanceEvent({eventName:"DeltaLatency",duration:e}),this.pongCount++}beforeOpSubmit(e){void 0===this.clientSequenceNumberForLatencyStatistics&&e.clientSequenceNumber%500==1&&(S(void 0===this.opProcessingTimes.outboundPushEventTime,716),S(void 0===this.opPerfData.durationNetwork,717),this.opProcessingTimes.submitOpEventTime=Date.now(),this.clientSequenceNumberForLatencyStatistics=e.clientSequenceNumber)}afterProcessingOp(e){const t=e.sequenceNumber;if(t===this.connectionOpSeqNumber&&this.reportGettingUpToDate(),void 0===this.sequenceNumberForMsnTracking&&t%1e3==0&&(this.sequenceNumberForMsnTracking=t,this.msnTrackingTimestamp=e.timestamp),void 0!==this.sequenceNumberForMsnTracking&&e.minimumSequenceNumber>=this.sequenceNumberForMsnTracking&&(S(void 0!==this.msnTrackingTimestamp,718),this.logger.sendPerformanceEvent({eventName:"MsnStatistics",sequenceNumber:t,msnDistance:t-this.sequenceNumberForMsnTracking,duration:e.timestamp-this.msnTrackingTimestamp}),this.sequenceNumberForMsnTracking=void 0),this.clientId===e.clientId&&this.clientSequenceNumberForLatencyStatistics===e.clientSequenceNumber){S(void 0!==this.opProcessingTimes.submitOpEventTime,288);const n=Date.now();void 0!==this.opProcessingTimes.inboundPushEventTime&&(this.opPerfData.durationInboundToProcessing=n-this.opProcessingTimes.inboundPushEventTime);const i=n-this.opProcessingTimes.submitOpEventTime;this.logger.sendPerformanceEvent(Object.assign({eventName:"OpRoundtripTime",sequenceNumber:t,referenceSequenceNumber:e.referenceSequenceNumber,duration:i,category:i>5e3?"error":"performance",pingLatency:this.pingLatency,msnDistance:this.deltaManager.lastSequenceNumber-this.deltaManager.minimumSequenceNumber},this.opPerfData)),this.clientSequenceNumberForLatencyStatistics=void 0,this.opPerfData={}}}}var Ia=v(2429),tn=v.n(Ia);class Rn{constructor(e,t,n){var i;this.stateHandler=e,this.pendingStates=new(tn()),this.disposeOnce=new tt(()=>{this.initialStates.clear(),this.pendingStates.clear()}),this._pendingMessagesCount=0,this.isProcessingBatch=!1,this.dispose=()=>this.disposeOnce.value,this.initialStates=new(tn())(null!==(i=n?.pendingStates)&&void 0!==i?i:[]),this.flushModeForNextMessage=t,this.onFlushModeUpdated(t)}get pendingMessagesCount(){return this._pendingMessagesCount}hasPendingMessages(){return 0!==this._pendingMessagesCount||!this.initialStates.isEmpty()}getLocalState(){if(S(this.initialStates.isEmpty(),745),this.hasPendingMessages())return{pendingStates:this.pendingStates.toArray().map(e=>"message"===e.type?Object.assign(Object.assign({},e),{localOpMetadata:void 0}):e)}}get disposed(){return this.disposeOnce.evaluated}onSubmitMessage(e,t,n,i,o,h){this.pendingStates.push({type:"message",messageType:e,clientSequenceNumber:t,referenceSequenceNumber:n,content:i,localOpMetadata:o,opMetadata:h}),this._pendingMessagesCount++}onFlushModeUpdated(e){this.pendingStates.push({type:"flushMode",flushMode:e})}onFlush(){this.stateHandler.flushMode()!==be.FlushMode.Immediate&&"message"===this.pendingStates.peekBack()?.type&&this.pendingStates.push({type:"flush"})}applyStashedOpsAt(e){var t=this;return(0,l.Z)(function*(){for(;!t.initialStates.isEmpty();){const n=t.initialStates.peekFront();if("message"===n.type){if(void 0!==e){if(n.referenceSequenceNumber>e)break;if(n.referenceSequenceNumber<e)throw new Error("loaded from snapshot too recent to apply stashed ops")}const i=yield t.stateHandler.applyStashedOp(n.messageType,n.content);n.localOpMetadata=i}t.pendingStates.push(t.initialStates.shift())}})()}processPendingLocalMessage(e){this.maybeProcessBatchBegin(e);const t=this.peekNextPendingState();if(S("message"===t.type,361),this.pendingStates.shift(),t.clientSequenceNumber===e.clientSequenceNumber)return this._pendingMessagesCount--,this.maybeProcessBatchEnd(e),t.localOpMetadata;{const n=Cn.create("pending local message clientSequenceNumber mismatch","unexpectedAckReceived",e,{expectedClientSequenceNumber:t.clientSequenceNumber});this.stateHandler.close(n)}}maybeProcessBatchBegin(e){let t,n=!1,i=this.peekNextPendingState();for(;"message"!==i.type;)"flushMode"===i.type&&(t=i.flushMode),"flush"===i.type&&(n=!0),this.pendingStates.shift(),i=this.peekNextPendingState();void 0!==t&&(this.flushModeForNextMessage=t),t!==be.FlushMode.Immediate&&(t===be.FlushMode.TurnBased||n)&&(S(!this.isProcessingBatch&&void 0===this.pendingBatchBeginMessage,363),this.pendingBatchBeginMessage=e,this.isProcessingBatch=!0)}maybeProcessBatchEnd(e){var t,n;if(!this.isProcessingBatch)return;const i=this.peekNextPendingState();if("message"===i.type)return;S("flushMode"!==i.type,701),S(void 0!==this.pendingBatchBeginMessage,365);const o=null===(t=this.pendingBatchBeginMessage.metadata)||void 0===t?void 0:t.batch;if(this.pendingBatchBeginMessage===e)S(void 0===o,366);else{const h=null===(n=e.metadata)||void 0===n?void 0:n.batch;S(!0===o,367),S(!1===h,368)}this.pendingBatchBeginMessage=void 0,this.isProcessingBatch=!1}checkpoint(){const e=this.pendingStates.peekBack();return{rollback:()=>{try{for(;this.pendingStates.peekBack()!==e;)this.rollbackNextPendingState()}catch(t){const n=hr(t,i=>Cn.create(`RollbackError: ${i}`,"checkpointRollback",void 0));throw this.stateHandler.close(n),n}}}}peekNextPendingState(){const e=this.pendingStates.peekFront();return S(!!e,369),e}rollbackNextPendingState(){if(0===this.pendingStates.length)return;this._pendingMessagesCount--;const t=this.pendingStates.pop();if("message"!==t.type)throw new Error(`Can't rollback state ${t.type}`);this.stateHandler.rollback(t.messageType,t.content,t.localOpMetadata)}replayPendingStates(){S(this.stateHandler.connected(),370),S(this.clientId!==this.stateHandler.clientId(),371),this.clientId=this.stateHandler.clientId(),S(this.initialStates.isEmpty(),372);let e=this.pendingStates.length;if(0===e)return;this._pendingMessagesCount=0;const t=this.stateHandler.flushMode();for(this.stateHandler.setFlushMode(this.flushModeForNextMessage);e>0;){const n=this.pendingStates.shift();switch(n.type){case"message":this.stateHandler.reSubmit(n.messageType,n.content,n.localOpMetadata,n.opMetadata);break;case"flushMode":this.stateHandler.setFlushMode(n.flushMode);break;case"flush":this.stateHandler.flush()}e--}this.stateHandler.setFlushMode(t)}}const oi="1.3.6";class Vr{constructor(e,t,n){this.path=e,this.routeContext=t,this.get=n,this.attached=!1,this.absolutePath=Rr(e,this.routeContext)}get IFluidHandle(){return this}get isAttached(){return this.attached}attachGraph(){this.attached=!0}bind(e){throw new Error("Cannot bind to blob handle")}}let Ar=(()=>{class u{constructor(t,n,i,o,h,w,D){this.routeContext=t,this.getStorage=i,this.attachBlobCallback=o,this.gcNodeUpdated=h,this.runtime=w,this.logger=D,this.blobIds=new Set,this.pendingBlobIds=new Map,this.detachedBlobIds=new Set,this.runtime.once("dispose",()=>{for(const _ of this.pendingBlobIds.values())_.reject(new Error("runtime disposed while blobAttach op in flight"))}),this.load(n)}hasBlob(t){return this.blobIds.has(t)||this.detachedBlobIds.has(t)}getBlobGCNodePath(t){return`/${u.basePath}/${t}`}getBlob(t){var n=this;return(0,l.Z)(function*(){var i,o;const h=null!==(o=null===(i=n.redirectTable)||void 0===i?void 0:i.get(t))&&void 0!==o?o:t;return S(n.hasBlob(h),287),n.gcNodeUpdated(n.getBlobGCNodePath(t)),new Vr(`${u.basePath}/${h}`,n.routeContext,(0,l.Z)(function*(){return it.timedExecAsync(n.logger,{eventName:"AttachmentReadBlob",id:h},(0,l.Z)(function*(){return n.getStorage().readBlob(h)}),{end:!0,cancel:"error"})}))})()}createBlob(t){var n=this;return(0,l.Z)(function*(){var i,o;n.runtime.attachState===we.Attaching&&(n.logger.sendTelemetryEvent({eventName:"CreateBlobWhileAttaching"}),yield new Promise(D=>n.runtime.once("attached",D))),!n.runtime.connected&&n.runtime.attachState===we.Attached&&(yield new Promise(D=>n.runtime.once("connected",D)));const h=yield it.timedExecAsync(n.logger,{eventName:"createBlob"},(0,l.Z)(function*(){return n.getStorage().createBlob(t)}),{end:!0,cancel:"error"}),w=new Vr(`${u.basePath}/${h.id}`,n.routeContext,(0,l.Z)(function*(){return n.getBlob(h.id).then(function(){var D=(0,l.Z)(function*(_){return _.get()});return function(_){return D.apply(this,arguments)}}())}));return n.runtime.attachState===we.Detached?(n.detachedBlobIds.add(h.id),w):(n.pendingBlobIds.has(h.id)?yield null===(i=n.pendingBlobIds.get(h.id))||void 0===i?void 0:i.promise:n.blobIds.has(h.id)||(n.pendingBlobIds.set(h.id,new jt),n.attachBlobCallback(h.id),yield null===(o=n.pendingBlobIds.get(h.id))||void 0===o?void 0:o.promise),w)})()}processBlobAttachOp(t,n){if(n){const i=this.pendingBlobIds.get(t);S(void 0!==i,504),i.resolve(),this.pendingBlobIds.delete(t)}this.blobIds.add(t)}static load(t,n){var i=this;return(0,l.Z)(function*(){if(!t)return{};let o;const h=t.blobs[i.redirectTableBlobName];return h&&(o=yield n(h)),{ids:Object.entries(t.blobs).filter(([D,_])=>D!==i.redirectTableBlobName).map(([D,_])=>_),redirectTable:o}})()}load(t){var n,i,o;if(t.ids){const h=this.runtime.attachState===we.Detached;t.ids.map(w=>h?this.detachedBlobIds.add(w):this.blobIds.add(w))}t.redirectTable&&(this.redirectTable=new Map(t.redirectTable)),this.logger.sendTelemetryEvent({eventName:"AttachmentBlobsLoaded",count:null!==(i=null===(n=t.ids)||void 0===n?void 0:n.length)&&void 0!==i?i:0,redirectTable:null===(o=t.redirectTable)||void 0===o?void 0:o.length})}getGCData(t=!1){const n={gcNodes:{}};if(this.blobIds.forEach(i=>{n.gcNodes[this.getBlobGCNodePath(i)]=[]}),void 0!==this.redirectTable)for(const[i,o]of this.redirectTable)n.gcNodes[this.getBlobGCNodePath(i)]=[this.getBlobGCNodePath(o)];return n}deleteUnusedRoutes(t){var n;for(const i of t){const o=i.split("/");S(3===o.length&&o[1]===u.basePath,725);const h=o[2];null!==(n=this.redirectTable)&&void 0!==n&&n.has(h)?this.redirectTable.delete(h):this.blobIds.delete(h)}}summarize(t){const i=this.redirectTable||this.runtime.attachState!==we.Detached?this.blobIds:this.detachedBlobIds,o=new Mn;return i.forEach(h=>{o.addAttachment(h)}),this.redirectTable&&this.redirectTable.size>0&&o.addBlob(u.redirectTableBlobName,JSON.stringify(Array.from(this.redirectTable.entries()))),o.getSummaryTree()}setRedirectTable(t){S(this.runtime.attachState===we.Detached,594),S(!this.redirectTable,595);for(const[n,i]of t)S(this.detachedBlobIds.delete(n),596),this.blobIds.add(i);S(0===this.detachedBlobIds.size,597),this.redirectTable=t}}return u.basePath="_blobs",u.redirectTableBlobName=".redirectTable",u})();function ws(u,e,t){const n=[];for(const i of e){const o=`${u}${i.path}`;if(i.type===sn.Blob){const h=i.value,w=X(h.contents,h.encoding),D=Pe();t.set(D,w),n.push({mode:_n[i.mode],path:o,sha:D,size:0,type:"blob",url:""})}else if(i.type===sn.Tree){S(i.type===sn.Tree,257);const h=i.value;n.push({mode:_n[i.mode],path:o,sha:"",size:-1,type:"tree",url:""});const D=ws(`${o}/`,h.entries,t);n.push(...D)}}return n}function Ht(u,e){const t=function nn(u,e){return{sha:"",tree:ws("",u,e),url:""}}(u,e);return Pi(t)}class qi{constructor(e){this.internalStorageService=e}set policies(e){this._policies=e}get policies(){var e;return null!==(e=this._policies)&&void 0!==e?e:this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}getSnapshotTree(e,t){var n=this;return(0,l.Z)(function*(){return n.internalStorageService.getSnapshotTree(e,t)})()}getVersions(e,t,n){var i=this;return(0,l.Z)(function*(){return i.internalStorageService.getVersions(e,t,n)})()}uploadSummaryWithContext(e,t){var n=this;return(0,l.Z)(function*(){return n.internalStorageService.uploadSummaryWithContext(e,t)})()}downloadSummary(e){var t=this;return(0,l.Z)(function*(){return t.internalStorageService.downloadSummary(e)})()}createBlob(e){var t=this;return(0,l.Z)(function*(){return t.internalStorageService.createBlob(e)})()}readBlob(e){var t=this;return(0,l.Z)(function*(){return t.internalStorageService.readBlob(e)})()}}class Oa extends qi{constructor(e,t){super(e),this.blobs=t}get policies(){return this.internalStorageService.policies}readBlob(e){var t=this;return(0,l.Z)(function*(){const n=t.blobs.get(e);return void 0!==n?n:t.internalStorageService.readBlob(e)})()}}class _a{constructor(e){this.notBoundContexts=new Set,this._contexts=new Map,this.deferredContexts=new Map,this.disposeOnce=new tt(()=>{for(const[t,n]of this.deferredContexts)n.promise.then(i=>{i.dispose()}).catch(i=>{this._logger.sendErrorEvent({eventName:"FluidDataStoreContextDisposeError",fluidDataStoreId:t},i)})}),this.dispose=()=>this.disposeOnce.value,this._logger=rt.create(e)}[Symbol.iterator](){return this._contexts.entries()}get size(){return this._contexts.size}get disposed(){return this.disposeOnce.evaluated}notBoundLength(){return this.notBoundContexts.size}isNotBound(e){return this.notBoundContexts.has(e)}has(e){return this._contexts.has(e)}get(e){return this._contexts.get(e)}delete(e){return this.deferredContexts.delete(e),this.notBoundContexts.delete(e),this._contexts.delete(e)}getUnbound(e){if(void 0!==this._contexts.get(e)&&this.notBoundContexts.has(e))return this._contexts.get(e)}addUnbound(e){const t=e.id;S(!this._contexts.has(t),344),this._contexts.set(t,e),this.notBoundContexts.add(t),this.ensureDeferred(t)}getBoundOrRemoted(e,t){var n=this;return(0,l.Z)(function*(){const i=n.ensureDeferred(e);if(t||i.isCompleted)return i.promise})()}ensureDeferred(e){const t=this.deferredContexts.get(e);if(t)return t;const n=new jt;return this.deferredContexts.set(e,n),n}bind(e){S(this.notBoundContexts.delete(e),345),this.resolveDeferred(e)}resolveDeferred(e){const t=this._contexts.get(e);S(!!t,346),S(!this.notBoundContexts.has(e),347);const n=this.deferredContexts.get(e);S(!!n,348),n.resolve(t)}addBoundOrRemoted(e){const t=e.id;S(!this._contexts.has(t),349),this._contexts.set(t,e),this.ensureDeferred(t),this.resolveDeferred(t)}}class ui{constructor(e,t,n=e){this.threshold=e,this.logger=t,this.thresholdMultiple=n}send(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}sendIfMultiple(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=2*this.thresholdMultiple)}}function Cs(u,e){const t=new Set,n=[...e];for(const h of n){if(t.has(h))continue;t.add(h);const w=u[h];void 0!==w&&n.push(...w)}const i=[],o=[];for(const h of Object.keys(u))t.has(h)?i.push(h):o.push(h);return{referencedNodeIds:i,deletedNodeIds:o}}var Es=function(u,e){var t={};for(var n in u)Object.prototype.hasOwnProperty.call(u,n)&&e.indexOf(n)<0&&(t[n]=u[n]);if(null!=u&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(u);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(u,n[i])&&(t[n[i]]=u[n[i]])}return t};const sr="gc",zi="__gc";class fi{constructor(e,t,n,i){this.unreferencedTimestampMs=e,this.inactiveTimeoutMs=t,this.sweepTimeoutMs=n,this._state="Active",void 0!==i&&this.updateTracking(i)}get state(){return this._state}updateTracking(e){const t=e-this.unreferencedTimestampMs;if(void 0!==this.sweepTimeoutMs&&t>=this.sweepTimeoutMs)return this._state="SweepReady",void this.clearTimers();if(t>=this.inactiveTimeoutMs)return this._state="Inactive",this.clearTimers(),void(void 0!==this.sweepTimeoutMs&&vr(this.sweepTimeoutMs-t,()=>{this._state="SweepReady"},i=>{this.sweepTimer=i}));const n=this.inactiveTimeoutMs-t;if(void 0===this.inactiveTimer){const i=()=>{this._state="Inactive",void 0!==this.sweepTimeoutMs&&vr(this.sweepTimeoutMs-this.inactiveTimeoutMs,()=>{this._state="SweepReady"},o=>{this.sweepTimer=o})};this.inactiveTimer=new gr(n,()=>i())}this.inactiveTimer.restart(n)}clearTimers(){var e;null===(e=this.inactiveTimer)||void 0===e||e.clear(),void 0!==this.sweepTimer&&clearTimeout(this.sweepTimer)}stopTracking(){this.clearTimers(),this._state="Active"}}class Zr{constructor(e){var n,i,o,h,w,D,_,t=this;this._writeDataAtRoot=!0,this.initialStateNeedsReset=!1,this.currentGCVersion=1,this.newReferencesSinceLastRun=new Map,this.unreferencedNodesState=new Map,this.loggedUnreferencedEvents=new Set,this.pendingEventsQueue=[],this.completedRuns=0,this.runtime=e.runtime,this.isSummarizerClient=e.isSummarizerClient,this.gcOptions=e.gcOptions,this.getNodePackagePath=e.getNodePackagePath,this.getLastSummaryTimestampMs=e.getLastSummaryTimestampMs;const U=e.baseSnapshot,Q=e.metadata,Y=e.readAndParseBlob;let ye;if(this.mc=gt(rt.create(e.baseLogger,"GarbageCollector",{all:{completedGCRuns:()=>this.completedRuns}})),e.existing)ye=ja(Q),this.gcEnabled=ye>0,this.sweepEnabled=null!==(n=Q?.sweepEnabled)&&void 0!==n&&n,this.sessionExpiryTimeoutMs=Q?.sessionExpiryTimeoutMs;else{if(this.gcOptions.sweepAllowed&&!1===this.gcOptions.gcAllowed)throw new wt("GC sweep phase cannot be enabled without enabling GC mark phase");this.gcEnabled=!1!==this.gcOptions.gcAllowed,this.sweepEnabled=!0===this.gcOptions.sweepAllowed,this.mc.config.getBoolean("Fluid.GarbageCollection.RunSessionExpiry")&&this.gcEnabled&&(this.sessionExpiryTimeoutMs=2592e6)}if(void 0!==this.sessionExpiryTimeoutMs&&!0!==this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSessionExpiry")){const ke=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.SessionExpiryMs")??this.sessionExpiryTimeoutMs;vr(ke,()=>{this.runtime.closeFn(new ia("Client session expired.",ke))},ze=>{this.sessionExpiryTimer=ze}),void 0!==e.snapshotCacheExpiryMs&&(this.sweepTimeoutMs=this.sessionExpiryTimeoutMs+e.snapshotCacheExpiryMs+864e5)}if(this.latestSummaryGCVersion=ye??this.currentGCVersion,this.shouldRunGC=null!==(i=this.mc.config.getBoolean("Fluid.GarbageCollection.RunGC"))&&void 0!==i?i:this.gcEnabled&&!this.gcOptions.disableGC,this.shouldRunSweep=this.shouldRunGC&&void 0!==this.sweepTimeoutMs&&(null!==(o=this.mc.config.getBoolean("Fluid.GarbageCollection.RunSweep"))&&void 0!==o?o:this.sweepEnabled),this.trackGCState=!0===this.mc.config.getBoolean("Fluid.GarbageCollection.TrackGCState"),this.inactiveTimeoutMs=null!==(w=null!==(h=this.mc.config.getNumber("Fluid.GarbageCollection.TestOverride.InactiveTimeoutMs"))&&void 0!==h?h:this.gcOptions.inactiveTimeoutMs)&&void 0!==w?w:6048e5,void 0!==this.sweepTimeoutMs&&this.inactiveTimeoutMs>this.sweepTimeoutMs)throw new wt("inactive timeout should not be greated than the sweep timeout");this.testMode=null!==(D=this.mc.config.getBoolean("Fluid.GarbageCollection.GCTestMode"))&&void 0!==D?D:!0===this.gcOptions.runGCInTestMode,this._writeDataAtRoot=null===(_=this.mc.config.getBoolean("Fluid.GarbageCollection.WriteDataAtRoot"))||void 0===_||_,this._writeDataAtRoot&&(this.initialStateNeedsReset=void 0!==U?.trees[sr]!==this.shouldRunGC);const Fe=new Wn((0,l.Z)(function*(){var Ee;if(void 0===U)return;const ke=U.trees[sr];if(void 0!==ke){t._writeDataAtRoot=!0;const $e=yield Fs(ke,Y);return t.trackGCState&&(t.latestSerializedSummaryState=JSON.stringify(pi($e))),$e}const ze={gcNodes:{"/":{outboundRoutes:[]}}},We=P(U,Q);S(void 0!==We,680);for(const[$e,dt]of Object.entries(We.trees)){const Dt=dt.blobs[be.gcBlobKey];if(void 0===Dt)continue;const qt=yield Y(Dt);if(void 0===(null===(Ee=qt.gcData)||void 0===Ee?void 0:Ee.gcNodes))continue;const St=`/${$e}`;(yield Y(dt.blobs[yr])).isRootDataStore&&ze.gcNodes["/"].outboundRoutes.push(St);for(const[hn,dn]of Object.entries(qt.gcData.gcNodes))ze.gcNodes["/"===hn?St:`${St}${hn}`]={outboundRoutes:Array.from(dn)};S(void 0!==ze.gcNodes[St],681),ze.gcNodes[St].unreferencedTimestampMs=qt.unrefTimestamp}return 1===Object.keys(ze.gcNodes).length?void 0:ze}));this.initializeBaseStateP=new Wn((0,l.Z)(function*(){const Ee=t.runtime.getCurrentReferenceTimestampMs(),ke=yield Fe;if(void 0===ke)return;const ze={};for(const[We,$e]of Object.entries(ke.gcNodes))void 0!==$e.unreferencedTimestampMs&&t.unreferencedNodesState.set(We,new fi($e.unreferencedTimestampMs,t.inactiveTimeoutMs,t.sweepTimeoutMs,Ee)),ze[We]=Array.from($e.outboundRoutes);t.previousGCDataFromLastRun={gcNodes:ze}})),this.baseGCDetailsP=new Wn((0,l.Z)(function*(){const Ee=yield Fe;if(void 0===Ee)return new Map;const ke={};for(const[$e,dt]of Object.entries(Ee.gcNodes))ke[$e]=Array.from(dt.outboundRoutes);const We=os({gcData:{gcNodes:ke},usedRoutes:Cs(ke,["/"]).referencedNodeIds});for(const[$e,dt]of Object.entries(Ee.gcNodes))if(void 0!==dt.unreferencedTimestampMs){const Dt=We.get($e.slice(1));void 0!==Dt&&(Dt.unrefTimestamp=dt.unreferencedTimestampMs)}return We}));const De=JSON.stringify(Object.assign({gcEnabled:this.gcEnabled,sweepEnabled:this.sweepEnabled,runGC:this.shouldRunGC,runSweep:this.shouldRunSweep,writeAtRoot:this._writeDataAtRoot,testMode:this.testMode,sessionExpiry:this.sessionExpiryTimeoutMs,inactiveTimeout:this.inactiveTimeoutMs,existing:e.existing,trackGCState:this.trackGCState},this.gcOptions));this.isSummarizerClient&&this.mc.logger.sendTelemetryEvent({eventName:"GarbageCollectorLoaded",gcConfigs:De}),this.shouldRunGC&&this.initializeBaseStateP.catch(Ee=>{const ke=Cn.wrapIfUnrecognized(Ee,"FailedToInitializeGC");throw ke.addTelemetryProperties({gcConfigs:De}),ke})}static create(e){return new Zr(e)}get summaryStateNeedsReset(){return this.initialStateNeedsReset||this.shouldRunGC&&this.latestSummaryGCVersion!==this.currentGCVersion}get writeDataAtRoot(){return this._writeDataAtRoot}collectGarbage(e){var t=this;return(0,l.Z)(function*(){const{fullGC:n=!0===t.gcOptions.runFullGC||t.summaryStateNeedsReset}=e,i=e.logger?rt.create(e.logger,void 0,{all:{completedGCRuns:()=>t.completedRuns}}):t.mc.logger;return it.timedExecAsync(i,{eventName:"GarbageCollection"},function(){var o=(0,l.Z)(function*(h){yield t.runPreGCSteps();const w=yield t.runtime.getGCData(n),D=Cs(w.gcNodes,["/"]),_=yield t.runPostGCSteps(w,D,i);return h.end(Object.assign({},_)),t.completedRuns++,_});return function(h){return o.apply(this,arguments)}}(),{end:!0,cancel:"error"})})()}runPreGCSteps(){var e=this;return(0,l.Z)(function*(){yield e.initializeBaseStateP,yield e.runtime.updateStateBeforeGC()})()}runPostGCSteps(e,t,n){var i=this;return(0,l.Z)(function*(){const o=i.generateStats(t);i.updateStateSinceLastRun(e,n);const h=i.runtime.getCurrentReferenceTimestampMs();return i.updateCurrentState(e,t,h),i.runtime.updateUsedRoutes(t.referencedNodeIds,h),i.logSweepEvents(n,h),i.testMode&&i.runtime.deleteUnusedRoutes(t.deletedNodeIds),yield i.logUnreferencedEvents(n),o})()}summarize(e,t,n){var i;if(!this.shouldRunGC||void 0===this.previousGCDataFromLastRun)return;const o={gcNodes:{}};for(const[D,_]of Object.entries(this.previousGCDataFromLastRun.gcNodes))o.gcNodes[D]={outboundRoutes:_,unreferencedTimestampMs:null===(i=this.unreferencedNodesState.get(D))||void 0===i?void 0:i.unreferencedTimestampMs};const h=JSON.stringify(pi(o));if(this.trackGCState&&(this.pendingSerializedSummaryState=h,void 0!==this.latestSerializedSummaryState&&this.latestSerializedSummaryState===h&&!e&&t)){const D=Vn();return D.handleNodeCount++,{summary:{type:Le.Handle,handle:`/${sr}`,handleType:Le.Tree},stats:D}}const w=new Mn;return w.addBlob(`${zi}_root`,h),w.getSummaryTree()}getMetadata(){return{gcFeature:this.gcEnabled?this.currentGCVersion:0,sessionExpiryTimeoutMs:this.sessionExpiryTimeoutMs,sweepEnabled:this.sweepEnabled}}getBaseGCDetails(){var e=this;return(0,l.Z)(function*(){return e.baseGCDetailsP})()}latestSummaryStateRefreshed(e,t){var n=this;return(0,l.Z)(function*(){if(!n.shouldRunGC||!e.latestSummaryUpdated)return;if(e.wasSummaryTracked)return n.latestSummaryGCVersion=n.currentGCVersion,n.initialStateNeedsReset=!1,void(n.trackGCState&&(n.latestSerializedSummaryState=n.pendingSerializedSummaryState,n.pendingSerializedSummaryState=void 0));const i=e.snapshot,o=i.blobs[Tr];if(o){const w=yield t(o);n.latestSummaryGCVersion=ja(w)}const h=i.trees[sr];if(void 0!==h&&n.trackGCState){const w=yield Fs(h,t);n.latestSerializedSummaryState=JSON.stringify(pi(w))}else n.latestSerializedSummaryState=void 0;n.pendingSerializedSummaryState=void 0})()}nodeUpdated(e,t,n,i,o){if(!this.shouldRunGC)return;const h=this.unreferencedNodesState.get(e);h&&"Active"!==h.state&&this.inactiveNodeUsed(t,e,h,void 0,i,n,o)}addedOutboundReference(e,t){var n;if(!this.shouldRunGC)return;const i=null!==(n=this.newReferencesSinceLastRun.get(e))&&void 0!==n?n:[];i.push(t),this.newReferencesSinceLastRun.set(e,i);const o=this.unreferencedNodesState.get(t);o&&"Active"!==o.state&&this.inactiveNodeUsed("Revived",t,o,e)}dispose(){void 0!==this.sessionExpiryTimer&&(clearTimeout(this.sessionExpiryTimer),this.sessionExpiryTimer=void 0)}updateCurrentState(e,t,n){this.previousGCDataFromLastRun=Mr(e),this.newReferencesSinceLastRun.clear();for(const i of t.referencedNodeIds){const o=this.unreferencedNodesState.get(i);void 0!==o&&(o.stopTracking(),this.unreferencedNodesState.delete(i))}if(void 0!==n)for(const i of t.deletedNodeIds){const o=this.unreferencedNodesState.get(i);void 0===o?this.unreferencedNodesState.set(i,new fi(n,this.inactiveTimeoutMs,this.sweepTimeoutMs,n)):o.updateTracking(n)}}updateStateSinceLastRun(e,t){if(void 0===this.previousGCDataFromLastRun)return;const n=this.findMissingExplicitReferences(e,this.previousGCDataFromLastRun,this.newReferencesSinceLastRun);if(this.writeDataAtRoot&&n.length>0&&n.forEach(h=>{const w={eventName:"gcUnknownOutboundReferences",gcNodeId:h[0],gcRoutes:JSON.stringify(h[1])};t.sendPerformanceEvent(w)}),0===this.newReferencesSinceLastRun.size)return;const i=function wr(u,e){const t=Mr(u);for(const[n,i]of Object.entries(e.gcNodes))if(void 0===t.gcNodes[n])t.gcNodes[n]=Array.from(i);else{const o=[...i,...t.gcNodes[n]];t.gcNodes[n]=[...new Set(o)]}return t}(this.previousGCDataFromLastRun,e);this.newReferencesSinceLastRun.forEach((h,w)=>{void 0===i.gcNodes[w]?i.gcNodes[w]=h:i.gcNodes[w].push(...h)});const o=Cs(i.gcNodes,["/"]);for(const h of o.referencedNodeIds){const w=this.unreferencedNodesState.get(h);void 0!==w&&(w.stopTracking(),this.unreferencedNodesState.delete(h))}}findMissingExplicitReferences(e,t,n){S(void 0!==t,695);const i=Object.entries(e.gcNodes),o=[];return i.forEach(([h,w])=>{var D,_;const U=null!==(D=t.gcNodes[h])&&void 0!==D?D:[],Q=null!==(_=n.get(h))&&void 0!==_?_:[],Y=[];w.forEach(ye=>{const Fe="Blob"===this.runtime.getNodeType(ye)||"DataStore"===this.runtime.getNodeType(ye),De=!h.startsWith(ye);Fe&&De&&!U.includes(ye)&&!Q.includes(ye)&&Y.push(ye)}),Y.length>0&&o.push([h,Y])}),o}generateStats(e){const t={nodeCount:0,dataStoreCount:0,attachmentBlobCount:0,unrefNodeCount:0,unrefDataStoreCount:0,unrefAttachmentBlobCount:0,updatedNodeCount:0,updatedDataStoreCount:0,updatedAttachmentBlobCount:0},n=(i,o)=>{t.nodeCount++;const h=void 0===this.previousGCDataFromLastRun||this.unreferencedNodesState.has(i)===o;h&&t.updatedNodeCount++,o||t.unrefNodeCount++,"DataStore"===this.runtime.getNodeType(i)&&(t.dataStoreCount++,h&&t.updatedDataStoreCount++,o||t.unrefDataStoreCount++),"Blob"===this.runtime.getNodeType(i)&&(t.attachmentBlobCount++,h&&t.updatedAttachmentBlobCount++,o||t.unrefAttachmentBlobCount++)};for(const i of e.referencedNodeIds)n(i,!0);for(const i of e.deletedNodeIds)n(i,!1);return t}logSweepEvents(e,t){!0===this.mc.config.getBoolean("Fluid.GarbageCollection.DisableSweepLog")||void 0===t||void 0===this.sweepTimeoutMs||this.unreferencedNodesState.forEach((n,i)=>{if("SweepReady"!==n.state)return;const o=this.runtime.getNodeType(i);if("DataStore"!==o&&"Blob"!==o)return;const h=`Deleted-${i}`;this.loggedUnreferencedEvents.has(h)||(this.loggedUnreferencedEvents.add(h),e.sendTelemetryEvent({eventName:"GCObjectDeleted",id:i,type:o,age:t-n.unreferencedTimestampMs,timeout:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs()}))})}inactiveNodeUsed(e,t,n,i,o,h=this.runtime.getCurrentReferenceTimestampMs(),w){if(void 0===h||"Active"===n.state||!this.isSummarizerClient&&"Loaded"!==e)return;const D=this.runtime.getNodeType(t);if("DataStore"!==D&&"Blob"!==D)return;const _=n.state,U=`${_}-${t}-${e}`;if(this.loggedUnreferencedEvents.has(U))return;this.loggedUnreferencedEvents.add(U);const Q={id:t,type:D,unrefTime:n.unreferencedTimestampMs,age:h-n.unreferencedTimestampMs,timeout:"Inactive"===n.state?this.inactiveTimeoutMs:this.sweepTimeoutMs,completedGCRuns:this.completedRuns,lastSummaryTime:this.getLastSummaryTimestampMs(),externalRequest:w?.[oe.externalRequest],viaHandle:w?.[oe.viaHandle],fromId:i};this.isSummarizerClient?this.pendingEventsQueue.push(Object.assign(Object.assign({},Q),{usageType:e,state:_})):this.mc.logger.sendErrorEvent(Object.assign(Object.assign({},Q),{eventName:`${_}Object_${e}`,pkg:o?{value:o.join("/"),tag:Tt.CodeArtifact}:void 0}))}logUnreferencedEvents(e){var t=this;return(0,l.Z)(function*(){for(const n of t.pendingEventsQueue){const{usageType:i,state:o}=n,h=Es(n,["usageType","state"]),w=t.unreferencedNodesState.get(n.id);if("Revived"===i==(void 0===w||"Active"===w.state)){const _=yield t.getNodePackagePath(n.id),U=n.fromId?yield t.getNodePackagePath(n.fromId):void 0;e.sendErrorEvent(Object.assign(Object.assign({},h),{eventName:`${o}Object_${i}`,pkg:_?{value:_.join("/"),tag:Tt.CodeArtifact}:void 0,fromPkg:U?{value:U.join("/"),tag:Tt.CodeArtifact}:void 0}))}}t.pendingEventsQueue=[]})()}}function Fs(u,e){return Ki.apply(this,arguments)}function Ki(){return(Ki=(0,l.Z)(function*(u,e){let t={gcNodes:{}};for(const n of Object.keys(u.blobs)){if(!n.startsWith(zi))continue;const i=u.blobs[n];if(void 0===i)continue;const o=yield e(i);S(void 0!==o,685),t=ca(t,o)}return t})).apply(this,arguments)}function pi(u){const e=Object.entries(u.gcNodes);e.sort(([n],[i])=>n.localeCompare(i));const t={gcNodes:{}};for(const[n,i]of e)i.outboundRoutes.sort(),t.gcNodes[n]=i;return t}function vr(u,e,t){let i;if(u>2147483647){const o=u-2147483647;i=setTimeout(()=>vr(o,e,t),2147483647)}else i=setTimeout(()=>e(),u);t(i)}function Kr(u){return u.summaryFormatVersion?u.summaryFormatVersion:"0.1"===u.snapshotFormatVersion?1:0}function Gi(u){return!!u.summaryFormatVersion&&!u.disableIsolatedChannels}const Ps=".aliases",Tr=".metadata",Gr=".chunks",Ce=".electedSummarizer",ct=".blobs";function ja(u){var e;return u&&null!==(e=u.gcFeature)&&void 0!==e?e:0}const Ns=[".protocol",".logTail",".serviceProtocol",ct,sr],yr=".component";function Wi(u){u.summary={type:Le.Tree,tree:{[be.channelsTreeName]:u.summary}},u.stats.treeNodeCount++}function Ge(){return(Ge=(0,l.Z)(function*(u,e){const t=yield V(u,e.blobs[yr]);return S(Kr(t)>0,469),t})).apply(this,arguments)}function $i(u,e,t){const n=JSON.stringify(u);return t?{pkg:n,snapshotFormatVersion:"0.1",isRootDataStore:e}:{pkg:n,summaryFormatVersion:2,isRootDataStore:e}}function r(u,e,t){const n=$i(u,e,t);return new un(yr,JSON.stringify(n))}let a=(()=>{class u extends Ke{constructor(t,n,i,o,h){var w;super(),w=this,this.existing=n,this.bindState=i,this.isLocalDataStore=o,this.makeLocallyVisibleFn=h,this._disposed=!1,this.detachedRuntimeCreation=!1,this.loaded=!1,this.pending=[],this._isInMemoryRoot=!1,this._containerRuntime=t.runtime,this.id=t.id,this.storage=t.storage,this.scope=t.scope,this.writeGCDataAtRoot=t.writeGCDataAtRoot,this.disableIsolatedChannels=t.disableIsolatedChannels,this.pkg=t.pkg,S(!this.id.includes("/"),314),this._attachState=this.containerRuntime.attachState!==we.Detached&&this.existing?this.containerRuntime.attachState:we.Detached,this.bindToContext=()=>{S(this.bindState===de.NotBound,315),this.bindState=de.Binding,S(void 0!==this.channel,316),this.makeLocallyVisible(),this.bindState=de.Bound};const D=function(){var _=(0,l.Z)(function*(U,Q,Y){return w.summarizeInternal(U,Q,Y)});return function(Q,Y,ye){return _.apply(this,arguments)}}();this.summarizerNode=t.createSummarizerNodeFn(D,function(){var _=(0,l.Z)(function*(U){return w.getGCDataInternal(U)});return function(U){return _.apply(this,arguments)}}(),(0,l.Z)(function*(){return w.getBaseGCDetails()})),this.subLogger=rt.create(this.logger,"FluidDataStoreContext"),this.thresholdOpsCounter=new ui(u.pendingOpsCountThreshold,this.subLogger)}get packagePath(){return S(void 0!==this.pkg,313),this.pkg}get options(){return this._containerRuntime.options}get clientId(){return this._containerRuntime.clientId}get clientDetails(){return this._containerRuntime.clientDetails}get logger(){return this._containerRuntime.logger}get deltaManager(){return this._containerRuntime.deltaManager}get connected(){return this._containerRuntime.connected}get IFluidHandleContext(){return this._containerRuntime.IFluidHandleContext}get containerRuntime(){return this._containerRuntime}get isLoaded(){return this.loaded}get baseSnapshot(){return this._baseSnapshot}get disposed(){return this._disposed}get attachState(){return this._attachState}get IFluidDataStoreRegistry(){return this.registry}isRoot(){var t=this;return(0,l.Z)(function*(){return t.isInMemoryRoot()||(yield t.getInitialSnapshotDetails()).isRootDataStore})()}isInMemoryRoot(){return this._isInMemoryRoot}dispose(){this._disposed||(this._disposed=!0,this.channelDeferred&&this.channelDeferred.promise.then(t=>{t.dispose()}).catch(t=>{}))}rejectDeferredRealize(t,n){throw new bt(t,{packageName:{value:n,tag:Tt.PackageData}})}realize(){var t=this;return(0,l.Z)(function*(){return S(!t.detachedRuntimeCreation,317),t.channelDeferred||(t.channelDeferred=new jt,t.realizeCore(t.existing).catch(n=>{var i;const o=Cn.wrapIfUnrecognized(n,"realizeFluidDataStoreContext");o.addTelemetryProperties({fluidDataStoreId:{value:t.id,tag:"PackageData"}}),null===(i=t.channelDeferred)||void 0===i||i.reject(o),t.logger.sendErrorEvent({eventName:"RealizeError"},o)})),t.channelDeferred.promise})()}factoryFromPackagePath(t){var n=this;return(0,l.Z)(function*(){S(n.pkg===t,318),void 0===t&&n.rejectDeferredRealize("packages is undefined");let i,h,o=n._containerRuntime.IFluidDataStoreRegistry;for(const D of t)o||n.rejectDeferredRealize("No registry for package",h),h=D,i=yield o.get(D),i||n.rejectDeferredRealize("Registry does not contain entry for the package",D),o=i.IFluidDataStoreRegistry;const w=i?.IFluidDataStoreFactory;return void 0===w&&n.rejectDeferredRealize("Can't find factory for package",h),{factory:w,registry:o}})()}realizeCore(t){var n=this;return(0,l.Z)(function*(){const i=yield n.getInitialSnapshotDetails();n._baseSnapshot=i.snapshot;const o=i.pkg,{factory:h,registry:w}=yield n.factoryFromPackagePath(o);S(void 0===n.registry,319),n.registry=w;const D=yield h.instantiateDataStore(n,t);S(void 0!==D,320),n.bindRuntime(D)})()}setConnectionState(t,n){this.verifyNotClosed(),this.loaded&&(S(this.connected===t,321),this.channel.setConnectionState(t,n))}process(t,n,i){var o;this.verifyNotClosed();const h=t.contents,w=Object.assign(Object.assign({},t),{type:h.type,contents:h.content});if(this.summarizerNode.recordChange(w),this.loaded)return null===(o=this.channel)||void 0===o?void 0:o.process(w,n,i);S(!n,322),S(void 0!==this.pending,573),this.pending.push(w),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length)}processSignal(t,n){var i;this.verifyNotClosed(),this.loaded&&(null===(i=this.channel)||void 0===i||i.processSignal(t,n))}getQuorum(){return this._containerRuntime.getQuorum()}getAudience(){return this._containerRuntime.getAudience()}summarize(t=!1,n=!0,i){var o=this;return(0,l.Z)(function*(){return o.summarizerNode.summarize(t,n,i)})()}summarizeInternal(t,n,i){var o=this;return(0,l.Z)(function*(){yield o.realize();const h=yield o.channel.summarize(t,n,i);let w;o.disableIsolatedChannels||(Wi(h),w=[be.channelsTreeName]);const{pkg:D}=yield o.getInitialSnapshotDetails(),U=$i(D,yield o.isRoot(),o.disableIsolatedChannels);return An(h,yr,JSON.stringify(U)),o.writeGCDataAtRoot||An(h,be.gcBlobKey,JSON.stringify(o.summarizerNode.getGCSummaryDetails())),o.summarizerNode.isReferenced()||(h.summary.unreferenced=!0,h.stats.unreferencedBlobSize=h.stats.totalBlobSize),Object.assign(Object.assign({},h),{id:o.id,pathPartsForChildren:w})})()}getGCData(t=!1){var n=this;return(0,l.Z)(function*(){return n.summarizerNode.getGCData(t)})()}getGCDataInternal(t=!1){var n=this;return(0,l.Z)(function*(){return yield n.realize(),S(void 0!==n.channel,323),n.channel.getGCData(t)})()}updateUsedRoutes(t,n){this.summarizerNode.updateUsedRoutes(t,n),this.lastUsedState={usedRoutes:t,gcTimestamp:n},this.loaded&&this.updateChannelUsedRoutes()}addedGCOutboundReference(t,n){this._containerRuntime.addedGCOutboundReference(t,n)}updateChannelUsedRoutes(){if(S(this.loaded,324),S(void 0!==this.channel,325),void 0===this.lastUsedState)return;const t=this.lastUsedState.usedRoutes.filter(n=>"/"!==n&&""!==n);this.channel.updateUsedRoutes(t,this.lastUsedState.gcTimestamp)}request(t){var n=this;return(0,l.Z)(function*(){return(yield n.realize()).request(t)})()}submitMessage(t,n,i){this.verifyNotClosed(),S(!!this.channel,326),this._containerRuntime.submitDataStoreOp(this.id,{content:n,type:t},i)}setChannelDirty(t){this.verifyNotClosed();const n=this.deltaManager.lastSequenceNumber;this.summarizerNode.invalidate(n);const i=this.summarizerNode.getChild(t);i&&i.invalidate(n)}submitSignal(t,n){return this.verifyNotClosed(),S(!!this.channel,327),this._containerRuntime.submitDataStoreSignal(this.id,t,n)}makeLocallyVisible(){S(void 0!==this.channel,719),this.makeLocallyVisibleFn()}bindRuntime(t){var n;if(this.channel)throw new Error("Runtime already bound");try{S(!this.detachedRuntimeCreation,328),S(void 0!==this.channelDeferred,329),S(void 0!==this.pkg,330);const i=this.pending;for(const o of i)t.process(o,!1,void 0);this.thresholdOpsCounter.send("ProcessPendingOps",i.length),this.pending=void 0,this.loaded=!0,this.channel=t,Object.freeze(this.pkg),this.updateChannelUsedRoutes(),this.channelDeferred.resolve(this.channel)}catch(i){null===(n=this.channelDeferred)||void 0===n||n.reject(i),this.logger.sendErrorEvent({eventName:"BindRuntimeError",fluidDataStoreId:{value:this.id,tag:"PackageData"}},i)}}getAbsoluteUrl(t){var n=this;return(0,l.Z)(function*(){if(n.attachState===we.Attached)return n._containerRuntime.getAbsoluteUrl(t)})()}setInMemoryRoot(){this._isInMemoryRoot=!0}reSubmit(t,n){S(!!this.channel,331),this.channel.reSubmit(t.type,t.content,n)}rollback(t,n){if(!this.channel)throw new Error("Channel must exist when rolling back ops");if(!this.channel.rollback)throw new Error("Channel doesn't support rollback");this.channel.rollback(t.type,t.content,n)}applyStashedOp(t){var n=this;return(0,l.Z)(function*(){return n.channel||(yield n.realize()),S(!!n.channel,332),n.channel.applyStashedOp(t.content)})()}verifyNotClosed(){if(this._disposed)throw new Error("Context is closed")}getCreateChildSummarizerNodeFn(t,n){return(i,o,h)=>this.summarizerNode.createChild(i,t,n,{throwOnFailure:!0},o,h)}uploadBlob(t){var n=this;return(0,l.Z)(function*(){return n.containerRuntime.uploadBlob(t)})()}}return u.pendingOpsCountThreshold=1e3,u})();class s extends a{constructor(e){var t;super(e,!0,de.Bound,!1,()=>{throw new Error("Already attached")}),t=this,this.initialSnapshotDetailsP=new Wn((0,l.Z)(function*(){var n,i;let o,h=!0;if("string"==typeof t.initSnapshotValue){const D=(yield t.storage.getVersions(t.initSnapshotValue,1))[0];o=null!==(n=yield t.storage.getSnapshotTree(D))&&void 0!==n?n:void 0}else o=t.initSnapshotValue;const w=function(){var D=(0,l.Z)(function*(_){return V(t.storage,_)});return function(U){return D.apply(this,arguments)}}();if(o){const D=yield t.summarizerNode.loadBaseSummary(o,w);o=D.baseSummary,t.pending=D.outstandingOps.concat(t.pending)}if(o&&void 0!==o.blobs[yr]){const D=yield w(o.blobs[yr]);let _;_=Kr(D)<1?D.pkg.startsWith('["')&&D.pkg.endsWith('"]')?JSON.parse(D.pkg):[D.pkg]:JSON.parse(D.pkg),t.pkg=_,h=null===(i=D.isRootDataStore)||void 0===i||i,Gi(D)&&(o=o.trees[be.channelsTreeName],S(void 0!==o,510))}return{pkg:t.pkg,isRootDataStore:h,snapshot:o}})),this.initSnapshotValue=e.snapshotTree,this.baseGCDetailsP=new Wn((0,l.Z)(function*(){var n;return null!==(n=yield e.getBaseGCDetails())&&void 0!==n?n:{}}))}getInitialSnapshotDetails(){var e=this;return(0,l.Z)(function*(){return e.initialSnapshotDetailsP})()}getInitialGCSummaryDetails(){var e=this;return(0,l.Z)(function*(){return e.getBaseGCDetails()})()}getBaseGCDetails(){var e=this;return(0,l.Z)(function*(){return e.baseGCDetailsP})()}generateAttachMessage(){throw new Error("Cannot attach remote store")}}class c extends a{constructor(e){super(e,void 0!==e.snapshotTree,e.snapshotTree?de.Bound:de.NotBound,!0,e.makeLocallyVisibleFn),this.snapshotTree=e.snapshotTree,!0===e.isRootDataStore&&this.setInMemoryRoot(),this.createProps=e.createProps,this.attachListeners()}attachListeners(){this.once("attaching",()=>{S(this.attachState===we.Detached,333),this._attachState=we.Attaching}),this.once("attached",()=>{S(this.attachState===we.Attaching,334),this._attachState=we.Attached})}generateAttachMessage(){S(void 0!==this.channel,335),S(void 0!==this.pkg,336);const e=this.channel.getAttachSummary();this.disableIsolatedChannels||Wi(e);const t=$i(this.pkg,this.isInMemoryRoot(),this.disableIsolatedChannels);An(e,yr,JSON.stringify(t));const n=ni(e.summary);return{id:this.id,snapshot:n,type:this.pkg[this.pkg.length-1]}}getInitialSnapshotDetails(){var e=this;return(0,l.Z)(function*(){var t;let i,n=e.snapshotTree,o=!1;return void 0!==n&&(i=yield function Rs(u,e){return Ge.apply(this,arguments)}(e.storage,n),Gi(i)&&(n=n.trees[be.channelsTreeName],S(void 0!==n,511)),void 0===e.pkg&&(e.pkg=JSON.parse(i.pkg),(!(null!==(t=i.isRootDataStore)&&void 0!==t)||t)&&(o=!0,e.setInMemoryRoot()))),S(void 0!==e.pkg,338),{pkg:e.pkg,isRootDataStore:o,snapshot:n}})()}getInitialGCSummaryDetails(){return(0,l.Z)(function*(){return{}})()}getBaseGCDetails(){return(0,l.Z)(function*(){return{}})()}}class f extends c{constructor(e){super(e)}}class p extends c{constructor(e){super(e),this.detachedRuntimeCreation=!0}attachRuntime(e,t){var n=()=>super.bindRuntime,i=this;return(0,l.Z)(function*(){S(i.detachedRuntimeCreation,340),S(void 0===i.channelDeferred,341);const o=e.IFluidDataStoreFactory,h=yield i.factoryFromPackagePath(i.pkg);S(h.factory===o,342),S(void 0===i.registry,343),i.registry=h.registry,i.detachedRuntimeCreation=!1,i.channelDeferred=new jt,n().call(i,t),(yield i.isRoot())&&(void 0!==t.makeVisibleAndAttachGraph?t.makeVisibleAndAttachGraph():t.bindToContext())})()}getInitialSnapshotDetails(){var e=()=>super.getInitialSnapshotDetails,t=this;return(0,l.Z)(function*(){if(t.detachedRuntimeCreation)throw new Error("Detached Fluid Data Store context can't be realized! Please attach runtime first!");return e().call(t)})()}}const g=u=>"string"==typeof u?.internalId&&"string"==typeof u?.alias,m=(u,e,t,n,i)=>new A(u,e,t,n,i);var x=(()=>{return(u=x||(x={})).Aliased="Aliased",u.Aliasing="Aliasing",u.None="None",x;var u})();class A{constructor(e,t,n,i,o){this.fluidDataStoreChannel=e,this.internalId=t,this.runtime=n,this.datastores=i,this.logger=o,this.aliasState=x.None}trySetAlias(e){var t=this;return(0,l.Z)(function*(){if(e.includes("/"))throw new wt(`The alias cannot contain slashes: '${e}'`);switch(t.aliasState){case x.Aliasing:return S(void 0!==t.aliasResult,790),yield t.aliasResult,t.alias===e?"Success":"AlreadyAliased";case x.Aliased:return t.alias===e?"Success":"AlreadyAliased";case x.None:break;default:En()}return t.aliasState=x.Aliasing,t.aliasResult=t.trySetAliasInternal(e),t.aliasResult})()}trySetAliasInternal(e){var t=this;return(0,l.Z)(function*(){const n={internalId:t.internalId,alias:e};if(void 0!==t.fluidDataStoreChannel.makeVisibleAndAttachGraph?t.fluidDataStoreChannel.makeVisibleAndAttachGraph():t.fluidDataStoreChannel.bindToContext(),t.runtime.attachState===we.Detached){const o=t.datastores.processAliasMessageCore(n);return t.aliasState=x.Aliased,o?"Success":"Conflict"}return(yield t.ackBasedPromise(o=>{t.runtime.submitDataStoreAliasOp(n,o)}).then(o=>(t.aliasState=x.Aliased,o&&(t.alias=e),o)).catch(o=>(t.logger.sendErrorEvent({eventName:"AliasingException",alias:{value:e,tag:Tt.UserData},internalId:{value:t.internalId,tag:Tt.PackageData}},o),t.aliasState=x.None,!1)))?"Success":"Conflict"})()}request(e){var t=this;return(0,l.Z)(function*(){return t.fluidDataStoreChannel.request(e)})()}get IFluidRouter(){return this.fluidDataStoreChannel}ackBasedPromise(e){var t=this;return(0,l.Z)(function*(){let n;return new Promise((i,o)=>{n=()=>o(new Error("ContainerRuntime disposed while this ack-based Promise was pending")),t.runtime.disposed?n():(t.runtime.on("dispose",n),e(i,o))}).finally(()=>{t.runtime.off("dispose",n)})})()}}class N{constructor(e,t,n,i,o,h,w,D,_,U,Q=new _a(h)){this.baseSnapshot=e,this.runtime=t,this.submitAttachFn=n,this.getCreateChildSummarizerNodeFn=i,this.deleteChildSummarizerNodeFn=o,this.gcNodeUpdated=D,this.aliasMap=_,this.writeGCDataAtRoot=U,this.contexts=Q,this.pendingAttach=new Map,this.attachOpFiredForDataStore=new Set,this.disposeOnce=new tt(()=>this.contexts.dispose()),this.dataStoresSinceLastGC=[],this.dispose=()=>this.disposeOnce.value,this.logger=rt.create(h),this.containerRuntimeHandle=new Cr(this.runtime,"/",this.runtime.IFluidHandleContext);const Y=new Wn((0,l.Z)(function*(){return w()})),ye=function(){var Ee=(0,l.Z)(function*(ke){return(yield Y).get(ke)});return function(ze){return Ee.apply(this,arguments)}}(),Fe=new Map;if(e)for(const[Ee,ke]of Object.entries(e.trees))Fe.set(Ee,ke);let De=0;for(const[Ee,ke]of Fe){let ze;if(ke.unreferenced&&De++,this.runtime.attachState!==we.Detached)ze=new s({id:Ee,snapshotTree:ke,getBaseGCDetails:function(){var We=(0,l.Z)(function*(){return ye(Ee)});return function(){return We.apply(this,arguments)}}(),runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(Ee,{type:be.CreateSummarizerNodeSource.FromSummary}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});else{if("object"!=typeof ke)throw new bt("Snapshot should be there to load from!!");const We=ke;ze=new f({id:Ee,pkg:void 0,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(Ee,{type:be.CreateSummarizerNodeSource.FromSummary}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(Ee),snapshotTree:We,isRootDataStore:void 0,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels})}this.contexts.addBoundOrRemoted(ze)}this.containerLoadStats={containerLoadDataStoreCount:Fe.size,referencedDataStoreCount:Fe.size-De}}aliases(){return this.aliasMap}processAttachMessage(e,t){var n,i;const o=e.contents;if(this.dataStoresSinceLastGC.push(o.id),t)return S(this.pendingAttach.has(o.id),350),null===(n=this.contexts.get(o.id))||void 0===n||n.emit("attached"),void this.pendingAttach.delete(o.id);if(this.alreadyProcessed(o.id))throw new zn("Duplicate DataStore created with existing id",Object.assign(Object.assign({},dr(e)),{dataStoreId:{value:o.id,tag:Tt.PackageData}}));const h=new Map;let w;o.snapshot&&(w=Ht(o.snapshot.entries,h));const D=[o.type],_=new s({id:o.id,snapshotTree:w,getBaseGCDetails:(U=(0,l.Z)(function*(){return{}}),function(){return U.apply(this,arguments)}),runtime:this.runtime,storage:new Oa(this.runtime.storage,h),scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(o.id,{type:be.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:null!==(i=o.snapshot)&&void 0!==i?i:{entries:[r(D,!0,this.runtime.disableIsolatedChannels)]}}),writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,pkg:D});var U;this.contexts.addBoundOrRemoted(_)}processAliasMessage(e,t,n){const i=e.contents;if(!g(i))throw new zn("malformedDataStoreAliasMessage",Object.assign({},dr(e)));const o=t,h=this.processAliasMessageCore(i);n&&o(h)}processAliasMessageCore(e){if(this.alreadyProcessed(e.alias))return!1;const t=this.contexts.get(e.internalId);if(void 0===t)return this.logger.sendErrorEvent({eventName:"AliasFluidDataStoreNotFound",fluidDataStoreId:e.internalId}),!1;const n=new Cr(t,e.internalId,this.runtime.IFluidHandleContext);return this.runtime.addedGCOutboundReference(this.containerRuntimeHandle,n),this.aliasMap.set(e.alias,t.id),t.setInMemoryRoot(),!0}alreadyProcessed(e){return void 0!==this.aliasMap.get(e)||void 0!==this.contexts.get(e)}makeDataStoreLocallyVisible(e){const t=this.contexts.getUnbound(e);if(S(!!t,351),this.runtime.attachState!==we.Detached){t.emit("attaching");const n=t.generateAttachMessage();this.pendingAttach.set(e,n),this.submitAttachFn(n),this.attachOpFiredForDataStore.add(e)}this.contexts.bind(e)}createDetachedDataStoreCore(e,t,n=Pe()){S(!n.includes("/"),780);const i=new p({id:n,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(n,{type:be.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(n),snapshotTree:void 0,isRootDataStore:t,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels});return this.contexts.addUnbound(i),i}_createFluidDataStoreContext(e,t,n,i){S(!t.includes("/"),781);const o=new f({id:t,pkg:e,runtime:this.runtime,storage:this.runtime.storage,scope:this.runtime.scope,createSummarizerNodeFn:this.getCreateChildSummarizerNodeFn(t,{type:be.CreateSummarizerNodeSource.Local}),makeLocallyVisibleFn:()=>this.makeDataStoreLocallyVisible(t),snapshotTree:void 0,isRootDataStore:n,writeGCDataAtRoot:this.writeGCDataAtRoot,disableIsolatedChannels:this.runtime.disableIsolatedChannels,createProps:i});return this.contexts.addUnbound(o),o}get disposed(){return this.disposeOnce.evaluated}resubmitDataStoreOp(e,t){const n=e,i=this.contexts.get(n.address);S(!!i,352),i.reSubmit(n.contents,t)}rollbackDataStoreOp(e,t){const n=e,i=this.contexts.get(n.address);S(!!i,744),i.rollback(n.contents,t)}applyStashedOp(e){var t=this;return(0,l.Z)(function*(){const n=e,i=t.contexts.get(n.address);return S(!!i,353),i.applyStashedOp(n.contents)})()}applyStashedAttachOp(e){var t=this;return(0,l.Z)(function*(){t.pendingAttach.set(e.id,e),t.processAttachMessage({contents:e},!1)})()}processFluidDataStoreOp(e,t,n){const i=e.contents,o=Object.assign(Object.assign({},e),{contents:i.contents}),h=this.contexts.get(i.address);S(!!h,354),h.process(o,t,n),this.gcNodeUpdated(`/${i.address}`,e.timestamp,h.isLoaded?h.packagePath:void 0)}getDataStore(e,t){var n=this;return(0,l.Z)(function*(){const i=yield n.contexts.getBoundOrRemoted(e,t);if(void 0===i){throw ii(kn({url:e}))}return i})()}processSignal(e,t,n){const i=this.contexts.get(e);if(!i)return S(!n,355),void this.logger.sendTelemetryEvent({eventName:"SignalFluidDataStoreNotFound",fluidDataStoreId:{value:e,tag:Tt.PackageData}});i.processSignal(t,n)}setConnectionState(e,t){for(const[n,i]of this.contexts)try{i.setConnectionState(e,t)}catch(o){this.logger.sendErrorEvent({eventName:"SetConnectionStateError",clientId:t,fluidDataStore:n},o)}}setAttachState(e){let t;t=e===we.Attaching?"attaching":"attached";for(const[,n]of this.contexts)this.contexts.isNotBound(n.id)||n.emit(t)}get size(){return this.contexts.size}summarize(e,t,n){var i=this;return(0,l.Z)(function*(){const o=new Mn;return yield Promise.all(Array.from(i.contexts).filter(([h,w])=>(S(w.attachState!==we.Attaching,357),w.attachState===we.Attached)).map(function(){var h=(0,l.Z)(function*([w,D]){const _=yield D.summarize(e,t,n);o.addWithStats(w,_)});return function(w){return h.apply(this,arguments)}}())),o.getSummaryTree()})()}createSummary(e){const t=new Mn;let n;do{const i=t.summary.tree;n=this.contexts.notBoundLength(),Array.from(this.contexts).filter(([o,h])=>!(this.contexts.isNotBound(o)||i[o]||this.attachOpFiredForDataStore.has(o))).map(([o,h])=>{let w;h.isLoaded?w=Fn(h.generateAttachMessage().snapshot,!0):(S(!!this.baseSnapshot,358),w=ti(this.baseSnapshot.trees[o])),t.addWithStats(o,w)})}while(n!==this.contexts.notBoundLength());return t.getSummaryTree()}updateStateBeforeGC(){var e=this;return(0,l.Z)(function*(){for(const t of e.dataStoresSinceLastGC){const n=e.contexts.get(t);if(S(void 0!==n,694),yield n.isRoot()){const i=new Cr(n,t,e.runtime.IFluidHandleContext);e.runtime.addedGCOutboundReference(e.containerRuntimeHandle,i)}}e.dataStoresSinceLastGC=[]})()}getGCData(e=!1){var t=this;return(0,l.Z)(function*(){const n=new Di;return yield Promise.all(Array.from(t.contexts).filter(([i,o])=>o.attachState===we.Attached).map(function(){var i=(0,l.Z)(function*([o,h]){const w=yield h.getGCData(e);n.prefixAndAddNodes(o,w.gcNodes)});return function(o){return i.apply(this,arguments)}}())),n.addNode("/",yield t.getOutboundRoutes()),n.getGCData()})()}updateUsedRoutes(e,t){var n;const i=us(e);for(const[o]of i)S(this.contexts.has(o),359);for(const[o,h]of this.contexts)h.updateUsedRoutes(null!==(n=i.get(o))&&void 0!==n?n:[],t)}deleteUnusedRoutes(e){for(const t of e){const n=t.split("/");if(n.length>2)continue;const i=n[1];S(this.contexts.has(i),727),this.contexts.delete(i),this.deleteChildSummarizerNodeFn(i)}}getOutboundRoutes(){var e=this;return(0,l.Z)(function*(){const t=[];for(const[n,i]of e.contexts)(yield i.isRoot())&&t.push(`/${n}`);return t})()}getDataStorePackagePath(e){var t=this;return(0,l.Z)(function*(){var n;const i=t.contexts.get(e.split("/")[1]);return null===(n=yield i?.getInitialSnapshotDetails())||void 0===n?void 0:n.pkg})()}getGCNodeType(e){const t=e.split("/");if(this.contexts.has(t[1]))return 2===t.length?"DataStore":"SubDataStore"}}function P(u,e){if(u){if(function qo(u){return!!u&&!u.disableIsolatedChannels}(e)){const t=u.trees[be.channelsTreeName];return S(!!t,360),t}{const t={};for(const[n,i]of Object.entries(u.trees))Ns.includes(n)||(t[n]=i);return Object.assign(Object.assign({},u),{trees:t})}}}var b=(()=>{return(u=b||(b={}))[u.Local=0]="Local",u[u.Broadcast=1]="Broadcast",u[u.Acked=2]="Acked",u[u.Nacked=-1]="Nacked",b;var u})();class y{constructor(e,t){this.clientId=e,this.clientSequenceNumber=t,this.state=b.Local,this.defSummaryOp=new jt,this.defSummaryAck=new jt}static createLocal(e,t){return new y(e,t)}static createFromOp(e){const t=new y(e.clientId,e.clientSequenceNumber);return t.broadcast(e),t}get summaryOp(){return this._summaryOp}get summaryAckNack(){return this._summaryAckNack}hasBeenAcked(){return this.state===b.Acked}broadcast(e){return S(this.state===b.Local,373),this._summaryOp=e,this.defSummaryOp.resolve(),this.state=b.Broadcast,!0}ackNack(e){return S(this.state===b.Broadcast,374),this._summaryAckNack=e,this.defSummaryAck.resolve(),this.state=e.type===E.SummaryAck?b.Acked:b.Nacked,!0}waitBroadcast(){var e=this;return(0,l.Z)(function*(){return yield e.defSummaryOp.promise,e._summaryOp})()}waitAckNack(){var e=this;return(0,l.Z)(function*(){return yield e.defSummaryAck.promise,e._summaryAckNack})()}}class F{constructor(e,t){this.clientId=e,this.summaryCollection=t,this.localSummaries=new Map,this._disposed=!1}get disposed(){return this._disposed}watchSummary(e){let t=this.localSummaries.get(e);return t||(t=y.createLocal(this.clientId,e),this.localSummaries.set(t.clientSequenceNumber,t)),t}waitFlushed(){return this.summaryCollection.waitFlushed()}tryGetSummary(e){return this.localSummaries.get(e)}setSummary(e){this.localSummaries.set(e.clientSequenceNumber,e)}dispose(){this.summaryCollection.removeWatcher(this.clientId),this._disposed=!0}}class C extends Ke{constructor(e,t){super(),this.deltaManager=e,this.logger=t,this.summaryWatchers=new Map,this.pendingSummaries=new Map,this.refreshWaitNextAck=new jt,this.deltaManager.on("op",n=>this.handleOp(n))}get latestAck(){return this.lastAck}emit(e,...t){return super.emit(e,...t)}get opsSinceLastAck(){var e,t;return this.deltaManager.lastSequenceNumber-(null!==(t=null===(e=this.lastAck)||void 0===e?void 0:e.summaryAck.sequenceNumber)&&void 0!==t?t:this.deltaManager.initialSequenceNumber)}addOpListener(e){this.deltaManager.on("op",e)}removeOpListener(e){this.deltaManager.off("op",e)}createWatcher(e){const t=new F(e,this);return this.summaryWatchers.set(e,t),t}removeWatcher(e){this.summaryWatchers.delete(e)}setPendingAckTimerTimeoutCallback(e,t){this.maxAckWaitTime=e,this.pendingAckTimerTimeoutCallback=t}unsetPendingAckTimerTimeoutCallback(){this.maxAckWaitTime=void 0,this.pendingAckTimerTimeoutCallback=void 0}waitFlushed(){var e=this;return(0,l.Z)(function*(){for(;e.pendingSummaries.size>0;){const t=Array.from(e.pendingSummaries,([,n])=>n.waitAckNack());yield Promise.all(t)}return e.lastAck})()}waitSummaryAck(e){var t=this;return(0,l.Z)(function*(){for(;!t.lastAck||t.lastAck.summaryOp.referenceSequenceNumber<e;)yield t.refreshWaitNextAck.promise;return t.lastAck})()}handleOp(e){var t;switch(e.type){case E.Summarize:return void this.handleSummaryOp(e);case E.SummaryAck:return void this.handleSummaryAck(e);case E.SummaryNack:return void this.handleSummaryNack(e);default:return void 0!==this.lastSummaryTimestamp&&void 0!==this.maxAckWaitTime&&e.timestamp-this.lastSummaryTimestamp>=this.maxAckWaitTime&&(null===(t=this.pendingAckTimerTimeoutCallback)||void 0===t||t.call(this)),void this.emit("default",e)}}handleSummaryOp(e){let t;const n=this.summaryWatchers.get(e.clientId);n&&(t=n.tryGetSummary(e.clientSequenceNumber),t&&t.broadcast(e)),t||(t=y.createFromOp(e),n&&n.setSummary(t)),this.pendingSummaries.set(e.sequenceNumber,t),this.lastSummaryTimestamp=e.timestamp,this.emit(E.Summarize,e)}handleSummaryAck(e){const t=e.contents.summaryProposal.summarySequenceNumber,n=this.pendingSummaries.get(t);n&&void 0!==n.summaryOp?(n.ackNack(e),this.pendingSummaries.delete(t),(!this.lastAck||t>this.lastAck.summaryAck.contents.summaryProposal.summarySequenceNumber)&&(this.lastAck={summaryOp:n.summaryOp,summaryAck:e},this.refreshWaitNextAck.resolve(),this.refreshWaitNextAck=new jt,this.emit(E.SummaryAck,e))):t>=this.deltaManager.initialSequenceNumber&&this.logger.sendErrorEvent({eventName:"SummaryAckWithoutOp",sequenceNumber:e.sequenceNumber,summarySequenceNumber:t,initialSequenceNumber:this.deltaManager.initialSequenceNumber})}handleSummaryNack(e){const t=e.contents.summaryProposal.summarySequenceNumber,n=this.pendingSummaries.get(t);n&&(n.ackNack(e),this.pendingSummaries.delete(t),this.emit(E.SummaryNack,e))}}class I extends Ke{constructor(e,t,n){super(),this.clientMap=new Map,this.rootNode={sequenceNumber:-1,olderClient:void 0,youngerClient:void 0},this._youngestClient=this.rootNode,this.logger=rt.create(e,"OrderedClientCollection");const i=n.getMembers();for(const[o,h]of i)this.addClient(o,h);n.on("addMember",(o,h)=>{const w=this.addClient(o,h);this.emit("addClient",w,t.lastSequenceNumber)}),n.on("removeMember",o=>{const h=t.lastSequenceNumber,w=this.removeClient(o);void 0===w?this.logger.sendErrorEvent({eventName:"ClientNotFound",clientId:o,sequenceNumber:h}):this.emit("removeClient",w,h)})}get count(){return this.clientMap.size}get oldestClient(){return this.rootNode.youngerClient}addClient(e,t){S(t.sequenceNumber>-1,502);let n=this._youngestClient;for(;n.sequenceNumber>t.sequenceNumber;)S(void 0!==n.olderClient,503),n=n.olderClient;const i={clientId:e,sequenceNumber:t.sequenceNumber,client:Object.assign({},t.client),olderClient:n,youngerClient:n.youngerClient};return i.olderClient.youngerClient=i,void 0===i.youngerClient?this._youngestClient=i:i.youngerClient.olderClient=i,this.clientMap.set(e,i),i}removeClient(e){const t=this.clientMap.get(e);if(void 0!==t)return t.olderClient.youngerClient=t.youngerClient,void 0===t.youngerClient?this._youngestClient=t.olderClient:t.youngerClient.olderClient=t.olderClient,this.clientMap.delete(e),t}getAllClients(){const e=[];let t=this.rootNode;for(;void 0!==t.youngerClient;)e.push(t.youngerClient),t=t.youngerClient;return e}}class T extends Ke{constructor(e,t,n,i){let o,h;super(),this.orderedClientCollection=t,this.isEligibleFn=i,this._eligibleCount=0;for(const w of t.getAllClients())this.addClient(w,0),"number"!=typeof n&&(w.clientId===n.electedClientId&&(o=w,void 0===n.electedParentId&&w.client.details.type!==vn&&(h=w)),w.clientId===n.electedParentId&&(h=w));t.on("addClient",(w,D)=>this.addClient(w,D)),t.on("removeClient",(w,D)=>this.removeClient(w,D)),"number"==typeof n?this._electionSequenceNumber=n:(o?.clientId!==n.electedClientId?e.sendErrorEvent({eventName:"InitialElectedClientNotFound",electionSequenceNumber:n.electionSequenceNumber,expectedClientId:n.electedClientId,electedClientId:o?.clientId,clientCount:t.count}):void 0!==o&&!i(o)&&(o=h=this.findFirstEligibleParent(h),e.sendErrorEvent({eventName:"InitialElectedClientIneligible",electionSequenceNumber:n.electionSequenceNumber,expectedClientId:n.electedClientId,electedClientId:o?.clientId})),this._electedParent=h,this._electedClient=o,this._electionSequenceNumber=n.electionSequenceNumber)}get eligibleCount(){return this._eligibleCount}get electionSequenceNumber(){return this._electionSequenceNumber}get electedClient(){return this._electedClient}get electedParent(){return this._electedParent}tryElectingClient(e,t){let n=!1;const i=e?.client.details.type===vn,o=this._electedClient;this._electedClient!==e&&(this._electionSequenceNumber=t,this._electedClient=e,n=!0),this._electedParent!==e&&!i&&(this._electedParent=e,n=!0),n&&this.emit("election",e,t,o)}tryElectingParent(e,t){this._electedParent!==e&&(this._electedParent=e,this.emit("election",this._electedClient,t,this._electedClient))}findFirstEligibleParent(e){let t=e;for(;void 0!==t&&(!this.isEligibleFn(t)||t.client.details.type===vn);)t=t.youngerClient;return t}addClient(e,t){var n;if(this.isEligibleFn(e)){this._eligibleCount++;const i=e.client.details.type===vn,o=(null===(n=this._electedClient)||void 0===n?void 0:n.client.details.type)===vn;void 0===this._electedClient||!o&&i?this.tryElectingClient(e,t):void 0===this._electedParent&&!i&&this.tryElectingParent(e,t)}}removeClient(e,t){var n,i,o,h,w;if(this.isEligibleFn(e))if(this._eligibleCount--,this._electedClient===e)if(this._electedParent!==e){if(this._electedClient.client.details.type!==vn)throw new wt("Elected client should be a summarizer client 1");this.tryElectingClient(this._electedParent,t)}else{const D=null!==(i=this.findFirstEligibleParent(null===(n=this._electedParent)||void 0===n?void 0:n.youngerClient))&&void 0!==i?i:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingClient(D,t)}else if(this._electedParent===e){if((null===(o=this._electedClient)||void 0===o?void 0:o.client.details.type)!==vn)throw new wt("Elected client should be a summarizer client 2");const D=null!==(w=this.findFirstEligibleParent(null===(h=this._electedParent)||void 0===h?void 0:h.youngerClient))&&void 0!==w?w:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);this.tryElectingParent(D,t)}}getAllEligibleClients(){return this.orderedClientCollection.getAllClients().filter(this.isEligibleFn)}incrementElectedClient(e){var t,n;const i=null!==(n=this.findFirstEligibleParent(null===(t=this._electedParent)||void 0===t?void 0:t.youngerClient))&&void 0!==n?n:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(i,e):this.tryElectingParent(i,e)}resetElectedClient(e){const t=this.findFirstEligibleParent(this.orderedClientCollection.oldestClient);void 0===this._electedClient||this._electedClient===this._electedParent?this.tryElectingClient(t,e):this.tryElectingParent(t,e)}peekNextElectedClient(){var e,t;return null!==(t=this.findFirstEligibleParent(null===(e=this._electedParent)||void 0===e?void 0:e.youngerClient))&&void 0!==t?t:this.findFirstEligibleParent(this.orderedClientCollection.oldestClient)}serialize(){var e,t;return{electionSequenceNumber:this.electionSequenceNumber,electedClientId:null===(e=this.electedClient)||void 0===e?void 0:e.clientId,electedParentId:null===(t=this.electedParent)||void 0===t?void 0:t.clientId}}}class L{constructor(e,t,n){this.delayWindowMs=e,this.maxDelayMs=t,this.delayFn=n,this.startTimes=[]}get numAttempts(){return this.startTimes.length}getAttempts(){return[...this.startTimes]}get latestAttemptTime(){return this.startTimes.length>0?this.startTimes[this.startTimes.length-1]:void 0}getDelay(){const e=Date.now(),t=this.latestAttemptTime;if(void 0!==t){const i=t-e;i>0&&(this.startTimes=this.startTimes.map(o=>o-i))}this.startTimes=this.startTimes.filter(i=>e-i<this.delayWindowMs);const n=Math.min(this.delayFn(this.startTimes.length),this.maxDelayMs);return this.startTimes.push(e),this.startTimes=this.startTimes.map(i=>i+n),n===this.maxDelayMs&&this.startTimes.shift(),n}}new Promise(()=>{});class O{constructor(e){this.runtime=e,this._cancelled=!1,this.stopDeferred=new jt}get cancelled(){return this._cancelled||S(this.runtime.deltaManager.active,605),this._cancelled}get waitCancelled(){return this.stopDeferred.promise}static create(e){return(0,l.Z)(function*(){const t=new O(e);return yield t.waitStart(),t})()}waitStart(){var e=this;return(0,l.Z)(function*(){if(e.runtime.disposed)e.stop("summarizerClientDisconnected");else{if(e.runtime.once("dispose",()=>e.stop("summarizerClientDisconnected")),!e.runtime.connected){const t=new Promise(n=>e.runtime.once("connected",n));yield Promise.race([t,e.waitCancelled])}e.runtime.once("disconnected",()=>e.stop("summarizerClientDisconnected"))}})()}stop(e){this._cancelled||(this._cancelled=!0,this.stopDeferred.resolve(e))}}class j{constructor(e,t,n,i,o=(()=>Re.now())){this.batchEventEmitter=e,this.trackedBatchCount=0,this.logger=rt.create(t,"Batching"),this.batchEventEmitter.on("batchBegin",h=>{this.startBatchSequenceNumber=h.sequenceNumber,this.batchProcessingStartTimeStamp=o(),this.trackedBatchCount++}),this.batchEventEmitter.on("batchEnd",(h,w)=>{S(void 0!==this.startBatchSequenceNumber&&void 0!==this.batchProcessingStartTimeStamp,698);const D=w.sequenceNumber-this.startBatchSequenceNumber+1;D>=n&&this.logger.sendErrorEvent({eventName:"LengthTooBig",length:D,threshold:n,batchEndSequenceNumber:w.sequenceNumber,duration:o()-this.batchProcessingStartTimeStamp,batchError:void 0!==h}),this.trackedBatchCount%i==0&&this.logger.sendPerformanceEvent({eventName:"Length",length:D,samplingRate:i,batchEndSequenceNumber:w.sequenceNumber,duration:o()-this.batchProcessingStartTimeStamp}),this.startBatchSequenceNumber=void 0,this.batchProcessingStartTimeStamp=void 0})}}class J{constructor(e,t){this.storageGetter=e,this.blobs=t}static serializeTree(e,t){var n=this;return(0,l.Z)(function*(){const i={};return yield n.serializeTreeCore(e,i,t),i})()}static serializeTreeCore(e,t,n){var i=this;return(0,l.Z)(function*(){const o=[];for(const h of Object.values(e.trees))o.push(i.serializeTreeCore(h,t,n));for(const h of Object.values(e.blobs)){const w=yield n.readBlob(h);t[h]=ne(w,"utf8")}return Promise.all(o)})()}static serializeTreeWithBlobContents(e){const t={};return this.serializeTreeWithBlobContentsCore(e,t),t}static serializeTreeWithBlobContentsCore(e,t){for(const n of Object.values(e.trees))this.serializeTreeWithBlobContentsCore(n,t);for(const n of Object.values(e.blobs)){const i=e.blobsContents[n];S(!!i,748),t[n]=ne(i,"utf8")}}get storage(){return this._storage||(this._storage=this.storageGetter()),this._storage}get repositoryUrl(){return this.storage.repositoryUrl}readBlob(e){var t=this;return(0,l.Z)(function*(){return void 0!==t.blobs[e]?X(t.blobs[e],"utf8"):t.storage.readBlob(e)})()}getSnapshotTree(e){var t=this;return(0,l.Z)(function*(){return t.storage.getSnapshotTree(e)})()}getVersions(e,t){var n=this;return(0,l.Z)(function*(){return n.storage.getVersions(e,t)})()}createBlob(e){var t=this;return(0,l.Z)(function*(){return t.storage.createBlob(e)})()}uploadSummaryWithContext(e,t){var n=this;return(0,l.Z)(function*(){return n.storage.uploadSummaryWithContext(e,t)})()}downloadSummary(e){var t=this;return(0,l.Z)(function*(){return t.storage.downloadSummary(e)})()}}class re{constructor(e,t){this.messageSize=new Map,this._nonSystemOpCount=0,this._opsSizeAccumulator=0,!t&&(e.inbound.on("push",n=>{var i;const o="string"==typeof n.contents?n.contents:null!==(i=JSON.stringify(n.contents))&&void 0!==i?i:"",h=re.messageHasData(n)?n.data:"";this.messageSize[re.messageId(n)]=o.length+h.length}),e.on("op",n=>{var i;this._nonSystemOpCount+=Ir(n)?1:0;const o=re.messageId(n);this._opsSizeAccumulator+=null!==(i=this.messageSize[o])&&void 0!==i?i:0,this.messageSize.delete(o)}))}get nonSystemOpCount(){return this._nonSystemOpCount}get opsSizeAccumulator(){return this._opsSizeAccumulator}static messageId(e){return e.sequenceNumber}static messageHasData(e){return void 0!==e.data}reset(){this._nonSystemOpCount=0,this._opsSizeAccumulator=0}}var le=(()=>{return(u=le||(le={})).FluidDataStoreOp="component",u.Attach="attach",u.ChunkedOp="chunkedOp",u.BlobAttach="blobAttach",u.Rejoin="rejoin",u.Alias="alias",le;var u})();const ee={state:"enabled",idleTime:15e3,maxTime:6e4,maxOps:100,minOpsForLastSummaryAttempt:10,maxAckWaitTime:6e4,maxOpsSinceLastSummary:7e3,initialSummarizerDelayMs:5e3,summarizerClientElection:!1};var oe=(()=>{return(u=oe||(oe={})).wait="wait",u.externalRequest="externalRequest",u.viaHandle="viaHandle",oe;var u})();const et=be.FlushMode.TurnBased;class cn{constructor(e,t){this.deltaManager=e,this.logger=t,this.localPaused=!1,this.timePaused=0,this.batchCount=0,this.deltaManager.on("prepareSend",i=>{if(0===i.length)return;const o=i[0].metadata;if(!o?.batch)return;if(1===i.length)return void delete o.batch;const h=i[i.length-1];h.metadata=Object.assign(Object.assign({},h.metadata),{batch:!1})}),this.deltaManager.inbound.on("push",i=>{this.trackPending(i)}),S(!this.localPaused,659);const n=this.deltaManager.inbound.toArray();for(const i of n)this.trackPending(i);this.deltaManager.on("op",i=>this.afterOpProcessing(i.sequenceNumber))}afterOpProcessing(e){S(!this.localPaused,660),0!==this.deltaManager.inbound.length?void 0!==this.pauseSequenceNumber&&(S(e<this.pauseSequenceNumber,662),e+1===this.pauseSequenceNumber&&this.pauseQueue()):S(void 0===this.pauseSequenceNumber,661)}pauseQueue(){S(!this.localPaused,663),this.localPaused=!0,this.timePaused=Re.now(),this.deltaManager.inbound.pause()}resumeQueue(e,t){const n=t.sequenceNumber,i=this.localPaused?Re.now()-this.timePaused:void 0;this.batchCount++,this.batchCount%1e3==1&&this.logger.sendTelemetryEvent({eventName:"BatchStats",sequenceNumber:n,length:n-e+1,msnDistance:n-t.minimumSequenceNumber,duration:i,batchCount:this.batchCount,interrupted:this.localPaused}),this.localPaused&&(this.localPaused=!1,void 0!==i&&i>5e3&&this.logger.sendErrorEvent({eventName:"MaxBatchWaitTimeExceeded",duration:i,sequenceNumber:n,length:n-e}),this.deltaManager.inbound.resume())}trackPending(e){S(0!==this.deltaManager.inbound.length,664),S(void 0===this.currentBatchClientId==(void 0===this.pauseSequenceNumber),665);const n=e.metadata?.batch;if(!Or(e))return S(void 0===this.currentBatchClientId,666),S(void 0===n,667),void S(!this.localPaused,668);if(void 0!==this.currentBatchClientId||void 0!==n){if((void 0!==this.currentBatchClientId||!1===n)&&this.currentBatchClientId!==e.clientId)throw new zn("OpBatchIncomplete",Object.assign({runtimeVersion:oi,batchClientId:this.currentBatchClientId},dr(e)));n?(S(void 0===this.currentBatchClientId,670),S(!this.localPaused,671),this.pauseSequenceNumber=e.sequenceNumber,this.currentBatchClientId=e.clientId,1===this.deltaManager.inbound.length&&this.pauseQueue()):!1===n?(S(void 0!==this.pauseSequenceNumber,672),this.resumeQueue(this.pauseSequenceNumber,e),this.pauseSequenceNumber=void 0,this.currentBatchClientId=void 0):S(void 0!==this.currentBatchClientId,673)}else S(!this.localPaused,669)}}class Pn{constructor(e,t,n){this.deltaManager=e,this.emitter=t,this.logger=n,this.hitError=!1,this.deltaScheduler=new mt(this.deltaManager,rt.create(this.logger,"DeltaScheduler")),new cn(e,n)}beforeOpProcessing(e){var t;this.batchClientId!==e.clientId&&(S(void 0===this.batchClientId,674),this.emitter.emit("batchBegin",e),this.deltaScheduler.batchBegin(e),this.batchClientId=(null===(t=e?.metadata)||void 0===t?void 0:t.batch)?e.clientId:void 0)}afterOpProcessing(e,t){var n;if(S(!this.hitError,675),e)return this.hitError=!0,this.batchClientId=void 0,this.emitter.emit("batchEnd",e,t),void this.deltaScheduler.batchEnd(t);const i=null===(n=t?.metadata)||void 0===n?void 0:n.batch;return void 0===this.batchClientId||!1===i?(this.batchClientId=void 0,this.emitter.emit("batchEnd",void 0,t),void this.deltaScheduler.batchEnd(t)):void 0}}const an="_scheduler";class ln extends Ke{constructor(e,t,n,i,o,h,w,D,_,U,Q,Y,ye,Fe){var De,Ee,ke,ze,We,$e,dt,Dt,qt,St;void 0===Fe&&(Fe=Object.assign(Object.assign({},ee),null===(Ee=w.summaryOptions)||void 0===Ee?void 0:Ee.summaryConfigOverrides)),super(),De=this,this.context=e,this.registry=t,this.runtimeOptions=w,this.containerScope=D,this.logger=_,this._storage=Y,this.requestHandler=ye,this.summaryConfiguration=Fe,this.defaultMaxConsecutiveReconnects=15,this._orderSequentiallyCalls=0,this.needsFlush=!1,this.flushTrigger=!1,this.savedOps=[],this.consecutiveReconnects=0,this._disposed=!1,this.emitDirtyDocumentEvent=!0,this.defaultTelemetrySignalSampleCount=100,this._perfSignalData={signalsLost:0,signalSequenceNumber:0,signalTimestamp:0,trackingSignalSequenceNumber:void 0},this.summarizeOnDemand=(...Qe)=>{if(this.clientDetails.type===vn)return this.summarizer.summarizeOnDemand(...Qe);if(void 0!==this.summaryManager)return this.summaryManager.summarizeOnDemand(...Qe);throw new wt(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.enqueueSummarize=(...Qe)=>{if(this.clientDetails.type===vn)return this.summarizer.enqueueSummarize(...Qe);if(void 0!==this.summaryManager)return this.summaryManager.enqueueSummarize(...Qe);throw new wt(`Can't summarize, disableSummaries: ${this.summariesDisabled}`)},this.messageAtLastSummary=n?.message,this.disableIsolatedChannels=null!==(ke=this.runtimeOptions.summaryOptions.disableIsolatedChannels)&&void 0!==ke&&ke,this._connected=this.context.connected,this.chunkMap=new Map(o),this.handleContext=new xa("",this),this.mc=gt(rt.create(this.logger,"ContainerRuntime")),this.summariesDisabled=this.isSummariesDisabled(),this.heuristicsDisabled=this.isHeuristicsDisabled(),this.summarizerClientElectionEnabled=this.isSummarizerClientElectionEnabled(),this.maxOpsSinceLastSummary=this.getMaxOpsSinceLastSummary(),this.initialSummarizerDelayMs=this.getInitialSummarizerDelayMs(),this._aliasingEnabled=null!==(ze=this.mc.config.getBoolean("Fluid.ContainerRuntime.UseDataStoreAliasing"))&&void 0!==ze&&ze||null!==(We=w.useDataStoreAliasing)&&void 0!==We&&We,this._maxOpSizeInBytes=null!==($e=this.mc.config.getNumber("Fluid.ContainerRuntime.MaxOpSizeInBytes"))&&void 0!==$e?$e:768e3,this.maxConsecutiveReconnects=null!==(dt=this.mc.config.getNumber("Fluid.ContainerRuntime.MaxConsecutiveReconnects"))&&void 0!==dt?dt:this.defaultMaxConsecutiveReconnects,this._flushMode=w.flushMode;const Gt=e.pendingLocalState,hn=null!==(Dt=Gt?.baseSnapshot)&&void 0!==Dt?Dt:e.baseSnapshot;var Qe;this.garbageCollector=Zr.create({runtime:this,gcOptions:this.runtimeOptions.gcOptions,baseSnapshot:hn,baseLogger:this.mc.logger,existing:U,metadata:n,isSummarizerClient:this.context.clientDetails.type===vn,getNodePackagePath:(Qe=(0,l.Z)(function*(Wt){return De.getGCNodePackagePath(Wt)}),function(xn){return Qe.apply(this,arguments)}),getLastSummaryTimestampMs:()=>{var Qe;return null===(Qe=this.messageAtLastSummary)||void 0===Qe?void 0:Qe.timestamp},readAndParseBlob:function(){var Qe=(0,l.Z)(function*(Wt){return V(De.storage,Wt)});return function(xn){return Qe.apply(this,arguments)}}()});const dn=this.deltaManager.initialSequenceNumber;if(this.summarizerNode=((u,e,t,n,i={},o,h)=>new Ri(u,e,i,t,void 0===n?void 0:pr.createForRoot(n),void 0,void 0,o,h))(rt.create(this.logger,"SummarizerNode"),function(){var Qe=(0,l.Z)(function*(Wt,xn,Qt){return De.summarizeInternal(Wt,xn,Qt)});return function(Wt,xn,Qt){return Qe.apply(this,arguments)}}(),dn,hn?dn:void 0,{canReuseHandle:!1,throwOnFailure:!0,gcDisabled:!this.garbageCollector.shouldRunGC}),hn&&this.summarizerNode.loadBaseSummaryWithoutDifferential(hn),this.dataStores=new N(P(hn,n),this,Qe=>this.submit(le.Attach,Qe),(Qe,Wt)=>(xn,Qt,wn)=>this.summarizerNode.createChild(xn,Qe,Wt,void 0,Qt,wn),Qe=>this.summarizerNode.deleteChild(Qe),this.mc.logger,(0,l.Z)(function*(){return De.garbageCollector.getBaseGCDetails()}),(Qe,Wt,xn)=>this.garbageCollector.nodeUpdated(Qe,"Changed",Wt,xn),new Map(h),this.garbageCollector.writeDataAtRoot),this.blobManager=new Ar(this.handleContext,Q,()=>this.storage,Qe=>this.submit(le.BlobAttach,void 0,void 0,{blobId:Qe}),Qe=>this.garbageCollector.nodeUpdated(Qe,"Loaded"),this,this.logger),this.scheduleManager=new Pn(e.deltaManager,this,rt.create(this.logger,"ScheduleManager")),this.deltaSender=this.deltaManager,this.pendingStateManager=new Rn({applyStashedOp:this.applyStashedOp.bind(this),clientId:()=>this.clientId,close:this.closeFn,connected:()=>this.connected,flush:this.flush.bind(this),flushMode:()=>this.flushMode,reSubmit:this.reSubmit.bind(this),rollback:this.rollback.bind(this),setFlushMode:Qe=>this.setFlushMode(Qe)},this._flushMode,Gt?.pending),this.context.quorum.on("removeMember",Qe=>{this.clearPartialChunks(Qe)}),this.summaryCollection=new C(this.deltaManager,this.logger),this.dirtyContainer=this.context.attachState!==we.Attached||this.pendingStateManager.hasPendingMessages(),this.context.updateDirtyContainerState(this.dirtyContainer),this.summariesDisabled)this.mc.logger.sendTelemetryEvent({eventName:"SummariesDisabled"});else{const Qe=rt.create(this.logger,"OrderedClientElection"),Wt=new I(Qe,this.context.deltaManager,this.context.quorum),xn=new T(Qe,Wt,i??this.context.deltaManager.lastSequenceNumber,_i.isClientEligible);if(this.summarizerClientElection=new _i(Qe,this.summaryCollection,xn,this.maxOpsSinceLastSummary,this.summarizerClientElectionEnabled),this.context.clientDetails.type===vn)this._summarizer=new mr("/_summarizer",this,()=>this.summaryConfiguration,this,this.handleContext,this.summaryCollection,function(){var Qt=(0,l.Z)(function*(wn){return O.create(wn)});return function(wn){return Qt.apply(this,arguments)}}());else if(_i.clientDetailsPermitElection(this.context.clientDetails)){const Qt=()=>{this.summaryCollection.opsSinceLastAck>this.maxOpsSinceLastSummary&&(this.logger.sendErrorEvent({eventName:"SummaryStatus:Behind"}),this.summaryCollection.once(E.SummaryAck,()=>{this.logger.sendTelemetryEvent({eventName:"SummaryStatus:CaughtUp"}),this.summaryCollection.on("default",Qt)}),this.summaryCollection.off("default",Qt))};this.summaryCollection.on("default",Qt),this.summaryManager=new zr(this.summarizerClientElection,this,this.summaryCollection,this.logger,this.formRequestSummarizerFn(this.context.loader),new L(6e4,3e4,(({multiplier:u=2,coefficient:e=1,offset:t=0,initialDelay:n}={})=>i=>Math.max(0,i<=0&&void 0!==n?n:e*Math.pow(u,i)+t))({coefficient:20,initialDelay:0})),{initialDelayMs:this.initialSummarizerDelayMs},this.heuristicsDisabled),this.summaryManager.start()}}let On;this.deltaManager.on("readonly",Qe=>{S(Qe===this.deltaManager.readOnlyInfo.readonly,292),S(!Qe||!this.connected,293),this.replayPendingStates()}),_.sendTelemetryEvent(Object.assign({eventName:"DeviceSpec"},function gn(){try{if("object"==typeof navigator&&null!==navigator)return{deviceMemory:navigator.deviceMemory,hardwareConcurrency:navigator.hardwareConcurrency}}catch{}return{}}())),U?(this.createContainerMetadata={createContainerRuntimeVersion:n?.createContainerRuntimeVersion,createContainerTimestamp:n?.createContainerTimestamp},On=null!==(St=null!==(qt=n?.summaryNumber)&&void 0!==qt?qt:n?.summaryCount)&&void 0!==St?St:0):(this.createContainerMetadata={createContainerRuntimeVersion:oi,createContainerTimestamp:Date.now()},On=0),this.nextSummaryNumber=On+1,this.logger.sendTelemetryEvent(Object.assign(Object.assign(Object.assign({eventName:"ContainerLoadStats"},this.createContainerMetadata),this.dataStores.containerLoadStats),{summaryNumber:On,summaryFormatVersion:n?.summaryFormatVersion,disableIsolatedChannels:n?.disableIsolatedChannels,gcVersion:n?.gcFeature})),function Ra(u,e,t){new Ho(u,e,t)}(this.context.clientId,this.deltaManager,this.logger),((u,e,t=1e3,n=1e3)=>{new j(this,this.logger,t,n)})(),this.opTracker=new re(this.deltaManager,!0===this.mc.config.getBoolean("Fluid.ContainerRuntime.DisableOpTracking"))}get IContainerRuntime(){return this}get IFluidRouter(){return this}static load(e,t,n,i={},o=e.scope,h){return(0,l.Z)(function*(){var w,D,_;const Q=null!==(w=e.taggedLogger)&&void 0!==w?w:new na(e.logger),Y=rt.create(Q,void 0,{all:{runtimeVersion:oi}}),{summaryOptions:ye={},gcOptions:Fe={},loadSequenceNumberVerification:De="close",useDataStoreAliasing:Ee=!1,flushMode:ke=et,enableOfflineLoad:ze=!1}=i,We=e.pendingLocalState,$e=null!==(D=We?.baseSnapshot)&&void 0!==D?D:e.baseSnapshot,dt=We?new J(()=>e.storage,We.snapshotBlobs):e.storage,Dt=new Oi(t),qt=function(){var Qt=(0,l.Z)(function*(wn){const ns=$e?.blobs[wn];if($e&&ns)return S(void 0!==dt,501),V(dt,ns)});return function(ns){return Qt.apply(this,arguments)}}(),[St,Gt,hn,dn]=yield Promise.all([qt(Gr),qt(Tr),qt(Ce),qt(Ps)]),On=!0===h||!0===e.existing,Qe=yield Ar.load($e?.trees[ct],function(){var Qt=(0,l.Z)(function*(wn){return S(void 0!==dt,598),V(dt,wn)});return function(wn){return Qt.apply(this,arguments)}}()),Wt=null===(_=Gt?.message)||void 0===_?void 0:_.sequenceNumber;if(!We&&void 0!==Wt){const Qt=e.deltaManager.initialSequenceNumber;if("bypass"!==De&&Wt!==Qt){const wn=new zn("Summary metadata mismatch",{runtimeVersion:oi,runtimeSequenceNumber:Wt,protocolSequenceNumber:Qt});"log"===De?Y.sendErrorEvent({eventName:"SequenceNumberMismatch"},wn):e.closeFn(wn)}}const xn=new ln(e,Dt,Gt,hn,St??[],dn??[],{summaryOptions:ye,gcOptions:Fe,loadSequenceNumberVerification:De,useDataStoreAliasing:Ee,flushMode:ke,enableOfflineLoad:ze},o,Y,On,Qe,dt,n);return We&&(yield xn.processSavedOps(We),We.savedOps=[]),yield xn.getSnapshotBlobs(),xn})()}get options(){return this.context.options}get clientId(){return this.context.clientId}get clientDetails(){return this.context.clientDetails}get deltaManager(){return this.context.deltaManager}get storage(){return this._storage}get reSubmitFn(){return this.reSubmit}get closeFn(){return this.context.closeFn}get flushMode(){return this._flushMode}get scope(){return this.containerScope}get IFluidDataStoreRegistry(){return this.registry}get attachState(){return this.context.attachState}get IFluidHandleContext(){return this.handleContext}get connected(){return this._connected}get summarizerClientId(){var e;return null===(e=this.summarizerClientElection)||void 0===e?void 0:e.electedClientId}get disposed(){return this._disposed}get summarizer(){return S(void 0!==this._summarizer,599),this._summarizer}isSummariesDisabled(){return!0===this.runtimeOptions.summaryOptions.disableSummaries||"disabled"===this.summaryConfiguration.state}isHeuristicsDisabled(){var e;return!0===(null===(e=this.runtimeOptions.summaryOptions.summarizerOptions)||void 0===e?void 0:e.disableHeuristics)||"disableHeuristics"===this.summaryConfiguration.state}isSummarizerClientElectionEnabled(){var e;return this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection")?null===(e=this.mc.config.getBoolean("Fluid.ContainerRuntime.summarizerClientElection"))||void 0===e||e:!0===this.runtimeOptions.summaryOptions.summarizerClientElection||"disabled"!==this.summaryConfiguration.state&&!0===this.summaryConfiguration.summarizerClientElection}getMaxOpsSinceLastSummary(){return void 0!==this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary?this.runtimeOptions.summaryOptions.maxOpsSinceLastSummary:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.maxOpsSinceLastSummary:0}getInitialSummarizerDelayMs(){return void 0!==this.runtimeOptions.summaryOptions.initialSummarizerDelayMs?this.runtimeOptions.summaryOptions.initialSummarizerDelayMs:"disabled"!==this.summaryConfiguration.state?this.summaryConfiguration.initialSummarizerDelayMs:0}dispose(e){var t;this._disposed||(this._disposed=!0,this.logger.sendTelemetryEvent({eventName:"ContainerRuntimeDisposed",isDirty:this.isDirty,lastSequenceNumber:this.deltaManager.lastSequenceNumber,attachState:this.attachState},e),void 0!==this.summaryManager&&this.summaryManager.dispose(),this.garbageCollector.dispose(),null===(t=this._summarizer)||void 0===t||t.dispose(),this.dataStores.dispose(),this.pendingStateManager.dispose(),this.emit("dispose"),this.removeAllListeners())}get IFluidTokenProvider(){var e;if(null!==(e=this.options)&&void 0!==e&&e.intelligence)return{intelligence:this.options.intelligence}}request(e){var t=this;return(0,l.Z)(function*(){try{const n=Un.create(e);return"_summarizer"===n.pathParts[0]&&1===n.pathParts.length?void 0!==t._summarizer?{status:200,mimeType:"fluid/object",value:t.summarizer}:kn(e):void 0!==t.requestHandler?t.requestHandler(n,t):kn(e)}catch(n){return Br(n)}})()}resolveHandle(e){var t=this;return(0,l.Z)(function*(){try{const n=Un.create(e),i=n.pathParts[0];if("_channels"===i)return t.resolveHandle(n.createSubRequest(1));if(i===Ar.basePath&&n.isLeaf(2)){const o=yield t.blobManager.getBlob(n.pathParts[1]);return o?{status:200,mimeType:"fluid/object",value:o.get()}:kn(e)}if(n.pathParts.length>0){const o=yield t.getDataStoreFromRequest(i,e),h=n.createSubRequest(1);return S(h.url.startsWith("/"),294),o.IFluidRouter.request(h)}return kn(e)}catch(n){return Br(n)}})()}internalId(e){var t;return null!==(t=this.dataStores.aliases().get(e))&&void 0!==t?t:e}getDataStoreFromRequest(e,t){var n=this;return(0,l.Z)(function*(){var i,o,h;const w="boolean"!=typeof(null===(i=t.headers)||void 0===i?void 0:i[oe.wait])||(null===(o=t.headers)||void 0===o?void 0:o[oe.wait]),D=n.internalId(e),_=yield n.dataStores.getDataStore(D,w);if(null!==(h=t.headers)&&void 0!==h&&h[oe.externalRequest]&&n.garbageCollector.shouldRunGC){const Y=(yield _.getBaseGCDetails()).usedRoutes;if(void 0!==Y&&!Y.includes("")&&!Y.includes("/"))throw ii(kn(t))}const U=yield _.realize(),Q=function oa(u){return u.replace(/^\/+|\/+$/g,"")}(t.url.split("?")[0]);return n.garbageCollector.nodeUpdated(`/${Q}`,"Loaded",void 0,_.packagePath,t?.headers),U})()}addMetadataToSummary(e){var t;const n=Object.assign(Object.assign(Object.assign(Object.assign({},this.createContainerMetadata),{summaryCount:this.nextSummaryNumber,summaryNumber:this.nextSummaryNumber++,summaryFormatVersion:1,disableIsolatedChannels:this.disableIsolatedChannels||void 0}),this.garbageCollector.getMetadata()),{message:null!==(u=this.deltaManager.lastMessage,t=void 0===u?void 0:{clientId:u.clientId,clientSequenceNumber:u.clientSequenceNumber,minimumSequenceNumber:u.minimumSequenceNumber,referenceSequenceNumber:u.referenceSequenceNumber,sequenceNumber:u.sequenceNumber,timestamp:u.timestamp,type:u.type})&&void 0!==t?t:this.messageAtLastSummary});var u;An(e,Tr,JSON.stringify(n))}addContainerStateToSummary(e,t,n,i){var o;if(this.addMetadataToSummary(e),this.chunkMap.size>0){const D=JSON.stringify([...this.chunkMap]);An(e,Gr,D)}const h=this.dataStores.aliases();if(h.size>0&&An(e,Ps,JSON.stringify([...h])),this.summarizerClientElection){const D=JSON.stringify(null===(o=this.summarizerClientElection)||void 0===o?void 0:o.serialize());An(e,Ce,D)}const w=this.blobManager.summarize();if(Object.keys(w.summary.tree).length>0&&function Tn(u,e,t){u.summary.tree[e]=t.summary,u.stats=Vn(u.stats,t.stats)}(e,ct,w),this.garbageCollector.writeDataAtRoot){const D=this.garbageCollector.summarize(t,n,i);void 0!==D&&function Yt(u,e,t){u.summary.tree[e]=t.summary,u.stats=Vn(u.stats,t.stats)}(e,sr,D)}}shouldContinueReconnecting(){return this.maxConsecutiveReconnects<=0||(this.pendingStateManager.hasPendingMessages()?(this.consecutiveReconnects===Math.floor(this.maxConsecutiveReconnects/2)&&this.mc.logger.sendTelemetryEvent({eventName:"ReconnectsWithNoProgress",attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}),this.consecutiveReconnects<this.maxConsecutiveReconnects):(this.resetReconnectCount(),!0))}resetReconnectCount(){this.consecutiveReconnects=0}replayPendingStates(){if(!this.canSendOps())return;const e=this.dirtyContainer;let t;this.dirtyContainer=!1,S(this.emitDirtyDocumentEvent,295),this.emitDirtyDocumentEvent=!1;try{this.pendingStateManager.replayPendingStates()}finally{t=this.dirtyContainer,this.dirtyContainer=e,this.emitDirtyDocumentEvent=!0}this.updateDocumentDirtyState(t)}applyStashedOp(e,t){var n=this;return(0,l.Z)(function*(){switch(e){case le.FluidDataStoreOp:return n.dataStores.applyStashedOp(t);case le.Attach:return n.dataStores.applyStashedAttachOp(t);case le.Alias:case le.BlobAttach:return;case le.ChunkedOp:throw new Error("chunkedOp not expected here");case le.Rejoin:throw new Error("rejoin not expected here");default:En(0,`Unknown ContainerMessageType: ${e}`)}})()}setConnectionState(e,t){this.verifyNotClosed();const n=this._connected!==e,i=n&&e;this._connected=e,e||(this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0,this._perfSignalData.trackingSignalSequenceNumber=void 0),!i||(this.consecutiveReconnects++,this.shouldContinueReconnecting())?(n&&this.replayPendingStates(),this.dataStores.setConnectionState(e,t),Fi(this.mc.logger,this,e,t)):this.closeFn(Cn.create("Runtime detected too many reconnects with no progress syncing local ops","setConnectionState",void 0,{dataLoss:1,attempts:this.consecutiveReconnects,pendingMessages:this.pendingStateManager.pendingMessagesCount}))}process(e,t){var n,i;if(this.verifyNotClosed(),!Or(e))return;(null!==(n=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==n?n:this.runtimeOptions.enableOfflineLoad)&&this.savedOps.push(e);let o=Object.assign({},e);this.scheduleManager.beforeOpProcessing(o);try{let h;switch(o=function vt(u){if(u.type===E.Operation){if(void 0!==u.contents.address&&void 0===u.contents.type)u.type=le.FluidDataStoreOp;else{const e=u.contents;S(void 0!==e.type,289),u.type=e.type,u.contents=e.contents}S(Or(u),290)}return u}(o),o=this.processRemoteChunkedMessage(o),t&&o.type!==le.ChunkedOp&&(h=this.pendingStateManager.processPendingLocalMessage(o)),this.pendingStateManager.hasPendingMessages()||this.updateDocumentDirtyState(!1),o.type){case le.Attach:this.dataStores.processAttachMessage(o,t);break;case le.Alias:this.processAliasMessage(o,h,t);break;case le.FluidDataStoreOp:this.dataStores.processFluidDataStoreOp(o,t,h);break;case le.BlobAttach:S(null===(i=o?.metadata)||void 0===i?void 0:i.blobId,298),this.blobManager.processBlobAttachOp(o.metadata.blobId,t)}this.emit("op",o),this.scheduleManager.afterOpProcessing(void 0,o),t&&this.resetReconnectCount()}catch(h){throw this.scheduleManager.afterOpProcessing(h,o),h}}processAliasMessage(e,t,n){this.dataStores.processAliasMessage(e,t,n)}sendSignalTelemetryEvent(e){const t=Date.now()-this._perfSignalData.signalTimestamp;this.logger.sendPerformanceEvent({eventName:"SignalLatency",duration:t,signalsLost:this._perfSignalData.signalsLost}),this._perfSignalData.signalsLost=0,this._perfSignalData.signalTimestamp=0}processSignal(e,t){const n=e.content,i={clientId:e.clientId,content:n.contents.content,type:n.contents.type};e.clientId===this.clientId&&this.connected&&(void 0!==this._perfSignalData.trackingSignalSequenceNumber&&n.clientSignalSequenceNumber>this._perfSignalData.trackingSignalSequenceNumber?(this._perfSignalData.signalsLost++,this._perfSignalData.trackingSignalSequenceNumber=void 0,this.logger.sendErrorEvent({eventName:"SignalLost",type:n.contents.type,signalsLost:this._perfSignalData.signalsLost,trackingSequenceNumber:this._perfSignalData.trackingSignalSequenceNumber,clientSignalSequenceNumber:n.clientSignalSequenceNumber})):n.clientSignalSequenceNumber===this._perfSignalData.trackingSignalSequenceNumber&&(this.sendSignalTelemetryEvent(n.clientSignalSequenceNumber),this._perfSignalData.trackingSignalSequenceNumber=void 0)),void 0!==n.address?this.dataStores.processSignal(n.address,i,t):this.emit("signal",i,t)}getRootDataStore(e,t=!0){var n=this;return(0,l.Z)(function*(){const i=n.internalId(e),o=yield n.dataStores.getDataStore(i,t);return S(yield o.isRoot(),299),o.realize()})()}setFlushMode(e){e!==this._flushMode&&(this.mc.logger.sendTelemetryEvent({eventName:"FlushMode Updated",old:this._flushMode,new:e}),e===be.FlushMode.Immediate&&this.flush(),this._flushMode=e,this.pendingStateManager.onFlushModeUpdated(e))}flush(){if(S(0===this._orderSequentiallyCalls,588),this.deltaSender&&(this.pendingStateManager.onFlush(),this.needsFlush&&(this.needsFlush=!1,this.canSendOps())))return this.deltaSender.flush()}orderSequentially(e){if(this.flushMode===be.FlushMode.TurnBased)return void this.trackOrderSequentiallyCalls(e);const t=this.flushMode;this.setFlushMode(be.FlushMode.TurnBased);try{this.trackOrderSequentiallyCalls(e),this.flush()}finally{this.setFlushMode(t)}}trackOrderSequentiallyCalls(e){let t;this.mc.config.getBoolean("Fluid.ContainerRuntime.EnableRollback")&&(t=this.pendingStateManager.checkpoint());try{this._orderSequentiallyCalls++,e()}catch(n){throw t?t.rollback():this.closeFn(new qn("orderSequentially callback exception",n)),n}finally{this._orderSequentiallyCalls--}}createDataStore(e){var t=this;return(0,l.Z)(function*(){const n=Pe();return m(yield t._createDataStore(e,!1,n),n,t,t.dataStores,t.mc.logger)})()}createRootDataStoreLegacy(e,t){var n=this;return(0,l.Z)(function*(){const i=yield n._createDataStore(e,!0,t);return void 0!==i.makeVisibleAndAttachGraph?i.makeVisibleAndAttachGraph():i.bindToContext(),i})()}createRootDataStore(e,t){var n=this;return(0,l.Z)(function*(){if(t.includes("/"))throw new wt(`Id cannot contain slashes: '${t}'`);return!0===n._aliasingEnabled?n.createAndAliasDataStore(e,t):n.createRootDataStoreLegacy(e,t)})()}createAndAliasDataStore(e,t,n){var i=this;return(0,l.Z)(function*(){const o=Pe(),h=yield i._createDataStore(e,!1,o,n),w=m(h,o,i,i.dataStores,i.mc.logger),D=yield w.trySetAlias(t);if("Success"!==D)throw new qn("dataStoreAliasFailure",void 0,{alias:{value:t,tag:Tt.UserData},internalId:{value:o,tag:Tt.PackageData},aliasResult:D});return w})()}createDetachedRootDataStore(e,t){if(t.includes("/"))throw new wt(`Id cannot contain slashes: '${t}'`);return this.dataStores.createDetachedDataStoreCore(e,!0,t)}createDetachedDataStore(e){return this.dataStores.createDetachedDataStoreCore(e,!1)}_createDataStoreWithPropsLegacy(e,t,n=Pe(),i=!1){var o=this;return(0,l.Z)(function*(){const h=yield o.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],n,i,t).realize();return i&&(void 0!==h.makeVisibleAndAttachGraph?h.makeVisibleAndAttachGraph():h.bindToContext(),o.logger.sendTelemetryEvent({eventName:"Root datastore with props",hasProps:void 0!==t})),m(h,n,o,o.dataStores,o.mc.logger)})()}_createDataStoreWithProps(e,t,n=Pe(),i=!1){var o=this;return(0,l.Z)(function*(){return!0===o._aliasingEnabled&&i?o.createAndAliasDataStore(e,n,t):o._createDataStoreWithPropsLegacy(e,t,n,i)})()}_createDataStore(e,t,n=Pe(),i){var o=this;return(0,l.Z)(function*(){return o.dataStores._createFluidDataStoreContext(Array.isArray(e)?e:[e],n,t,i).realize()})()}canSendOps(){return this.connected&&!this.deltaManager.readOnlyInfo.readonly}getQuorum(){return this.context.quorum}getAudience(){return this.context.audience}get isDirty(){return this.dirtyContainer}isContainerMessageDirtyable(e,t){if(e===le.Attach){if(t.id===an)return!1}else if(e===le.FluidDataStoreOp&&t.address===an)return!1;return!0}createNewSignalEnvelope(e,t,n){const i=++this._perfSignalData.signalSequenceNumber,o={address:e,clientSignalSequenceNumber:i,contents:{type:t,content:n}};return i%this.defaultTelemetrySignalSampleCount==1&&void 0===this._perfSignalData.trackingSignalSequenceNumber&&(this._perfSignalData.signalTimestamp=Date.now(),this._perfSignalData.trackingSignalSequenceNumber=i),o}submitSignal(e,t){this.verifyNotClosed();const n=this.createNewSignalEnvelope(void 0,e,t);return this.context.submitSignalFn(n)}submitDataStoreSignal(e,t,n){const i=this.createNewSignalEnvelope(e,t,n);return this.context.submitSignalFn(i)}setAttachState(e){e===we.Attaching?S(this.attachState===we.Attaching,301):(S(this.attachState===we.Attached,302),this.emit("attached")),e===we.Attached&&!this.pendingStateManager.hasPendingMessages()&&this.updateDocumentDirtyState(!1),this.dataStores.setAttachState(e)}createSummary(e,t){e&&this.blobManager.setRedirectTable(e);const n=this.dataStores.createSummary(t);return this.disableIsolatedChannels||Wi(n),this.addContainerStateToSummary(n,!0,!1,t),n.summary}getAbsoluteUrl(e){var t=this;return(0,l.Z)(function*(){if(void 0===t.context.getAbsoluteUrl)throw new Error("Driver does not implement getAbsoluteUrl");if(t.attachState===we.Attached)return t.context.getAbsoluteUrl(e)})()}summarizeInternal(e,t,n){var i=this;return(0,l.Z)(function*(){const o=yield i.dataStores.summarize(e,t,n);let h;return i.disableIsolatedChannels||(Wi(o),h=[be.channelsTreeName]),i.addContainerStateToSummary(o,e,t,n),Object.assign(Object.assign({},o),{id:"",pathPartsForChildren:h})})()}summarize(e){var t=this;return(0,l.Z)(function*(){t.verifyNotClosed();const{fullTree:n=!1,trackState:i=!0,summaryLogger:o=t.mc.logger,runGC:h=t.garbageCollector.shouldRunGC,runSweep:w,fullGC:D}=e;let _;h&&(_=yield t.collectGarbage({logger:o,runSweep:w,fullGC:D}));const U=new fs,{stats:Q,summary:Y}=yield t.summarizerNode.summarize(n,i,U);return t.logger.sendTelemetryEvent({eventName:"SummarizeTelemetry",details:U.serialize()}),S(Y.type===Le.Tree,303),{stats:Q,summary:Y,gcStats:_}})()}updateStateBeforeGC(){var e=this;return(0,l.Z)(function*(){return e.dataStores.updateStateBeforeGC()})()}getGCData(e){var t=this;return(0,l.Z)(function*(){const n=new Di,i=yield t.dataStores.getGCData(e);n.addNodes(i.gcNodes);const o=t.blobManager.getGCData(e);return n.addNodes(o.gcNodes),n.getGCData()})()}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""]);const n=[];for(const i of e)i.split("/")[1]!==Ar.basePath&&n.push(i);return this.dataStores.updateUsedRoutes(n,t)}deleteUnusedRoutes(e){const t=[],n=[];for(const i of e)this.isBlobPath(i)?t.push(i):n.push(i);this.blobManager.deleteUnusedRoutes(t),this.dataStores.deleteUnusedRoutes(n)}getCurrentReferenceTimestampMs(){var e,t,n;return null!==(t=null===(e=this.deltaManager.lastMessage)||void 0===e?void 0:e.timestamp)&&void 0!==t?t:null===(n=this.messageAtLastSummary)||void 0===n?void 0:n.timestamp}getNodeType(e){var t;return this.isBlobPath(e)?"Blob":null!==(t=this.dataStores.getGCNodeType(e))&&void 0!==t?t:"Other"}getGCNodePackagePath(e){var t=this;return(0,l.Z)(function*(){switch(t.getNodeType(e)){case"Blob":return["_blobs"];case"DataStore":case"SubDataStore":return t.dataStores.getDataStorePackagePath(e);default:S(!1,734)}})()}isBlobPath(e){const t=e.split("/");return!(t.length<2||t[1]!==Ar.basePath)}collectGarbage(e){var t=this;return(0,l.Z)(function*(){return t.garbageCollector.collectGarbage(e)})()}addedGCOutboundReference(e,t){this.garbageCollector.addedOutboundReference(e.absolutePath,t.absolutePath)}submitSummary(e){var t=this;return(0,l.Z)(function*(){var n,i,o;const{fullTree:h,refreshLatestAck:w,summaryLogger:D}=e,_=t.nextSummaryNumber,U=rt.create(D,void 0,{all:{summaryNumber:_}});let Q;if(w){const Y=yield t.refreshLatestSummaryAckFromServer(rt.create(U,void 0,{all:{safeSummary:!0}})),ye=Y.latestSnapshotRefSeq;Q=Y.latestSnapshotVersionId,ye>t.deltaManager.lastSequenceNumber&&(yield it.timedExecAsync(U,{eventName:"WaitingForSeq",lastSequenceNumber:t.deltaManager.lastSequenceNumber,targetSequenceNumber:ye,lastKnownSeqNumber:t.deltaManager.lastKnownSeqNumber},(0,l.Z)(function*(){return yt(t.deltaManager,ye)}),{start:!0,end:!0,cancel:"error"}))}try{yield t.deltaManager.inbound.pause();const Y=t.deltaManager.lastSequenceNumber,ye=t.deltaManager.minimumSequenceNumber,Fe=`Summary @${Y}:${t.deltaManager.minimumSequenceNumber}`;Y!==(null===(n=t.deltaManager.lastMessage)||void 0===n?void 0:n.sequenceNumber)&&U.sendErrorEvent({eventName:"LastSequenceMismatch",error:Fe}),t.summarizerNode.startSummary(Y,U);const De=()=>e.cancellationToken.cancelled?{continue:!1,error:"disconnected"}:(S(t.connected,600),t.deltaManager.lastSequenceNumber!==Y?{continue:!1,error:`lastSequenceNumber changed before uploading to storage. ${t.deltaManager.lastSequenceNumber} !== ${Y}`}:{continue:!0});let Ee=De();if(!Ee.continue)return{stage:"base",referenceSequenceNumber:Y,minimumSequenceNumber:ye,error:Ee.error};const ke=Xr.start();let ze;const We=t.garbageCollector.summaryStateNeedsReset;try{ze=yield t.summarize({fullTree:h||We,trackState:!0,summaryLogger:U,runGC:t.garbageCollector.shouldRunGC})}catch(Jr){return{stage:"base",referenceSequenceNumber:Y,minimumSequenceNumber:ye,error:Jr}}const{summary:$e,stats:dt}=ze;t.messageAtLastSummary=t.deltaManager.lastMessage;const Dt=t.disableIsolatedChannels?$e:$e.tree[be.channelsTreeName];S(Dt.type===Le.Tree,508);const qt=Object.values(Dt.tree).filter(Jr=>Jr.type===Le.Handle).length,St=$e.tree[sr]?ei($e.tree[sr]):void 0,Gt=Object.assign({dataStoreCount:t.dataStores.size,summarizedDataStoreCount:t.dataStores.size-qt,gcStateUpdatedDataStoreCount:null===(i=ze.gcStats)||void 0===i?void 0:i.updatedDataStoreCount,gcBlobNodeCount:St?.blobNodeCount,gcTotalBlobsSize:St?.totalBlobSize,opsSizesSinceLastSummary:t.opTracker.opsSizeAccumulator,nonSystemOpsSinceLastSummary:t.opTracker.nonSystemOpCount,summaryNumber:_},dt),hn={referenceSequenceNumber:Y,minimumSequenceNumber:ye,summaryTree:$e,summaryStats:Gt,generateDuration:ke.trace().duration,forcedFullTree:We};if(Ee=De(),!Ee.continue)return Object.assign(Object.assign({stage:"generate"},hn),{error:Ee.error});const dn=t.summaryCollection.latestAck;let On,Qe;On=dn?.summaryAck.contents.handle!==Q&&void 0!==Q?{proposalHandle:void 0,ackHandle:Q,referenceSequenceNumber:Y}:void 0===dn?{proposalHandle:void 0,ackHandle:null===(o=t.context.getLoadedFromVersion())||void 0===o?void 0:o.id,referenceSequenceNumber:Y}:{proposalHandle:dn.summaryOp.contents.handle,ackHandle:dn.summaryAck.contents.handle,referenceSequenceNumber:Y};try{Qe=yield t.storage.uploadSummaryWithContext(ze.summary,On)}catch(Jr){return Object.assign(Object.assign({stage:"generate"},hn),{error:Jr})}const Wt=On.ackHandle,xn={handle:Qe,head:Wt,message:Fe,parents:Wt?[Wt]:[]},Qt=Object.assign(Object.assign({},hn),{handle:Qe,uploadDuration:ke.trace().duration});if(Ee=De(),!Ee.continue)return Object.assign(Object.assign({stage:"upload"},Qt),{error:Ee.error});let wn;try{wn=t.submitSystemMessage(E.Summarize,xn)}catch(Jr){return Object.assign(Object.assign({stage:"upload"},Qt),{error:Jr})}const ns=Object.assign(Object.assign({stage:"submit"},Qt),{clientSequenceNumber:wn,submitOpDuration:ke.trace().duration});return t.summarizerNode.completeSummary(Qe),t.opTracker.reset(),ns}finally{t.summarizerNode.clearSummary(),t.deltaManager.inbound.resume()}})()}processRemoteChunkedMessage(e){if(e.type!==le.ChunkedOp)return e;const t=e.clientId,n=e.contents;if(this.addChunk(t,n),n.chunkId===n.totalChunks){const i=Object.assign({},e),o=this.chunkMap.get(t).join("");return i.contents=JSON.parse(o),i.type=n.originalType,this.clearPartialChunks(t),i}return e}addChunk(e,t){let n=this.chunkMap.get(e);void 0===n&&(n=[],this.chunkMap.set(e,n)),S(t.chunkId===n.length+1,305),n.push(t.contents)}clearPartialChunks(e){this.chunkMap.has(e)&&this.chunkMap.delete(e)}updateDocumentDirtyState(e){this.dirtyContainer!==e&&(this.dirtyContainer=e,this.emitDirtyDocumentEvent&&(this.emit(e?"dirty":"saved"),this.context.updateDirtyContainerState(e)))}submitDataStoreOp(e,t,n){this.submit(le.FluidDataStoreOp,{address:e,contents:t},n)}submitDataStoreAliasOp(e,t){if(!g(e))throw new wt("malformedDataStoreAliasMessage");this.submit(le.Alias,e,t)}uploadBlob(e){var t=this;return(0,l.Z)(function*(){return t.verifyNotClosed(),t.blobManager.createBlob(e)})()}submit(e,t,n,i){this.verifyNotClosed(),S(this.attachState!==we.Detached,306);let o=-1,h=i;if(this.canSendOps()){const w=JSON.stringify(t),D=this.context.deltaManager.maxMessageSize;this.flushMode===be.FlushMode.TurnBased&&!this.needsFlush&&(h=Object.assign(Object.assign({},i),{batch:!0}),this.needsFlush=!0,this.flushTrigger||Promise.resolve().then(()=>{this.flushTrigger=!1,this.flush()})),o=this.submitMaybeChunkedMessages(e,t,w,D,this._flushMode===be.FlushMode.TurnBased,h)}this.pendingStateManager.onSubmitMessage(e,o,this.deltaManager.lastSequenceNumber,t,n,h),this.isContainerMessageDirtyable(e,t)&&this.updateDocumentDirtyState(!0)}submitMaybeChunkedMessages(e,t,n,i,o,h){return this._maxOpSizeInBytes>=0?!n||n.length<=this._maxOpSizeInBytes?this.submitRuntimeMessage(e,t,o,h):(this.closeFn(new qn("OpTooLarge",void 0,{length:{value:n.length,tag:Tt.PackageData},limit:{value:this._maxOpSizeInBytes,tag:Tt.PackageData}})),-1):!n||n.length<=i?this.submitRuntimeMessage(e,t,o,h):this.submitChunkedMessage(e,n,i)}submitChunkedMessage(e,t,n){const o=Math.floor((t.length-1)/n)+1;let h=0,w=0;for(let D=1;D<=o;D+=1){const _={chunkId:D,contents:t.substr(h,n),originalType:e,totalChunks:o};h+=n,w=this.submitRuntimeMessage(le.ChunkedOp,_,!1)}return w}submitSystemMessage(e,t){this.verifyNotClosed(),S(this.connected,307);const n=this.flushMode===be.FlushMode.TurnBased&&this.needsFlush;return n&&this.mc.logger.sendErrorEvent({eventName:"submitSystemMessageError",type:e}),this.context.submitFn(e,t,n)}submitRuntimeMessage(e,t,n,i){return this.verifyNotClosed(),S(this.connected,601),this.context.submitFn(E.Operation,{type:e,contents:t},n,i)}verifyNotClosed(){if(this._disposed)throw new Error("Runtime is closed")}reSubmit(e,t,n,i){switch(e){case le.FluidDataStoreOp:this.dataStores.resubmitDataStoreOp(t,n);break;case le.Attach:case le.Alias:this.submit(e,t,n);break;case le.ChunkedOp:throw new Error("chunkedOp not expected here");case le.BlobAttach:this.submit(e,t,n,i);break;case le.Rejoin:this.submit(e,t);break;default:En(0,`Unknown ContainerMessageType: ${e}`)}}rollback(e,t,n){if(e!==le.FluidDataStoreOp)throw new Error(`Can't rollback ${e}`);this.dataStores.rollbackDataStoreOp(t,n)}refreshLatestSummaryAck(e,t,n,i){var o=this;return(0,l.Z)(function*(){const h=function(){var _=(0,l.Z)(function*(U){return V(o.storage,U)});return function(Q){return _.apply(this,arguments)}}(),{snapshotTree:w}=yield o.fetchSnapshotFromStorage(t,i,{eventName:"RefreshLatestSummaryGetSnapshot",ackHandle:t,summaryRefSeq:n,fetchLatest:!1}),D=yield o.summarizerNode.refreshLatestSummary(e,n,(0,l.Z)(function*(){return w}),h,i);yield o.garbageCollector.latestSummaryStateRefreshed(D,h)})()}refreshLatestSummaryAckFromServer(e){var t=this;return(0,l.Z)(function*(){const{snapshotTree:n,versionId:i}=yield t.fetchSnapshotFromStorage(null,e,{eventName:"RefreshLatestSummaryGetSnapshot",fetchLatest:!0}),o=function(){var D=(0,l.Z)(function*(_){return V(t.storage,_)});return function(U){return D.apply(this,arguments)}}(),h=yield function Sa(u,e){return Vt.apply(this,arguments)}(n,o),w=yield t.summarizerNode.refreshLatestSummary(void 0,h,(0,l.Z)(function*(){return n}),o,e);return yield t.garbageCollector.latestSummaryStateRefreshed(w,o),{latestSnapshotRefSeq:h,latestSnapshotVersionId:i}})()}fetchSnapshotFromStorage(e,t,n){var i=this;return(0,l.Z)(function*(){return it.timedExecAsync(t,n,function(){var o=(0,l.Z)(function*(h){const w={},D=Xr.start(),_=yield i.storage.getVersions(e,1);S(!!_&&!!_[0],311),w.getVersionDuration=D.trace().duration;const U=yield i.storage.getSnapshotTree(_[0]);return S(!!U,312),w.getSnapshotDuration=D.trace().duration,h.end(w),{snapshotTree:U,versionId:_[0].id}});return function(h){return o.apply(this,arguments)}}())})()}notifyAttaching(e){var t;(null!==(t=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==t?t:this.runtimeOptions.enableOfflineLoad)&&(this.baseSnapshotBlobs=J.serializeTreeWithBlobContents(e))}getSnapshotBlobs(){var e=this;return(0,l.Z)(function*(){var t;!(null!==(t=e.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==t?t:e.runtimeOptions.enableOfflineLoad)||e.attachState!==we.Attached||e.context.pendingLocalState||(S(!!e.context.baseSnapshot,741),e.baseSnapshotBlobs=yield J.serializeTree(e.context.baseSnapshot,e.storage))})()}getPendingLocalState(){var e;if(!(null!==(e=this.mc.config.getBoolean("enableOfflineLoad"))&&void 0!==e?e:this.runtimeOptions.enableOfflineLoad))throw new wt("can't get state when offline load disabled");const t=this.context.pendingLocalState;return t?{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:t.snapshotBlobs,baseSnapshot:t.baseSnapshot,savedOps:this.savedOps}:(S(!!this.context.baseSnapshot,742),S(!!this.baseSnapshotBlobs,743),{pending:this.pendingStateManager.getLocalState(),snapshotBlobs:this.baseSnapshotBlobs,baseSnapshot:this.context.baseSnapshot,savedOps:this.savedOps})}formRequestSummarizerFn(e){return(0,l.Z)(function*(){const t={headers:{[Mt.cache]:!1,[Mt.clientDetails]:{capabilities:{interactive:!1},type:vn},[fr.summarizingClient]:!0,[Mt.reconnect]:!1},url:"/_summarizer"},i=(yield jr(e,t)).ISummarizer;if(!i)throw new wt("Fluid object does not implement ISummarizer");return i})}processSavedOps(e){var t=this;return(0,l.Z)(function*(){for(const n of e.savedOps)t.process(n,!1),yield t.pendingStateManager.applyStashedOpsAt(n.sequenceNumber);yield t.pendingStateManager.applyStashedOpsAt()})()}}const yt=function(){var u=(0,l.Z)(function*(e,t){return new Promise((n,i)=>{e.on("closed",i);const o=h=>{h.sequenceNumber>=t&&(n(),e.off("op",o))};e.on("op",o)})});return function(t,n){return u.apply(this,arguments)}}();class Kt{constructor(e,t){this.absolutePath=e,this.routeContext=t,this.isAttached=!0,S(e.startsWith("/"),413)}get IFluidRouter(){return this}get IFluidHandleContext(){return this}get IFluidHandle(){return this}get(){var e=this;return(0,l.Z)(function*(){if(void 0===e.objectP){e.objectP=e.routeContext.resolveHandle({url:e.absolutePath,headers:{[oe.viaHandle]:!0}}).then(n=>{if("fluid/object"===n.mimeType)return n.value;throw ii(n)})}return e.objectP})()}attachGraph(){}bind(e){e.attachGraph()}request(e){var t=this;return(0,l.Z)(function*(){try{const i=(yield t.get()).IFluidRouter;return void 0!==i?i.request(e):kn(e)}catch(n){return Br(n)}})()}}class zt{constructor(e,t){for(this.context=e,this.handleParsedCb=t,this.encodeValue=(n,i)=>{const o=n?.IFluidHandle;return void 0!==o?this.serializeHandle(o,i):n},this.decodeValue=n=>{if("__fluid_handle__"===n?.type){const i=n.url.startsWith("/")?n.url:Rr(n.url,this.context),o=new Kt(i,this.root);return this.handleParsedCb(o),o}return n},this.root=this.context;void 0!==this.root.routeContext;)this.root=this.root.routeContext}get IFluidSerializer(){return this}encode(e,t){return e&&"object"==typeof e?this.recursivelyReplace(e,this.encodeValue,t):e}decode(e){return e&&"object"==typeof e?this.recursivelyReplace(e,this.decodeValue):e}stringify(e,t){return JSON.stringify(e,(n,i)=>this.encodeValue(i,t))}parse(e){return JSON.parse(e,(t,n)=>this.decodeValue(n))}recursivelyReplace(e,t,n){const i=t(e,n);if(i!==e)return i;let o;for(const h of Object.keys(e)){const w=e[h];if(w&&"object"==typeof w){const D=this.recursivelyReplace(w,t,n);D!==w&&(o=o??(Array.isArray(e)?[...e]:Object.assign({},e)),o[h]=D)}}return o??e}serializeHandle(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}class mn extends Cr{get isAttached(){return this.value.isAttached()}constructor(e,t,n){super(e,t,n)}attachGraph(){this.value.bindToContext(),super.attachGraph()}}class Ct extends zt{constructor(){super(...arguments),this.serializedRoutes=new Set}getSerializedRoutes(){return Array.from(this.serializedRoutes)}serializeHandle(e,t){return this.serializedRoutes.add(e.absolutePath),super.serializeHandle(e,t)}}class bn extends Je{constructor(e,t,n){super((i,o)=>this.eventListenerErrorHandler(i,o)),this.id=e,this.runtime=t,this.attributes=n,this._connected=!1,this._isBoundToContext=!1,S(!e.includes("/"),772),this.handle=new mn(this,e,t.IFluidHandleContext),this.logger=rt.create(t.logger,void 0,{all:{sharedObjectId:Pe(),ddsType:{value:this.attributes.type,tag:Tt.CodeArtifact}}}),this.mc=gt(this.logger),[this.opProcessingHelper,this.callbacksHelper]=this.setUpSampledTelemetryHelpers(),this.attachListeners()}get IFluidLoadable(){return this}get connected(){return this._connected}setUpSampledTelemetryHelpers(){var e,t;S(void 0!==this.mc&&void 0!==this.logger,"this.mc and/or this.logger has not been set");const n=new Ai({eventName:"ddsOpProcessing",category:"performance"},this.logger,null!==(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))&&void 0!==e?e:100,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),i=new Ai({eventName:"ddsEventCallbacks",category:"performance"},this.logger,null!==(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))&&void 0!==t?t:100,!0);return this.runtime.once("dispose",()=>{this.callbacksHelper.dispose(),this.opProcessingHelper.dispose()}),[n,i]}closeWithError(e){void 0===this.closeError&&(this.closeError=e)}verifyNotClosed(){if(void 0!==this.closeError)throw this.closeError}eventListenerErrorHandler(e,t){const n=Cn.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw n.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(n),n}attachListeners(){this.isAttached()||this.runtime.once("attaching",()=>{this.didAttach()})}load(e){var t=this;return(0,l.Z)(function*(){t.runtime.attachState!==we.Detached&&(t.services=e),yield t.loadCore(e.objectStorage),t.runtime.attachState!==we.Detached&&t.attachDeltaHandler()})()}initializeLocal(){this.initializeLocalCore()}bindToContext(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}connect(e){this.services=e,this.attachDeltaHandler()}isAttached(){return void 0!==this.services&&this.runtime.attachState!==we.Detached}handleDecoded(e){var t,n,i;this.isAttached()&&(null===(i=null===(t=this.services)||void 0===t?void 0:(n=t.deltaConnection).addedGCOutboundReference)||void 0===i||i.call(n,this.handle,e))}initializeLocalCore(){}didAttach(){}submitLocalMessage(e,t){this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}dirty(){this.isAttached()&&this.services.deltaConnection.dirty()}onConnect(){}reSubmitCore(e,t){this.submitLocalMessage(e,t)}newAckBasedPromise(e){var t=this;return(0,l.Z)(function*(){let n;return new Promise((i,o)=>{n=()=>o(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending")),t.runtime.disposed?n():(t.runtime.on("dispose",n),e(i,o))}).finally(()=>{t.runtime.off("dispose",n)})})()}attachDeltaHandler(){S(void 0!==this.services,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:(e,t,n)=>{this.process(e,t,n)},setConnectionState:e=>{this.setConnectionState(e)},reSubmit:(e,t)=>{this.reSubmit(e,t)},applyStashedOp:e=>this.applyStashedOp(e),rollback:(e,t)=>{this.rollback(e,t)}}),this.setConnectionState(this.services.deltaConnection.connected)}setConnectionState(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}process(e,t,n){this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure(()=>{this.processCore(e,t,n)},t?"local":"remote"),this.emitInternal("op",e,t,this)}reSubmit(e,t){this.reSubmitCore(e,t)}rollback(e,t){throw new Error("rollback not supported")}emit(e,...t){return this.callbacksHelper.measure(()=>super.emit(e,...t))}emitInternal(e,...t){return super.emit(e,...t)}}class Fr extends bn{constructor(e,t,n,i){super(e,t,n),this.telemetryContextPrefix=i,this._isGCing=!1,this._serializer=new zt(this.runtime.channelsRoutingContext,o=>this.handleDecoded(o))}get serializer(){return S(!this._isGCing,117),this._serializer}getAttachSummary(e=!1,t=!1,n){const i=this.summarizeCore(this.serializer,n);return this.incrementTelemetryMetric(be.blobCountPropertyName,i.stats.blobNodeCount,n),this.incrementTelemetryMetric(be.totalBlobSizePropertyName,i.stats.totalBlobSize,n),i}summarize(e=!1,t=!1,n){var i=this;return(0,l.Z)(function*(){const o=i.summarizeCore(i.serializer,n);return i.incrementTelemetryMetric(be.blobCountPropertyName,o.stats.blobNodeCount,n),i.incrementTelemetryMetric(be.totalBlobSizePropertyName,o.stats.totalBlobSize,n),o})()}getGCData(e=!1){let t;S(!this._isGCing,120),this._isGCing=!0;try{const n=new Ct(this.runtime.channelsRoutingContext,i=>this.handleDecoded(i));this.processGCDataCore(n),t={gcNodes:{"/":n.getSerializedRoutes()}},S(this._isGCing,121)}finally{this._isGCing=!1}return t}processGCDataCore(e){this.summarizeCore(e)}incrementTelemetryMetric(e,t,n){var i;const o=null!==(i=n?.get(this.telemetryContextPrefix,e))&&void 0!==i?i:0;n?.set(this.telemetryContextPrefix,e,o+t)}}var Uo,Bt=(()=>{return(u=Bt||(Bt={}))[u.Shared=0]="Shared",u[u.Plain=1]="Plain",Bt;var u})();function gi(u,e,t){const n=u.makeSerialized(e,t);return{type:n.type,value:n.value&&JSON.parse(n.value)}}class It{constructor(e){this.value=e}get type(){return Bt[Bt.Plain]}makeSerialized(e,t){const n=function Ha(u,e,t){return void 0!==u?e.stringify(u,t):u}(this.value,e,t);return{type:this.type,value:n}}}class jn{constructor(e){this.serializer=e}fromSerializable(e){e.type===Bt[Bt.Shared]&&(e.type=Bt[Bt.Plain],e.value={type:"__fluid_handle__",url:e.value});const t=function br(u,e){return void 0!==u?e.parse(JSON.stringify(u)):u}(e.value,this.serializer);return new It(t)}fromInMemory(e){return new It(e)}}function ht(u){return void 0!==u&&"number"==typeof u.pendingMessageId&&("add"===u.type||"edit"===u.type)}function Yn(u){return void 0!==u&&"clear"===u.type&&"number"==typeof u.pendingMessageId}class mc{constructor(e,t,n,i,o){this.serializer=e,this.handle=t,this.submitMessage=n,this.isAttached=i,this.eventEmitter=o,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new jn(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const n=e.next();return n.done?{value:void 0,done:!0}:{value:[n.value[0],n.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const n=e.next();return n.done?{value:void 0,done:!0}:{value:n.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,n,i)=>{e(t.value,n,i)})}get(e){const t=this.data.get(e);return void 0===t?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(null==e)throw new Error("Undefined and null keys are not supported");const n=this.localValueMaker.fromInMemory(t),i=gi(n,this.serializer,this.handle),o=this.setCore(e,n,!0);this.isAttached()&&this.submitMapKeyMessage({key:e,type:"set",value:i},o)}delete(e){const t=this.deleteCore(e,!0);return this.isAttached()?(this.submitMapKeyMessage({key:e,type:"delete"},t),void 0!==t):void 0!==t}clear(){const e=this.isAttached()?new Map(this.data):void 0;this.clearCore(!0),this.isAttached()&&this.submitMapClearMessage({type:"clear"},e)}getSerializedStorage(e){const t={};return this.data.forEach((n,i)=>{t[i]=n.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((n,i)=>{t[i]=gi(n,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,n]of Object.entries(e)){const i={key:t,value:this.makeLocal(t,n)};this.data.set(i.key,i.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){const n=this.messageHandlers.get(e.type);return void 0!==n&&(n.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=this.messageHandlers.get(e.type);if(void 0===t)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,n){const i=this.messageHandlers.get(e.type);return void 0!==i&&(i.process(e,t,n),!0)}rollback(e,t){if(!function gc(u){return void 0!==u&&"number"==typeof u.pendingMessageId&&("add"===u.type||"edit"===u.type||"clear"===u.type)}(t))throw new Error("Invalid localOpMetadata");if("clear"===e.type&&"clear"===t.type){if(void 0===t.previousMap)throw new Error("Cannot rollback without previous map");t.previousMap.forEach((i,o)=>{this.setCore(o,i,!0)});const n=this.pendingClearMessageIds.pop();if(void 0===n||n!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else{if("delete"!==e.type&&"set"!==e.type)throw new Error("Unsupported op for rollback");{if("add"===t.type)this.deleteCore(e.key,!0);else{if("edit"!==t.type||void 0===t.previousValue)throw new Error("Cannot rollback without previous value");this.setCore(e.key,t.previousValue,!0)}const n=this.pendingKeys.get(e.key),i=n?.pop();if(!n||i!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");0===n.length&&this.pendingKeys.delete(e.key)}}}setCore(e,t,n){const i=this.data.get(e),o=i?.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:o},n,this.eventEmitter),i}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){const n=this.data.get(e),i=n?.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},t,this.eventEmitter),n}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,n)=>{e.set(n,this.data.get(n))}),this.clearCore(!1),e.forEach((t,n)=>{this.setCore(n,t,!0)})}makeLocal(e,t){if(t.type===Bt[Bt.Plain]||t.type===Bt[Bt.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,n){if(this.pendingClearMessageIds.length>0)return t&&S(void 0!==n&&ht(n)&&n.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){S(void 0!==n&&ht(n),20);const o=this.pendingKeys.get(e.key);S(void 0!==o&&o[0]===n.pendingMessageId,762),o.shift(),0===o.length&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){const e=new Map;return e.set("clear",{process:(t,n,i)=>{n?(S(Yn(i),21),S(this.pendingClearMessageIds.shift()===i.pendingMessageId,763)):0===this.pendingKeys.size?this.clearCore(n):this.clearExceptPendingKeys()},submit:(t,n)=>{S(Yn(n),764),S(this.pendingClearMessageIds.shift()===n.pendingMessageId,765),this.submitMapClearMessage(t,n.previousMap)},getStashedOpLocalMetadata:t=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(t,n,i)=>{this.needProcessKeyOperation(t,n,i)&&this.deleteCore(t.key,n)},submit:(t,n)=>{this.resubmitMapKeyMessage(t,n)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e.set("set",{process:(t,n,i)=>{if(!this.needProcessKeyOperation(t,n,i))return;const o=this.makeLocal(t.key,t.value);this.setCore(t.key,o,n)},submit:(t,n)=>{this.resubmitMapKeyMessage(t,n)},getStashedOpLocalMetadata:t=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(t)})}),e}getMapClearMessageId(){const e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){const n={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,n)}getMapKeyMessageId(e){const t=++this.pendingMessageId,n=this.pendingKeys.get(e.key);return void 0!==n?n.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){const n=this.getMapKeyMessageId(e);this.submitMessage(e,t?{type:"edit",pendingMessageId:n,previousValue:t}:{type:"add",pendingMessageId:n})}resubmitMapKeyMessage(e,t){S(ht(t),766);const n=this.pendingKeys.get(e.key);S(void 0!==n&&n[0]===t.pendingMessageId,767),n.shift(),0===n.length&&this.pendingKeys.delete(e.key);const i=this.getMapKeyMessageId(e);this.submitMessage(e,"edit"===t.type?{type:"edit",pendingMessageId:i,previousValue:t.previousValue}:{type:"add",pendingMessageId:i})}}class er{get type(){return er.Type}get attributes(){return er.Attributes}load(e,t,n,i){return(0,l.Z)(function*(){const o=new Is(t,e,i);return yield o.load(n),o})()}create(e,t){const n=new Is(t,e,er.Attributes);return n.initializeLocal(),n}}er.Type="https://graph.microsoft.com/types/map",er.Attributes={type:er.Type,snapshotFormatVersion:"0.2",packageVersion:"1.3.6"};class Is extends Fr{constructor(e,t,n){super(e,t,n,"fluid_map_"),this[Uo]="SharedMap",this.kernel=new mc(this.serializer,this.handle,(i,o)=>this.submitLocalMessage(i,o),()=>this.isAttached(),this)}static create(e,t){return e.createChannel(t,er.Type)}static getFactory(){return new er}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(Uo=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let n=0,i=0,o={};const h=[],w=new Mn,D=this.kernel.getSerializedStorage(e);for(const Y of Object.keys(D)){const ye=D[Y];if(ye.value&&ye.value.length>=8192){const Fe=`blob${i}`;i++,h.push(Fe);const De={[Y]:{type:ye.type,value:JSON.parse(ye.value)}};w.addBlob(Fe,JSON.stringify(De))}else{if(n+=ye.type.length+21,ye.value&&(n+=ye.value.length),n>16384){const Fe=`blob${i}`;i++,h.push(Fe),w.addBlob(Fe,JSON.stringify(o)),o={},n=0}o[Y]={type:ye.type,value:void 0===ye.value?void 0:JSON.parse(ye.value)}}}return w.addBlob("header",JSON.stringify({blobs:h,content:o})),w.getSummaryTree()}loadCore(e){var t=this;return(0,l.Z)(function*(){const n=yield V(e,"header"),i=n;Array.isArray(i.blobs)?(t.kernel.populateFromSerializable(i.content),yield Promise.all(i.blobs.map(function(){var o=(0,l.Z)(function*(h){const w=yield V(e,h);t.kernel.populateFromSerializable(w)});return function(h){return o.apply(this,arguments)}}()))):t.kernel.populateFromSerializable(n)})()}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,n){e.type===E.Operation&&this.kernel.tryProcessMessage(e.contents,t,n)}rollback(e,t){this.kernel.rollback(e,t)}}var qa=v(1455);class Ji extends Xt{constructor(e,t,n){super(void 0,n),this.debug=e,this.debugErr=t}static create(e,t){const n=(0,qa.debug)(e),i=(0,qa.debug)(e);return i.log=console.error.bind(console),i.enabled=!0,new Ji(n,i,t)}static mixinDebugLogger(e,t,n){if(!t)return Ji.create(e,n);const i=new ra(void 0,n);return i.addLogger(Ji.create(e,this.tryGetBaseLoggerProps(t))),i.addLogger(rt.create(t,e)),i}static tryGetBaseLoggerProps(e){if(e instanceof Xt)return e.properties}send(e){const t=this.prepareEvent(e),n="error"===t.category;let i=n?this.debugErr:this.debug;const o=e.eventName.lastIndexOf(Xt.eventNamespaceSeparator),h=e.eventName.substring(o+1);o>0&&(i=i.extend(e.eventName.substring(0,o))),t.eventName=void 0;let w="";w=`tick=${Xt.formatTick(Re.now())}`;const D=t.stack?t.stack:"";let _;t.stack=void 0;try{_=JSON.stringify(t)}catch{t.error=void 0,_=JSON.stringify(t)}"{}"===_&&(_=""),n&&(i.enabled=!0),i(`${h} ${_} ${w} ${D}`)}}const za=u=>"fluid"===u?.type;function ar(u){if(!za(u))throw new Error(`resolved is not a Fluid url. Type: ${u?.type}`)}function Va(){return(Va=(0,l.Z)(function*(u,e){let t;for(const n of u)if(t=yield n.resolve(Object.assign({},e)),void 0!==t)return t})).apply(this,arguments)}class Ua{constructor(e){this.urlResolvers=e}static create(e){return Array.isArray(e)?1===e.length?e[0]:new Ua(e):e}resolve(e){var t=this;return(0,l.Z)(function*(){return function vc(u,e){return Va.apply(this,arguments)}(t.urlResolvers,e)})()}getAbsoluteUrl(e,t){return(0,l.Z)(function*(){throw new Error("Not implmented")})()}}var Za=v(8762);class Ka{constructor(e){this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,e.forEach(t=>{this.protocolToDocumentFactoryMap.set(t.protocolName,t)})}static create(e){if(Array.isArray(e)){const t=[];return e.forEach(n=>{void 0!==n.protocolToDocumentFactoryMap?t.push(...n.protocolToDocumentFactoryMap.values()):t.push(n)}),1===t.length?t[0]:new Ka(t)}return e}createDocumentService(e,t,n){var i=this;return(0,l.Z)(function*(){ar(e);const o=(0,Za.Qc)(e.url);if(null==o.protocol)throw new Error("No protocol provided");const h=i.protocolToDocumentFactoryMap.get(o.protocol);if(void 0===h)throw new Error("Unknown Fluid protocol");return h.createDocumentService(e,t,n)})()}createContainer(e,t,n,i){var o=this;return(0,l.Z)(function*(){ar(t);const h=(0,Za.Qc)(t.url);if(null==h.protocol)throw new Error("No protocol provided");const w=o.protocolToDocumentFactoryMap.get(h.protocol);if(void 0===w)throw new Error("Unknown Fluid protocol");return w.createContainer(e,t,n,i)})()}}var yc=v(567),bc=v.n(yc);const Ko=u=>"object"==typeof u&&"string"==typeof u?.name&&"object"==typeof u?.fluid,Go=u=>{const e=u;return"object"==typeof e&&("string"==typeof e?.package||Ko(e?.package))&&(void 0===e?.config||"object"==typeof e?.config)};function Os(u,e){return{type:Le.Tree,tree:{".protocol":e,".app":u}}}const Wo="1.3.6";function Ga(u,e,t,n){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,l.Z)(function*(u,e,t,n){var i,o;let h,w=!1,D=1e3,_=0;const U=Re.now();let Q;do{try{h=yield u(n.cancel),w=!0}catch(Y){if(!Lr(Y))throw t.sendTelemetryEvent({eventName:`${e}_cancel`,retry:_,duration:Re.now()-U,fetchCallName:e},Y),Y;if(!0===(null===(i=n.cancel)||void 0===i?void 0:i.aborted))throw t.sendTelemetryEvent({eventName:`${e}_runWithRetryAborted`,retry:_,duration:Re.now()-U,fetchCallName:e},Y),new ai("runWithRetry was Aborted",Dn.genericError,{driverVersion:Wo,fetchCallName:e});_++,Q=Y,D=null!==(o=Ne(Y))&&void 0!==o?o:Math.min(2*D,8e3),n.onRetry&&n.onRetry(D,Y),yield ms(D)}}while(!w);return _>0&&t.sendTelemetryEvent({eventName:`${e}_lastError`,retry:_,duration:Re.now()-U,fetchCallName:e},Q),h})).apply(this,arguments)}var wc=v(733),_s=v.n(wc);class $o{constructor(e,t,n,i){this.sequenceNumber=e,this.key=t,this.value=n,this.local=i}}class Cc extends Ke{constructor(e){super(),this.isDisposed=!1,this.members=new Map(e),this.snapshotCache=e}get disposed(){return this.isDisposed}snapshot(){var e;return null!==(e=this.snapshotCache)&&void 0!==e||(this.snapshotCache=_s()(Array.from(this.members))),this.snapshotCache}addMember(e,t){S(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}removeMember(e){S(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}dispose(){this.isDisposed=!0}}class Ec extends Ke{constructor(e,t){super(),this.sendProposal=t,this.isDisposed=!1,this.stateEvents=new at.EventEmitter,this.proposals=new Map(e.proposals.map(([,n])=>[n.sequenceNumber,new $o(n.sequenceNumber,n.key,n.value,!1)])),this.values=new Map(e.values),this.proposalsSnapshotCache=e.proposals,this.valuesSnapshotCache=e.values}get disposed(){return this.isDisposed}snapshot(){var e,t;return null!==(e=this.proposalsSnapshotCache)&&void 0!==e||(this.proposalsSnapshotCache=Array.from(this.proposals).map(([n,i])=>[n,{sequenceNumber:n,key:i.key,value:i.value},[]])),null!==(t=this.valuesSnapshotCache)&&void 0!==t||(this.valuesSnapshotCache=_s()(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(e){return this.values.has(e)}get(e){var t;return null===(t=this.values.get(e))||void 0===t?void 0:t.value}getApprovalData(e){const t=this.values.get(e);return t?_s()(t):void 0}propose(e,t){var n=this;return(0,l.Z)(function*(){const i=n.sendProposal(e,t);if(i<0)throw n.emit("error",{eventName:"ProposalInDisconnectedState",key:e}),new Error("Can't propose in disconnected state");return new Promise((o,h)=>{let w;const D=(ye,Fe)=>{ye===i&&(w=Fe,n.stateEvents.off("localProposalSequenced",D),n.stateEvents.off("disconnected",U),n.stateEvents.on("localProposalApproved",_))},_=ye=>{ye===w&&(o(),Y())},U=()=>{void 0===w&&n.stateEvents.once("connected",()=>{void 0===w&&(h(new Error("Client disconnected without successfully sending proposal")),Y())})},Q=()=>{h(new Error("QuorumProposals was disposed")),Y()},Y=()=>{n.stateEvents.off("localProposalSequenced",D),n.stateEvents.off("localProposalApproved",_),n.stateEvents.off("disconnected",U),n.stateEvents.off("disposed",Q)};n.stateEvents.on("localProposalSequenced",D),n.stateEvents.on("disconnected",U),n.stateEvents.on("disposed",Q)})})()}addProposal(e,t,n,i,o){S(!this.proposals.has(n),464);const h=new $o(n,e,t,i);this.proposals.set(n,h),this.emit("addProposal",h),i&&this.stateEvents.emit("localProposalSequenced",o,n),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(e){const t=e.minimumSequenceNumber,n=[];for(const[i,o]of this.proposals)i<=t&&n.push(o);n.sort((i,o)=>i.sequenceNumber-o.sequenceNumber);for(const i of n){const o={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:i.key,sequenceNumber:i.sequenceNumber,value:i.value};this.values.set(o.key,o),this.valuesSnapshotCache=void 0,this.emit("approveProposal",o.sequenceNumber,o.key,o.value,o.approvalSequenceNumber),this.proposals.delete(i.sequenceNumber),this.proposalsSnapshotCache=void 0,i.local&&this.stateEvents.emit("localProposalApproved",i.sequenceNumber)}}setConnectionState(e){this.stateEvents.emit(e?"connected":"disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}class Ac extends Ke{constructor(e,t,n,i){super(),this.isDisposed=!1,this.quorumClients=new Cc(e),this.quorumClients.on("addMember",(o,h)=>{this.emit("addMember",o,h)}),this.quorumClients.on("removeMember",o=>{this.emit("removeMember",o)}),this.quorumProposals=new Ec({proposals:t,values:n},i),this.quorumProposals.on("addProposal",o=>{this.emit("addProposal",o)}),this.quorumProposals.on("approveProposal",(o,h,w,D)=>{this.emit("approveProposal",o,h,w,D)})}get disposed(){return this.isDisposed}close(){this.removeAllListeners()}snapshot(){const e=this.quorumClients.snapshot(),{proposals:t,values:n}=this.quorumProposals.snapshot();return{members:e,proposals:t,values:n}}has(e){return this.quorumProposals.has(e)}get(e){return this.quorumProposals.get(e)}getApprovalData(e){return this.quorumProposals.getApprovalData(e)}addMember(e,t){this.quorumClients.addMember(e,t)}removeMember(e){this.quorumClients.removeMember(e)}getMembers(){return this.quorumClients.getMembers()}getMember(e){return this.quorumClients.getMember(e)}propose(e,t){var n=this;return(0,l.Z)(function*(){return n.quorumProposals.propose(e,t)})()}addProposal(e,t,n,i,o){return this.quorumProposals.addProposal(e,t,n,i,o)}updateMinimumSequenceNumber(e){this.quorumProposals.updateMinimumSequenceNumber(e)}setConnectionState(e,t){this.quorumProposals.setConnectionState(e)}dispose(){throw new Error("Not implemented.")}}class Tc{constructor(e,t,n,i,o,h,w){this.minimumSequenceNumber=e,this.sequenceNumber=t,this.term=n??1,this._quorum=new Ac(i,o,h,w)}get quorum(){return this._quorum}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}setConnectionState(e,t){this._quorum.setConnectionState(e,t)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${e.sequenceNumber}`);this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;let n=!1;switch(e.type){case E.ClientJoin:const i=e,o=JSON.parse(i.data);this._quorum.addMember(o.clientId,{client:o.detail,sequenceNumber:i.sequenceNumber});break;case E.ClientLeave:const D=JSON.parse(e.data);this._quorum.removeMember(D);break;case E.Propose:const _=e.contents;this._quorum.addProposal(_.key,_.value,e.sequenceNumber,t,e.clientSequenceNumber),n=!0;break;case E.Reject:throw new Error("Quorum rejection is removed.")}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:n}}getProtocolState(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}}class Fc extends Tc{processMessage(e,t){const n=this._quorum.getMember(e.clientId);if(null!=e.clientId){if(void 0===n&&e.type!==E.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if(!0===n?.shouldHaveLeft&&e.type!==E.NoOp)throw new Error("Remote message's clientId already should have left")}return super.processMessage(e,t)}}class Dc extends at.EventEmitter{constructor(){super(...arguments),this.members=new Map}on(e,t){return super.on(e,t)}addMember(e,t){this.members.set(e,t),this.emit("addMember",e,t)}removeMember(e){const t=this.members.get(e);return void 0!==t&&(this.members.delete(e),this.emit("removeMember",e,t),!0)}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}clear(){const e=this.members.keys();for(const t of e)this.removeMember(t)}}class $a{constructor(e,t,n,i,o,h,w,D,_,U,Q,Y,ye,Fe,De){var Ee=this;this.container=e,this.scope=t,this.codeLoader=n,this._codeDetails=i,this._baseSnapshot=o,this.deltaManager=h,this.loader=D,this.submitFn=_,this.submitSignalFn=U,this.closeFn=Q,this.version=Y,this.updateDirtyContainerState=ye,this.existing=Fe,this.pendingLocalState=De,this._disposed=!1,this._quorum=w,this.taggedLogger=e.subLogger,this._fluidModuleP=new Wn((0,l.Z)(function*(){return Ee.loadCodeModule(i)})),this.attachListener()}static createOrLoad(e,t,n,i,o,h,w,D,_,U,Q,Y,ye,Fe,De){return(0,l.Z)(function*(){const Ee=new $a(e,t,n,i,o,h,w,D,_,U,Q,Y,ye,Fe,De);return yield Ee.instantiateRuntime(Fe),Ee})()}get clientId(){return this.container.clientId}get id(){const e=this.container.resolvedUrl;return za(e)?e.id:""}get clientDetails(){return this.container.clientDetails}get connected(){return this.container.connected}get canSummarize(){return"summarize"in this.runtime}get serviceConfiguration(){return this.container.serviceConfiguration}get audience(){return this.container.audience}get options(){return this.container.options}get baseSnapshot(){return this._baseSnapshot}get storage(){return this.container.storage}get runtime(){if(void 0===this._runtime)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get disposed(){return this._disposed}get codeDetails(){return this._codeDetails}get quorum(){return this._quorum}getSpecifiedCodeDetails(){var e;return null!==(e=this._quorum.get("code"))&&void 0!==e?e:this._quorum.get("code2")}dispose(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}getLoadedFromVersion(){return this.container.loadedFromVersion}get attachState(){return this.container.attachState}createSummary(e){return this.runtime.createSummary(e)}setConnectionState(e,t){const n=this.runtime;S(e===this.connected,222),n.setConnectionState(e,t)}process(e,t,n){this.runtime.process(e,t,n)}processSignal(e,t){this.runtime.processSignal(e,t)}request(e){var t=this;return(0,l.Z)(function*(){return t.runtime.request(e)})()}getAbsoluteUrl(e){var t=this;return(0,l.Z)(function*(){return t.container.getAbsoluteUrl(e)})()}getPendingLocalState(){return this.runtime.getPendingLocalState()}satisfies(e){var t=this;return(0,l.Z)(function*(){var n;const i=[],o=t.codeLoader;void 0!==o.IFluidCodeDetailsComparer&&i.push(o.IFluidCodeDetailsComparer);const h=yield t._fluidModuleP,w=null===(n=h.module)||void 0===n?void 0:n.fluidExport;if(void 0!==w?.IFluidCodeDetailsComparer&&i.push(w.IFluidCodeDetailsComparer),0===i.length)return!1;for(const D of i)if(!1===(yield D.satisfies(h.details,e)))return!1;return!0})()}notifyAttaching(e){var t,n;this._baseSnapshot=e,null===(n=(t=this.runtime).notifyAttaching)||void 0===n||n.call(t,e),this.runtime.setAttachState(we.Attaching)}getRuntimeFactory(){var e=this;return(0,l.Z)(function*(){var t;const i=(null===(t=(yield e._fluidModuleP).module)||void 0===t?void 0:t.fluidExport)?.IRuntimeFactory;if(void 0===i)throw new Error("Code package does not implement IRuntimeFactory");return i})()}instantiateRuntime(e){var t=this;return(0,l.Z)(function*(){const n=yield t.getRuntimeFactory();t._runtime=yield n.instantiateRuntime(t,e)})()}attachListener(){this.container.once("attached",()=>{this.runtime.setAttachState(we.Attached)})}loadCodeModule(e){var t=this;return(0,l.Z)(function*(){const n=yield it.timedExecAsync(t.taggedLogger,{eventName:"CodeLoad"},(0,l.Z)(function*(){return t.codeLoader.load(e)}));if("module"in n){const{module:i,details:o}=n;return{module:i,details:o??e}}return t.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),n})()}}var Sn=(()=>{return(u=Sn||(Sn={})).Never="Never",u.Disabled="Disabled",u.Enabled="Enabled",Sn;var u})(),Rc=v(552),Ja=v.n(Rc);class Qa extends Ke{constructor(e){super(),this.worker=e,this.isDisposed=!1,this.q=new(tn()),this.pauseCount=1}get disposed(){return this.isDisposed}get paused(){return 0!==this.pauseCount}get length(){return this.q.length}get idle(){return void 0===this.processingPromise&&0===this.q.length}waitTillProcessingDone(){var e=this;return(0,l.Z)(function*(){var t;return null!==(t=e.processingPromise)&&void 0!==t?t:{count:0,duration:0}})()}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(t){this.emit("error",t)}}pause(){var e=this;return(0,l.Z)(function*(){e.pauseCount++,yield e.waitTillProcessingDone()})()}resume(){S(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&void 0===this.processingPromise&&(this.processingPromise=Promise.resolve().then(()=>{S(void 0!==this.processingPromise,"reentrancy?");const e=this.processDeltas();return S(void 0!==this.processingPromise,"reentrancy?"),this.processingPromise=void 0,e}).catch(e=>(this.error=e,this.processingPromise=void 0,this.emit("error",e),{count:0,duration:0})),S(void 0!==this.processingPromise,"processDeltas() should run async"))}anythingToProcess(){return 0!==this.q.length&&!this.paused&&void 0===this.error}processDeltas(){const e=Re.now();let t=0;for(;this.anythingToProcess();){const i=this.q.shift();t++,this.worker(i),this.emit("op",i)}const n=Re.now()-e;return 0===this.q.length&&this.emit("idle",t,n),{count:t,duration:n}}}class Oc extends Ke{constructor(e,t,n,i){super(),this.serviceProvider=e,this.logger=t,this._active=n,this.pending=[],this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.baseTerm=0,this.opsSize=0,this.initSequenceNumber=0,this.closed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new(Ja()),this.deltaStorageDelayId=Pe(),this.deltaStreamDelayId=Pe(),this.messageBuffer=[];const o={incomingOpHandler:(h,w)=>{try{this.enqueueMessages(h,w)}catch(D){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},D),this.close(Rt(D))}},signalHandler:h=>this._inboundSignal.push(h),reconnectionDelayHandler:(h,w)=>this.emitDelayInfo(this.deltaStreamDelayId,h,w),closeHandler:h=>this.close(h),disconnectHandler:h=>this.disconnectHandler(h),connectHandler:h=>this.connectHandler(h),pongHandler:h=>this.emit("pong",h),readonlyChangeHandler:h=>function sa(u,e,t,...n){try{u.emit(t,...n)}catch(i){e.sendErrorEvent({eventName:"RaiseEventError",event:t},i)}}(this,this.logger,"readonly",h)};this.connectionManager=i(o),this._inbound=new Qa(h=>{this.processInboundMessage(h)}),this._inbound.on("error",h=>{this.close(Cn.wrapIfUnrecognized(h,"deltaManagerInboundErrorHandler",this.lastMessage))}),this._inboundSignal=new Qa(h=>{if(void 0===this.handler)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({clientId:h.clientId,content:JSON.parse(h.content)})}),this._inboundSignal.on("error",h=>{this.close(Rt(h))})}get active(){return this._active()}get disposed(){return this.closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get referenceTerm(){return this.baseTerm}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return S(this.connectionManager.connected,223),void 0!==this._checkpointSequenceNumber}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(e,t,n=!1,i){const o={contents:JSON.stringify(t),metadata:i,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};n||this.flush();const h=this.connectionManager.prepareMessageToSend(o);return void 0===h?-1:(this.opsSize+=h.contents.length,this.messageBuffer.push(h),this.emit("submitOp",h),n||this.flush(),h.clientSequenceNumber)}submitSignal(e){return this.connectionManager.submitSignal(e)}flush(){0!==this.messageBuffer.length&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}get connectionProps(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}logConnectionIssue(e){var t;S(this.connectionManager.connected,568);const n=this.pending.sort((i,o)=>i.sequenceNumber-o.sequenceNumber);this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:null===(t=n[0])||void 0===t?void 0:t.sequenceNumber,haveHandler:void 0!==this.handler,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}connectHandler(e){this.refreshDelayInfo(this.deltaStreamDelayId);const t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;const n=e.checkpointSequenceNumber;this._checkpointSequenceNumber=n,void 0!==n&&this.updateLatestKnownOpSeqNumber(n),S(0===this.messageBuffer.length,233),this.opsSize=0,this.emit("connect",e,void 0!==n?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),void 0!==n?n>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):"read"===e.mode&&this.fetchMissingDeltas("AfterReadConnection")}dispose(){throw new Error("Not implemented.")}attachOpHandler(e,t,n,i,o="none"){var h=this;return(0,l.Z)(function*(){if(h.initSequenceNumber=t,h.lastProcessedSequenceNumber=t,h.baseTerm=n,h.minSequenceNumber=e,h.lastQueuedSequenceNumber=t,h.lastObservedSeqNumber=t,S(void 0===h.handler,226),h.handler=i,S(!!h.handler,227),S(void 0===h.fetchReason,616),!h.closed){if(h._inbound.resume(),h._inboundSignal.resume(),"none"!==o){const w="cached"===o;yield h.fetchMissingDeltasCore(`DocumentOpen_${o}`,w),w&&h.fetchMissingDeltas("PostDocumentOpen")}S(void 0!==h.fetchReason||0===h.pending.length,617)}})()}connect(e){var t;const n=null===(t=e.fetchOpsFromStorage)||void 0===t||t;(function Ic(u,e,t){if(u)return!0;const n="string"==typeof t?{eventName:t,category:"error"}:Object.assign({category:"error"},t);e.send(n)})(void 0!==this.handler||!n,this.logger,"CantFetchWithoutBaseline"),n&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}getDeltas(e,t,n,i,o){var h=this;return(0,l.Z)(function*(){const w=h.serviceProvider();if(void 0===w)throw new Error("Delta manager is not attached");let D;if(void 0===h.deltaStorage&&(h.deltaStorage=yield w.connectToDeltaStorage()),void 0!==t){const Y=t-1;if(h.lastQueuedSequenceNumber>=Y)return void h.logger.sendPerformanceEvent(Object.assign({reason:n,eventName:"ExtraStorageCall",early:!0,from:e,to:t},h.connectionManager.connectionVerboseProps));D=ye=>ye.sequenceNumber>=Y}else D=Y=>Y.sequenceNumber>=h.lastObservedSeqNumber;const _=new(Ja());let U=!1;const Q=Y=>{S(Y.sequenceNumber===h.lastQueuedSequenceNumber,570),!U&&D(Y)&&(_.abort(),h._inbound.off("push",Q))};try{h._inbound.on("push",Q),S(null===h.closeAbortController.signal.onabort,488),h.closeAbortController.signal.onabort=()=>_.abort();const Y=h.deltaStorage.fetchMessages(e,t,_.signal,o,n);for(;;){const ye=yield Y.read();if(ye.done)break;try{U=!0,i(ye.value)}finally{U=!1}}}finally{h.closeAbortController.signal.onabort=null,h._inbound.off("push",Q),S(!U,649)}})()}close(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}refreshDelayInfo(e){this.throttlingIdSet.delete(e),0===this.throttlingIdSet.size&&(this.timeTillThrottling=0)}disconnectHandler(e){this.messageBuffer.length=0,this.emit("disconnect",e)}emitDelayInfo(e,t,n){const i=Date.now();if(this.throttlingIdSet.add(e),t>0&&i+t>this.timeTillThrottling){this.timeTillThrottling=i+t;const o=Ti.wrap(n,t/1e3,this.logger);this.emit("throttled",o)}}comparableMessagePayload(e){return`${e.clientId}-${e.type}-${e.minimumSequenceNumber}-${e.referenceSequenceNumber}-${e.timestamp}`}enqueueMessages(e,t,n=!1){var i,o;if(void 0===this.handler)return void(this.pending=this.pending.concat(e));if(S(0===this.pending.length||void 0!==this.fetchReason,489),0===e.length)return;const h=e[0].sequenceNumber,w=e[e.length-1].sequenceNumber;if(w>this.lastQueuedSequenceNumber){let _=h-1;const U=_-this.lastQueuedSequenceNumber;let Q,Fe,Y=0,ye=0;for(const De of e)De.sequenceNumber===_?Y++:De.sequenceNumber!==_+1&&(ye++,void 0===Q&&(Q=_+1)),_=De.sequenceNumber;0!==Y||0!==ye&&!n||U>0&&void 0===this.fetchReason?Fe="enqueueMessages":void 0!==this.fetchReason&&this.fetchReason!==t&&h<=this.lastQueuedSequenceNumber+1&&w>this.lastQueuedSequenceNumber&&(Fe="enqueueMessagesExtraFetch"),void 0!==Fe&&this.logger.sendPerformanceEvent(Object.assign({eventName:Fe,reason:t,previousReason:this.prevEnqueueMessagesReason,from:h,to:w+1,length:e.length,fetchReason:this.fetchReason,duplicate:Y>0?Y:void 0,initialGap:0!==U?U:void 0,gap:ye>0?ye:void 0,firstMissing:Q,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);const D=null===(i=this.previouslyProcessedMessage)||void 0===i?void 0:i.sequenceNumber;S(void 0===D||D===this.lastQueuedSequenceNumber,236);for(const _ of e)if(_.sequenceNumber<=this.lastQueuedSequenceNumber){if((null===(o=this.previouslyProcessedMessage)||void 0===o?void 0:o.sequenceNumber)===_.sequenceNumber){const U=this.comparableMessagePayload(this.previouslyProcessedMessage),Q=this.comparableMessagePayload(_);if(U!==Q){const Y=new ai("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",Dn.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:_.sequenceNumber,message1:U,message2:Q,driverVersion:void 0});this.close(Y)}}}else _.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(_),this.fetchMissingDeltas(t,_.sequenceNumber)):(this.lastQueuedSequenceNumber=_.sequenceNumber,this.previouslyProcessedMessage=_,this._inbound.push(_));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}processInboundMessage(e){const t=Date.now();if(this.lastProcessedMessage=e,S(void 0!==e.clientId||!function aa(u){if(Ir(u))return!0;switch(u.type){case E.Propose:case E.Reject:case E.NoOp:return!0;default:return!1}}(e),237),"string"==typeof e.contents&&""!==e.contents&&e.type!==E.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new zn("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},dr(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new zn("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},dr(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,S(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),void 0===e.term&&(e.term=1),this.baseTerm=e.term,void 0===this.handler)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);const n=Date.now();this.emit("op",e,n-t)}fetchMissingDeltas(e,t){this.fetchMissingDeltasCore(e,!1,t).catch(n=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},n)})}fetchMissingDeltasCore(e,t,n){var i=this;return(0,l.Z)(function*(){var o;if(void 0===i.fetchReason){if(i.closed)return void i.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:e});if(void 0===i.handler)return void S(0===i.lastQueuedSequenceNumber,619);try{let h=i.lastQueuedSequenceNumber+1;const w=null===(o=i.previouslyProcessedMessage)||void 0===o?void 0:o.sequenceNumber;void 0!==w&&(S(w===i.lastQueuedSequenceNumber,242),S(h>1,243),h--);const D=`${e}_fetch`;i.fetchReason=D,yield i.getDeltas(h,n,D,_=>{i.refreshDelayInfo(i.deltaStorageDelayId),i.enqueueMessages(_,D)},t)}catch(h){i.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},h),i.close(Rt(h))}finally{i.refreshDelayInfo(i.deltaStorageDelayId),i.fetchReason=void 0,i.processPendingOps(e)}}})()}processPendingOps(e){if(this.closed)return;S(void 0!==this.handler,620);const t=this.pending.sort((n,i)=>n.sequenceNumber-i.sequenceNumber);this.pending=[],this.enqueueMessages(t,`${e}_pending`,!0),void 0===this.fetchReason&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}}let Ms=(()=>{class u extends Ke{constructor(t){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,void 0!==t){const i=o=>this.forwardEvent(t,o);this.on(u.removeListenerEvent,o=>this.unforwardEvent(t,o)),this.on(u.newListenerEvent,i)}}static isEmitterEvent(t){return t===u.newListenerEvent||t===u.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const t of this.forwardingEvents.values())for(const n of t.values())try{n()}catch{}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(t,...n){for(const i of n)if(void 0!==t&&void 0!==i&&!u.isEmitterEvent(i)){let o=this.forwardingEvents.get(i);if(void 0===o&&(o=new Map,this.forwardingEvents.set(i,o)),!o.has(t)){const h=(...w)=>this.emit(i,...w);o.set(t,()=>t.off(i,h)),t.on(i,h)}}}unforwardEvent(t,...n){for(const i of n)if(void 0!==i&&!u.isEmitterEvent(i)){const o=this.forwardingEvents.get(i);if(o?.has(t)&&0===this.listenerCount(i)){const h=o.get(t);void 0!==h&&h(),o.delete(t),0===o.size&&this.forwardingEvents.delete(i)}}}}return u.newListenerEvent="newListener",u.removeListenerEvent="removeListener",u})();class Xa extends Ms{constructor(e){super(e),this.queue=e}get paused(){return this.queue.paused}get length(){return this.queue.length}get idle(){return this.queue.idle}peek(){return this.queue.peek()}toArray(){return this.queue.toArray()}systemPause(){var e=this;return(0,l.Z)(function*(){return e.pause()})()}pause(){var e=this;return(0,l.Z)(function*(){return e.queue.pause()})()}systemResume(){var e=this;return(0,l.Z)(function*(){return e.resume()})()}resume(){var e=this;return(0,l.Z)(function*(){e.queue.resume()})()}waitTillProcessingDone(){var e=this;return(0,l.Z)(function*(){return e.queue.waitTillProcessingDone()})()}}class _c extends Ms{constructor(e){super(e),this.deltaManager=e,this.inbound=new Xa(e.inbound),this.outbound=new Xa(e.outbound),this.inboundSignal=new Xa(e.inboundSignal)}get IDeltaSender(){return this}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}dispose(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),super.dispose()}submitSignal(e){return this.deltaManager.submitSignal(e)}flush(){return this.deltaManager.flush()}}var Et=(()=>{return(u=Et||(Et={}))[u.Disconnected=0]="Disconnected",u[u.EstablishingConnection=3]="EstablishingConnection",u[u.Connecting=1]="Connecting",u[u.CatchingUp=1]="CatchingUp",u[u.Connected=2]="Connected",Et;var u})();class kc{constructor(e,t,n){var i;this.handler=e,this.logger=t,this._clientId=n,this._connectionState=Et.Disconnected,this.prevClientLeftTimer=new gr(null!==(i=this.handler.maxClientLeaveWaitTime)&&void 0!==i?i:3e5,()=>{S(!this.connected,684),this.applyForConnectedState("timeout")}),this.joinOpTimer=new gr(45e3,()=>{var o;if(this.connectionState!==Et.CatchingUp)return;const h=this.handler.quorumClients(),w={quorumInitialized:void 0!==h,hasPendingClientId:void 0!==this.pendingClientId,inQuorum:void 0!==h?.getMember(null!==(o=this.pendingClientId)&&void 0!==o?o:""),waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue("NoJoinOp",w)})}get connectionState(){return this._connectionState}get connected(){return this.connectionState===Et.Connected}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}startJoinOpTimer(){S(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}stopJoinOpTimer(){S(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){S(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=it.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(e){var t,n;const i=this.handler.quorumClients();S(void 0!==i,566),S(!1===this.waitingForLeaveOp||void 0!==this.clientId&&void 0!==i.getMember(this.clientId),738),this.pendingClientId===this.clientId||void 0===this.pendingClientId||void 0===i.getMember(this.pendingClientId)||this.waitingForLeaveOp?this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:"timeout"===e?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:void 0!==i?.getMember(null!==(n=this.pendingClientId)&&void 0!==n?n:"")})}):(null===(t=this.waitEvent)||void 0===t||t.end({source:e}),this.setConnectionState(Et.Connected))}receivedRemoveMemberEvent(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(Et.Disconnected,e)}receivedConnectEvent(e,t){const n=this._connectionState;this._connectionState=Et.CatchingUp;const i="write"===e;S(i||!this.handler.shouldClientJoinWrite(),778),S(i||!this.waitingForLeaveOp,678);const o=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(Et.CatchingUp,n),i&&void 0===o?.getMember(this._pendingClientId)?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(Et.Connected)}setConnectionState(e,t){if(this.connectionState===e)return void this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e});const n=this._connectionState;this._connectionState=e;const i=this.handler.quorumClients();let o;void 0!==this._clientId&&(o=i?.getMember(this._clientId)),e===Et.Connected?(S(n===Et.CatchingUp,472),void 0!==o&&(o.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===Et.Disconnected&&(this._pendingClientId=void 0,void 0!==o&&this.handler.shouldClientJoinWrite()&&!1===this.prevClientLeftTimer.hasTimer?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:void 0!==o,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,n,t),this.handler.connectionStateChanged()}initProtocol(e){e.quorum.on("addMember",(t,n)=>{this.receivedAddMemberEvent(t)}),e.quorum.on("removeMember",t=>{this.receivedRemoveMemberEvent(t)}),void 0!==this.clientId&&void 0!==e.quorum.getMember(this.clientId)&&this.prevClientLeftTimer.restart()}}class Bc{constructor(e,t){this.internalStorageService=e,this.logger=t,this._disposed=!1}get policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}dispose(){this._disposed=!0}get repositoryUrl(){return this.internalStorageService.repositoryUrl}getSnapshotTree(e,t){var n=this;return(0,l.Z)(function*(){return n.runWithRetry((0,l.Z)(function*(){return n.internalStorageService.getSnapshotTree(e,t)}),"storage_getSnapshotTree")})()}readBlob(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalStorageService.readBlob(e)}),"storage_readBlob")})()}getVersions(e,t,n){var i=this;return(0,l.Z)(function*(){return i.runWithRetry((0,l.Z)(function*(){return i.internalStorageService.getVersions(e,t,n)}),"storage_getVersions")})()}uploadSummaryWithContext(e,t){var n=this;return(0,l.Z)(function*(){return S(0===t.referenceSequenceNumber==(void 0===t.ackHandle),593),0!==t.referenceSequenceNumber?n.internalStorageService.uploadSummaryWithContext(e,t):n.runWithRetry((0,l.Z)(function*(){return n.internalStorageService.uploadSummaryWithContext(e,t)}),"storage_uploadSummaryWithContext")})()}downloadSummary(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalStorageService.downloadSummary(e)}),"storage_downloadSummary")})()}createBlob(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalStorageService.createBlob(e)}),"storage_createBlob")})()}checkStorageDisposed(){if(this._disposed)throw new qn("Storage Service is disposed. Cannot retry",{canRetry:!1})}runWithRetry(e,t){var n=this;return(0,l.Z)(function*(){return Ga(e,t,n.logger,{onRetry:()=>n.checkStorageDisposed()})})()}}class jc{constructor(e,t){this.internalStorageService=e,this.generateProtocolTree=t,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}get policies(){return this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}get disposed(){return this.internalStorageService.disposed}uploadSummaryWithContext(e,t){var n=this;return(0,l.Z)(function*(){return n.internalStorageService.uploadSummaryWithContext(Os(e,n.generateProtocolTree()),t)})()}}class Lc{constructor(e){this.storageGetter=e,this.blobContents={}}loadSnapshotForRehydratingContainer(e){this.getBlobContents(e)}getBlobContents(e){for(const[t,n]of Object.entries(e.blobsContents))this.blobContents[t]=n;for(const[t,n]of Object.entries(e.trees))this.getBlobContents(n)}get policies(){try{return this.storageGetter().policies}catch{}}get repositoryUrl(){return this.storageGetter().repositoryUrl}getSnapshotTree(e,t){var n=this;return(0,l.Z)(function*(){return n.storageGetter().getSnapshotTree(e,t)})()}readBlob(e){var t=this;return(0,l.Z)(function*(){const n=t.blobContents[e];return void 0!==n?n:t.storageGetter().readBlob(e)})()}getVersions(e,t,n){var i=this;return(0,l.Z)(function*(){return i.storageGetter().getVersions(e,t,n)})()}uploadSummaryWithContext(e,t){var n=this;return(0,l.Z)(function*(){return n.storageGetter().uploadSummaryWithContext(e,t)})()}downloadSummary(e){var t=this;return(0,l.Z)(function*(){return t.storageGetter().downloadSummary(e)})()}createBlob(e){var t=this;return(0,l.Z)(function*(){return t.storageGetter().createBlob(e)})()}}class Hc{constructor(e,t){this.blobStorage=e,this.logger=t,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}createBlob(e){var t=this;return(0,l.Z)(function*(){return t.blobStorage.createBlob(e)})()}readBlob(e){var t=this;return(0,l.Z)(function*(){return t.blobStorage.readBlob(e)})()}get policies(){return this.notCalled()}get repositoryUrl(){return this.notCalled()}notCalled(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}}function qc(u){return 0===u.byteOffset&&u.byteLength===u.buffer.byteLength?u.buffer:u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)}function Ya(u){var e;const t=(0,Za.Qc)(u,!0);if("string"!=typeof t.pathname)throw new bt("Failed to parse pathname");const n=null!==(e=t.search)&&void 0!==e?e:"",o=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(t.pathname);return 3===o?.length?{id:o[1],path:o[2],query:n,version:t.query.version}:void 0}function Qo(u){const e={blobs:{},blobsContents:{},trees:{},id:Pe(),unreferenced:u.unreferenced},t=Object.keys(u.tree);for(const n of t){const i=u.tree[n];switch(i.type){case Le.Tree:e.trees[n]=Qo(i);break;case Le.Attachment:e.blobs[n]=i.id;break;case Le.Blob:{const o=Pe();e.blobs[n]=o;const h="string"==typeof i.content?X(i.content,"utf8"):qc(i.content);e.blobsContents[o]=h;break}case Le.Handle:throw new bt("No handles should be there in summary in detached container!!");default:En(0,`Unknown tree type ${i.type}`)}}return e}function zc(u,e){const t={type:Le.Tree,tree:Object.assign({},e.tree)};return t.tree[".protocol"]=u,Qo(t)}const eo=u=>{const e=u.tree[".protocol"],t=u.tree[".app"];return S(void 0!==e&&void 0!==t,480),zc(e,t)};function Xo(u){return".protocol"in u.trees?u.trees[".protocol"]:u}function Qi(u,e){return(...t)=>{if(u.disposed)throw new Error("Already disposed");return e(...t)}}class Vc extends Ms{constructor(e){super(e),super.setMaxListeners(50),this.propose=Qi(this,e.propose.bind(e)),this.has=Qi(this,e.has.bind(e)),this.get=Qi(this,e.get.bind(e)),this.getMembers=Qi(this,e.getMembers.bind(e)),this.getMember=Qi(this,e.getMember.bind(e))}}function Yo(u){return[["code",{key:"code",value:u,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}class Gc{constructor(e,t=2e3,n=50){this.submit=e,this.NoopCountFrequency=n,this.opsCountSinceNoop=0,t!==1/0&&(this.timer=new gr(t,()=>{0!==this.opsCountSinceNoop&&this.submitNoop(!1)}))}scheduleSequenceNumberUpdate(e,t){if(t)this.submitNoop(!0);else if(Ir(e)){if(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency)return void this.submitNoop(!1);void 0!==this.timer&&(1===this.opsCountSinceNoop&&this.timer.restart(),S(this.timer.hasTimer,578))}}submitNoop(e){this.submit(E.NoOp,e?"":null),S(0===this.opsCountSinceNoop,579)}stopSequenceNumberUpdate(){this.opsCountSinceNoop=0}}function to(u,e,t){var n,i;const o=Object.assign({},e),h=t.online;if(o.online="string"==typeof h?h:Jn[ki()],"object"==typeof navigator&&null!==navigator){const w=navigator,D=null!==(i=null!==(n=w.connection)&&void 0!==n?n:w.mozConnection)&&void 0!==i?i:w.webkitConnection;null!==D&&"object"==typeof D&&(o.connectionType=D.type)}o.category=Lr(t)?"generic":"error",u.sendTelemetryEvent(o,t)}function no(u){return new Promise(t=>{let n=t,i=u;ki()===Jn.Offline&&void 0!==window?.addEventListener&&(n=()=>{t(),window.removeEventListener("online",n)},window.addEventListener("online",n,!1),i=Math.max(u,3e4)),setTimeout(n,i)})}var Sr=(()=>{return(u=Sr||(Sr={})).DocRead="doc:read",u.DocWrite="doc:write",u.SummaryWrite="summary:write",Sr;var u})();const eu={fatalConnectError:!0};class ro extends Ke{constructor(){super(...arguments),this.clientId="storage-only client",this.claims={scopes:[Sr.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[],this.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(e){this.emit("nack",this.clientId,e.map(t=>({operation:t,content:{message:"Cannot submit with storage-only connection",code:403}})))}submitSignal(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}}class io{constructor(e,t,n,i,o){this.serviceProvider=e,this.client=t,this.logger=i,this.props=o,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=(h,w)=>{const D=Array.isArray(w)?w:[w];this.props.incomingOpHandler(D,"opHandler")},this.nackHandler=(h,w)=>{const D=w[0];if(!0===this._readonlyPermissions)return void this.props.closeHandler(new ai("writeOnReadOnlyDocument",Dn.writeError,{driverVersion:void 0}));const _=function Qc(u){return Er(`Nack (${u.type}): ${u.message}`,{canRetry:403!==u.code,retryAfterMs:void 0!==u.retryAfter?1e3*u.retryAfter:void 0},{statusCode:u.code,driverVersion:void 0})}(D.content);_.canRetry?this.reconnectOnError("write",_):this.props.closeHandler(_)},this.disconnectHandlerInternal=h=>{this.reconnectOnError(this.defaultReconnectionMode,h)},this.errorHandler=h=>{this.reconnectOnError(this.defaultReconnectionMode,h)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=n?Sn.Enabled:Sn.Never,this._outbound=new Qa(h=>{if(void 0===this.connection)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(h)}),this._outbound.on("error",h=>{this.props.closeHandler(Rt(h))})}get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){var e,t;return null!==(t=null===(e=this.connection)||void 0===e?void 0:e.mode)&&void 0!==t?t:"read"}get connected(){return void 0!==this.connection}get clientId(){var e;return null===(e=this.connection)||void 0===e?void 0:e.clientId}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){var e,t,n;return null!==(n=null===(t=null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration)||void 0===t?void 0:t.maxMessageSize)&&void 0!==n?n:16384}get version(){if(void 0===this.connection)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){var e;return null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration}get scopes(){var e;return null===(e=this.connection)||void 0===e?void 0:e.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return void 0!==this.connection?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}shouldJoinWrite(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}get readonly(){return!!this._forceReadonly||this._readonlyPermissions}get readOnlyInfo(){const e=void 0!==this.connection&&this.connection instanceof ro;return e||this._forceReadonly||!0===this._readonlyPermissions?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}static detailsFromConnection(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}dispose(e){this.closed||(this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=Sn.Never,this._outbound.clear(),this.disconnectFromDeltaStream(void 0!==e?`Closing DeltaManager (${e.message})`:"Closing DeltaManager"),this.set_readonlyPermissions(!0))}setAutoReconnect(e){S(e!==Sn.Never&&this._reconnectMode!==Sn.Never,632),this._reconnectMode=e,e!==Sn.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}forceReadonly(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});const t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===Sn.Never)throw new wt("API is not supported for non-connecting or closed container");let n=!1;!0===this.readonly&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),n=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),n&&this.triggerConnect("read")}}set_readonlyPermissions(e){const t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}connect(e){this.connectCore(e).catch(t=>{const n=Rt(t,{props:eu});this.props.closeHandler(n)})}connectCore(e){var t=this;return(0,l.Z)(function*(){var n,i;if(S(!t.closed,618),void 0!==t.connection)return;let o;void 0!==t.pendingConnection&&(o=t.pendingConnection.connectionMode,t.cancelConnection(),S(void 0===t.pendingConnection,836));let h=null!==(n=e??o)&&void 0!==n?n:t.defaultReconnectionMode;t.shouldJoinWrite()&&(h="write");const w=t.serviceProvider();let D;if(S(void 0!==w,679),!0===(null===(i=w.policies)||void 0===i?void 0:i.storageOnly))return D=new ro,t.setupNewSuccessfulConnection(D,"read"),void S(void 0===t.pendingConnection,691);let _=1e3,U=0;const Q=Re.now();let Y;const ye=new(Ja()),Fe=ye.signal;for(t.pendingConnection={abort:()=>{ye.abort()},connectionMode:h};void 0===D;){if(t.closed)throw new Error("Attempting to connect a closed DeltaManager");if(!0===Fe.aborted)return void t.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:U,duration:Xt.formatTick(Re.now()-Q),connectionEstablished:!1});U++;try{t.client.mode=h,D=yield w.connectToDeltaStream(Object.assign(Object.assign({},t.client),{mode:h})),D.disposed&&(t.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),D=void 0)}catch(De){if("object"==typeof De&&null!==De&&De?.errorType===si.errorType){D=new ro,h="read";break}if(!Lr(De)){const ke=Rt(De,{props:eu});throw t.props.closeHandler(ke),ke}to(t.logger,{attempts:U,delay:_,eventName:"DeltaConnectionFailureToConnect",duration:Xt.formatTick(Re.now()-Q)},De),Y=De;const Ee=Ne(De);_=Ee??Math.min(2*_,8e3),void 0!==Ee&&t.props.reconnectionDelayHandler(Ee,De),yield no(_)}}if(U>1&&to(t.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:U,duration:Xt.formatTick(Re.now()-Q)},Y),!0===Fe.aborted)return D.dispose(),void t.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:U,duration:Xt.formatTick(Re.now()-Q),connectionEstablished:!0});t.setupNewSuccessfulConnection(D,h)})()}triggerConnect(e){S(void 0===this.connection,569),this.reconnectMode===Sn.Enabled&&this.connect(e)}disconnectFromDeltaStream(e){if(this.pendingReconnect=!1,void 0===this.connection)return void 0!==this.pendingConnection&&(this.cancelConnection(),!0);S(void 0===this.pendingConnection,635);const t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}cancelConnection(){S(void 0!==this.pendingConnection,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}setupNewSuccessfulConnection(e,t){S(void 0===this.connection,230),S(!e.disposed,650),this.pendingConnection=void 0,this.connection=e;const n=!e.claims.scopes.includes(Sr.DocWrite);if(S("read"===t||n===("read"===this.connectionMode),231),S(!n||"read"===this.connectionMode,232),this.set_readonlyPermissions(n),this.closed)return void this.disconnectFromDeltaStream("ConnectionManager already closed");this._outbound.resume(),e.on("op",this.opHandler),e.on("signal",this.props.signalHandler),e.on("nack",this.nackHandler),e.on("disconnect",this.disconnectHandlerInternal),e.on("error",this.errorHandler),e.on("pong",this.props.pongHandler);const i=e.initialMessages.sort((D,_)=>D.sequenceNumber-_.sequenceNumber);let o=e.checkpointSequenceNumber;this._connectionVerboseProps={clientId:e.clientId,mode:e.mode},this._connectionProps={},void 0!==e.relayServiceAgent&&(this._connectionVerboseProps.relayServiceAgent=e.relayServiceAgent,this._connectionProps.relayServiceAgent=e.relayServiceAgent),this._connectionProps.socketDocumentId=e.claims.documentId,this._connectionProps.connectionMode=e.mode;let h=-1;if(0!==i.length&&(this._connectionVerboseProps.connectionInitialOpsFrom=i[0].sequenceNumber,h=i[i.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=h+1,(void 0===o||o<h)&&(o=h)),this.props.incomingOpHandler(i,this.connectFirstConnection?"InitialOps":"ReconnectOps"),void 0!==e.initialSignals)for(const D of e.initialSignals)this.props.signalHandler(D);const w=io.detailsFromConnection(e);w.checkpointSequenceNumber=o,this.props.connectHandler(w),this.connectFirstConnection=!1}reconnectOnError(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}reconnect(e,t,n){var i=this;return(0,l.Z)(function*(){if(S(void 0!==i.connection,235),i.disconnectFromDeltaStream(t),void 0!==n&&!n.canRetry&&i.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:i.reconnectMode},n),i.reconnectMode===Sn.Never&&i.props.closeHandler(),i.closed||i.reconnectMode!==Sn.Enabled)return;const o=Ne(n);void 0!==n&&void 0!==o&&(i.props.reconnectionDelayHandler(o,n),yield no(o)),i.triggerConnect(e)})()}prepareMessageToSend(e){var t,n;if(!0!==this.readonly)return S(!!this.connection,228),this.lastSubmittedClientId!==(null===(t=this.connection)||void 0===t?void 0:t.clientId)&&(this.lastSubmittedClientId=null===(n=this.connection)||void 0===n?void 0:n.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===E.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber});{S(!0===this.readOnlyInfo.readonly,496);const i=new qn("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(i)}}submitSignal(e){void 0!==this.connection?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}sendMessages(e){var t=this;S(this.connected,692),"read"!==this.connectionMode?(S(!this.pendingReconnect,693),this._outbound.push(e)):this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then((0,l.Z)(function*(){t.pendingReconnect&&(yield t.reconnect("write","Switch to write"))})).catch(()=>{}))}beforeProcessingIncomingOp(e){if(S(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),void 0!==this.lastSubmittedClientId&&this.lastSubmittedClientId===e.clientId){const t=e.clientSequenceNumber;S(this.clientSequenceNumberObserved<t,239),S(t<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=t}e.type===E.ClientLeave&&JSON.parse(e.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch(i=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},i)}))}}const so="saved";function nu(u,e,t){return oo.apply(this,arguments)}function oo(){return(oo=(0,l.Z)(function*(u,e,t){const n=it.start(u,{eventName:e}),i=yield t();n.duration>1e3&&n.end(i)})).apply(this,arguments)}const ru="summarizer";let ks=(()=>{class u extends Je{constructor(t,n){var i,o;super((Q,Y)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:"string"==typeof Q?Q:void 0},Y)}),this.loader=t,this._canReconnect=!0,this._lifecycleState="loading",this._attachState=we.Detached,this.inboundQueuePausedFromInit=!0,this.firstConnection=!0,this.connectionTransitionTimes=[],this.messageCountAfterDisconnection=0,this.attachStarted=!1,this._dirtyContainer=!1,this.setAutoReconnectTime=Re.now(),this._audience=new Dc,this.clientDetailsOverride=n.clientDetailsOverride,this._resolvedUrl=n.resolvedUrl,void 0!==n.canReconnect&&(this._canReconnect=n.canReconnect);const h=this.client.details.type;this.subLogger=rt.create(t.services.subLogger,void 0,{all:{clientType:`${this.client.details.capabilities.interactive?"interactive":"noninteractive"}${void 0!==h&&""!==h?`/${h}`:""}`,containerId:Pe(),docId:()=>{var Q,Y;return null!==(Y=null===(Q=this._resolvedUrl)||void 0===Q?void 0:Q.id)&&void 0!==Y?Y:void 0},containerAttachState:()=>this._attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>Et[this.connectionState],serializedContainer:void 0!==n.serializedContainerState},error:{dmInitialSeqNumber:()=>{var Q;return null===(Q=this._deltaManager)||void 0===Q?void 0:Q.initialSequenceNumber},dmLastProcessedSeqNumber:()=>{var Q;return null===(Q=this._deltaManager)||void 0===Q?void 0:Q.lastSequenceNumber},dmLastKnownSeqNumber:()=>{var Q;return null===(Q=this._deltaManager)||void 0===Q?void 0:Q.lastKnownSeqNumber},containerLoadedFromVersionId:()=>{var Q;return null===(Q=this.loadedFromVersion)||void 0===Q?void 0:Q.id},containerLoadedFromVersionDate:()=>{var Q;return null===(Q=this.loadedFromVersion)||void 0===Q?void 0:Q.date},dmLastMsqSeqNumber:()=>{var Q,Y;return null===(Y=null===(Q=this.deltaManager)||void 0===Q?void 0:Q.lastMessage)||void 0===Y?void 0:Y.sequenceNumber},dmLastMsqSeqTimestamp:()=>{var Q,Y;return null===(Y=null===(Q=this.deltaManager)||void 0===Q?void 0:Q.lastMessage)||void 0===Y?void 0:Y.timestamp},dmLastMsqSeqClientId:()=>{var Q,Y;return null===(Y=null===(Q=this.deltaManager)||void 0===Q?void 0:Q.lastMessage)||void 0===Y?void 0:Y.clientId},connectionStateDuration:()=>Re.now()-this.connectionTransitionTimes[this.connectionState]}}),this.mc=gt(rt.create(this.subLogger,"Container"));const _=null!==(i=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))&&void 0!==i?i:this.loader.services.options.summarizeProtocolTree;this.options=Object.assign(Object.assign({},this.loader.services.options),{summarizeProtocolTree:_}),this.connectionStateHandler=new kc({quorumClients:()=>{var Q;return null===(Q=this._protocolHandler)||void 0===Q?void 0:Q.quorum},logConnectionStateChangeTelemetry:(Q,Y,ye)=>this.logConnectionStateChangeTelemetry(Q,Y,ye),shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:this.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:(Q,Y)=>{this._deltaManager.logConnectionIssue(Object.assign({eventName:Q,duration:Re.now()-this.connectionTransitionTimes[Et.CatchingUp]},void 0===Y?{}:{details:JSON.stringify(Y)}))},connectionStateChanged:()=>{"loaded"===this._lifecycleState&&this.propagateConnectionState()}},this.mc.logger,null===(o=n.serializedContainerState)||void 0===o?void 0:o.clientId),this.on(so,()=>{this.connectionStateHandler.containerSaved()}),this._deltaManager=this.createDeltaManager(),this._storage=new Lc(()=>{if(this.attachState!==we.Attached){if(void 0!==this.loader.services.detachedBlobStorage)return new Hc(this.loader.services.detachedBlobStorage,this.mc.logger);throw this.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return this.storageService}),"object"==typeof document&&null!==document&&"function"==typeof document.addEventListener&&null!==document.addEventListener&&(this.lastVisible=document.hidden?Re.now():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=Re.now():setTimeout(()=>{this.lastVisible=void 0},0)},document.addEventListener("visibilitychange",this.visibilityEventHandler)),this.on("newListener",(Q,Y)=>{Promise.resolve().then(()=>{switch(Q){case"dirty":this._dirtyContainer&&Y();break;case so:this._dirtyContainer||Y();break;case is:this.connected&&Y(this.clientId);break;case ss:this.connected||Y()}}).catch(ye=>{this.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},ye)})})}static load(t,n,i){return(0,l.Z)(function*(){const o=new u(t,{clientDetailsOverride:n.clientDetailsOverride,resolvedUrl:n.resolvedUrl,canReconnect:n.canReconnect,serializedContainerState:i});return it.timedExecAsync(o.mc.logger,{eventName:"Load"},function(){var h=(0,l.Z)(function*(w){return new Promise((D,_)=>{var U,Q;const Y=n.version,ye={opsBeforeReturn:"cached"},Fe=i?Object.assign(Object.assign({},null!==(U=n.loadMode)&&void 0!==U?U:ye),{opsBeforeReturn:void 0}):null!==(Q=n.loadMode)&&void 0!==Q?Q:ye,De=Ee=>{_(Ee??new qn("Container closed without error during load"))};o.on("closed",De),o.load(Y,Fe,i).finally(()=>{o.removeListener("closed",De)}).then(Ee=>{w.end(Object.assign(Object.assign({},Ee),n.loadMode)),D(o)},Ee=>{const ke=Rt(Ee);o.close(ke),De(ke)})})});return function(w){return h.apply(this,arguments)}}(),{start:!0,end:!0,cancel:"generic"})})()}static createDetached(t,n){return(0,l.Z)(function*(){const i=new u(t,{});return it.timedExecAsync(i.mc.logger,{eventName:"CreateDetached"},function(){var o=(0,l.Z)(function*(h){return yield i.createDetached(n),i});return function(h){return o.apply(this,arguments)}}(),{start:!0,end:!0,cancel:"generic"})})()}static rehydrateDetachedFromSnapshot(t,n){return(0,l.Z)(function*(){const i=new u(t,{});return it.timedExecAsync(i.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},function(){var o=(0,l.Z)(function*(h){const w=JSON.parse(n);return yield i.rehydrateDetachedFromSnapshot(w),i});return function(h){return o.apply(this,arguments)}}(),{start:!0,end:!0,cancel:"generic"})})()}setLoaded(){"loading"===this._lifecycleState&&(this.propagateConnectionState(),this._lifecycleState="loaded")}get closed(){return"closing"===this._lifecycleState||"closed"===this._lifecycleState}get storage(){return this._storage}get storageService(){if(void 0===this._storageService)throw new Error("Attempted to access storageService before it was defined");return this._storageService}get context(){if(void 0===this._context)throw new qn("Attempted to access context before it was defined");return this._context}get protocolHandler(){if(void 0===this._protocolHandler)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get IFluidRouter(){return this}get resolvedUrl(){return this._resolvedUrl}get loadedFromVersion(){return this._loadedFromVersion}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get closeSignal(){return this._deltaManager.closeAbortController.signal}forceReadonly(t){this._deltaManager.connectionManager.forceReadonly(t)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connected}get serviceConfiguration(){return this._deltaManager.serviceConfiguration}get clientId(){return this.connectionStateHandler.clientId}get scopes(){return this._deltaManager.connectionManager.scopes}get clientDetails(){return this._deltaManager.clientDetails}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){var t;return null===(t=this._context)||void 0===t?void 0:t.codeDetails}get audience(){return this._audience}get isDirty(){return this._dirtyContainer}get serviceFactory(){return this.loader.services.documentServiceFactory}get urlResolver(){return this.loader.services.urlResolver}get scope(){return this.loader.services.scope}get codeLoader(){return this.loader.services.codeLoader}getQuorum(){return this.protocolHandler.quorum}close(t){this._deltaManager.close(t),S(this.connectionState===Et.Disconnected,207),S("closed"===this._lifecycleState,788)}closeCore(t){var n,i,o,h;S(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:void 0===t?"generic":"error"},t),this._lifecycleState="closing",null===(n=this._protocolHandler)||void 0===n||n.close(),this.connectionStateHandler.dispose(),null===(i=this._context)||void 0===i||i.dispose(void 0!==t?new Error(t.message):void 0),null===(o=this._storageService)||void 0===o||o.dispose(),null===(h=this.service)||void 0===h||h.dispose(t)}catch(w){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},w)}this.emit("closed",t),this.removeAllListeners(),void 0!==this.visibilityEventHandler&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}closeAndGetPendingLocalState(){S(this.attachState===we.Attached,209),S(void 0!==this.resolvedUrl&&"fluid"===this.resolvedUrl.type,210),S(!!this._protocolHandler,739),S(void 0!==this._protocolHandler.attributes.term,779);const t={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(t)}get attachState(){return this._attachState}serialize(){S(this.attachState===we.Detached,211);const i=Os(this.context.createSummary(),this.captureProtocolSummary());return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(i.tree[".hasAttachmentBlobs"]={type:Le.Blob,content:"true"}),JSON.stringify(i)}attach(t){var n=this;return(0,l.Z)(function*(){yield it.timedExecAsync(n.mc.logger,{eventName:"Attach"},(0,l.Z)(function*(){if("loaded"!==n._lifecycleState)throw new wt(`The Container is not in a valid state for attach [${n._lifecycleState}]`);S(n._attachState===we.Detached&&!n.attachStarted,517),n.attachStarted=!0;const i=void 0!==n.loader.services.detachedBlobStorage&&n.loader.services.detachedBlobStorage.size>0;try{let o;if(S(0===n.deltaManager.inbound.length,214),!i){const D=n.context.createSummary(),_=n.captureProtocolSummary();o=Os(D,_),n._attachState=we.Attaching,n.context.notifyAttaching(eo(o))}const h=yield n.urlResolver.resolve(t);ar(h),void 0===n.service&&(S(n.client.details.type!==ru,708),n.service=yield Ga((0,l.Z)(function*(){return n.serviceFactory.createContainer(o,h,n.subLogger,!1)}),"containerAttach",n.mc.logger,{cancel:n.closeSignal}));const w=n.service.resolvedUrl;if(ar(w),n._resolvedUrl=w,yield n.connectStorageService(),i){S(!!n.loader.services.detachedBlobStorage,590);const D=new Map;for(;D.size<n.loader.services.detachedBlobStorage.size;){const Q=n.loader.services.detachedBlobStorage.getBlobIds().filter(Y=>!D.has(Y));for(const Y of Q){const ye=yield n.loader.services.detachedBlobStorage.readBlob(Y),Fe=yield n.storageService.createBlob(ye);D.set(Y,Fe.id)}}const _=n.context.createSummary(D),U=n.captureProtocolSummary();o=Os(_,U),n._attachState=we.Attaching,n.context.notifyAttaching(eo(o)),yield n.storageService.uploadSummaryWithContext(o,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0})}n._attachState=we.Attached,n.emit("attached"),n.propagateConnectionState(),n.closed||n.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"})}catch(o){const h=Rt(o),w=n.resolvedUrl;throw za(w)&&h.addTelemetryProperties({resolvedUrl:w.url}),n.close(h),h}}),{start:!0,end:!0,cancel:"generic"})})()}request(t){var n=this;return(0,l.Z)(function*(){return it.timedExecAsync(n.mc.logger,{eventName:"Request"},(0,l.Z)(function*(){return n.context.request(t)}),{end:!0,cancel:"error"})})()}setAutoReconnectInternal(t){if(this._deltaManager.connectionManager.reconnectMode===t)return;const i=Re.now(),o=i-this.setAutoReconnectTime;this.setAutoReconnectTime=i,this.mc.logger.sendTelemetryEvent({eventName:t===Sn.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:Et[this.connectionState],duration:o}),this._deltaManager.connectionManager.setAutoReconnect(t)}connect(){if(this.closed)throw new wt("The Container is closed and cannot be connected");if(this._attachState!==we.Attached)throw new wt("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}connectInternal(t){S(!this.closed,709),S(this._attachState===we.Attached,710),this.resumeInternal(t),this.setAutoReconnectInternal(Sn.Enabled)}disconnect(){if(this.closed)throw new wt("The Container is closed and cannot be disconnected");this.disconnectInternal()}disconnectInternal(){S(!this.closed,711),this.setAutoReconnectInternal(Sn.Disabled)}resumeInternal(t){S(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(t)}getAbsoluteUrl(t){var n=this;return(0,l.Z)(function*(){var i;if(void 0!==n.resolvedUrl)return n.urlResolver.getAbsoluteUrl(n.resolvedUrl,t,(u=>{let e;return e=u&&"name"in u?u:Ko(u?.package)?u?.package.name:u?.package,{name:e}})(null===(i=n._context)||void 0===i?void 0:i.codeDetails))})()}proposeCodeDetails(t){var n=this;return(0,l.Z)(function*(){if(!Go(t))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(n.codeLoader.IFluidCodeDetailsComparer){const i=yield n.codeLoader.IFluidCodeDetailsComparer.compare(t,n.getCodeDetailsFromQuorum());if(void 0!==i&&i<=0)throw new Error("Proposed code details should be greater than the current")}return n.protocolHandler.quorum.propose("code",t).then(()=>!0).catch(()=>!1)})()}processCodeProposal(){var t=this;return(0,l.Z)(function*(){const n=t.getCodeDetailsFromQuorum();if(yield Promise.all([t.deltaManager.inbound.pause(),t.deltaManager.inboundSignal.pause()]),!0===(yield t.context.satisfies(n)))return t.deltaManager.inbound.resume(),void t.deltaManager.inboundSignal.resume();t.close(new qn("Existing context does not satisfy incoming proposal"))})()}getVersion(t){var n=this;return(0,l.Z)(function*(){return(yield n.storageService.getVersions(t,1))[0]})()}recordConnectStartTime(){void 0===this.connectionTransitionTimes[Et.Disconnected]&&(this.connectionTransitionTimes[Et.Disconnected]=Re.now())}connectToDeltaStream(t){this.recordConnectStartTime(),(!this._canReconnect||!this.client.details.capabilities.interactive)&&(t.mode="write"),this._deltaManager.connect(t)}load(t,n,i){var o=this;return(0,l.Z)(function*(){if(void 0===o._resolvedUrl)throw new Error("Attempting to load without a resolved url");o.service=yield o.serviceFactory.createDocumentService(o._resolvedUrl,o.subLogger,o.client.details.type===ru),void 0===n.deltaConnection&&o.connectToDeltaStream({reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1}),i?o.connectStorageService().catch(Y=>o.close(Y)):yield o.connectStorageService(),o._attachState=we.Attached;const{snapshot:w,versionId:D}=void 0===i?yield o.fetchSnapshotTree(t):{snapshot:void 0,versionId:void 0};S(void 0!==w||void 0!==i,567);const _=void 0===i?yield o.getDocumentAttributes(o.storageService,w):{sequenceNumber:i.protocol.sequenceNumber,minimumSequenceNumber:i.protocol.minimumSequenceNumber,term:i.term};let U;switch(n.opsBeforeReturn){case void 0:o.attachDeltaManagerOpHandler(_,"none"!==n.deltaConnection?"all":"none");break;case"cached":U=o.attachDeltaManagerOpHandler(_,"cached");break;case"all":U=o.attachDeltaManagerOpHandler(_,"all");break;default:En()}o._protocolHandler=void 0===i?yield o.initializeProtocolStateFromSnapshot(_,o.storageService,w):yield o.initializeProtocolState(_,i.protocol.members,i.protocol.proposals,i.protocol.values);const Q=o.getCodeDetailsFromQuorum();if(yield o.instantiateContext(!0,Q,w,i?.pendingRuntimeState),!o.closed)switch(void 0!==U&&(o._deltaManager.inbound.resume(),yield nu(o.mc.logger,"WaitOps",(0,l.Z)(function*(){return yield U,{}})),yield nu(o.mc.logger,"WaitOpProcessing",(0,l.Z)(function*(){return o._deltaManager.inbound.waitTillProcessingDone()})),o._deltaManager.inbound.pause()),n.deltaConnection){case void 0:case"delayed":S(o.inboundQueuePausedFromInit,838),o.inboundQueuePausedFromInit=!1,o._deltaManager.inbound.resume(),o._deltaManager.inboundSignal.resume();break;case"none":break;default:En()}if(o.closed)throw new Error("Container was closed while load()");return o.setLoaded(),{sequenceNumber:_.sequenceNumber,version:D,dmLastProcessedSeqNumber:o._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:o._deltaManager.lastKnownSeqNumber}})()}createDetached(t){var n=this;return(0,l.Z)(function*(){const i={sequenceNumber:0,term:1,minimumSequenceNumber:0};yield n.attachDeltaManagerOpHandler(i);const o=Yo(t);n._protocolHandler=yield n.initializeProtocolState(i,[],[],o),yield n.instantiateContextDetached(!1),n.setLoaded()})()}rehydrateDetachedFromSnapshot(t){var n=this;return(0,l.Z)(function*(){void 0!==t.tree[".hasAttachmentBlobs"]&&(S(!!n.loader.services.detachedBlobStorage&&n.loader.services.detachedBlobStorage.size>0,592),delete t.tree[".hasAttachmentBlobs"]);const i=eo(t);n._storage.loadSnapshotForRehydratingContainer(i);const o=yield n.getDocumentAttributes(n._storage,i);yield n.attachDeltaManagerOpHandler(o);const h=Xo(i),D=function Uc(u){const t=new Map(u).get("code");return S(void 0!==t,732),t?.value}(yield V(n._storage,h.blobs.quorumValues));n._protocolHandler=yield n.initializeProtocolState(o,[],[],void 0!==D?Yo(D):[]),yield n.instantiateContextDetached(!0,i),n.setLoaded()})()}connectStorageService(){var t=this;return(0,l.Z)(function*(){var n,i;if(void 0!==t._storageService)return;S(void 0!==t.service,495);const o=yield t.service.connectToStorage();t._storageService=new Bc(o,t.mc.logger),!0===t.options.summarizeProtocolTree&&(t.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),t._storageService=new jc(t._storageService,()=>t.captureProtocolSummary())),S((null===(n=o.policies)||void 0===n?void 0:n.minBlobSize)===(null===(i=t.storageService.policies)||void 0===i?void 0:i.minBlobSize),224)})()}getDocumentAttributes(t,n){return(0,l.Z)(function*(){if(void 0===n)return{minimumSequenceNumber:0,sequenceNumber:0,term:1};const i=".protocol"in n.trees?n.trees[".protocol"].blobs.attributes:n.blobs[".attributes"],o=yield V(t,i);return void 0===o.term&&(o.term=1),o})()}initializeProtocolStateFromSnapshot(t,n,i){var o=this;return(0,l.Z)(function*(){let h=[],w=[],D=[];if(void 0!==i){const U=Xo(i);[h,w,D]=yield Promise.all([V(n,U.blobs.quorumMembers),V(n,U.blobs.quorumProposals),V(n,U.blobs.quorumValues)])}return yield o.initializeProtocolState(t,h,w,D)})()}initializeProtocolState(t,n,i,o){var h=this;return(0,l.Z)(function*(){const w=new Fc(t.minimumSequenceNumber,t.sequenceNumber,t.term,n,i,o,(_,U)=>h.submitMessage(E.Propose,{key:_,value:U})),D=rt.create(h.subLogger,"ProtocolHandler");return w.quorum.on("error",_=>{D.sendErrorEvent(_)}),h.connectionStateHandler.initProtocol(w),w.quorum.on("addProposal",_=>{("code"===_.key||"code2"===_.key)&&h.emit("codeDetailsProposed",_.value,_)}),w.quorum.on("approveProposal",(_,U,Q)=>{("code"===U||"code2"===U)&&(Go(Q)||h.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),h.processCodeProposal().catch(Y=>{throw h.close(Rt(Y)),Y}))}),w})()}captureProtocolSummary(){const t=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:Le.Blob},quorumMembers:{content:JSON.stringify(t.members),type:Le.Blob},quorumProposals:{content:JSON.stringify(t.proposals),type:Le.Blob},quorumValues:{content:JSON.stringify(t.values),type:Le.Blob}},type:Le.Tree}}getCodeDetailsFromQuorum(){return(u=>{var e;return null!==(e=u.get("code"))&&void 0!==e?e:u.get("code2")})(this.protocolHandler.quorum)}get client(){var t;const n=void 0!==(null===(t=this.options)||void 0===t?void 0:t.client)?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return void 0!==this.clientDetailsOverride&&bc()(n.details,this.clientDetailsOverride),n.details.environment=[n.details.environment," loaderVersion:1.3.6"].join(";"),n}activeConnection(){return this.connectionState===Et.Connected&&"write"===this.connectionMode}createDeltaManager(){const t=()=>this.service,n=new Oc(t,rt.create(this.subLogger,"DeltaManager"),()=>this.activeConnection(),i=>new io(t,this.client,this._canReconnect,rt.create(this.subLogger,"ConnectionManager"),i));return n.inbound.pause(),n.inboundSignal.pause(),n.on("connect",(i,o)=>{var h;this._audience.clear();for(const w of null!==(h=i.initialClients)&&void 0!==h?h:[])this._audience.addMember(w.clientId,w.client);this.connectionStateHandler.receivedConnectEvent(this.connectionMode,i)}),n.on("disconnect",i=>{var o;null===(o=this.collabWindowTracker)||void 0===o||o.stopSequenceNumberUpdate(),this.connectionStateHandler.receivedDisconnectEvent(i)}),n.on("throttled",i=>{const o=i;!0!==o.logged&&this.logContainerError(o),this.emit("warning",o)}),n.on("readonly",i=>{this.emit("readonly",i)}),n.on("closed",i=>{this.closeCore(i)}),n}attachDeltaManagerOpHandler(t,n){var i=this;return(0,l.Z)(function*(){var o;return i._deltaManager.attachOpHandler(t.minimumSequenceNumber,t.sequenceNumber,null!==(o=t.term)&&void 0!==o?o:1,{process:h=>i.processRemoteMessage(h),processSignal:h=>{i.processSignal(h)}},n)})()}logConnectionStateChangeTelemetry(t,n,i){var o;const h=Re.now();this.connectionTransitionTimes[t]=h;const w=h-this.connectionTransitionTimes[n];let D,_,U,Q,Y;t===Et.Disconnected?U=this._deltaManager.connectionManager.reconnectMode:(t===Et.Connected?(D=h-this.connectionTransitionTimes[Et.Disconnected],D=Xt.formatTick(D)):(Q=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(Y=Q-this.deltaManager.lastSequenceNumber)),_=this.firstConnection?"InitialConnect":"AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:`ConnectionStateChange_${Et[t]}`,from:Et[n],duration:w,durationFromDisconnected:D,reason:i,connectionInitiationReason:_,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:U,opsBehind:Y,online:Jn[ki()],lastVisible:void 0!==this.lastVisible?Re.now()-this.lastVisible:void 0,checkpointSequenceNumber:Q,quorumSize:null===(o=this._protocolHandler)||void 0===o?void 0:o.quorum.getMembers().size},this._deltaManager.connectionProps)),t===Et.Connected&&(this.firstConnection=!1)}propagateConnectionState(){var t;const n=this.connectionState===Et.Connected&&!this.firstConnection&&"write"===this.connectionMode;n&&(this.messageCountAfterDisconnection=0);const i=this.connectionState===Et.Connected;!1===(null===(t=this._context)||void 0===t?void 0:t.disposed)&&this.context.setConnectionState(i,this.clientId),this.protocolHandler.setConnectionState(i,this.clientId),Fi(this.mc.logger,this,i,this.clientId),n&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}submitContainerMessage(t,n,i,o){switch(t){case E.Operation:case E.RemoteHelp:break;case E.Summarize:{const w=n;void 0===w.details&&(w.details={}),w.details.includesProtocolTree=!0===this.options.summarizeProtocolTree;break}default:return this.close(new qn("invalidContainerSubmitOpType",void 0,{messageType:t})),-1}return this.submitMessage(t,n,i,o)}submitMessage(t,n,i,o){var h;return this.connectionState!==Et.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:t}),-1):(this.messageCountAfterDisconnection+=1,null===(h=this.collabWindowTracker)||void 0===h||h.stopSequenceNumberUpdate(),this._deltaManager.submit(t,n,i,o))}processRemoteMessage(t){const n=this.clientId===t.clientId;let i={immediateNoOp:!1};try{i=this.protocolHandler.processMessage(t,n)}catch(o){this.close(hr(o,h=>new zn(h,dr(t))))}return Or(t)&&!Ir(t)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:t.type}),(Ir(t)||Or(t))&&this.context.process(t,n,void 0),this.activeConnection()&&(void 0===this.collabWindowTracker&&(S(void 0!==this.serviceConfiguration,740),this.collabWindowTracker=new Gc((o,h)=>{S(this.activeConnection(),577),this.submitMessage(o,h)},this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(t,!0===i.immediateNoOp)),this.emit("op",t),i}submitSignal(t){this._deltaManager.submitSignal(JSON.stringify(t))}processSignal(t){if(null===t.clientId){const n=t.content;if(n.type===E.ClientJoin){const i=n.content;this._audience.addMember(i.clientId,i.client)}else n.type===E.ClientLeave&&this._audience.removeMember(n.content)}else this.context.processSignal(t,this.clientId===t.clientId)}fetchSnapshotTree(t){var n=this;return(0,l.Z)(function*(){var i;const o=yield n.getVersion(t??null);void 0===o&&void 0!==t&&n.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:t}),n._loadedFromVersion=o;const h=null!==(i=yield n.storageService.getSnapshotTree(o))&&void 0!==i?i:void 0;return void 0===h&&void 0!==o&&n.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:o.id}),{snapshot:h,versionId:o?.id}})()}instantiateContextDetached(t,n){var i=this;return(0,l.Z)(function*(){const o=i.getCodeDetailsFromQuorum();if(void 0===o)throw new Error("pkg should be provided in create flow!!");yield i.instantiateContext(t,o,n)})()}instantiateContext(t,n,i,o){var h=this;return(0,l.Z)(function*(){var w;S(!1!==(null===(w=h._context)||void 0===w?void 0:w.disposed),221);const D=new el(h,h.loader);h._context=yield $a.createOrLoad(h,h.scope,h.codeLoader,n,i,new _c(h._deltaManager),new Vc(h.protocolHandler.quorum),D,(_,U,Q,Y)=>h.submitContainerMessage(_,U,Q,Y),_=>h.submitSignal(_),_=>h.close(_),u.version,_=>h.updateDirtyContainerState(_),t,o),h.emit("contextChanged",n)})()}updateDirtyContainerState(t){this._dirtyContainer!==t&&(this._dirtyContainer=t,this.emit(t?"dirty":so))}logContainerError(t){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},t)}}return u.version="^0.1.0",u})();function iu(u){return void 0===u.headers||!1!==u.headers[Mt.cache]}class el{constructor(e,t){this.container=e,this.loader=t}get IFluidRouter(){return this}resolve(e){var t=this;return(0,l.Z)(function*(){var n,i,o,h,w;if(e.url.startsWith("/")){if(iu(e))return t.container;{const D=t.container.resolvedUrl;return ar(D),yield ks.load(t.loader,{canReconnect:null===(n=e.headers)||void 0===n?void 0:n[Mt.reconnect],clientDetailsOverride:null===(i=e.headers)||void 0===i?void 0:i[Mt.clientDetails],resolvedUrl:Object.assign({},D),version:null!==(h=null===(o=e.headers)||void 0===o?void 0:o[Mt.version])&&void 0!==h?h:void 0,loadMode:null===(w=e.headers)||void 0===w?void 0:w[Mt.loadMode]})}}if(void 0===t.loader)throw new Error("Cannot resolve external containers");return t.loader.resolve(e)})()}request(e){var t=this;return(0,l.Z)(function*(){return e.url.startsWith("/")?(yield t.resolve(e)).request(e):void 0===t.loader?{status:404,value:"Cannot request external containers",mimeType:"plain/text"}:t.loader.request(e)})()}}function tl(u){const e=Object.create(u),t=new Map;return e.resolve=function(){var n=(0,l.Z)(function*(i){return iu(i)?(t.has(i.url)||t.set(i.url,u.resolve(i)),t.get(i.url)):u.resolve(i)});return function(i){return n.apply(this,arguments)}}(),e}class nl{constructor(e){var t,n;this.containers=new Map;const i=Object.assign({},e.scope);!1!==(null===(t=e.options)||void 0===t?void 0:t.provideScopeLoader)&&(i.ILoader=this);const o={loaderId:Pe(),loaderVersion:"1.3.6"},h=xt(Ji.mixinDebugLogger("fluid:telemetry",e.logger,{all:o}),Xe.value,e.configProvider);this.services={urlResolver:tl(Ua.create(e.urlResolver)),documentServiceFactory:Ka.create(e.documentServiceFactory),codeLoader:e.codeLoader,options:null!==(n=e.options)&&void 0!==n?n:{},scope:i,subLogger:h.logger,detachedBlobStorage:e.detachedBlobStorage},this.mc=gt(rt.create(this.services.subLogger,"Loader"))}get IFluidRouter(){return this}createDetachedContainer(e){var t=this;return(0,l.Z)(function*(){const n=yield ks.createDetached(t,e);return t.cachingEnabled&&n.once("attached",()=>{ar(n.resolvedUrl);const i=Ya(n.resolvedUrl.url);void 0!==i&&t.addToContainerCache(i.id,Promise.resolve(n))}),n})()}rehydrateDetachedContainerFromSnapshot(e){var t=this;return(0,l.Z)(function*(){return ks.rehydrateDetachedFromSnapshot(t,e)})()}resolve(e,t){var n=this;return(0,l.Z)(function*(){return it.timedExecAsync(n.mc.logger,{eventName:void 0===t?"Resolve":"ResolveWithPendingState"},(0,l.Z)(function*(){return(yield n.resolveCore(e,void 0!==t?JSON.parse(t):void 0)).container}))})()}request(e){var t=this;return(0,l.Z)(function*(){return it.timedExecAsync(t.mc.logger,{eventName:"Request"},(0,l.Z)(function*(){const n=yield t.resolveCore(e);return n.container.request(Object.assign(Object.assign({},e),{url:`${n.parsed.path}${n.parsed.query}`}))}))})()}getKeyForContainerCache(e,t){var n;return void 0!==(null===(n=e.headers)||void 0===n?void 0:n[Mt.version])?`${t.id}@${e.headers[Mt.version]}`:t.id}addToContainerCache(e,t){this.containers.set(e,t),t.then(n=>{n.closed?this.containers.delete(e):n.once("closed",()=>{this.containers.delete(e)})}).catch(n=>{})}resolveCore(e,t){var n=this;return(0,l.Z)(function*(){const i=yield n.services.urlResolver.resolve(e);ar(i);const o=Ya(i.url);if(void 0===o)throw new Error(`Invalid URL ${i.url}`);if(void 0!==t){const U=Ya(t.url);if(U?.id!==o.id||U?.path.replace(/\/$/,"")!==o.path.replace(/\/$/,""))throw new Error(`URL ${i.url} does not match pending state URL ${t.url}`)}const{canCache:h,fromSequenceNumber:w}=n.parseHeader(o,e);let _;if(void 0===t&&h){const U=n.getKeyForContainerCache(e,o),Q=yield n.containers.get(U);if(void 0!==Q)_=Q;else{const Y=n.loadContainer(e,i);n.addToContainerCache(U,Y),_=yield Y}}else _=yield n.loadContainer(e,i,t);return _.deltaManager.lastSequenceNumber<=w&&(yield new Promise((U,Q)=>{_.on("op",function Y(ye){ye.sequenceNumber>w&&(U(),_.removeListener("op",Y))})})),{container:_,parsed:o}})()}get cachingEnabled(){return!1!==this.services.options.cache}canCacheForRequest(e){return this.cachingEnabled&&!1!==e[Mt.cache]}parseHeader(e,t){var n,i;let o=-1;t.headers=null!==(n=t.headers)&&void 0!==n?n:{};const h=t.headers[Mt.sequenceNumber];return void 0!==h&&(o=h),t.headers[Mt.version]=null!==(i=e.version)&&void 0!==i?i:t.headers[Mt.version],{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:o}}loadContainer(e,t,n){var i=this;return(0,l.Z)(function*(){var o,h,w,D,_;return ks.load(i,{canReconnect:null===(o=e.headers)||void 0===o?void 0:o[Mt.reconnect],clientDetailsOverride:null===(h=e.headers)||void 0===h?void 0:h[Mt.clientDetails],resolvedUrl:t,version:null!==(D=null===(w=e.headers)||void 0===w?void 0:w[Mt.version])&&void 0!==D?D:void 0,loadMode:null===(_=e.headers)||void 0===_?void 0:_[Mt.loadMode]},n)})()}}class Bs{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{const t=this.tasks.shift();if(void 0!==t)return t();this.maxRequests++},S(e>0,174)}get waitQueueLength(){return this.tasks.length}acquire(){var e=this;return(0,l.Z)(function*(){if(!(e.maxRequests>0))return new Promise(t=>{e.tasks.push(t)});e.maxRequests--})()}schedule(e){var t=this;return(0,l.Z)(function*(){return yield t.acquire(),e().finally(t.release)})()}}var Wr=(()=>{return(u=Wr||(Wr={}))[u.NoCaching=0]="NoCaching",u[u.Prefetch=1]="Prefetch",Wr;var u})(),rl=v(7137),il=v(642),uo=v.n(il),sl=v(3014),al=v.n(sl);const $r=(0,qa.debug)("fluid:services-client");$r("Package: @fluidframework/server-services-client - Version: 0.1036.5001");class mi extends Error{constructor(e,t,n,i,o){super(t),this.code=e,this.canRetry=n,this.isFatal=i,this.retryAfterMs=o,this.name="NetworkError",this.retryAfter=void 0!==o?o/1e3:void 0}get details(){return void 0===this.canRetry&&void 0===this.isFatal&&void 0===this.retryAfterMs?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}}function js(u,e){var t;let n,i,o,h;switch(e&&"object"==typeof e?(n=null!==(t=e.message)&&void 0!==t?t:"Unknown Error",i=e.canRetry,o=e.isFatal,h=e.retryAfter):n=e&&"string"==typeof e?e:"Unknown Error",u){case 401:case 403:case 404:return new mi(u,n,!1,!1);case 413:case 422:return new mi(u,n,i??!1,o??!1,i?h:void 0);case 429:case 502:case 503:case 504:return new mi(u,n,!0,!1,h);case 500:return new mi(u,n,i??!0,o??!1,i?h:void 0);default:return new mi(u,n,!1,!0)}}const co="x-correlation-id";class su{constructor(e,t={},n=1048576e3,i=1048576e3){this.baseurl=e,this.defaultQueryString=t,this.maxBodyLength=n,this.maxContentLength=i}get(e,t,n){var i=this;return(0,l.Z)(function*(){const o={baseURL:i.baseurl,headers:n,maxBodyLength:i.maxBodyLength,maxContentLength:i.maxContentLength,method:"GET",url:`${e}${i.generateQueryString(t)}`};return i.request(o,200)})()}post(e,t,n,i){var o=this;return(0,l.Z)(function*(){const h={baseURL:o.baseurl,data:t,headers:i,maxBodyLength:o.maxBodyLength,maxContentLength:o.maxContentLength,method:"POST",url:`${e}${o.generateQueryString(n)}`};return o.request(h,201)})()}delete(e,t,n){var i=this;return(0,l.Z)(function*(){const o={baseURL:i.baseurl,headers:n,maxBodyLength:i.maxBodyLength,maxContentLength:i.maxContentLength,method:"DELETE",url:`${e}${i.generateQueryString(t)}`};return i.request(o,204)})()}patch(e,t,n,i){var o=this;return(0,l.Z)(function*(){const h={baseURL:o.baseurl,data:t,headers:i,maxBodyLength:o.maxBodyLength,maxContentLength:o.maxContentLength,method:"PATCH",url:`${e}${o.generateQueryString(n)}`};return o.request(h,200)})()}generateQueryString(e){if(this.defaultQueryString||e){const t=Object.assign(Object.assign({},this.defaultQueryString),e),n=rl.stringify(t);if(""!==n)return`?${n}`}return""}}class cl extends su{constructor(e,t={},n=1048576e3,i=1048576e3,o={},h=al(),w,D,_){super(e,t,n,i),this.defaultHeaders=o,this.axios=h,this.refreshDefaultQueryString=w,this.refreshDefaultHeaders=D,this.getCorrelationId=_}request(e,t,n=!0){var i=this;return(0,l.Z)(function*(){var o,h;const w=Object.assign({},e);return w.headers=i.generateHeaders(w.headers,null!==(h=null===(o=i.getCorrelationId)||void 0===o?void 0:o.call(i))&&void 0!==h?h:Pe()),new Promise((D,_)=>{i.axios.request(w).then(U=>{D(U.data)}).catch(U=>{var Q,Y,ye,Fe,De,Ee,ke,ze,We,$e,dt,Dt,qt,St;if((null===(Q=U?.response)||void 0===Q?void 0:Q.status)===t&&D(null===(Y=U?.response)||void 0===Y?void 0:Y.data),$r(U?.config?`[${U.config.method}] request to [${null!==(ye=U.config.baseURL)&&void 0!==ye?ye:""}${null!==(Fe=U.config.url)&&void 0!==Fe?Fe:""}] failed with [${null===(De=U.response)||void 0===De?void 0:De.status}] [${uo()(null===(Ee=U.response)||void 0===Ee?void 0:Ee.data,void 0,2)}]`:`request to ${w.url} failed ${U?U.message:""}`),429===(null===(ke=U?.response)||void 0===ke?void 0:ke.status)&&(null===(We=null===(ze=U?.response)||void 0===ze?void 0:ze.data)||void 0===We?void 0:We.retryAfter)>0&&n)setTimeout(()=>{i.request(w,t).then(D).catch(_)},1e3*U.response.data.retryAfter);else if(401===(null===($e=U?.response)||void 0===$e?void 0:$e.status)&&n&&i.refreshOnAuthError()){const Gt=Object.assign({},e);Gt.headers=i.generateHeaders(Gt.headers,w.headers[co]),i.request(Gt,t,!1).then(D).catch(_)}else if(U?.response)_(js(null===(dt=U?.response)||void 0===dt?void 0:dt.status,null===(Dt=U?.response)||void 0===Dt?void 0:Dt.data));else if(U?.request)_(js(502,`Network Error: ${null!==(qt=U?.message)&&void 0!==qt?qt:"undefined"}`));else{const Gt={canRetry:!1,isFatal:!1,message:null!==(St=U?.message)&&void 0!==St?St:"Unknown Error"};_(js(500,Gt))}})})})()}generateHeaders(e,t){let n=e??{};return this.defaultHeaders&&(n=Object.assign(Object.assign({},this.defaultHeaders),e)),n[co]?n:Object.assign({[co]:t},n)}refreshOnAuthError(){return(void 0!==this.refreshDefaultQueryString||void 0!==this.refreshDefaultHeaders)&&(void 0!==this.refreshDefaultHeaders&&(this.defaultHeaders=this.refreshDefaultHeaders()),void 0!==this.refreshDefaultQueryString&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}function ll(u,e){for(const t of e)if(u.endsWith(t))return!0;return!1}class au{constructor(e,t,n,i){this.endpoint=e,this.historianApi=t,this.restWrapper=i,this.defaultQueryString={},n&&this.historianApi?(this.defaultQueryString.disableCache=n,this.cacheBust=!1):this.cacheBust=n,void 0===this.restWrapper&&(this.restWrapper=new cl(this.endpoint))}getHeader(e){var t=this;return(0,l.Z)(function*(){return t.historianApi?t.restWrapper.get(`/headers/${encodeURIComponent(e)}`,t.getQueryString()):t.getHeaderDirect(e)})()}getFullTree(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.get(`/tree/${encodeURIComponent(e)}`,t.getQueryString())})()}getBlob(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.get(`/git/blobs/${encodeURIComponent(e)}`,t.getQueryString())})()}createBlob(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.post("/git/blobs",e,t.getQueryString())})()}getContent(e,t){var n=this;return(0,l.Z)(function*(){return n.restWrapper.get(`/contents/${e}`,n.getQueryString({ref:t}))})()}getCommits(e,t){var n=this;return(0,l.Z)(function*(){return n.restWrapper.get("/commits",n.getQueryString({count:t,sha:e})).catch(i=>400===i||404===i?[]:Promise.reject(i))})()}getCommit(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.get(`/git/commits/${encodeURIComponent(e)}`,t.getQueryString())})()}createCommit(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.post("/git/commits",e,t.getQueryString())})()}getRefs(){var e=this;return(0,l.Z)(function*(){return e.restWrapper.get("/git/refs",e.getQueryString())})()}getRef(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.get(`/git/refs/${e}`,t.getQueryString())})()}createRef(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.post("/git/refs",e,t.getQueryString())})()}updateRef(e,t){var n=this;return(0,l.Z)(function*(){return n.restWrapper.patch(`/git/refs/${e}`,t,n.getQueryString())})()}deleteRef(e){var t=this;return(0,l.Z)(function*(){yield t.restWrapper.delete(`/git/refs/${e}`,t.getQueryString())})()}createTag(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.post("/git/tags",e,t.getQueryString())})()}getTag(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.get(`/git/tags/${e}`,t.getQueryString())})()}createTree(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.post("/git/trees",e,t.getQueryString())})()}getTree(e,t){var n=this;return(0,l.Z)(function*(){return n.restWrapper.get(`/git/trees/${encodeURIComponent(e)}`,n.getQueryString({recursive:t?1:0}))})()}createSummary(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.post("/git/summaries",e,t.getQueryString())})()}deleteSummary(e){var t=this;return(0,l.Z)(function*(){const n={"Soft-Delete":e};return t.restWrapper.delete("/git/summaries",t.getQueryString(),n)})()}getSummary(e){var t=this;return(0,l.Z)(function*(){return t.restWrapper.get(`/git/summaries/${e}`,t.getQueryString())})()}getHeaderDirect(e){var t=this;return(0,l.Z)(function*(){const n=yield t.getTree(e,!0),i=[".attributes",".blobs",".messages","header"],o=[];for(const w of n.tree)if("blob"===w.type&&ll(w.path,i)){const D=t.getBlob(w.sha);o.push(D)}return{blobs:yield Promise.all(o),tree:n}})()}getQueryString(e){return Object.assign(Object.assign(this.cacheBust?{cacheBust:Date.now()}:{},this.defaultQueryString),e)}}class ou{constructor(e){this.historian=e,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}getHeader(e,t){var n=this;return(0,l.Z)(function*(){const i=yield n.historian.getHeader(t);for(const o of i.blobs)n.blobCache.set(o.sha,o);return Pi(i.tree)})()}getFullTree(e){var t=this;return(0,l.Z)(function*(){return t.historian.getFullTree(e)})()}getCommit(e){var t=this;return(0,l.Z)(function*(){return t.commitCache.has(e)?($r(`Cache hit on ${e}`),t.commitCache.get(e)):t.historian.getCommit(e)})()}getCommits(e,t){var n=this;return(0,l.Z)(function*(){let i=e;if(n.refCache.has(e)&&($r(`Commit cache hit on ${e}`),i=n.refCache.get(e),n.refCache.delete(e),!i))return[];if(n.commitCache.has(i)){const o=n.commitCache.get(i);return[{commit:{author:o.author,committer:o.committer,message:o.message,tree:o.tree,url:o.url},parents:o.parents,sha:o.sha,url:o.url}]}return n.historian.getCommits(i,t)})()}getTree(e,t=!0){var n=this;return(0,l.Z)(function*(){return n.treeCache.has(e)?($r(`Tree cache hit on ${e}`),n.treeCache.get(e)):n.historian.getTree(e,t)})()}getBlob(e){var t=this;return(0,l.Z)(function*(){return t.blobCache.has(e)?($r(`Blob cache hit on ${e}`),t.blobCache.get(e)):t.historian.getBlob(e)})()}getRawUrl(e){return`${this.historian.endpoint}/git/blobs/raw/${e}`}getContent(e,t){var n=this;return(0,l.Z)(function*(){return n.historian.getContent(t,e)})()}createBlob(e,t){var n=this;return(0,l.Z)(function*(){return n.historian.createBlob({content:e,encoding:t})})()}createGitTree(e){var t=this;return(0,l.Z)(function*(){return t.historian.createTree(e)})()}createTree(e){var t=this;return(0,l.Z)(function*(){return t.createTreeCore(e,0)})()}createCommit(e){var t=this;return(0,l.Z)(function*(){return t.historian.createCommit(e)})()}createSummary(e){var t=this;return(0,l.Z)(function*(){return t.historian.createSummary(e)})()}deleteSummary(e){var t=this;return(0,l.Z)(function*(){return t.historian.deleteSummary(e)})()}getSummary(e){var t=this;return(0,l.Z)(function*(){return t.historian.getSummary(e)})()}getRef(e){var t=this;return(0,l.Z)(function*(){return t.historian.getRef(`heads/${e}`).catch(n=>{if(400===n||404===n)return null;throw n})})()}createRef(e,t){var n=this;return(0,l.Z)(function*(){return n.historian.createRef({ref:`refs/heads/${e}`,sha:t,config:{enabled:!0}})})()}upsertRef(e,t){var n=this;return(0,l.Z)(function*(){return n.historian.updateRef(`heads/${e}`,{force:!0,sha:t,config:{enabled:!0}})})()}addRef(e,t){this.refCache.set(e,t)}addCommit(e){this.commitCache.set(e.sha,e)}addTree(e){this.treeCache.set(e.sha,e)}addBlob(e){this.blobCache.set(e.sha,e)}write(e,t,n,i){var o=this;return(0,l.Z)(function*(){const h=yield o.createTree(t),w={author:{date:(new Date).toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:i,parents:n,tree:h.sha},D=yield o.historian.createCommit(w);return(yield o.getRef(e))?yield o.upsertRef(e,D.sha):yield o.createRef(e,D.sha),D})()}createTreeCore(e,t){var n=this;return(0,l.Z)(function*(){if(e.id)return n.getTree(e.id);const i=[];for(const _ of e.entries)switch(sn[_.type]){case sn.Blob:{const U=_.value;_.mode===_n.Symlink&&(U.contents=n.translateSymlink(U.contents,t));const Q=n.createBlob(U.contents,U.encoding);i.push(Q);break}case sn.Tree:{const Q=n.createTreeCore(_.value,t+1);i.push(Q);break}default:throw new Error("Unknown entry type")}const o=yield Promise.all(i),h=[];S(o.length===e.entries.length,"File entries length is not correct");for(let _=0;_<e.entries.length;_++)h.push({mode:e.entries[_].mode,path:e.entries[_].path,sha:o[_].sha,type:e.entries[_].type===sn.Tree?"tree":e.entries[_].type===sn.Blob?"blob":"commit"});return n.historian.createTree({tree:h})})()}translateSymlink(e,t){let n="";for(let i=0;i<=t;i++)n+="../";return`${n}${e}`}}const or=Object.create(null);or.open="0",or.close="1",or.ping="2",or.pong="3",or.message="4",or.upgrade="5",or.noop="6";const Ls=Object.create(null);Object.keys(or).forEach(u=>{Ls[or[u]]=u});const dl={type:"error",data:"parser error"},fl="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),pl="function"==typeof ArrayBuffer,uu=(u,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(u)},cu=({type:u,data:e},t,n)=>fl&&e instanceof Blob?t?n(e):uu(e,n):pl&&(e instanceof ArrayBuffer||(u=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(u):u&&u.buffer instanceof ArrayBuffer)(e))?t?n(e):uu(new Blob([e]),n):n(or[u]+(e||"")),vi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Xi=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let u=0;u<vi.length;u++)Xi[vi.charCodeAt(u)]=u;const yl="function"==typeof ArrayBuffer,Sl=(u,e)=>{if(yl){const t=(u=>{let n,o,h,w,D,e=.75*u.length,t=u.length,i=0;"="===u[u.length-1]&&(e--,"="===u[u.length-2]&&e--);const _=new ArrayBuffer(e),U=new Uint8Array(_);for(n=0;n<t;n+=4)o=Xi[u.charCodeAt(n)],h=Xi[u.charCodeAt(n+1)],w=Xi[u.charCodeAt(n+2)],D=Xi[u.charCodeAt(n+3)],U[i++]=o<<2|h>>4,U[i++]=(15&h)<<4|w>>2,U[i++]=(3&w)<<6|63&D;return _})(u);return lu(t,e)}return{base64:!0,data:u}},lu=(u,e)=>"blob"===e&&u instanceof ArrayBuffer?new Blob([u]):u,hu=(u,e)=>{if("string"!=typeof u)return{type:"message",data:lu(u,e)};const t=u.charAt(0);return"b"===t?{type:"message",data:Sl(u.substring(1),e)}:Ls[t]?u.length>1?{type:Ls[t],data:u.substring(1)}:{type:Ls[t]}:dl},du=String.fromCharCode(30);function rn(u){if(u)return function Cl(u){for(var e in rn.prototype)u[e]=rn.prototype[e];return u}(u)}rn.prototype.on=rn.prototype.addEventListener=function(u,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+u]=this._callbacks["$"+u]||[]).push(e),this},rn.prototype.once=function(u,e){function t(){this.off(u,t),e.apply(this,arguments)}return t.fn=e,this.on(u,t),this},rn.prototype.off=rn.prototype.removeListener=rn.prototype.removeAllListeners=rn.prototype.removeEventListener=function(u,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var t=this._callbacks["$"+u];if(!t)return this;if(1==arguments.length)return delete this._callbacks["$"+u],this;for(var n,i=0;i<t.length;i++)if((n=t[i])===e||n.fn===e){t.splice(i,1);break}return 0===t.length&&delete this._callbacks["$"+u],this},rn.prototype.emit=function(u){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+u],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){n=0;for(var i=(t=t.slice(0)).length;n<i;++n)t[n].apply(this,e)}return this},rn.prototype.emitReserved=rn.prototype.emit,rn.prototype.listeners=function(u){return this._callbacks=this._callbacks||{},this._callbacks["$"+u]||[]},rn.prototype.hasListeners=function(u){return!!this.listeners(u).length};const Zn=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function pu(u,...e){return e.reduce((t,n)=>(u.hasOwnProperty(n)&&(t[n]=u[n]),t),{})}const El=Zn.setTimeout,Al=Zn.clearTimeout;function Hs(u,e){e.useNativeTimers?(u.setTimeoutFn=El.bind(Zn),u.clearTimeoutFn=Al.bind(Zn)):(u.setTimeoutFn=Zn.setTimeout.bind(Zn),u.clearTimeoutFn=Zn.clearTimeout.bind(Zn))}const Tl=1.33;function Fl(u){return"string"==typeof u?function Dl(u){let e=0,t=0;for(let n=0,i=u.length;n<i;n++)e=u.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}(u):Math.ceil((u.byteLength||u.size)*Tl)}class Pl extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class gu extends rn{constructor(e){super(),this.writable=!1,Hs(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new Pl(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=hu(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}const mu="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),qs=64,vu={};let bu,yu=0,Dr=0;function Su(u){let e="";do{e=mu[u%qs]+e,u=Math.floor(u/qs)}while(u>0);return e}function xu(){const u=Su(+new Date);return u!==bu?(yu=0,bu=u):u+"."+Su(yu++)}for(;Dr<qs;Dr++)vu[mu[Dr]]=Dr;function wu(u){let e="";for(let t in u)u.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(u[t]));return e}let Cu=!1;try{Cu=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Rl=Cu;function Eu(u){const e=u.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Rl))return new XMLHttpRequest}catch{}if(!e)try{return new(Zn[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch{}}function Il(){}const Ol=null!=new Eu({xdomain:!1}).responseType;let zs=(()=>{class u extends rn{constructor(t,n){super(),Hs(this,n),this.opts=n,this.method=n.method||"GET",this.uri=t,this.async=!1!==n.async,this.data=void 0!==n.data?n.data:null,this.create()}create(){const t=pu(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const n=this.xhr=new Eu(t);try{n.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let i in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this.opts.extraHeaders[i])}}catch{}if("POST"===this.method)try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{4===n.readyState&&(200===n.status||1223===n.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof n.status?n.status:0)},0))},n.send(this.data)}catch(i){return void this.setTimeoutFn(()=>{this.onError(i)},0)}typeof document<"u"&&(this.index=u.requestsCount++,u.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(!(typeof this.xhr>"u"||null===this.xhr)){if(this.xhr.onreadystatechange=Il,t)try{this.xhr.abort()}catch{}typeof document<"u"&&delete u.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}return u.requestsCount=0,u.requests={},u})();function Au(){for(let u in zs.requests)zs.requests.hasOwnProperty(u)&&zs.requests[u].abort()}typeof document<"u"&&("function"==typeof attachEvent?attachEvent("onunload",Au):"function"==typeof addEventListener&&addEventListener("onpagehide"in Zn?"pagehide":"unload",Au,!1));const Tu="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),Vs=Zn.WebSocket||Zn.MozWebSocket,Fu=typeof navigator<"u"&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),Bl={websocket:class kl extends gu{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=Fu?{}:pu(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Fu?new Vs(e,t,n):t?new Vs(e,t):new Vs(e)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const i=t===e.length-1;cu(e[t],this.supportsBinary,o=>{try{this.ws.send(o)}catch{}i&&Tu(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=xu()),this.supportsBinary||(e.b64=1);const i=wu(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}check(){return!!Vs}},polling:class _l extends gu{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n="https:"===location.protocol;let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port,this.xs=e.secure!==n}this.supportsBinary=Ol&&!(e&&e.forceBase64)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((u,e)=>{const t=u.split(du),n=[];for(let i=0;i<t.length;i++){const o=hu(t[i],e);if(n.push(o),"error"===o.type)break}return n})(e,this.socket.binaryType).forEach(n=>{if("opening"===this.readyState&&"open"===n.type&&this.onOpen(),"close"===n.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((u,e)=>{const t=u.length,n=new Array(t);let i=0;u.forEach((o,h)=>{cu(o,!1,w=>{n[h]=w,++i===t&&e(n.join(du))})})})(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=xu()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);const i=wu(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(i.length?"?"+i:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new zs(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}},jl=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ll=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ho(u){const e=u,t=u.indexOf("["),n=u.indexOf("]");-1!=t&&-1!=n&&(u=u.substring(0,t)+u.substring(t,n).replace(/:/g,";")+u.substring(n,u.length));let i=jl.exec(u||""),o={},h=14;for(;h--;)o[Ll[h]]=i[h]||"";return-1!=t&&-1!=n&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=function Hl(u,e){const n=e.replace(/\/{2,9}/g,"/").split("/");return("/"==e.slice(0,1)||0===e.length)&&n.splice(0,1),"/"==e.slice(-1)&&n.splice(n.length-1,1),n}(0,o.path),o.queryKey=function ql(u,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,o){i&&(t[i]=o)}),t}(0,o.query),o}let Du=(()=>{class u extends rn{constructor(t,n={}){super(),this.writeBuffer=[],t&&"object"==typeof t&&(n=t,t=null),t?(t=ho(t),n.hostname=t.host,n.secure="https"===t.protocol||"wss"===t.protocol,n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=ho(n.host).host),Hs(this,n),this.secure=null!=n.secure?n.secure:typeof location<"u"&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=n.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function Nl(u){let e={},t=u.split("&");for(let n=0,i=t.length;n<i;n++){let o=t[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=4,n.transport=t,this.id&&(n.sid=this.id);const i=Object.assign({},this.opts.transportOptions[t],this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Bl[t](i)}open(){let t;if(this.opts.rememberUpgrade&&u.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch{return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",n=>this.onClose("transport close",n))}probe(t){let n=this.createTransport(t),i=!1;u.priorWebsocketSuccess=!1;const o=()=>{i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",Y=>{if(!i)if("pong"===Y.type&&"probe"===Y.data){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;u.priorWebsocketSuccess="websocket"===n.name,this.transport.pause(()=>{i||"closed"!==this.readyState&&(Q(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const ye=new Error("probe error");ye.transport=n.name,this.emitReserved("upgradeError",ye)}}))};function h(){i||(i=!0,Q(),n.close(),n=null)}const w=Y=>{const ye=new Error("probe error: "+Y);ye.transport=n.name,h(),this.emitReserved("upgradeError",ye)};function D(){w("transport closed")}function _(){w("socket closed")}function U(Y){n&&Y.name!==n.name&&h()}const Q=()=>{n.removeListener("open",o),n.removeListener("error",w),n.removeListener("close",D),this.off("close",_),this.off("upgrading",U)};n.once("open",o),n.once("error",w),n.once("close",D),this.once("close",_),this.once("upgrading",U),n.open()}onOpen(){if(this.readyState="open",u.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;const n=this.upgrades.length;for(;t<n;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const n=new Error("server error");n.code=t.data,this.onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let i=0;i<this.writeBuffer.length;i++){const o=this.writeBuffer[i].data;if(o&&(n+=Fl(o)),i>0&&n>this.maxPayload)return this.writeBuffer.slice(0,i);n+=2}return this.writeBuffer}write(t,n,i){return this.sendPacket("message",t,n,i),this}send(t,n,i){return this.sendPacket("message",t,n,i),this}sendPacket(t,n,i,o){if("function"==typeof n&&(o=n,n=void 0),"function"==typeof i&&(o=i,i=null),"closing"===this.readyState||"closed"===this.readyState)return;(i=i||{}).compress=!1!==i.compress;const h={type:t,data:n,options:i};this.emitReserved("packetCreate",h),this.writeBuffer.push(h),o&&this.once("flush",o),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},i=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():t()}):this.upgrading?i():t()),this}onError(t){u.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,n){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const n=[];let i=0;const o=t.length;for(;i<o;i++)~this.transports.indexOf(t[i])&&n.push(t[i]);return n}}return u.protocol=4,u})();const Vl="function"==typeof ArrayBuffer,Ul=u=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(u):u.buffer instanceof ArrayBuffer,Pu=Object.prototype.toString,Zl="function"==typeof Blob||typeof Blob<"u"&&"[object BlobConstructor]"===Pu.call(Blob),Kl="function"==typeof File||typeof File<"u"&&"[object FileConstructor]"===Pu.call(File);function fo(u){return Vl&&(u instanceof ArrayBuffer||Ul(u))||Zl&&u instanceof Blob||Kl&&u instanceof File}function Us(u,e){if(!u||"object"!=typeof u)return!1;if(Array.isArray(u)){for(let t=0,n=u.length;t<n;t++)if(Us(u[t]))return!0;return!1}if(fo(u))return!0;if(u.toJSON&&"function"==typeof u.toJSON&&1===arguments.length)return Us(u.toJSON(),!0);for(const t in u)if(Object.prototype.hasOwnProperty.call(u,t)&&Us(u[t]))return!0;return!1}function Gl(u){const e=[],n=u;return n.data=po(u.data,e),n.attachments=e.length,{packet:n,buffers:e}}function po(u,e){if(!u)return u;if(fo(u)){const t={_placeholder:!0,num:e.length};return e.push(u),t}if(Array.isArray(u)){const t=new Array(u.length);for(let n=0;n<u.length;n++)t[n]=po(u[n],e);return t}if("object"==typeof u&&!(u instanceof Date)){const t={};for(const n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=po(u[n],e));return t}return u}function Wl(u,e){return u.data=go(u.data,e),delete u.attachments,u}function go(u,e){if(!u)return u;if(u&&!0===u._placeholder){if("number"==typeof u.num&&u.num>=0&&u.num<e.length)return e[u.num];throw new Error("illegal attachments")}if(Array.isArray(u))for(let t=0;t<u.length;t++)u[t]=go(u[t],e);else if("object"==typeof u)for(const t in u)Object.prototype.hasOwnProperty.call(u,t)&&(u[t]=go(u[t],e));return u}const $l=5;var lt=(()=>{return(u=lt||(lt={}))[u.CONNECT=0]="CONNECT",u[u.DISCONNECT=1]="DISCONNECT",u[u.EVENT=2]="EVENT",u[u.ACK=3]="ACK",u[u.CONNECT_ERROR=4]="CONNECT_ERROR",u[u.BINARY_EVENT=5]="BINARY_EVENT",u[u.BINARY_ACK=6]="BINARY_ACK",lt;var u})();class Jl{constructor(e){this.replacer=e}encode(e){return e.type!==lt.EVENT&&e.type!==lt.ACK||!Us(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===lt.EVENT?lt.BINARY_EVENT:lt.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return(e.type===lt.BINARY_EVENT||e.type===lt.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Gl(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}class mo extends rn{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===lt.BINARY_EVENT;n||t.type===lt.BINARY_ACK?(t.type=n?lt.EVENT:lt.ACK,this.reconstructor=new Ql(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!fo(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===lt[n.type])throw new Error("unknown packet type "+n.type);if(n.type===lt.BINARY_EVENT||n.type===lt.BINARY_ACK){const o=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const h=e.substring(o,t);if(h!=Number(h)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(h)}if("/"===e.charAt(t+1)){const o=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);n.nsp=e.substring(o,t)}else n.nsp="/";const i=e.charAt(t+1);if(""!==i&&Number(i)==i){const o=t+1;for(;++t;){const h=e.charAt(t);if(null==h||Number(h)!=h){--t;break}if(t===e.length)break}n.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(!mo.isPayloadValid(n.type,o))throw new Error("invalid payload");n.data=o}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case lt.CONNECT:return"object"==typeof t;case lt.DISCONNECT:return void 0===t;case lt.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case lt.EVENT:case lt.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case lt.ACK:case lt.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ql{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Wl(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function tr(u,e,t){return u.on(e,t),function(){u.off(e,t)}}const Xl=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Nu extends rn{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[tr(e,"open",this.onopen.bind(this)),tr(e,"packet",this.onpacket.bind(this)),tr(e,"error",this.onerror.bind(this)),tr(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Xl.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:lt.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const h=this.ids++,w=t.pop();this._registerAckCallback(h,w),n.id=h}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const i=null!==(n=this.flags.timeout)&&void 0!==n?n:this._opts.ackTimeout;if(void 0===i)return void(this.acks[e]=t);const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let h=0;h<this.sendBuffer.length;h++)this.sendBuffer[h].id===e&&this.sendBuffer.splice(h,1);t.call(this,new Error("operation has timed out"))},i);this.acks[e]=(...h)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...h])}}emitWithAck(e,...t){const n=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((i,o)=>{t.push((h,w)=>n?h?o(h):i(w):i(h)),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...o)=>n!==this._queue[0]?void 0:(null!==i?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:lt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case lt.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case lt.EVENT:case lt.BINARY_EVENT:this.onevent(e);break;case lt.ACK:case lt.BINARY_ACK:this.onack(e);break;case lt.DISCONNECT:this.ondisconnect();break;case lt.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:lt.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:lt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function yi(u){this.ms=(u=u||{}).min||100,this.max=u.max||1e4,this.factor=u.factor||2,this.jitter=u.jitter>0&&u.jitter<=1?u.jitter:0,this.attempts=0}yi.prototype.duration=function(){var u=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*u);u=1&Math.floor(10*e)?u+t:u-t}return 0|Math.min(u,this.max)},yi.prototype.reset=function(){this.attempts=0},yi.prototype.setMin=function(u){this.ms=u},yi.prototype.setMax=function(u){this.max=u},yi.prototype.setJitter=function(u){this.jitter=u};class vo extends rn{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Hs(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new yi({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||R;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Du(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=tr(t,"open",function(){n.onopen(),e&&e()}),o=tr(t,"error",h=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",h),e?e(h):n.maybeReconnectOnOpen()});if(!1!==this._timeout){const h=this._timeout;0===h&&i();const w=this.setTimeoutFn(()=>{i(),t.close(),t.emit("error",new Error("timeout"))},h);this.opts.autoUnref&&w.unref(),this.subs.push(function(){clearTimeout(w)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(tr(e,"ping",this.onping.bind(this)),tr(e,"data",this.ondata.bind(this)),tr(e,"error",this.onerror.bind(this)),tr(e,"close",this.onclose.bind(this)),tr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Tu(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Nu(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Yi={};function Zs(u,e){"object"==typeof u&&(e=u,u=void 0);const t=function zl(u,e="",t){let n=u;t=t||typeof location<"u"&&location,null==u&&(u=t.protocol+"//"+t.host),"string"==typeof u&&("/"===u.charAt(0)&&(u="/"===u.charAt(1)?t.protocol+u:t.host+u),/^(https?|wss?):\/\//.test(u)||(u=typeof t<"u"?t.protocol+"//"+u:"https://"+u),n=ho(u)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}(u,(e=e||{}).path||"/socket.io"),n=t.source,i=t.id;let D;return e.forceNew||e["force new connection"]||!1===e.multiplex||Yi[i]&&t.path in Yi[i].nsps?D=new vo(n,e):(Yi[i]||(Yi[i]=new vo(n,e)),D=Yi[i]),t.query&&!e.query&&(e.query=t.queryKey),D.socket(t.path,e)}Object.assign(Zs,{Manager:vo,Socket:Nu,io:Zs,connect:Zs});const Yl=1e4,eh=100;class th{constructor(e,t,n,i,o,h){this.to=t,this.payloadSize=n,this.logger=i,this.requestCallback=o,this.responseCallback=h,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new jt,this.requests=0,this.latestRequested=e,this.nextToDeliver=e,this.knewTo=void 0!==t}get working(){return"working"===this.workingState}get canceled(){return"canceled"===this.workingState}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}run(e){var t=this;return(0,l.Z)(function*(){S(e>0,258),S(t.working,259);let n=e;for(;n>0;)n--,t.addRequest();return t.dispatch(),t.endEvent.promise})()}done(){S(void 0!==this.to,260),S(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}dispatch(){for(;this.working;){const e=this.results.get(this.nextToDeliver);if(void 0===e)break;this.results.delete(this.nextToDeliver),S(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(0===this.requestsInFlight?(S(0===this.results.size,263),this.done()):void 0!==this.to&&this.nextToDeliver>=this.to&&(S(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;const e=this.latestRequested;return void 0!==this.to&&this.to<=e?void 0:(this.latestRequested+=this.payloadSize,void 0!==this.to&&(this.latestRequested=Math.min(this.to,this.latestRequested)),S(e<this.latestRequested,265),{from:e,to:this.latestRequested})}addRequest(){const e=this.getNextChunk();void 0!==e&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}addRequestCore(e,t){var n=this;return(0,l.Z)(function*(){S(n.working,266);let i=e,o=t;for(n.requestsInFlight++;n.working;){const h=o-i;S(h>0,267),void 0!==n.to&&(S(i<n.to,268),S(o<=n.to,269)),n.requests++;const w=n.requestCallback(n.requests,i,o,void 0!==n.to,{});n.dispatch();const{payload:D,cancel:_,partial:U}=yield w;if(_&&n.cancel(),void 0!==n.to&&i>=n.to){S(!n.knewTo,270),0!==D.length&&n.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:i,to:o,end:n.to,length:D.length});break}if(n.working){const Q=i,Y=D.length;let ye=h<=Y;if(0!==Y){h<Y&&n.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:i,to:o,length:Y});const Fe=D.splice(0,h);n.results.set(i,Fe),i+=Fe.length}else S(!U,271),S(!n.knewTo,272);if(!U&&!ye){if(!n.knewTo){(void 0===n.to||n.to>i)&&(n.to=i);break}n.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:Q,to:o,length:Y})}if(o===n.latestRequested&&(0!==D.length&&(n.results.set(i,D),i+=D.length),n.latestRequested=i,ye=!0),ye){const Fe=n.getNextChunk();if(void 0===Fe)break;i=Fe.from,o=Fe.to}}}n.requestsInFlight--,n.dispatch()})()}}class nh{constructor(){this.queue=[],this.done=!1}pushValue(e){this.pushCore(Promise.resolve({done:!1,value:e}))}pushError(e){this.pushCore(Promise.reject(e)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(e){S(!this.done,274),this.deferred?(S(0===this.queue.length,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}read(){var e=this;return(0,l.Z)(function*(){S(void 0===e.deferred,276);const t=e.queue.shift();return void 0!==t?t:(S(!e.done,277),e.deferred=new jt,e.deferred.promise)})()}}function yo(){return(yo=(0,l.Z)(function*(u,e,t,n,i,o){let h,w=0;const D=[];for(;!0!==i?.aborted;){w++;let U=Math.min(Yl,eh*Math.pow(2,w));const Q=Re.now();try{const Y=u(Object.assign(Object.assign({},e),{retry:w})),{messages:ye,partialResult:Fe}=yield Y;if(D.push(...ye),0!==ye.length||!t)return{payload:D,cancel:!1,partial:Fe};if(void 0===h)h=Re.now();else if(Re.now()-h>3e4)throw Er("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:w,driverVersion:Wo},e))}catch(Y){const ye=Lr(Y);h=void 0;const Fe=Ne(Y);if(to(n,Object.assign(Object.assign({eventName:"GetDeltas_Error"},e),{retry:w,duration:Re.now()-Q,retryAfter:Fe,reason:o}),Y),!ye)throw Y;void 0!==Fe&&Fe>=0&&(U=Fe)}yield no(U)}return{partial:!1,cancel:!0,payload:[]}})).apply(this,arguments)}const sh={read:(u=(0,l.Z)(function*(){return{done:!0}}),function(){return u.apply(this,arguments)})};var u;class oh{constructor(e,t,n,i){this.tenantId=e,this.id=t,this.deltaStorageService=n,this.documentStorageService=i,this.logtailSha=this.documentStorageService.logTailSha}fetchMessages(e,t,n,i,o){return i?sh:function ih(u,e,t,n,i,o,h,w){let _,D=0,U=0;const Q=new nh,Y={fromTotal:t,toTotal:n},ye=it.start(o,Object.assign(Object.assign({eventName:"GetDeltas"},Y),{reason:w})),Fe=new th(t,n,i,o,function(){var Ee=(0,l.Z)(function*(ke,ze,We,$e,dt){return D++,function rh(u,e,t,n,i,o){return yo.apply(this,arguments)}(function(){var Dt=(0,l.Z)(function*(qt){return u(ze,We,qt)});return function(qt){return Dt.apply(this,arguments)}}(),Object.assign(Object.assign({request:ke,from:ze,to:We},Y),dt),$e,o,h,w)});return function(ke,ze,We,$e,dt){return Ee.apply(this,arguments)}}(),Ee=>{void 0===_?S(Ee[0].sequenceNumber===t,621):S(Ee[0].sequenceNumber===_+1,622),_=Ee[Ee.length-1].sequenceNumber,S(_-Ee[0].sequenceNumber+1===Ee.length,623),U+=Ee.length,Q.pushValue(Ee)}),De=Ee=>{Fe.cancel()};return void 0!==h&&h.addEventListener("abort",De),Fe.run(e).finally(()=>{void 0!==h&&h.removeEventListener("abort",De)}).then(()=>{const Ee={lastFetch:_,length:U,requests:D};Fe.canceled?ye.cancel(Object.assign(Object.assign({},Ee),{error:"ops request cancelled by client"})):(S(void 0===n||void 0!==_&&_>=n-1,624),ye.end(Ee)),Q.pushDone()}).catch(Ee=>{ye.cancel({lastFetch:_,length:U,requests:D},Ee),Q.pushError(Ee)}),Q}(this.getCore.bind(this),1,e,t,2e3,new _e,n,o)}getCore(e,t){var n=this;return(0,l.Z)(function*(){const i=n.logtailSha?yield V(n.documentStorageService,n.logtailSha):[];if(n.logtailSha=void 0,i.length>0){const o=i.filter(h=>h.sequenceNumber>=e);if(o.length>0)return{messages:o,partialResult:!0}}return n.deltaStorageService.get(n.tenantId,n.id,e,t)})()}}class uh{constructor(e,t,n,i=(0,l.Z)(function*(){return _this2.restWrapper}),o=(()=>this.url)){this.url=e,this.restWrapper=t,this.logger=n,this.getRestWrapper=i,this.getDeltaStorageUrl=o}get(e,t,n,i){var o=this;return(0,l.Z)(function*(){return{messages:yield it.timedExecAsync(o.logger,{eventName:"getDeltas",from:n,to:i},function(){var w=(0,l.Z)(function*(D){const _=yield o.getRestWrapper(),U=o.getDeltaStorageUrl(),Q=yield _.get(U,{from:n-1,to:i});return D.end({count:Q.length}),Q});return function(D){return w.apply(this,arguments)}}()),partialResult:!1}})()}}class ch extends qi{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){const e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:Wr.NoCaching})}getSnapshotTree(e){var t=this;return(0,l.Z)(function*(){const n=t.internalStorageService.getSnapshotTree(e);return t.prefetchEnabled&&n.then(i=>{null!=i&&t.prefetchTree(i)}),n})()}readBlob(e){var t=this;return(0,l.Z)(function*(){return t.cachedRead(e)})()}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}cachedRead(e){var t=this;return(0,l.Z)(function*(){if(t.prefetchEnabled){const n=t.prefetchCache.get(e);if(void 0!==n)return n;const i=t.internalStorageService.readBlob(e);return t.prefetchCache.set(e,i.catch(o=>{throw Lr(o)&&t.prefetchCache.delete(e),o})),i}return t.internalStorageService.readBlob(e)})()}prefetchTree(e){const t=[];this.prefetchTreeCore(e,t);for(const n of t)this.cachedRead(n)}prefetchTreeCore(e,t){for(const n of Object.keys(e.blobs)){const i=e.blobs[n];n.startsWith(".")||"header"===n||n.startsWith("quorum")?null!==i&&this.cachedRead(i):n.startsWith("deltas")||null!==i&&t.push(i)}for(const n of Object.keys(e.trees))this.prefetchTreeCore(e.trees[n],t)}}class lh{constructor(e){this.props=e,this.attachmentCounter=0,this.summaryTree={}}get summary(){var e;return{type:Le.Tree,tree:Object.assign({},this.summaryTree),unreferenced:null===(e=this.props)||void 0===e?void 0:e.unreferenced}}addBlob(e,t){this.summaryTree[e]={type:Le.Blob,content:t}}addHandle(e,t,n){this.summaryTree[e]={type:Le.Handle,handleType:t,handle:n}}addTree(e,t){this.summaryTree[e]=t}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:Le.Attachment}}}function Ru(u,e){const t=new lh({unreferenced:u.unreferenced});for(const[n,i]of Object.entries(u.blobs)){const o=e.get(i);S(void 0!==o,733),t.addBlob(n,ce.from(o).toString("utf-8"))}for(const[n,i]of Object.entries(u.trees)){const o=Ru(i,e);t.addTree(n,o)}return t.summary}const bo=(...u)=>u.map(e=>e.replace(/^\//,"").replace(/\/$/,"")).filter(e=>!!e).join("/");function Iu(u,e,t="",n=""){const i={type:"tree",entries:[]},o=Object.keys(e.tree);for(const h of o){const w=e.tree[h];let D,_,U;const Q=bo(""===t?n:t,h);switch(w.type){case Le.Tree:_=Iu(u,w,Q,n),U=w.unreferenced||void 0;break;case Le.Blob:_="string"==typeof w.content?{type:"blob",content:w.content,encoding:"utf-8"}:{type:"blob",content:K(w.content,"base64"),encoding:"base64"};break;case Le.Handle:if(w.embedded)D=w.handle;else{if(!u)throw Error("Parent summary does not exist to reference by handle.");D=bo(u,n,w.handle)}break;case Le.Attachment:D=w.id;break;default:En(0,`Unknown type: ${w.type}`)}const Y={path:encodeURIComponent(h),type:ls(w)};let ye;if(_)S(void 0===D,173),ye=Object.assign({value:_,unreferenced:U},Y);else{if(!D)throw new Error(`Invalid tree entry for ${w.type}`);ye=Object.assign(Object.assign({},Y),{id:D})}i.entries.push(ye)}return i}function Ou(u,e=".app"){var t;const n=new Map;u.blobs&&u.blobs.forEach(w=>{var D;n.set(w.id,X(w.content,null!==(D=w.encoding)&&void 0!==D?D:"utf-8"))});const i=null===(t=u.trees)||void 0===t?void 0:t[0],o=i?.sequenceNumber,h=function hh(u,e){const t={},n={id:u.id,blobs:{},trees:{}};t[""]=n;for(const i of u.entries){const o=i.path.replace(new RegExp(`^${e}/`),""),h=o.lastIndexOf("/"),w=o.slice(0,Math.max(0,h)),D=o.slice(h+1),_=t[w];if("tree"===i.type){const U={blobs:{},trees:{},unreferenced:i.unreferenced};_.trees[decodeURIComponent(D)]=U,t[o]=U}else{if("blob"!==i.type)throw new Error("Unknown entry type!!");_.blobs[decodeURIComponent(D)]=i.id}}return n}(i,e);return{blobs:n,snapshotTree:h,sequenceNumber:o}}class dh{constructor(e){this.manager=e}writeSummaryTree(e,t,n,i){var o=this;return(0,l.Z)(function*(){const h=yield o.writeSummaryTreeCore(t,e,n,i??0);if(!h)throw new Error("Failed to write summary tree");return h})()}writeSummaryTreeCore(e,t,n,i){var o=this;return(0,l.Z)(function*(){const w={entries:Iu(e,t,"","channel"===n?".app":"").entries,message:void 0,sequenceNumber:i,type:n};return o.manager.createSummary(w).then(D=>D.id)})()}}class bi{constructor(){this.cache=new Map}get(e){var t=this;return(0,l.Z)(function*(){return t.cache.get(e)})()}put(e,t){var n=this;return(0,l.Z)(function*(){n.cache.set(e,t)})()}}class fh{constructor(e,t,n,i={},o,h=new bi,w=new bi,D,_=function(){var U=(0,l.Z)(function*(Q){return Q&&void 0!==_this.noCacheGitManager?_this.noCacheGitManager:_this.manager});return function(Q){return U.apply(this,arguments)}}()){this.id=e,this.manager=t,this.logger=n,this.policies=i,this.driverPolicies=o,this.blobCache=h,this.snapshotTreeCache=w,this.noCacheGitManager=D,this.getStorageManager=_,this.firstVersionsCall=!0}get repositoryUrl(){return""}getSummaryUploadManager(){var e=this;return(0,l.Z)(function*(){const t=yield e.getStorageManager();return new dh(t)})()}getVersions(e,t){var n=this;return(0,l.Z)(function*(){var i;if(e!==n.id&&null!==e)return[{id:e,treeId:void 0}];if(n.firstVersionsCall&&1===t){n.firstVersionsCall=!1;const{id:w,snapshotTree:D}=null!==(i=n.driverPolicies)&&void 0!==i&&i.enableDiscovery?yield n.fetchAndCacheSnapshotTree("latest",!0):yield n.fetchAndCacheSnapshotTree("latest",!1);return[{id:w,treeId:D.id}]}const o=e||n.id;return(yield it.timedExecAsync(n.logger,{eventName:"getVersions",versionId:o,count:t},(0,l.Z)(function*(){return(yield n.getStorageManager()).getCommits(o,t)}))).map(w=>({date:w.commit.author.date,id:w.sha,treeId:w.commit.tree.sha}))})()}getSnapshotTree(e){var t=this;return(0,l.Z)(function*(){let n=e;if(!n){const i=yield t.getVersions(t.id,1);if(0===i.length)return null;n=i[0]}return(yield t.fetchAndCacheSnapshotTree(n.id)).snapshotTree})()}readBlob(e){var t=this;return(0,l.Z)(function*(){const n=yield t.blobCache.get(t.getCacheKey(e));if(void 0!==n)return n;const i=yield it.timedExecAsync(t.logger,{eventName:"readBlob",blobId:e},function(){var h=(0,l.Z)(function*(w){const _=yield(yield t.getStorageManager()).getBlob(e);return w.end({size:_.size}),_});return function(w){return h.apply(this,arguments)}}()),o=X(i.content,i.encoding);return yield t.blobCache.put(t.getCacheKey(i.sha),o),o})()}uploadSummaryWithContext(e,t){var n=this;return(0,l.Z)(function*(){return yield it.timedExecAsync(n.logger,{eventName:"uploadSummaryWithContext"},(0,l.Z)(function*(){var o;return(yield n.getSummaryUploadManager()).writeSummaryTree(e,null!==(o=t.ackHandle)&&void 0!==o?o:"","channel")}))})()}downloadSummary(e){var t=this;return(0,l.Z)(function*(){const n=yield it.timedExecAsync(t.logger,{eventName:"getWholeFlatSummary",treeId:e.handle},function(){var h=(0,l.Z)(function*(w){var D;const U=yield(yield t.getStorageManager()).getSummary(e.handle);return w.end({size:null===(D=U.trees[0])||void 0===D?void 0:D.entries.length}),U});return function(w){return h.apply(this,arguments)}}()),{blobs:i,snapshotTree:o}=Ou(n,"");return Ru(o,i)})()}createBlob(e){var t=this;return(0,l.Z)(function*(){const n=new Uint8Array(e);return it.timedExecAsync(t.logger,{eventName:"createBlob",size:n.length},function(){var i=(0,l.Z)(function*(o){const w=yield(yield t.getStorageManager()).createBlob(K(n,"base64"),"base64").then(D=>({id:D.sha,url:D.url}));return o.end({blobId:w.id}),w});return function(o){return i.apply(this,arguments)}}())})()}fetchAndCacheSnapshotTree(e,t){var n=this;return(0,l.Z)(function*(){const i=yield n.snapshotTreeCache.get(n.getCacheKey(e));if(void 0!==i)return{id:i.id,snapshotTree:i.snapshotTree};const o=yield it.timedExecAsync(n.logger,{eventName:"getWholeFlatSummary",treeId:e},function(){var Q=(0,l.Z)(function*(Y){var ye;const De=yield(yield n.getStorageManager(t)).getSummary(e);return Y.end({size:null===(ye=De.trees[0])||void 0===ye?void 0:ye.entries.length}),De});return function(Y){return Q.apply(this,arguments)}}()),h=Ou(o),w=o.id,D=h.snapshotTree.id;S(void 0!==D,629);const _={id:w,snapshotTree:h.snapshotTree},U=[n.snapshotTreeCache.put(n.getCacheKey(D),_),n.initBlobCache(h.blobs)];return D!==e&&U.push(n.snapshotTreeCache.put(n.getCacheKey(e),_)),yield Promise.all(U),_})()}initBlobCache(e){var t=this;return(0,l.Z)(function*(){const n=[];e.forEach((i,o)=>{const h=t.getCacheKey(o);n.push(t.blobCache.put(h,i))}),yield Promise.all(n)})()}getCacheKey(e){return`${this.id}:${e}`}}function So(){return So=(0,l.Z)(function*(u,e){const t=yield crypto.subtle.digest(e,u);return new Uint8Array(t)}),So.apply(this,arguments)}function xo(){return xo=(0,l.Z)(function*(u,e="SHA-1",t="hex"){if(void 0===crypto.subtle)return v.e(564).then(v.bind(v,2393)).then(function(){var i=(0,l.Z)(function*(o){return o.hashFile(u,e,t)});return function(o){return i.apply(this,arguments)}}());const n=yield function ph(u,e){return So.apply(this,arguments)}(u,e);return function gh(u,e){switch(e){case"hex":return Array.prototype.map.call(u,n=>n.toString(16).padStart(2,"0")).join("");case"base64":return z.fromByteArray(u)}}(n,t)}),xo.apply(this,arguments)}function wo(){return wo=(0,l.Z)(function*(u){const t=`blob ${u.byteLength.toString()}${String.fromCharCode(0)}`;return function mh(u){return xo.apply(this,arguments)}(ce.from(t+u.toString()))}),wo.apply(this,arguments)}class yh{constructor(e,t,n){this.manager=e,this.blobsShaCache=t,this.getPreviousFullSnapshot=n}writeSummaryTree(e,t,n,i){var o=this;return(0,l.Z)(function*(){const h=yield o.getPreviousFullSnapshot(t);return o.writeSummaryTreeCore(e,h??void 0)})()}writeSummaryTreeCore(e,t){var n=this;return(0,l.Z)(function*(){const i=yield Promise.all(Object.keys(e.tree).map(function(){var h=(0,l.Z)(function*(w){const D=e.tree[w],_=yield n.writeSummaryTreeObject(D,t);return{mode:ha(D),path:encodeURIComponent(w),sha:_,type:ls(D)}});return function(w){return h.apply(this,arguments)}}()));return(yield n.manager.createGitTree({tree:i})).sha})()}writeSummaryTreeObject(e,t){var n=this;return(0,l.Z)(function*(){switch(e.type){case Le.Blob:return n.writeSummaryBlob(e.content);case Le.Handle:if(void 0===t)throw Error("Parent summary does not exist to reference by handle.");return n.getIdFromPath(e.handleType,e.handle,t);case Le.Tree:return n.writeSummaryTreeCore(e,t);case Le.Attachment:return e.id;default:En(0,`Unknown type: ${e.type}`)}})()}writeSummaryBlob(e){var t=this;return(0,l.Z)(function*(){const{parsedContent:n,encoding:i}="string"==typeof e?{parsedContent:e,encoding:"utf-8"}:{parsedContent:K(e,"base64"),encoding:"base64"},o=yield function vh(u){return wo.apply(this,arguments)}(ce.from(n,i));return t.blobsShaCache.has(o)||(t.blobsShaCache.set(o,""),S(o===(yield t.manager.createBlob(n,i)).sha,182)),o})()}getIdFromPath(e,t,n){const i=t.split("/").map(o=>decodeURIComponent(o));return""===i[0]&&i.shift(),0===i.length?n.id:this.getIdFromPathCore(e,i,n)}getIdFromPathCore(e,t,n){var i;S(t.length>0,179);const o=t[0];if(1===t.length)switch(e){case Le.Blob:{const h=n.blobs[o];return S(!!h,180),h}case Le.Tree:{const h=null===(i=n.trees[o])||void 0===i?void 0:i.id;return S(!!h,181),h}default:throw Error(`Unexpected handle summary object type: "${e}".`)}return this.getIdFromPathCore(e,t.slice(1),n.trees[o])}}class bh{constructor(e,t){this.internalGitManager=e,this.logger=t}getHeader(e,t){var n=this;return(0,l.Z)(function*(){return n.runWithRetry((0,l.Z)(function*(){return n.internalGitManager.getHeader(e,t)}),"gitManager_getHeader")})()}getFullTree(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.getFullTree(e)}),"gitManager_getFullTree")})()}getCommit(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.getCommit(e)}),"gitManager_getCommit")})()}getCommits(e,t){var n=this;return(0,l.Z)(function*(){return n.runWithRetry((0,l.Z)(function*(){return n.internalGitManager.getCommits(e,t)}),"gitManager_getCommits")})()}getTree(e,t){var n=this;return(0,l.Z)(function*(){return n.runWithRetry((0,l.Z)(function*(){return n.internalGitManager.getTree(e,t)}),"gitManager_getTree")})()}getBlob(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.getBlob(e)}),"gitManager_getBlob")})()}getRawUrl(e){return this.internalGitManager.getRawUrl(e)}getContent(e,t){var n=this;return(0,l.Z)(function*(){return n.runWithRetry((0,l.Z)(function*(){return n.internalGitManager.getContent(e,t)}),"gitManager_getContent")})()}createBlob(e,t){var n=this;return(0,l.Z)(function*(){return n.runWithRetry((0,l.Z)(function*(){return n.internalGitManager.createBlob(e,t)}),"gitManager_createBlob")})()}createGitTree(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.createGitTree(e)}),"gitManager_createGitTree")})()}createTree(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.createTree(e)}),"gitManager_createTree")})()}createCommit(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.createCommit(e)}),"gitManager_createCommit")})()}getRef(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.getRef(e)}),"gitManager_getRef")})()}createRef(e,t){var n=this;return(0,l.Z)(function*(){return n.runWithRetry((0,l.Z)(function*(){return n.internalGitManager.createRef(e,t)}),"gitManager_createRef")})()}upsertRef(e,t){var n=this;return(0,l.Z)(function*(){return n.runWithRetry((0,l.Z)(function*(){return n.internalGitManager.upsertRef(e,t)}),"gitManager_upsertRef")})()}write(e,t,n,i){var o=this;return(0,l.Z)(function*(){return o.runWithRetry((0,l.Z)(function*(){return o.internalGitManager.write(e,t,n,i)}),"gitManager_write")})()}createSummary(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.createSummary(e)}),"gitManager_createSummary")})()}deleteSummary(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.deleteSummary(e)}),"gitManager_deleteSummary")})()}getSummary(e){var t=this;return(0,l.Z)(function*(){return t.runWithRetry((0,l.Z)(function*(){return t.internalGitManager.getSummary(e)}),"gitManager_getSummary")})()}runWithRetry(e,t){var n=this;return(0,l.Z)(function*(){return Ga(e,t,n.logger,{})})()}}const Sh=typeof window>"u";class xh{constructor(e,t,n,i={},o,h,w,D=(0,l.Z)(function*(){return _this.manager})){this.id=e,this.manager=t,this.logger=n,this.policies=i,this.getStorageManager=D,this.blobsShaCache=new Map,(!0===o?.enableRestLess||Sh)&&(this.blobCache=h??new bi,this.snapshotTreeCache=w??new bi)}get repositoryUrl(){return""}getSummaryUploadManager(){var e=this;return(0,l.Z)(function*(){const t=yield e.getStorageManager();return new yh(new bh(t,e.logger),e.blobsShaCache,e.getPreviousFullSnapshot.bind(e))})()}getVersions(e,t){var n=this;return(0,l.Z)(function*(){const i=e||n.id;return(yield it.timedExecAsync(n.logger,{eventName:"getVersions",versionId:i,count:t},(0,l.Z)(function*(){return(yield n.getStorageManager()).getCommits(i,t)}))).map(h=>({date:h.commit.author.date,id:h.sha,treeId:h.commit.tree.sha}))})()}getSnapshotTree(e){var t=this;return(0,l.Z)(function*(){var n,i;let o=e;if(!o){const _=yield t.getVersions(t.id,1);if(0===_.length)return null;o=_[0]}const h=yield null===(n=t.snapshotTreeCache)||void 0===n?void 0:n.get(t.getCacheKey(o.treeId));if(h)return h.snapshotTree;const w=yield it.timedExecAsync(t.logger,{eventName:"getSnapshotTree",treeId:o.treeId},function(){var _=(0,l.Z)(function*(U){const Y=yield(yield t.getStorageManager()).getTree(o.treeId);return U.end({size:Y.tree.length}),Y});return function(U){return _.apply(this,arguments)}}()),D=Pi(w,t.blobsShaCache,!0);return yield null===(i=t.snapshotTreeCache)||void 0===i?void 0:i.put(t.getCacheKey(D.id),{id:o.id,snapshotTree:D}),D})()}readBlob(e){var t=this;return(0,l.Z)(function*(){var n,i;const o=yield null===(n=t.blobCache)||void 0===n?void 0:n.get(t.getCacheKey(e));if(o)return o;const h=yield it.timedExecAsync(t.logger,{eventName:"readBlob",blobId:e},function(){var D=(0,l.Z)(function*(_){const Q=yield(yield t.getStorageManager()).getBlob(e);return _.end({size:Q.size}),Q});return function(_){return D.apply(this,arguments)}}());t.blobsShaCache.set(h.sha,"");const w=X(h.content,h.encoding);return yield null===(i=t.blobCache)||void 0===i?void 0:i.put(t.getCacheKey(h.sha),w),w})()}uploadSummaryWithContext(e,t){var n=this;return(0,l.Z)(function*(){return yield it.timedExecAsync(n.logger,{eventName:"uploadSummaryWithContext"},(0,l.Z)(function*(){var o;return(yield n.getSummaryUploadManager()).writeSummaryTree(e,null!==(o=t.ackHandle)&&void 0!==o?o:"","channel")}))})()}downloadSummary(e){return(0,l.Z)(function*(){throw new Error("NOT IMPLEMENTED!")})()}createBlob(e){var t=this;return(0,l.Z)(function*(){const n=new Uint8Array(e);return it.timedExecAsync(t.logger,{eventName:"createBlob",size:n.length},function(){var i=(0,l.Z)(function*(o){const w=yield(yield t.getStorageManager()).createBlob(K(n,"base64"),"base64").then(D=>({id:D.sha,url:D.url}));return o.end({blobId:w.id}),w});return function(o){return i.apply(this,arguments)}}())})()}getPreviousFullSnapshot(e){var t=this;return(0,l.Z)(function*(){return e?t.getVersions(e,1).then(function(){var n=(0,l.Z)(function*(i){return t.blobsShaCache.clear(),t.getSnapshotTree(i[0])});return function(i){return n.apply(this,arguments)}}()):void 0})()}getCacheKey(e){return`${this.id}:${e}`}}class Co extends qi{constructor(e,t,n,i={},o,h,w,D,_){super(Co.loadInternalDocumentStorageService(e,t,n,i,o,h,w,D,_)),this.id=e,this.manager=t,this.noCacheGitManager=D,this._logTailSha=void 0}get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(e,t,n,i,o,h,w,D,_){const U=o?.enableWholeSummaryUpload?new fh(e,t,n,i,o,h,w,D,_):new xh(e,t,n,i,o,h,w,_);return o?.enableWholeSummaryUpload||i.caching!==Wr.Prefetch?U:new ch(U)}getSnapshotTree(e){var t=this;return(0,l.Z)(function*(){const n=yield t.internalStorageService.getSnapshotTree(e);return null!==n&&(t._logTailSha=".logTail"in n.trees?n.trees[".logTail"].blobs.logTail:void 0),n})()}}let wh=(()=>{class u extends Je{constructor(t,n,i,o=!1){super((h,w)=>{i.sendErrorEvent({eventName:"DeltaConnection:EventException",name:h},w)}),this.socket=t,this.documentId=n,this.enableLongPollingDowngrades=o,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(h,w)=>{this.queuedMessages.push(...w)},this.earlySignalHandler=h=>{this.queuedSignals.push(h)},this.mc=gt(rt.create(i,"DeltaConnection")),this.on("newListener",(h,w)=>{if(S(!this.disposed,522),u.eventsAlwaysForwarded.includes(h))S(this.trackedListeners.has(h),581);else{if(!u.eventsToForward.includes(h))throw new Error(`DocumentDeltaConnection: Registering for unknown event: ${h}`);S(0!==this.listeners(h).length===this.trackedListeners.has(h),523),this.trackedListeners.has(h)||this.addTrackedListener(h,(...D)=>{this.emit(h,...D)})}})}get hasDetails(){return!!this._details}get disposed(){return S(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotClosed(){S(!this.disposed,524)}get initialMessages(){return this.checkNotClosed(),S(this.earlyOpHandlerAttached,142),S(0!==this.listeners("op").length,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort((t,n)=>t.sequenceNumber-n.sequenceNumber),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotClosed(),S(0!==this.listeners("signal").length,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotClosed(),this.details.initialClients}emitMessages(t,n){this.disposed||this.socket.emit(t,this.clientId,n)}submitCore(t,n){this.emitMessages(t,[n])}submit(t){this.checkNotClosed(),this.submitCore("submitOp",t)}submitSignal(t){this.checkNotClosed(),this.submitCore("submitSignal",[t])}dispose(){this.disposeCore(!1,Er("Client closing delta connection",{canRetry:!0},{driverVersion:"1.3.6"}))}disposeCore(t,n){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(t,n))}disconnect(t,n){this.socket.disconnect()}initialize(t,n){var i=this;return(0,l.Z)(function*(){i.socket.on("op",i.earlyOpHandler),i.socket.on("signal",i.earlySignalHandler),i.earlyOpHandlerAttached=!0;let o=0;const h=()=>i.socket.io.reconnection();i._details=yield new Promise((_,U)=>{const Q=(Y,ye)=>{i.disposeCore(Y,ye),U(ye)};i.addConnectionListener("connect_error",Y=>{var ye;o++;let Fe=!1;try{const De=Y?.description;De&&"object"==typeof De&&("TransportError"===Y.type&&(Fe=!0),De.target=void 0)}catch{}Fe&&i.enableLongPollingDowngrades&&"polling"!==(null===(ye=i.socket.io.opts.transports)||void 0===ye?void 0:ye[0])&&(i.socket.io.opts.transports=["polling","websocket"],h()||(i.socket.io.reconnection(!0),i.socket.io.reconnectionAttempts(1))),!(h()&&o<(h()?i.socket.io.reconnectionAttempts():0)+1)&&Q(!0,i.createErrorObject("connect_error",Y))}),i.addConnectionListener("connect_timeout",()=>{Q(!0,i.createErrorObject("connect_timeout"))}),i.addConnectionListener("connect_document_success",Y=>{if(void 0!==t.nonce&&void 0!==Y.nonce&&Y.nonce!==t.nonce)return;const ye=t.mode,Fe=Y.mode;if(Y.claims.scopes.includes(Sr.DocWrite)){if(Fe!==ye)return void Q(!1,i.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1))}else if("write"===Fe)return void Q(!1,i.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));i.checkpointSequenceNumber=Y.checkpointSequenceNumber,i.removeConnectionListeners(),_(Y)}),i.addTrackedListener("disconnect",Y=>{const ye=i.createErrorObject("disconnect",Y);i.emit("disconnect",ye),Q(!0,ye)}),i.addTrackedListener("error",Y=>{const ye=i.createErrorObject("error",Y,"Invalid namespace"!==Y);i.emit("error",ye),Q(!0,ye)}),i.addConnectionListener("connect_document_error",Y=>{void 0!==t.nonce&&void 0!==Y.nonce&&Y.nonce!==t.nonce||Q(!1,i.createErrorObject("connect_document_error",Y))}),i.socket.emit("connect_document",t),i.socketConnectionTimeout=setTimeout(()=>{Q(!1,i.createErrorObject("orderingServiceHandshakeTimeout"))},n+2e3)}),S(!i.disposed,582)})()}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(t,n){S(!u.eventsAlwaysForwarded.includes(t),583),S(!u.eventsToForward.includes(t),584),this.socket.on(t,n),S(!this.connectionListeners.has(t),525),this.connectionListeners.set(t,n)}addTrackedListener(t,n){this.socket.on(t,n),S(!this.trackedListeners.has(t),526),this.trackedListeners.set(t,n)}removeTrackedListeners(){for(const[t,n]of this.trackedListeners.entries())this.socket.off(t,n);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){void 0!==this.socketConnectionTimeout&&clearTimeout(this.socketConnectionTimeout);for(const[t,n]of this.connectionListeners.entries())this.socket.off(t,n);this.connectionListeners.clear()}createErrorObject(t,n,i=!0){let o;return o="TransportError"===n?.type?`${void 0!==n?.message?`${n.message}: `:""}${JSON.stringify(n,(()=>{const u=new WeakSet;return(e,t)=>{if("object"==typeof t&&null!==t){if(u.has(t))return"<removed/circular>";u.add(t)}return t}})())}`:function je(u){const i={message:"string"==typeof u?.message?u.message:String(u)};if(null!==(o=u)&&!Array.isArray(o)&&"object"==typeof o){const{errorType:o,stack:h,name:w}=u;"string"==typeof o&&(i.errorType=o),"string"==typeof h&&(i.stack=((o,h)=>{const w=o.split("\n");return w.shift(),void 0!==h&&w.unshift(h),w.join("\n")})(h,"string"==typeof w?w:void 0))}var o;return i}(n).message,Er(`socket.io (${t}): ${o}`,{canRetry:i},{driverVersion:"1.3.6"})}}return u.eventsToForward=["nack","op","signal","pong"],u.eventsAlwaysForwarded=["disconnect","error"],u})();const Ks="1.3.6";var Gs=(()=>(function(u){u.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError"}(Gs||(Gs={})),Gs))();function ku(u,e,t){const n={statusCode:e,driverVersion:Ks};switch(e){case void 0:return new Bi(u,u.startsWith("NetworkError"),n);case 401:case 403:return new Qn(u,void 0,void 0,n);case 404:return new ai(u,Gs.fileNotFoundOrAccessDeniedError,n);case 429:return Er(u,{canRetry:!0,retryAfterMs:t},n);case 500:case 502:return new Bi(u,!0,n);default:return Er(u,{canRetry:void 0!==t,retryAfterMs:t},n)}}function Bu(u,e,t){throw ku(u,e,t)}const Eh=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"];class Eo extends wh{static create(e,t,n,i,o,h,w,D=2e4){return(0,l.Z)(function*(){const _=i(h,{query:{documentId:t,tenantId:e},reconnection:!1,transports:["websocket"],timeout:D}),U={client:o,id:t,mode:o.mode,tenantId:e,token:n,versions:Eh,relayUserAgent:[o.details.environment,` driverVersion:${Ks}`].join(";")},Y=new Eo(_,t,w,!0);return yield Y.initialize(U,D),Y})()}createErrorObject(e,t,n=!0){return n&&Number.isInteger(t?.code)&&"string"==typeof t?.message?function Ch(u,e){return ku(`R11s socket error (${e}): ${u.message}`,u.code,u.retryAfterMs)}(t,e):super.createErrorObject(e,t,n)}}class Ah{get repositoryUrl(){throw new Error("Invalid operation")}getSnapshotTree(e){return(0,l.Z)(function*(){return e?Promise.reject(new Error("Invalid operation")):null})()}getVersions(e,t){return(0,l.Z)(function*(){return[]})()}uploadSummaryWithContext(e,t){return(0,l.Z)(function*(){return Promise.reject(new Error("Invalid operation"))})()}downloadSummary(e){return(0,l.Z)(function*(){return Promise.reject(new Error("Invalid operation"))})()}createBlob(e){return(0,l.Z)(function*(){return Promise.reject(new Error("Null blob storage can not create blob"))})()}readBlob(e){return(0,l.Z)(function*(){return Promise.reject(new Error("Null blob storage can not read blob"))})()}}var Si=(()=>(function(u){u.Method="method",u.Header="header",u.Body="body"}(Si||(Si={})),Si))();const Th=(u,e)=>`${u}: ${e}`;class Fh{translate(e){var t,n;const i=Object.assign({},e),o=new URLSearchParams;if(o.append(Si.Method,null!==(t=i.method)&&void 0!==t?t:"GET"),i.headers)for(const[h,w]of Object.entries(i.headers)){const D=Th(h,w);o.append(Si.Header,D)}if(i.data&&["post","put","patch"].includes(null===(n=i.method)||void 0===n?void 0:n.toLowerCase())){const h=JSON.stringify(i.data);o.append(Si.Body,h)}return i.data=o.toString(),i.method="POST",i.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},i}}var Dh=v(8472),Ph=v.n(Dh);class ju extends su{constructor(e,t,n,i,o,h={}){super(o,h),this.rateLimiter=t,this.getAuthorizationHeader=n,this.useRestLess=i,this.restLess=new Fh}load(){var e=this;return(0,l.Z)(function*(){e.authorizationHeader=yield e.getAuthorizationHeader()})()}request(e,t,n=!0){var i=this;return(0,l.Z)(function*(){var o;const h=Object.assign(Object.assign({},e),{headers:i.generateHeaders(e.headers)}),D=(u=>{var e,t;return[void 0!==u.baseURL?`${u.baseURL}${null!==(e=u.url)&&void 0!==e?e:""}`:null!==(t=u.url)&&void 0!==t?t:"",{method:u.method,headers:u.headers,body:u.data}]})(i.useRestLess?i.restLess.translate(h):h),_=yield i.rateLimiter.schedule((0,l.Z)(function*(){return Ph()(...D).catch(function(){var Y=(0,l.Z)(function*(ye){Bu(["TypeError","FetchError"].includes(ye?.name)?`NetworkError: ${ye.message}`:uo()(ye))});return function(ye){return Y.apply(this,arguments)}}())})),U=null!==(o=_.headers.get("content-type"))&&void 0!==o&&o.includes("application/json")?yield _.json():yield _.text();return _.ok||_.status===t?U:401===_.status&&n?(i.authorizationHeader=yield i.getAuthorizationHeader(!0),i.request(h,t,!1)):429===_.status&&U?.retryAfter>0?new Promise((Y,ye)=>setTimeout(()=>{i.request(h,t).then(Y).catch(ye)},1e3*U.retryAfter)):void Bu(`R11s fetch error: ${void 0!==U?"string"==typeof U?U:uo()(U):_.statusText}`,_.status,U?.retryAfter)})()}generateHeaders(e){const t=e?.["x-correlation-id"]||Pe();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":Ks,Authorization:this.authorizationHeader})}}class Ao extends ju{constructor(e,t,n,i,o,h={}){super(e,t,n,i,o,h)}static load(e,t,n,i,o,h,w){return(0,l.Z)(function*(){const D={token:`${cs(e)}`},_=function(){var Q=(0,l.Z)(function*(Y){return(u=>`Basic ${cs(`${u.user}:${u.password}`)}`)({password:(yield n.fetchStorageToken(e,t,Y)).jwt,user:e})});return function(ye){return Q.apply(this,arguments)}}(),U=new Ao(i,o,_,h,w,D);try{yield U.load()}catch(Q){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},Q),yield U.load()}return U})()}}class es extends ju{constructor(e,t,n,i,o,h={}){super(e,t,n,i,o,h)}static load(e,t,n,i,o,h,w){return(0,l.Z)(function*(){const D=function(){var U=(0,l.Z)(function*(Q){return`Basic ${(yield n.fetchOrdererToken(e,t,Q)).jwt}`});return function(Y){return U.apply(this,arguments)}}(),_=new es(i,o,D,h,w);try{yield _.load()}catch(U){i.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},U),yield _.load()}return _})()}}class Ih{constructor(e,t,n,i,o,h,w,D,_,U,Q,Y){this._resolvedUrl=e,this.ordererUrl=t,this.deltaStorageUrl=n,this.storageUrl=i,this.logger=o,this.tokenProvider=h,this.tenantId=w,this.documentId=D,this.driverPolicies=_,this.blobCache=U,this.snapshotTreeCache=Q,this.discoverFluidResolvedUrl=Y,this.lastDiscoveredAt=Date.now()}get resolvedUrl(){return this._resolvedUrl}dispose(){}connectToStorage(){var e=this;return(0,l.Z)(function*(){if(void 0!==e.documentStorageService)return e.documentStorageService;if(void 0===e.storageUrl)return new Ah;const t=function(){var h=(0,l.Z)(function*(w){const D=e.shouldUpdateDiscoveredSessionInfo();if(D&&(yield e.refreshDiscovery()),!e.storageManager||!e.noCacheStorageManager||D){const _=new Bs(e.driverPolicies.maxConcurrentStorageRequests),U=yield Ao.load(e.tenantId,e.documentId,e.tokenProvider,e.logger,_,e.driverPolicies.enableRestLess,e.storageUrl),Q=new au(e.storageUrl,!0,!1,U);e.storageManager=new ou(Q);const Y=new au(e.storageUrl,!0,!0,U);e.noCacheStorageManager=new ou(Y)}return w?e.noCacheStorageManager:e.storageManager});return function(D){return h.apply(this,arguments)}}(),n=yield t(),i=yield t(!0);return e.documentStorageService=new Co(e.documentId,n,e.logger,{caching:e.driverPolicies.enablePrefetch?Wr.Prefetch:Wr.NoCaching,minBlobSize:e.driverPolicies.aggregateBlobsSmallerThanBytes},e.driverPolicies,e.blobCache,e.snapshotTreeCache,i,t),e.documentStorageService})()}connectToDeltaStorage(){var e=this;return(0,l.Z)(function*(){yield e.connectToStorage(),S(!!e.documentStorageService,177);const t=function(){var o=(0,l.Z)(function*(){const h=e.shouldUpdateDiscoveredSessionInfo();if(h&&(yield e.refreshDiscovery()),!e.ordererRestWrapper||h){const w=new Bs(e.driverPolicies.maxConcurrentOrdererRequests);e.ordererRestWrapper=yield es.load(e.tenantId,e.documentId,e.tokenProvider,e.logger,w,e.driverPolicies.enableRestLess)}return e.ordererRestWrapper});return function(){return o.apply(this,arguments)}}(),n=yield t(),i=new uh(e.deltaStorageUrl,n,e.logger,t,()=>e.deltaStorageUrl);return new oh(e.tenantId,e.documentId,i,e.documentStorageService)})()}connectToDeltaStream(e){var t=this;return(0,l.Z)(function*(){const n=function(){var i=(0,l.Z)(function*(o){t.shouldUpdateDiscoveredSessionInfo()&&(yield t.refreshDiscovery());const h=yield t.tokenProvider.fetchOrdererToken(t.tenantId,t.documentId,o);return Eo.create(t.tenantId,t.documentId,h.jwt,Zs,e,t.ordererUrl,t.logger)});return function(h){return i.apply(this,arguments)}}();try{return yield n()}catch(i){if(401===i?.statusCode)return n(!0);throw i}})()}refreshDiscovery(){var e=this;return(0,l.Z)(function*(){return e.discoverP||(e.discoverP=it.timedExecAsync(e.logger,{eventName:"refreshSessionDiscovery"},(0,l.Z)(function*(){return e.refreshDiscoveryCore()}))),e.discoverP})()}refreshDiscoveryCore(){var e=this;return(0,l.Z)(function*(){const t=yield e.discoverFluidResolvedUrl();e._resolvedUrl=t,e.storageUrl=t.endpoints.storageUrl,e.ordererUrl=t.endpoints.ordererUrl,e.deltaStorageUrl=t.endpoints.deltaStorageUrl})()}shouldUpdateDiscoveredSessionInfo(){if(!this.driverPolicies.enableDiscovery)return!1;const t=Date.now()-this.lastDiscoveredAt>3e5;return t&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch(()=>{this.lastDiscoveredAt=0})),t}}function Lu(u){const e=Object.keys(u.tree);for(const t of e){const n=u.tree[t];switch(n.type){case Le.Tree:u.tree[t]=Lu(n);break;case Le.Blob:n.content="string"==typeof n.content?n.content:K(n.content,"utf8");break;case Le.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error(`Unknown tree type ${n.type}`)}}return u}var Oh=v(7629),xi=v.n(Oh);const Ws=u=>new(xi())(u,!0),Hu=(u,e)=>u.split("/").slice(0,-1).concat([e]).join("/"),qu=(u,e)=>{if(e){const t=new(xi())(e.ordererUrl),n=new(xi())(u.endpoints.deltaStorageUrl);n.set("host",t.host);const i=new(xi())(e.historianUrl),o=new(xi())(u.endpoints.storageUrl);o.set("host",i.host);const h=Ws(u.url);return{endpoints:{deltaStorageUrl:n.toString(),ordererUrl:e.ordererUrl,storageUrl:o.toString()},id:u.id,tokens:u.tokens,type:u.type,url:new(xi())(`fluid://${t.host}${h.pathname}`).toString()}}return u},_h={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0};class Mh{constructor(e,t={}){this.tokenProvider=e,this.protocolName="fluid:",this.blobCache=new bi,this.snapshotTreeCache=new bi,this.driverPolicies=Object.assign(Object.assign({},_h),t)}createContainer(e,t,n,i){var o=this;return(0,l.Z)(function*(){if(ar(t),void 0===e)throw new Error("Empty file summary creation isn't supported in this driver.");S(!!t.endpoints.ordererUrl,178);let h=Ws(t.url);if(!h.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");const[,w]=h.pathname.split("/"),D=e.tree[".protocol"],_=e.tree[".app"];if(!D||!_)throw new Error("Protocol and App Summary required in the full summary");const U=function Sc(u){var e;const n=JSON.parse(u.tree.attributes.content);return n.term=null!==(e=n.term)&&void 0!==e?e:1,n}(D),Q=function xc(u){return JSON.parse(u.tree.quorumValues.content)}(D),Y=rt.create(n,"RouterliciousDriver"),ye=new Bs(o.driverPolicies.maxConcurrentOrdererRequests),De=yield(yield es.load(w,void 0,o.tokenProvider,Y,ye,o.driverPolicies.enableRestLess,t.endpoints.ordererUrl)).post(`/documents/${w}`,{summary:Lu(_),sequenceNumber:U.sequenceNumber,values:Q,enableDiscovery:o.driverPolicies.enableDiscovery,generateToken:void 0!==o.tokenProvider.documentPostCreateCallback});let Ee,ke,ze;if("string"==typeof De?Ee=De:(Ee=De.id,ke=De.token,ze=o.driverPolicies.enableDiscovery?De.session:void 0),h=Ws(t.url),ke&&void 0!==o.tokenProvider.documentPostCreateCallback)try{yield o.tokenProvider.documentPostCreateCallback(Ee,ke)}catch(dt){throw new kh(dt)}h.set("pathname",Hu(h.pathname,Ee));const We=t.endpoints.deltaStorageUrl;if(!We)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${We}]`);const $e=new URL(We);return $e.pathname=Hu($e.pathname,Ee),o.createDocumentService(Object.assign(Object.assign({},t),{url:h.toString(),id:Ee,endpoints:Object.assign(Object.assign({},t.endpoints),{deltaStorageUrl:$e.toString()})}),n,i,ze)})()}createDocumentService(e,t,n,i){var o=this;return(0,l.Z)(function*(){ar(e);const h=Ws(e.url),[,w,D]=h.pathname.split("/");if(!D||!w)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${D}][tenantId:${w}]`);const _=rt.create(t,"RouterliciousDriver",{all:{driverVersion:Ks}}),U=function(){var De=(0,l.Z)(function*(){if(!o.driverPolicies.enableDiscovery)return e;const Ee=new Bs(o.driverPolicies.maxConcurrentOrdererRequests),ze=yield(yield es.load(w,D,o.tokenProvider,_,Ee,o.driverPolicies.enableRestLess,e.endpoints.ordererUrl)).get(`/documents/${w}/session/${D}`);return qu(e,ze)});return function(){return De.apply(this,arguments)}}(),Q=void 0!==i?qu(e,i):yield U(),Y=Q.endpoints.storageUrl,ye=Q.endpoints.ordererUrl,Fe=Q.endpoints.deltaStorageUrl;if(!ye||!Fe)throw new Error(`All endpoints urls must be provided. [ordererUrl:${ye}][deltaStorageUrl:${Fe}]`);return new Ih(Q,ye,Fe,Y,_,o.tokenProvider,w,D,o.driverPolicies,o.blobCache,o.snapshotTreeCache,U)})()}}class kh extends Error{constructor(e){super(e.message),this.innerError=e,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}}class Lh{constructor(e=7070,t="http://localhost"){this.tinyliciousEndpoint=`${t}:${e}`,this.fluidProtocolEndpoint=this.tinyliciousEndpoint.replace(/(^\w+:|^)\/\//,"fluid://")}resolve(e){var t=this;return(0,l.Z)(function*(){var n;if(e.headers&&!0===e.headers[fr.createNew]){const Y=null!==(n=e.url)&&void 0!==n?n:"new";return{endpoints:{deltaStorageUrl:`${t.tinyliciousEndpoint}/deltas/tinylicious/${Y}`,ordererUrl:t.tinyliciousEndpoint,storageUrl:`${t.tinyliciousEndpoint}/repos/tinylicious`},id:e.url,tokens:{},type:"fluid",url:`${t.fluidProtocolEndpoint}/tinylicious/${Y}`}}const i=e.url.replace(`${t.tinyliciousEndpoint}/`,""),o=i.split("/")[0],h=encodeURIComponent(o),w=i.slice(o.length);return{endpoints:{deltaStorageUrl:`${t.tinyliciousEndpoint}/deltas/tinylicious/${h}`,ordererUrl:t.tinyliciousEndpoint,storageUrl:`${t.tinyliciousEndpoint}/repos/tinylicious`},id:o,tokens:{},type:"fluid",url:`${t.fluidProtocolEndpoint}/tinylicious/${h}${w}`}})()}getAbsoluteUrl(e,t){var n=this;return(0,l.Z)(function*(){return`${decodeURIComponent(e.url.replace(`${n.fluidProtocolEndpoint}/tinylicious/`,""))}/${t}`})()}}var qh=v(2648),zh=v.n(qh);function zu(u="_",e=!1){let[t,n]=zh()().split(" ");return e||(t=t.toLowerCase(),n=n.toLowerCase()),`${t}${u}${n}`}var Uu,Zu,Vh=v(2573);class Uh{fetchOrdererToken(e,t){var n=this;return(0,l.Z)(function*(){return{fromCache:!0,jwt:n.getSignedToken(e,t)}})()}fetchStorageToken(e,t){var n=this;return(0,l.Z)(function*(){return{fromCache:!0,jwt:n.getSignedToken(e,t)}})()}getSignedToken(e,t,n=3600,i="1.0"){const o=Math.round((new Date).getTime()/1e3),h={id:Pe(),name:zu()},w={documentId:t??"",scopes:[Sr.DocRead,Sr.DocWrite,Sr.SummaryWrite],tenantId:e,user:h,iat:o,exp:o+n,ver:i};return Vh.fs.jws.JWS.sign(null,JSON.stringify({alg:"HS256",typ:"JWT"}),w,{utf8:"12345"})}}class Vu extends Ke{constructor(e,t){super(),this.container=e,this.rootDataObject=t,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=n=>this.emit("disposed",n),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),e.on("connected",this.connectedHandler),e.on("closed",this.disposedHandler),e.on("disconnected",this.disconnectedHandler),e.on("saved",this.savedHandler),e.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}attach(){return(0,l.Z)(function*(){throw new Error("Cannot attach container. Container is not in detached state")})()}connect(){var e=this;return(0,l.Z)(function*(){var t,n;null===(n=(t=e.container).connect)||void 0===n||n.call(t)})()}disconnect(){var e=this;return(0,l.Z)(function*(){var t,n;null===(n=(t=e.container).disconnect)||void 0===n||n.call(t)})()}create(e){var t=this;return(0,l.Z)(function*(){return t.rootDataObject.create(e)})()}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}}const In=v(3928).posix;class ur{get type(){return ur.Type}get attributes(){return ur.Attributes}load(e,t,n,i){return(0,l.Z)(function*(){const o=new $s(t,e,i);return yield o.load(n),o})()}create(e,t){const n=new $s(t,e,ur.Attributes);return n.initializeLocal(),n}}ur.Type="https://graph.microsoft.com/types/directory",ur.Attributes={type:ur.Type,snapshotFormatVersion:"0.1",packageVersion:"1.3.6"};class $s extends Fr{constructor(e,t,n){super(e,t,n,"fluid_directory_"),this[Uu]="SharedDirectory",this.root=new Js(this,this.runtime,this.serializer,In.sep),this.messageHandlers=new Map,this.localValueMaker=new jn(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",(i,o)=>{this.emit("containedValueChanged",i,o,this)}),this.root.on("subDirectoryCreated",(i,o)=>{this.emit("subDirectoryCreated",i,o,this)}),this.root.on("subDirectoryDeleted",(i,o)=>{this.emit("subDirectoryDeleted",i,o,this)})}static create(e,t){return e.createChannel(t,ur.Type)}static getFactory(){return new ur}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(Uu=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){const t=this.makeAbsolute(e);if(t===In.sep)return this.root;let n=this.root;const i=t.substr(1).split(In.sep);for(const o of i)if(n=n.getSubDirectory(o),!n)return;return n}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){const n=e,i=this.messageHandlers.get(n.type);S(void 0!==i,13),i.submit(n,t)}loadCore(e){var t=this;return(0,l.Z)(function*(){const n=yield V(e,"header"),i=n;Array.isArray(i.blobs)?(t.populate(i.content),yield Promise.all(i.blobs.map(function(){var o=(0,l.Z)(function*(h){const w=yield V(e,h);t.populate(w)});return function(h){return o.apply(this,arguments)}}()))):t.populate(n)})()}populate(e){const t=[];for(t.push([this.root,e]);t.length>0;){const[n,i]=t.pop();if(i.subdirectories)for(const[o,h]of Object.entries(i.subdirectories)){let w=n.getSubDirectory(o);w||(w=new Js(this,this.runtime,this.serializer,In.join(n.absolutePath,o)),n.populateSubDirectory(o,w)),t.push([w,h])}if(i.storage)for(const[o,h]of Object.entries(i.storage)){const w=this.makeLocal(o,n.absolutePath,h);n.populateStorage(o,w)}}}processCore(e,t,n){if(e.type===E.Operation){const i=e.contents,o=this.messageHandlers.get(i.type);S(void 0!==o,14),o.process(i,t,n)}}rollback(e,t){const n=e,i=this.getWorkingDirectory(n.path);i&&i.rollback(n,t)}makeAbsolute(e){return In.resolve(In.sep,e)}makeLocal(e,t,n){return S(n.type===Bt[Bt.Plain]||n.type===Bt[Bt.Shared],484),this.localValueMaker.fromSerializable(n)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,n)=>{const i=this.getWorkingDirectory(e.path);i&&i.processClearMessage(e,t,n)},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,n)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteMessage(e,t,n)},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,n)=>{const i=this.getWorkingDirectory(e.path);if(i){const o=t?void 0:this.makeLocal(e.key,e.path,e.value);i.processSetMessage(e,o,t,n)}},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,n)=>{const i=this.getWorkingDirectory(e.path);i&&i.processCreateSubDirectoryMessage(e,t,n)},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,n)=>{const i=this.getWorkingDirectory(e.path);i&&i.processDeleteSubDirectoryMessage(e,t,n)},submit:(e,t)=>{const n=this.getWorkingDirectory(e.path);n&&n.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,n){const o=new Mn;let h=0;const w=[],D=[],_={};for(D.push([e,_]);D.length>0;){const[Q,Y]=D.pop();for(const[ye,Fe]of Q.getSerializedStorage(t)){Y.storage||(Y.storage={});const De={type:Fe.type,value:Fe.value&&JSON.parse(Fe.value)};if(Fe.value&&Fe.value.length>=8192){const Ee={};let ke=Ee;if(Q.absolutePath!==In.sep)for(const We of Q.absolutePath.substr(1).split(In.sep)){const $e={};ke.subdirectories={[We]:$e},ke=$e}ke.storage={[ye]:De};const ze=`blob${h}`;h++,w.push(ze),o.addBlob(ze,JSON.stringify(Ee))}else Y.storage[ye]=De}for(const[ye,Fe]of Q.subdirectories()){Y.subdirectories||(Y.subdirectories={});const De={};Y.subdirectories[ye]=De,D.push([Fe,De])}}return o.addBlob("header",JSON.stringify({blobs:w,content:_})),o.getSummaryTree()}}function To(u){return void 0!==u&&"number"==typeof u.pendingMessageId&&"edit"===u.type}function Gu(u){return void 0!==u&&"clear"===u.type&&"number"==typeof u.pendingMessageId&&"object"==typeof u.previousStorage}function Wu(u){return void 0!==u&&"number"==typeof u.pendingMessageId&&("createSubDir"===u.type&&"boolean"==typeof u.previouslyExisted||"deleteSubDir"===u.type)}class Js extends Ke{constructor(e,t,n,i){super(),this.directory=e,this.runtime=t,this.serializer=n,this.absolutePath=i,this._deleted=!1,this[Zu]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new wt("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),null===(t=this._storage.get(e))||void 0===t?void 0:t.value}set(e,t){if(this.throwIfDisposed(),null==e)throw new Error("Undefined and null keys are not supported");const n=this.directory.localValueMaker.fromInMemory(t),i=gi(n,this.serializer,this.directory.handle),o=this.setCore(e,n,!0);return this.directory.isAttached()?(this.submitKeyMessage({key:e,path:this.absolutePath,type:"set",value:i},o),this):this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),null==e)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(In.sep))throw new Error(`SubDirectory name may not contain ${In.sep}`);const t=this.createSubDirectoryCore(e,!0),n=this._subdirectories.get(e);return this.directory.isAttached()?(this.submitCreateSubDirectoryMessage({path:this.absolutePath,subdirName:e,type:"createSubDirectory"},!t),n):n}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();const t=this.deleteSubDirectoryCore(e,!0);return this.directory.isAttached()?(this.submitDeleteSubDirectoryMessage({path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"},t),void 0!==t):void 0!==t}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();const t=this.deleteCore(e,!0);return this.directory.isAttached()?(this.submitKeyMessage({key:e,path:this.absolutePath,type:"delete"},t),void 0!==t):void 0!==t}clear(){if(this.throwIfDisposed(),!this.directory.isAttached())return void this.clearCore(!0);const e=new Map(this._storage);this.clearCore(!0),this.submitClearMessage({path:this.absolutePath,type:"clear"},e)}forEach(e){this.throwIfDisposed(),this._storage.forEach((t,n,i)=>{e(t.value,n,i)})}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();const e=this._storage.entries();return{next(){const n=e.next();return n.done?{value:void 0,done:!0}:{value:[n.value[0],n.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();const e=this._storage.values();return{next(){const n=e.next();return n.done?{value:void 0,done:!0}:{value:n.value.value,done:!1}},[Symbol.iterator](){return this}}}[(Zu=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,n){this.throwIfDisposed(),t?(S(Gu(n),15),S(this.pendingClearMessageIds.shift()===n.pendingMessageId,810)):this.clearExceptPendingKeys()}processDeleteMessage(e,t,n){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,n)&&this.deleteCore(e.key,t)}processSetMessage(e,t,n,i){this.throwIfDisposed(),this.needProcessStorageOperation(e,n,i)&&this.setCore(e.key,t,n)}processCreateSubDirectoryMessage(e,t,n){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,n)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,n){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,n)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();const n=++this.pendingMessageId;this.pendingClearMessageIds.push(n),this.directory.submitDirectoryMessage(e,{type:"clear",pendingMessageId:n,previousStorage:t})}resubmitClearMessage(e,t){S(Gu(t),811),S(this.pendingClearMessageIds.shift()===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){const t=++this.pendingMessageId,n=this.pendingKeys.get(e.key);return void 0!==n?n.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();const i={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,i)}resubmitKeyMessage(e,t){S(To(t),813);const n=this.pendingKeys.get(e.key);S(void 0!==n&&n[0]===t.pendingMessageId,814),n.shift(),0===n.length&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){const t=++this.pendingMessageId,n=this.pendingSubDirectories.get(e.subdirName);return void 0!==n?n.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,i)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();const i={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,i)}resubmitSubDirectoryMessage(e,t){S(Wu(t),815);const n=this.pendingSubDirectories.get(e.subdirName);S(void 0!==n&&n[0]===t.pendingMessageId,816),n.shift(),0===n.length&&this.pendingSubDirectories.delete(e.subdirName),"createSubDir"===t.type?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(const[t,n]of this._storage){const i=n.makeSerialized(e,this.directory.handle);yield[t,i]}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,n){const i=e.get(t),o=i?.pop();if(!i||o!==n)throw new Error("Rollback op does not match last pending");0===i.length&&e.delete(t)}rollback(e,t){if(!function Kh(u){return void 0!==u&&"number"==typeof u.pendingMessageId&&("edit"===u.type||"deleteSubDir"===u.type||"clear"===u.type&&"object"==typeof u.previousStorage||"createSubDir"===u.type&&"boolean"==typeof u.previouslyExisted)}(t))throw new Error("Invalid localOpMetadata");if("clear"===e.type&&"clear"===t.type){t.previousStorage.forEach((i,o)=>{this.setCore(o,i,!0)});const n=this.pendingClearMessageIds.pop();if(void 0===n||n!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if("delete"!==e.type&&"set"!==e.type||"edit"!==t.type)if("createSubDirectory"===e.type&&"createSubDir"===t.type)t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else{if("deleteSubDirectory"!==e.type||"deleteSubDir"!==t.type)throw new Error("Unsupported op for rollback");void 0!==t.subDirectory&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId)}else void 0===t.previousValue?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId)}makeAbsolute(e){return In.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,n){if(this.pendingClearMessageIds.length>0)return t&&S(void 0!==n&&To(n)&&n.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){S(void 0!==n&&To(n),17);const o=this.pendingKeys.get(e.key);S(void 0!==o&&o[0]===n.pendingMessageId,817),o.shift(),0===o.length&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,n){if(void 0!==this.pendingSubDirectories.get(e.subdirName)){if(t){S(Wu(n),18);const o=this.pendingSubDirectories.get(e.subdirName);S(void 0!==o&&o[0]===n.pendingMessageId,818),o.shift(),0===o.length&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,n,i)=>{e.set(n,this._storage.get(n))}),this.clearCore(!1),e.forEach((t,n,i)=>{this.setCore(n,t,!0)})}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){const n=this._storage.get(e),i=n?.value;return this._storage.delete(e)&&(this.directory.emit("valueChanged",{key:e,path:this.absolutePath,previousValue:i},t,this.directory),this.emit("containedValueChanged",{key:e,previousValue:i},t,this)),n}setCore(e,t,n){const i=this._storage.get(e),o=i?.value;return this._storage.set(e,t),this.directory.emit("valueChanged",{key:e,path:this.absolutePath,previousValue:o},n,this.directory),this.emit("containedValueChanged",{key:e,previousValue:o},n,this),i}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){const n=In.join(this.absolutePath,e),i=new Js(this.directory,this.runtime,this.serializer,n);return this.registerEventsOnSubDirectory(i,e),this._subdirectories.set(e,i),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",(n,i)=>{this.emit("subDirectoryCreated",In.join(t,n),i,this)}),e.on("subDirectoryDeleted",(n,i)=>{this.emit("subDirectoryDeleted",In.join(t,n),i,this)})}deleteSubDirectoryCore(e,t){const n=this._subdirectories.get(e);return void 0!==n&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(n),this.emit("subDirectoryDeleted",e,t,this)),n}disposeSubDirectoryTree(e){if(!e)return;const t=e.subdirectories();for(const[n,i]of t)this.disposeSubDirectoryTree(i);"function"==typeof e.dispose&&e.dispose()}undeleteSubDirectoryTree(e){for(const[t,n]of this._subdirectories.entries())this.undeleteSubDirectoryTree(n);e.undispose()}}class Gh{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){S(!1,202)}get(){var e=this;return(0,l.Z)(function*(){const t=yield e.runtime.IFluidHandleContext.resolveHandle({url:e.absolutePath});if(200===t.status&&"fluid/object"===t.mimeType)return t.value;throw new Error(`Failed to resolve container path ${e.absolutePath}`)})()}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}}const Jh=u=>function(){var e=(0,l.Z)(function*(t,n){const i=Un.create(t);if(0===i.pathParts.length)return n.IFluidHandleContext.resolveHandle({url:`/${u}${i.query}`,headers:t.headers})});return function(t,n){return e.apply(this,arguments)}}();class Ju extends Ms{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,S(void 0===this.runtime._dataObject,189),this.runtime._dataObject=this,this.innerHandle=new Cr(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",()=>{this._disposed=!0,this.dispose()})}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static getDataObject(e){return(0,l.Z)(function*(){const t=e._dataObject;return S(void 0!==t,188),yield t.finishInitialization(!0),t})()}request(e){var t=this;return(0,l.Z)(function*(){return function Qh(u,e){return""===e.url||"/"===e.url||e.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:u}:kn(e)}(t,e)})()}finishInitialization(e){var t=this;return(0,l.Z)(function*(){return void 0!==t.initializeP||(t.initializeP=t.initializeInternal(e)),t.initializeP})()}initializeInternal(e){var t=this;return(0,l.Z)(function*(){var n;yield t.preInitialize(),e?(S(void 0===t.initProps,190),yield t.initializingFromExisting()):yield t.initializingFirstTime(null!==(n=t.context.createProps)&&void 0!==n?n:t.initProps),yield t.hasInitialized()})()}getFluidObjectFromDirectory(e,t,n){return(0,l.Z)(function*(){const o=(n?n(e,t):t.get(e))?.IFluidHandle;if(o)return o.get()})()}getService(e){var t=this;return(0,l.Z)(function*(){return function Wh(u,e){return new Gh(u,e)}(`/_services/${e}`,t.context.containerRuntime).get()})()}preInitialize(){return(0,l.Z)(function*(){})()}initializingFirstTime(e){return(0,l.Z)(function*(){})()}initializingFromExisting(){return(0,l.Z)(function*(){})()}hasInitialized(){return(0,l.Z)(function*(){})()}dispose(){super.dispose()}}class Xh extends Ju{constructor(){super(...arguments),this.rootDirectoryId="root"}request(e){var t=()=>super.request,n=this;return(0,l.Z)(function*(){const i=Un.create(e);if("bigBlobs"===i.pathParts[0]){const h=n.root.get(i.pathParts.join("/"));return void 0===h?kn(i):{mimeType:"fluid/object",status:200,value:h}}return t().call(n,i)})()}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}initializeInternal(e){var t=()=>super.initializeInternal,n=this;return(0,l.Z)(function*(){e?(n.internalRoot=yield n.runtime.getChannel(n.rootDirectoryId),n.internalRoot.attributes.type===er.Type&&n.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(n.internalRoot=$s.create(n.runtime,n.rootDirectoryId),n.internalRoot.bindToContext()),yield t().call(n,e)})()}getUninitializedErrorString(e){return`${e} must be initialized before being accessed.`}}var Yh=v(3842);class ed{constructor(){this.handlers=[]}pushHandler(...e){void 0!==e&&this.handlers.push(...e)}handleRequest(e,t){var n=this;return(0,l.Z)(function*(){const i=Un.create(e);for(const o of n.handlers){const h=yield o(i,t);if(void 0!==h)return h}return kn(e)})()}}const Qu="IFluidDependencySynthesizer";class Qs{constructor(...e){this.providers=new Map,this.parents=e.filter(t=>void 0!==t)}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){const n={};return this.generateRequired(n,t),this.generateOptional(n,e),Object.defineProperty(n,Qu,{get:()=>this}),n}has(e,t){return!!this.providers.has(e)||!0!==t&&this.parents.some(n=>n.has(e))}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(const t of this.parents){if(t instanceof Qs)return t.getProvider(e);if(void 0!==t?.getProvider)return t.getProvider(e)}}}generateRequired(e,t){if(void 0!==t)for(const n of Object.keys(t)){const i=this.resolveProvider(n);if(void 0===i)throw new Error(`Object attempted to be created without registered required provider ${n}`);Object.defineProperty(e,n,i)}}generateOptional(e,t){var n;if(void 0!==t)for(const i of Object.keys(t)){const o=null!==(n=this.resolveProvider(i))&&void 0!==n?n:{get:function(){var h=(0,l.Z)(function*(){});return function(){return h.apply(this,arguments)}}()};Object.defineProperty(e,i,o)}}resolveProvider(e){const t=this.providers.get(e);if(void 0!==t)return"function"==typeof t?{get(){if(t&&"function"==typeof t)return Promise.resolve(this[Qu]).then(function(){var n=(0,l.Z)(function*(i){return t(i)});return function(i){return n.apply(this,arguments)}}()).then(n=>n?.[e])}}:{get(){if(t)return Promise.resolve(t).then(n=>{if(n)return n[e]})}};for(const n of this.parents){const o=n.synthesize({[e]:e},{}),h=Object.getOwnPropertyDescriptor(o,e);if(void 0!==h)return h}}}class nd{get IRuntimeFactory(){return this}instantiateRuntime(e,t){var n=this;return(0,l.Z)(function*(){const i=void 0===t?!0===e.existing:t,o=yield n.preInitialize(e,i);return i?yield n.instantiateFromExisting(o):yield n.instantiateFirstTime(o),yield n.hasInitialized(o),o})()}instantiateFirstTime(e){return(0,l.Z)(function*(){})()}instantiateFromExisting(e){return(0,l.Z)(function*(){})()}hasInitialized(e){return(0,l.Z)(function*(){})()}}class rd extends nd{constructor(e,t,n=[],i){super(),this.registryEntries=e,this.dependencyContainer=t,this.requestHandlers=n,this.runtimeOptions=i,this.registry=new Oi(e)}get IFluidDataStoreRegistry(){return this.registry}instantiateFirstTime(e){var t=this;return(0,l.Z)(function*(){yield t.containerInitializingFirstTime(e),yield t.containerHasInitialized(e)})()}instantiateFromExisting(e){var t=this;return(0,l.Z)(function*(){yield t.containerHasInitialized(e)})()}preInitialize(e,t){var n=this;return(0,l.Z)(function*(){const i=e.scope,o=new Qs(n.dependencyContainer,i.IFluidDependencySynthesizer);i.IFluidDependencySynthesizer=o;const h=yield ln.load(e,n.registryEntries,function td(...u){const e=new ed;return e.pushHandler(...u),function(){var t=(0,l.Z)(function*(n,i){return e.handleRequest(n,i)});return function(n,i){return t.apply(this,arguments)}}()}(...n.requestHandlers),n.runtimeOptions,i,t);return o.register(Yh.IContainerRuntime,h),h})()}containerInitializingFirstTime(e){return(0,l.Z)(function*(){})()}containerHasInitialized(e){return(0,l.Z)(function*(){})()}}class id{constructor(e,t,n,i,o){this.objectId=e,this._connected=t,this.submit=n,this.dirty=i,this.addedGCOutboundReference=o}get handler(){return S(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){S(void 0===this._handler,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,n){try{this.handler.process(e,t,n)}catch(i){throw Cn.wrapIfUnrecognized(i,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(void 0===this.handler.rollback)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}}class Xs{constructor(e,t,n,i){this.tree=e,this.storage=t,this.logger=n,this.extraBlobs=i,this.flattenedTree={},void 0!==e&&Xs.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,n){for(const i in t.trees)Xs.flattenTree(`${e}${i}/`,t.trees[i],n);for(const i in t.blobs)n[`${e}${i}`]=t.blobs[i]}contains(e){var t=this;return(0,l.Z)(function*(){return void 0!==t.flattenedTree[e]})()}readBlob(e){var t=this;return(0,l.Z)(function*(){const n=yield t.getIdForPath(e),i=void 0!==t.extraBlobs?t.extraBlobs.get(n):void 0;if(void 0!==i)return i;const o=t.storage.readBlob(n);return o.catch(h=>t.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},h)),o})()}list(e){var t=this;return(0,l.Z)(function*(){var n;let i=t.tree;const o=function Xu(u){let e=u;return e.startsWith("/")&&(e=e.substr(1)),e.endsWith("/")&&(e=e.substr(0,e.length-1)),e.length>0?e.split("/"):[]}(e);for(;void 0!==i&&o.length>0;){const h=o.shift();i=i.trees[h]}if(void 0===i||0!==o.length)throw new Error("path does not exist");return Object.keys(null!==(n=i?.blobs)&&void 0!==n?n:{})})()}getIdForPath(e){var t=this;return(0,l.Z)(function*(){return t.flattenedTree[e]})()}}const Ys=".attributes";function Do(u,e,t,n,i,o,h,w,D){return{deltaConnection:new id(u,e,(Q,Y)=>t(Q,Y),n,i),objectStorage:new Xs(w,o,h,D)}}function Yu(u,e=!1,t=!1,n){const i=u.getAttachSummary(e,t,n);return An(i,Ys,JSON.stringify(u.attributes)),i}function ec(u){return Po.apply(this,arguments)}function Po(){return Po=(0,l.Z)(function*(u,e=!1,t=!1,n){const i=yield u.summarize(e,t,n);return An(i,Ys,JSON.stringify(u.attributes)),i}),Po.apply(this,arguments)}class No{constructor(e,t,n,i){this.id=e,this.registry=t,this.runtime=n,this.servicesGetter=i,this.globallyVisible=!1,this.pending=[],S(!this.id.includes("/"),783)}getChannel(){var e=this;return(0,l.Z)(function*(){return S(void 0!==e.channel,519),e.channel})()}get isLoaded(){return void 0!==this.channel}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,n){S(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,n):(S(!1===t,393),this.pending.push(e))}reSubmit(e,t){S(this.isLoaded,394),S(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){S(this.isLoaded,750),S(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}summarize(e=!1,t=!1,n){var i=this;return(0,l.Z)(function*(){return S(i.isLoaded&&void 0!==i.channel,396),ec(i.channel,e,t,n)})()}getAttachSummary(e){return S(this.isLoaded&&void 0!==this.channel,397),Yu(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(S(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}getGCData(e=!1){var t=this;return(0,l.Z)(function*(){return S(t.isLoaded&&void 0!==t.channel,403),t.channel.getGCData(e)})()}updateUsedRoutes(e,t){}}class sd extends No{constructor(e,t,n,i,o,h,w,D,_,U){super(e,t,n,()=>this.services),this.snapshotTree=U;const Q=new Map,Y=_s()(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(Y,Q)&&this.sanitizeSnapshot(Y),this.services=new tt(()=>Do(this.id,i.connected,w,this.dirtyFn,_,o,h,Y,Q)),this.dirtyFn=()=>{D(e)}}getChannel(){var e=this;return(0,l.Z)(function*(){return void 0===e.channel&&(e.channel=yield e.loadChannel().catch(t=>{throw Cn.wrapIfUnrecognized(t,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)})),e.channel})()}loadChannel(){var e=this;return(0,l.Z)(function*(){S(!e.isLoaded,398),S(yield e.services.value.objectStorage.contains(".attributes"),400);const t=yield V(e.services.value.objectStorage,".attributes");if(S(void 0===e.factory,520),e.factory=e.registry.get(t.type),void 0===e.factory)throw new Error(`Channel Factory ${t.type} not registered`);const n=yield e.factory.load(e.runtime,e.id,e.services.value,t);e.channel=n;for(const i of e.pending)e.services.value.deltaConnection.process(i,!1,void 0);return e.channel})()}isSnapshotInOldFormatAndCollectBlobs(e,t){let n=!1;Object.entries(e.blobsContents).forEach(([o,h])=>{t.set(o,h),void 0!==e.blobs[o]&&(n=!0)});for(const o of Object.values(e.trees))n=n||this.isSnapshotInOldFormatAndCollectBlobs(o,t);return n}sanitizeSnapshot(e){const t=new Map(Object.entries(e.blobs));for(const[n,i]of t.entries())void 0===t.get(i)&&delete e.blobs[n];for(const n of Object.values(e.trees))this.sanitizeSnapshot(n)}}class ad extends No{constructor(e,t,n,i,o,h,w,D,_,U){if(super(e,t,i,()=>this.services),S(void 0!==n,521),this.factory=t.get(n),void 0===this.factory)throw new Error(`Channel Factory ${n} not registered`);this.channel=this.factory.create(i,e),this.services=new tt(()=>Do(this.id,o.connected,D,this.dirtyFn,U,h,w)),this.dirtyFn=()=>{_(e)}}}let tc=(()=>{class u{constructor(t,n,i,o,h,w,D,_,U,Q,Y,ye,Fe){var De=this;this.runtime=t,this.dataStoreContext=n,this.id=D,this.registry=U,this.attachMessageType=Fe,this.isLoaded=!1,this.pending=[],S(!this.id.includes("/"),784),this.subLogger=rt.create(this.runtime.logger,"RemoteChannelContext"),this.services=Do(this.id,this.dataStoreContext.connected,o,()=>h(this.id),w,i,this.subLogger,_,Q);const Ee=function(){var ke=(0,l.Z)(function*(ze,We,$e){return De.summarizeInternal(ze,We,$e)});return function(We,$e,dt){return ke.apply(this,arguments)}}();this.summarizerNode=Y(Ee,function(){var ke=(0,l.Z)(function*(ze){return De.getGCDataInternal(ze)});return function(ze){return ke.apply(this,arguments)}}(),(0,l.Z)(function*(){return ye()})),this.thresholdOpsCounter=new ui(u.pendingOpsCountThreshold,this.subLogger)}getChannel(){return void 0===this.channelP&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(t,n){this.isLoaded&&this.services.deltaConnection.setConnectionState(t)}applyStashedOp(t){return S(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(t)}processOp(t,n,i){this.summarizerNode.invalidate(t.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(t,n,i):(S(!n,405),S(void 0!==this.pending,574),this.pending.push(t),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(t,n){S(this.isLoaded,406),this.services.deltaConnection.reSubmit(t,n)}rollback(t,n){S(this.isLoaded,752),this.services.deltaConnection.rollback(t,n)}summarize(t=!1,n=!0,i){var o=this;return(0,l.Z)(function*(){return o.summarizerNode.summarize(t,n,i)})()}summarizeInternal(t,n,i){var o=this;return(0,l.Z)(function*(){const h=yield o.getChannel(),w=yield ec(h,t,n,i);return Object.assign(Object.assign({},w),{id:o.id})})()}loadChannel(){var t=this;return(0,l.Z)(function*(){let n,i;if(S(!t.isLoaded,407),(yield t.services.objectStorage.contains(Ys))&&(n=yield V(t.services.objectStorage,Ys)),void 0===n){if(void 0===t.attachMessageType)throw new zn("channelTypeNotAvailable",{channelId:{value:t.id,tag:Tt.PackageData},dataStoreId:{value:t.dataStoreContext.id,tag:Tt.PackageData},dataStorePackagePath:t.dataStoreContext.packagePath.join("/")});if(i=t.registry.get(t.attachMessageType),void 0===i)throw new zn("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:t.id,tag:Tt.PackageData},dataStoreId:{value:t.dataStoreContext.id,tag:Tt.PackageData},dataStorePackagePath:t.dataStoreContext.packagePath.join("/"),channelFactoryType:t.attachMessageType});n=i.attributes}else if(i=t.registry.get(n.type),void 0===i)throw new zn("channelFactoryNotRegisteredForGivenType",{channelId:{value:t.id,tag:Tt.PackageData},dataStoreId:{value:t.dataStoreContext.id,tag:Tt.PackageData},dataStorePackagePath:t.dataStoreContext.packagePath.join("/"),channelFactoryType:n.type});void 0!==n.snapshotFormatVersion&&n.snapshotFormatVersion!==i.attributes.snapshotFormatVersion&&t.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:n.type,tag:Tt.PackageData},channelSnapshotVersion:{value:`${n.snapshotFormatVersion}@${n.packageVersion}`,tag:Tt.PackageData},channelCodeVersion:{value:`${i.attributes.snapshotFormatVersion}@${i.attributes.packageVersion}`,tag:Tt.PackageData}});const o=yield i.load(t.runtime,t.id,t.services,n);S(void 0!==t.pending,575);for(const h of t.pending)t.services.deltaConnection.process(h,!1,void 0);return t.thresholdOpsCounter.send("ProcessPendingOps",t.pending.length),t.channel=o,t.pending=void 0,t.isLoaded=!0,t.services.deltaConnection.setConnectionState(t.dataStoreContext.connected),t.channel})()}getGCData(t=!1){var n=this;return(0,l.Z)(function*(){return n.summarizerNode.getGCData(t)})()}getGCDataInternal(t=!1){var n=this;return(0,l.Z)(function*(){return(yield n.getChannel()).getGCData(t)})()}updateUsedRoutes(t,n){this.summarizerNode.updateUsedRoutes([""])}}return u.pendingOpsCountThreshold=1e3,u})();var cr=(()=>(function(u){u.Attach="attach",u.ChannelOp="op"}(cr||(cr={})),cr))();class wi extends Ke{constructor(e,t,n){var i;super(),i=this,this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new jt,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,S(!e.id.includes("/"),782),this.logger=rt.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:Pe()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();const o=e.baseSnapshot;this.channelsBaseGCDetails=new Wn((0,l.Z)(function*(){var h,w,D;return os(yield null!==(D=null===(w=(h=i.dataStoreContext).getBaseGCDetails)||void 0===w?void 0:w.call(h))&&void 0!==D?D:i.dataStoreContext.getInitialGCSummaryDetails())})),void 0!==o?.trees&&Object.keys(o.trees).forEach(h=>{if("_search"===h)return;let w;e.isLocalDataStore?(w=new sd(h,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(_,U)=>this.submitChannelOp(h,_,U),_=>this.setChannelDirty(_),(_,U)=>this.addedGCOutboundReference(_,U),o.trees[h]),e.attachState!==we.Detached?w.makeVisible():this.localChannelContextQueue.set(h,w)):w=new tc(this,e,e.storage,(_,U)=>this.submitChannelOp(h,_,U),_=>this.setChannelDirty(_),(_,U)=>this.addedGCOutboundReference(_,U),h,o.trees[h],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(h,{type:be.CreateSummarizerNodeSource.FromSummary}),(0,l.Z)(function*(){return i.getChannelBaseGCDetails(h)}));const D=new jt;D.resolve(w),this.contexts.set(h,w),this.contextsDeferred.set(h,D)}),this.attachListener(),this.bindState=n?de.Bound:de.NotBound,this._attachState=e.attachState,this.visibilityState=n?e.attachState===we.Detached?be.VisibilityState.LocallyVisible:be.VisibilityState.GloballyVisible:be.VisibilityState.NotVisible,n&&this.deferredAttached.resolve()}static load(e,t,n){return new wi(e,t,n)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==we.Detached}get attachState(){return this._attachState}get absolutePath(){return Rr(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}resolveHandle(e){var t=this;return(0,l.Z)(function*(){return t.request(e)})()}request(e){var t=this;return(0,l.Z)(function*(){try{const n=Un.create(e),i=n.pathParts[0];if("_channels"===i||"_custom"===i)return t.request(n.createSubRequest(1));if(t.contextsDeferred.has(i)&&n.isLeaf(1))try{return{mimeType:"fluid/object",status:200,value:yield(yield t.contextsDeferred.get(i).promise).getChannel()}}catch(o){return t.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},o),gs(500,`Failed to get Channel: ${o}`,e)}return kn(e)}catch(n){return Br(n)}})()}getChannel(e){var t=this;return(0,l.Z)(function*(){return t.verifyNotClosed(),t.contextsDeferred.has(e)||t.contextsDeferred.set(e,new jt),yield(yield t.contextsDeferred.get(e).promise).getChannel()})()}createChannel(e=Pe(),t){if(e.includes("/"))throw new wt(`Id cannot contain slashes: ${e}`);this.verifyNotClosed(),S(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);const n=new ad(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(i,o)=>this.submitChannelOp(e,i,o),i=>this.setChannelDirty(i),(i,o)=>this.addedGCOutboundReference(i,o));if(this.contexts.set(e,n),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(n);else{const i=new jt;i.resolve(n),this.contextsDeferred.set(e,i)}return S(!!n.channel,378),n.channel}bindChannel(e){S(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached?this.attachChannel(e):this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===be.VisibilityState.NotVisible&&(this.visibilityState=be.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===de.NotBound&&(this.bindState=de.Binding,this.dataStoreContext.bindToContext(),this.bindState=de.Bound)}bind(e){this.visibilityState===be.VisibilityState.NotVisible?this.pendingHandlesToMakeVisible.add(e):e.attachGraph()}setConnectionState(e,t){this.verifyNotClosed();for(const[,n]of this.contexts)n.setConnectionState(e,t);Fi(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}uploadBlob(e){var t=this;return(0,l.Z)(function*(){return t.verifyNotClosed(),t.dataStoreContext.uploadBlob(e)})()}process(e,t,n){var i=this;this.verifyNotClosed();try{switch(e.type){case cr.Attach:{const o=e.contents,h=o.id;if(t)S(this.pendingAttach.has(h),380),this.pendingAttach.delete(h);else{S(!this.contexts.has(h),381);const w=new Map,D=Ht(o.snapshot.entries,w),_=new tc(this,this.dataStoreContext,this.dataStoreContext.storage,(U,Q)=>this.submitChannelOp(h,U,Q),U=>this.setChannelDirty(U),(U,Q)=>this.addedGCOutboundReference(U,Q),h,D,this.sharedObjectRegistry,w,this.dataStoreContext.getCreateChildSummarizerNodeFn(h,{type:be.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:o.snapshot}),(0,l.Z)(function*(){return i.getChannelBaseGCDetails(h)}),o.type);if(this.contexts.set(h,_),this.contextsDeferred.has(h))this.contextsDeferred.get(h).resolve(_);else{const U=new jt;U.resolve(_),this.contextsDeferred.set(h,U)}}break}case cr.ChannelOp:this.processChannelOp(e,t,n)}this.emit("op",e)}catch(o){throw Cn.wrapIfUnrecognized(o,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){const e=[];for(const[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}getGCData(e=!1){var t=this;return(0,l.Z)(function*(){const n=new Di;return yield Promise.all(Array.from(t.contexts).filter(([i,o])=>t.isChannelAttached(i)).map(function(){var i=(0,l.Z)(function*([o,h]){const w=yield h.getGCData(e);n.prefixAndAddNodes(o,w.gcNodes)});return function(o){return i.apply(this,arguments)}}())),t.updateGCNodes(n),n.getGCData()})()}updateUsedRoutes(e,t){var n;const i=us(e);for(const[o]of i)S(this.contexts.has(o),382);for(const[o,h]of this.contexts)h.updateUsedRoutes(null!==(n=i.get(o))&&void 0!==n?n:[],t)}addedGCOutboundReference(e,t){var n,i;null===(i=(n=this.dataStoreContext).addedGCOutboundReference)||void 0===i||i.call(n,e,t)}getChannelBaseGCDetails(e){var t=this;return(0,l.Z)(function*(){var n;let i=(yield t.channelsBaseGCDetails).get(e);return void 0===i?i={}:void 0!==(null===(n=i.gcData)||void 0===n?void 0:n.gcNodes)&&function ua(u,e){const t=Object.entries(u);for(const[n,i]of t){const o=new Set(i);o.delete(e),u[n]=[...o]}}(i.gcData.gcNodes,t.absolutePath),(void 0===i.usedRoutes||0===i.usedRoutes.length)&&(i.usedRoutes=[""]),i})()}summarize(e=!1,t=!0,n){var i=this;return(0,l.Z)(function*(){const o=new Mn;return yield Promise.all(Array.from(i.contexts).filter(([h,w])=>{const D=i.isChannelAttached(h);return S(D,383),D}).map(function(){var h=(0,l.Z)(function*([w,D]){const _=yield D.summarize(e,t,n);o.addWithStats(w,_)});return function(w){return h.apply(this,arguments)}}())),o.getSummaryTree()})()}getAttachSummary(e){this.attachGraph();const t=new Mn;for(const[n,i]of this.contexts){if(!(i instanceof No))throw new bt("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(n)){let o;if(i.isLoaded){const h=i.getAttachSummary(e);S(h.summary.type===Le.Tree,384),o={stats:h.stats,summary:h.summary}}else S(!!this.dataStoreContext.baseSnapshot,385),o=ti(this.dataStoreContext.baseSnapshot.trees[n]);t.addWithStats(n,o)}}return t.getSummaryTree()}submitMessage(e,t,n){this.submit(e,t,n)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}waitAttached(){var e=this;return(0,l.Z)(function*(){return e.deferredAttached.promise})()}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),S(this.isAttached,386),S(this.visibilityState===be.VisibilityState.GloballyVisible,720);const n=ni(Yu(e,!0,!1).summary),i={id:e.id,snapshot:n,type:e.attributes.type};this.pendingAttach.set(e.id,i),this.submit(cr.Attach,i),this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,n){this.submit(cr.ChannelOp,{address:e,contents:t},n)}submit(e,t,n){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,n)}reSubmit(e,t,n){switch(this.verifyNotClosed(),e){case cr.ChannelOp:{const i=t,o=this.contexts.get(i.address);S(!!o,387),o.reSubmit(i.contents,n);break}case cr.Attach:this.submit(e,t,n);break;default:En()}}rollback(e,t,n){switch(this.verifyNotClosed(),e){case cr.ChannelOp:{const i=t,o=this.contexts.get(i.address);S(!!o,749),o.rollback(i.contents,n);break}default:throw new bt(`Can't rollback ${e} message`)}}applyStashedOp(e){var t=this;return(0,l.Z)(function*(){const n=e,i=t.contexts.get(n.address);return S(!!i,388),yield i.getChannel(),i.applyStashedOp(n.contents)})()}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,n){this.verifyNotClosed();const i=e.contents,o=Object.assign(Object.assign({},e),{contents:i.contents}),h=this.contexts.get(i.address);return S(!!h,389),h.processOp(o,t,n),h}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",()=>{this.attachGraph(),this._attachState=we.Attaching,S(this.visibilityState===be.VisibilityState.LocallyVisible,721),this.visibilityState=be.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach(e=>{e.makeVisible()}),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")}),this.dataStoreContext.once("attached",()=>{S(this.visibilityState===be.VisibilityState.GloballyVisible,722),this._attachState=we.Attached,this.emit("attached")})}verifyNotClosed(){if(this._disposed)throw new bt("Runtime is closed")}}const od=(u,e=wi)=>class extends e{request(n){var i=()=>super.request,o=this;return(0,l.Z)(function*(){const h=yield i().call(o,n);return 404===h.status?u(n,o):h})()}};function nc(u,e,t,n,i,o,h){return Ro.apply(this,arguments)}function Ro(){return Ro=(0,l.Z)(function*(u,e,t,n,i,o,h){let w=i;w=od(function(){var ye=(0,l.Z)(function*(Fe,De){return(yield Ju.getDataObject(De)).request(Fe)});return function(Fe,De){return ye.apply(this,arguments)}}(),w);const D=new w(e,t,o),Y=new u({runtime:D,context:e,providers:new Qs(e.scope.IFluidDependencySynthesizer).synthesize(n,{}),initProps:h});return o||(yield Y.finishInitialization(o)),{instance:Y,runtime:D}}),Ro.apply(this,arguments)}class ud{constructor(e,t,n,i,o,h=wi){if(this.type=e,this.ctor=t,this.optionalProviders=i,this.runtimeClass=h,""===this.type)throw new Error("undefined type member");void 0!==o&&(this.registry=new Oi(o)),this.sharedObjectRegistry=new Map(n.map(w=>[w.type,w]))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}instantiateDataStore(e,t){var n=this;return(0,l.Z)(function*(){const{runtime:i}=yield nc(n.ctor,e,n.sharedObjectRegistry,n.optionalProviders,n.runtimeClass,t);return i})()}createChildInstance(e,t){var n=this;return(0,l.Z)(function*(){return n.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,n.type],t)})()}createPeerInstance(e,t){var n=this;return(0,l.Z)(function*(){return n.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)})()}createInstance(e,t){var n=this;return(0,l.Z)(function*(){return n.createNonRootInstanceCore(e,[n.type],t)})()}createRootInstance(e,t,n){var i=this;return(0,l.Z)(function*(){const o=t.createDetachedRootDataStore([i.type],e);return i.createInstanceCore(o,n)})()}createNonRootInstanceCore(e,t,n){var i=this;return(0,l.Z)(function*(){const o=e.createDetachedDataStore(t);return i.createInstanceCore(o,n)})()}createInstanceCore(e,t){var n=this;return(0,l.Z)(function*(){const{instance:i,runtime:o}=yield nc(n.ctor,e,n.sharedObjectRegistry,n.optionalProviders,n.runtimeClass,!1,t);return yield e.attachRuntime(n,o),i})()}}class cd extends ud{constructor(e,t,n=[],i,o,h=wi){const w=[...n];n.find(D=>D.type===ur.Type)||w.push($s.getFactory()),n.find(D=>D.type===er.Type)||w.push(Is.getFactory()),super(e,t,w,i,o,h)}}const rc=u=>void 0!==u?.factory,ic=u=>void 0!==u?.getFactory;class hd extends Xh{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get initialObjectsDir(){const e=this.root.getSubDirectory(this.initialObjectsDirKey);if(void 0===e)throw new Error("InitialObjects sub-directory was not initialized");return e}initializingFirstTime(e){var t=this;return(0,l.Z)(function*(){t.root.createSubDirectory(t.initialObjectsDirKey);const n=[];Object.entries(e.initialObjects).forEach(([i,o])=>{const h=function(){var w=(0,l.Z)(function*(){const D=yield t.create(o);t.initialObjectsDir.set(i,D.handle)});return function(){return w.apply(this,arguments)}}();n.push(h())}),yield Promise.all(n)})()}hasInitialized(){var e=this;return(0,l.Z)(function*(){const t=[];for(const[n,i]of Array.from(e.initialObjectsDir.entries())){const o=function(){var h=(0,l.Z)(function*(){const w=yield i.get();Object.assign(e._initialObjects,{[n]:w})});return function(){return h.apply(this,arguments)}}();t.push(o())}yield Promise.all(t)})()}get initialObjects(){if(0===Object.keys(this._initialObjects).length)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}create(e){var t=this;return(0,l.Z)(function*(){if(rc(e))return t.createDataObject(e);if(ic(e))return t.createSharedObject(e);throw new Error("Could not create new Fluid object because an unknown object was passed")})()}createDataObject(e){var t=this;return(0,l.Z)(function*(){const i=[...t.context.packagePath,e.factory.type];return jr(yield t.context.containerRuntime.createDataStore(i),"/")})()}createSharedObject(e){const t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}}const sc="rootDOId";class dd extends rd{constructor(e){const[t,n]=(u=>{var e;const t=new Set,n=new Set;if(new Set([...Object.values(u.initialObjects),...null!==(e=u.dynamicObjectTypes)&&void 0!==e?e:[]]).forEach(h=>{if(ic(h))n.add(h.getFactory());else{if(!rc(h))throw new Error("Entry is neither a DataObject or a SharedObject");t.add([h.factory.type,Promise.resolve(h.factory)])}}),0===t.size&&0===n.size)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(t),Array.from(n)]})(e),i=new cd("rootDO",hd,n,{},t);super([i.registryEntry],void 0,[Jh(sc)],{flushMode:be.FlushMode.Immediate}),this.rootDataObjectFactory=i,this.initialObjects=e.initialObjects}containerInitializingFirstTime(e){var t=this;return(0,l.Z)(function*(){yield t.rootDataObjectFactory.createRootInstance(sc,e,{initialObjects:t.initialObjects})})()}}class fd extends Ke{constructor(e){super(),this.container=e,this.lastMembers=new Map,this.audience=e.audience,this.getMembers(),this.audience.on("addMember",(t,n)=>{if(this.shouldIncludeAsMember(n)){const i=this.getMember(t);this.emit("memberAdded",t,i),this.emit("membersChanged")}}),this.audience.on("removeMember",t=>{this.lastMembers.has(t)&&(this.emit("memberRemoved",t,this.lastMembers.get(t)),this.emit("membersChanged"))}),this.container.on("connected",()=>this.emit("membersChanged"))}getMembers(){const e=new Map,t=new Map;return this.audience.getMembers().forEach((n,i)=>{if(this.shouldIncludeAsMember(n)){const o=n.user.id;let h=e.get(o);void 0===h&&(h=this.createServiceMember(n),e.set(o,h)),h.connections.push({id:i,mode:n.mode}),t.set(i,h)}}),this.lastMembers=t,e}getMyself(){const e=this.container.clientId;if(void 0!==e)return this.getMember(e)}getMember(e){const t=this.audience.getMember(e);if(void 0===t)return;const i=this.getMembers().get(t?.user.id);if(void 0===i)throw Error(`Attempted to fetch client ${e} that is not part of the current member list`);return i}shouldIncludeAsMember(e){return e.details.capabilities.interactive}}class pd extends fd{createServiceMember(e){const t=e.user;return S(void 0!==t&&"string"==typeof t.name,787),{userId:t.id,userName:t.name,connections:[]}}}class gd{constructor(e){var t,n,i,o;this.props=e;const h=new Uh;this.urlResolver=new Lh(null===(n=null===(t=this.props)||void 0===t?void 0:t.connection)||void 0===n?void 0:n.port,null===(o=null===(i=this.props)||void 0===i?void 0:i.connection)||void 0===o?void 0:o.domain),this.documentServiceFactory=new Mh(h)}createContainer(e){var t=this;return(0,l.Z)(function*(){const i=yield t.createLoader(e).createDetachedContainer({package:"no-dynamic-package",config:{}}),o=yield jr(i,"/");return{container:new class extends Vu{attach(){var D=this;return(0,l.Z)(function*(){if(D.attachState!==we.Detached)throw new Error("Cannot attach container. Container is not in detached state");const _={url:"",headers:{[fr.createNew]:!0}};yield i.attach(_);const U=i.resolvedUrl;return ar(U),U.id})()}}(i,o),services:t.getContainerServices(i)}})()}getContainer(e,t){var n=this;return(0,l.Z)(function*(){const o=yield n.createLoader(t).resolve({url:e}),h=yield jr(o,"/");return{container:new Vu(o,h),services:n.getContainerServices(o)}})()}getContainerServices(e){return{audience:new pd(e)}}createLoader(e){var t;const n=new dd(e),o={load:function(){var w=(0,l.Z)(function*(){return{module:{fluidExport:n},details:{package:"no-dynamic-package",config:{}}}});return function(){return w.apply(this,arguments)}}()};return new nl({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:o,logger:null===(t=this.props)||void 0===t?void 0:t.logger})}}const Io=[{language:"javascript",version:"16.3.0",aliases:["node-javascript","node-js","javascript","js"],runtime:"node"},{language:"dart",version:"2.12.1",aliases:[]},{language:"csharp.net",version:"5.0.201",aliases:["csharp","c#","cs","c#.net","cs.net","c#-dotnet","cs-dotnet","csharp-dotnet","dotnet-c#","dotnet-cs","dotnet-csharp"],runtime:"dotnet"},{language:"c",version:"10.2.0",aliases:["gcc"],runtime:"gcc"},{language:"c++",version:"10.2.0",aliases:["cpp","g++"],runtime:"gcc"},{language:"go",version:"1.16.2",aliases:["go","golang"]},{language:"java",version:"15.0.2",aliases:[]},{language:"kotlin",version:"1.4.31",aliases:["kt"]},{language:"csharp",version:"6.12.0",aliases:["mono","mono-csharp","mono-c#","mono-cs","c#","cs"],runtime:"mono"},{language:"php",version:"8.0.2",aliases:["php8","html"]},{language:"python2",version:"2.7.18",aliases:["py2","python2"]},{language:"python",version:"3.10.0",aliases:["py","py3","python3","python3.10"]},{language:"ruby",version:"3.0.1",aliases:["ruby3","rb"]},{language:"rust",version:"1.65.0",aliases:["rs"]},{language:"scala",version:"3.0.0",aliases:["sc"]},{language:"sqlite3",editorLang:"sql",version:"3.36.0",aliases:["sqlite","sql"]},{language:"swift",version:"5.3.3",aliases:["swift"]},{language:"typescript",version:"4.2.3",aliases:["ts","node-ts","tsc"]}],ac={theme:"vs-dark",language:Io[0].language,automaticLayout:!0,fontSize:16,zoom:.56};var Oe=v(4650),ea=v(333),ts=v(433),md=v(4968);const vd=["editorContainer"],Oo=new Oe.OlP("NGX_MONACO_EDITOR_CONFIG");let uc,oc=!1,yd=(()=>{class u{constructor(t){this.config=t,this.onInit=new Oe.vpe,this._insideNg=!1}set insideNg(t){this._insideNg=t,this._editor&&(this._editor.dispose(),this.initMonaco(this._options,this.insideNg))}get insideNg(){return this._insideNg}ngAfterViewInit(){oc?uc.then(()=>{this.initMonaco(this._options,this.insideNg)}):(oc=!0,uc=new Promise(t=>{const n=this.config.baseUrl||"./assets";if("object"==typeof window.monaco)return this.initMonaco(this._options,this.insideNg),void t();const i=()=>{window.require.config({paths:{vs:`${n}/monaco/min/vs`}}),window.require(["vs/editor/editor.main"],()=>{"function"==typeof this.config.onMonacoLoad&&this.config.onMonacoLoad(),this.initMonaco(this._options,this.insideNg),t()})};if(window.require)i();else{const o=document.createElement("script");o.type="text/javascript",o.src=`${n}/monaco/min/vs/loader.js`,o.addEventListener("load",i),document.body.appendChild(o)}}))}ngOnDestroy(){this._windowResizeSubscription&&this._windowResizeSubscription.unsubscribe(),this._editor&&(this._editor.dispose(),this._editor=void 0)}}return u.\u0275fac=function(t){return new(t||u)(Oe.Y36(Oo))},u.\u0275cmp=Oe.Xpm({type:u,selectors:[["ng-component"]],viewQuery:function(t,n){if(1&t&&Oe.Gf(vd,7),2&t){let i;Oe.iGM(i=Oe.CRH())&&(n._editorContainer=i.first)}},inputs:{insideNg:"insideNg"},outputs:{onInit:"onInit"},decls:0,vars:0,template:function(t,n){},encapsulation:2}),u})(),cc=(()=>{class u extends yd{constructor(t,n){super(n),this.zone=t,this.editorConfig=n,this._value="",this.propagateChange=i=>{},this.onTouched=()=>{}}set options(t){this._options=Object.assign({},this.config.defaultOptions,t),this._editor&&(this._editor.dispose(),this.initMonaco(t,this.insideNg))}get options(){return this._options}set model(t){this.options.model=t,this._editor&&(this._editor.dispose(),this.initMonaco(this.options,this.insideNg))}writeValue(t){this._value=t||"",setTimeout(()=>{this._editor&&!this.options.model&&this._editor.setValue(this._value)})}registerOnChange(t){this.propagateChange=t}registerOnTouched(t){this.onTouched=t}initMonaco(t,n){const i=!!t.model;if(i){const o=monaco.editor.getModel(t.model.uri||"");o?(t.model=o,t.model.setValue(this._value)):t.model=monaco.editor.createModel(t.model.value,t.model.language,t.model.uri)}n?this._editor=monaco.editor.create(this._editorContainer.nativeElement,t):this.zone.runOutsideAngular(()=>{this._editor=monaco.editor.create(this._editorContainer.nativeElement,t)}),i||this._editor.setValue(this._value),this._editor.onDidChangeModelContent(o=>{const h=this._editor.getValue();this.zone.run(()=>{this.propagateChange(h),this._value=h})}),this._editor.onDidBlurEditorWidget(()=>{this.onTouched()}),this._windowResizeSubscription&&this._windowResizeSubscription.unsubscribe(),this._windowResizeSubscription=(0,md.R)(window,"resize").subscribe(()=>this._editor.layout()),this.onInit.emit(this._editor)}}return u.\u0275fac=function(t){return new(t||u)(Oe.Y36(Oe.R0b),Oe.Y36(Oo))},u.\u0275cmp=Oe.Xpm({type:u,selectors:[["ngx-monaco-editor"]],inputs:{options:"options",model:"model"},features:[Oe._Bn([{provide:ts.JU,useExisting:(0,Oe.Gpc)(()=>u),multi:!0}]),Oe.qOj],decls:2,vars:0,consts:[[1,"editor-container"],["editorContainer",""]],template:function(t,n){1&t&&Oe._UZ(0,"div",0,1)},styles:["[_nghost-%COMP%]{display:block;height:200px}.editor-container[_ngcontent-%COMP%]{width:100%;height:98%}"]}),u})(),bd=(()=>{class u{static forRoot(t={}){return{ngModule:u,providers:[{provide:Oo,useValue:t}]}}}return u.\u0275fac=function(t){return new(t||u)},u.\u0275mod=Oe.oAB({type:u}),u.\u0275inj=Oe.cJS({imports:[B.ez]}),u})();var lc=v(1102),ta=v(3679),hc=v(6616),dc=v(7044),fc=v(1664),pc=v(1971);const Sd=["monacoEditor"];function xd(u,e){if(1&u&&(Oe.TgZ(0,"p",14)(1,"span",15),Oe._uU(2,"---RESET---"),Oe.qZA(),Oe._uU(3),Oe.qZA()),2&u){const t=e.$implicit;Oe.MGl("ngClass","",null!=t&&t.stderr?"danger":"success"," "),Oe.xp6(3),Oe.hij(" ",(null==t?null:t.stderr)||(null==t?null:t.output)," ")}}let wd=(()=>{class u{constructor(t,n,i){this.interviewService=t,this.aRouter=n,this.router=i,this.code="",this.supportedLanguages=Io,this.preferredLanguage="0",this.editorOptions=ac,this.runningCode=!1,this.executedCodes=[],this.containerId=""}ngOnInit(){var t=this;return(0,l.Z)(function*(){t.aRouter.queryParamMap.subscribe(n=>{t.containerId=n?.get("editorId")}),t.sharedRealTimeCode=yield t.getFluidData(),t.syncCodeData()})()}ngAfterViewInit(){this.preferredLanguageInfo=this.supportedLanguages[0]}ngOnDestroy(){this.sharedRealTimeCode?.off("valueChanged",this.updateRealTimeCode),this.sharedRealTimeCode?.off("valueChanged",this.changeEditorType),this.sharedRealTimeCode?.off("valueChanged",this.updateSelectionEvent)}getFluidData(){var t=this;return(0,l.Z)(function*(){const i=new gd,o={initialObjects:{sharedRealTimeCode:Is}};let h;if(t.containerId)({container:h}=yield i.getContainer(t.containerId,o));else{({container:h}=yield i.createContainer(o));const w=yield h.attach();t.router.navigate([],{relativeTo:t.aRouter,queryParams:{editorId:w}})}return h.initialObjects.sharedRealTimeCode})()}syncCodeData(){this.sharedRealTimeCode&&(this.updateRealTimeCode=(t,n)=>{if("code"==t?.key){console.log("Firing updateRealTimeCode");const i=this.sharedRealTimeCode.get("code")||this.code;console.log(i,t?.previousValue),i!=t?.previousValue&&(this.code=i)}},this.changeEditorType=(t,n)=>{if("getCodeType"==t?.key&&!n){console.log("Firing changeEditorType");const i=this.sharedRealTimeCode.get("getCodeType")||this.preferredLanguage;this.preferredLanguage=i,this.setCodeType(this.preferredLanguage)}},this.updateSelectionEvent=(t,n)=>{if("setSelection"==t?.key&&!n){console.log("Firing updateSelectionEvent");const i=this.sharedRealTimeCode?.get("setSelection")||this.setSelection;i&&(this.setSelection=JSON.parse(i),this.monacoEditor?._editor?.focus(),this.monacoEditor?._editor?.setSelection(this.setSelection))}},this.updateRealTimeCode(),this.changeEditorType(),this.updateSelectionEvent(),this.sharedRealTimeCode.on("valueChanged",this.updateRealTimeCode),this.sharedRealTimeCode.on("valueChanged",this.changeEditorType),this.sharedRealTimeCode.on("valueChanged",this.updateSelectionEvent))}onCodeChange(t){this.sharedRealTimeCode?.set("code",t)}updateCodeType(t){this.sharedRealTimeCode?.set("getCodeType",t)}updateSelection(){this.sharedRealTimeCode?.set("setSelection",JSON.stringify(this.monacoEditor?._editor?.getSelection()))}setCodeType(t){this.preferredLanguageInfo=this.supportedLanguages[t];const n=this.preferredLanguageInfo?.editorLang||this.preferredLanguageInfo?.language;let i=this.monacoEditor?._editor?.getModel();i&&monaco.editor.setModelLanguage(i,n)}runCode(){const t={language:this.preferredLanguageInfo?.language,version:this.preferredLanguageInfo?.version,files:[{content:this.code}]};this.runningCode=!this.runningCode,this.interviewService.executeCode(t).subscribe(n=>{this.runningCode=!this.runningCode,this.executedCodes.push(n.run)})}}return u.\u0275fac=function(t){return new(t||u)(Oe.Y36(ea.nm),Oe.Y36(M.gz),Oe.Y36(M.F0))},u.\u0275cmp=Oe.Xpm({type:u,selectors:[["app-panel"]],viewQuery:function(t,n){if(1&t&&Oe.Gf(Sd,5),2&t){let i;Oe.iGM(i=Oe.CRH())&&(n.monacoEditor=i.first)}},decls:18,vars:5,consts:[["nz-col",""],["nz-row","","nzJustify","center","nzAlign","middle",1,"inner-content"],["nz-col","",3,"nzSpan"],["nz-row","","nzJustify","center"],["nz-row","","nzJustify","center",2,"height","100vh"],["nz-col","","nzFlex","4"],[2,"height","100%",3,"options","ngModel","click","ngModelChange"],["monacoEditor",""],["nz-col","","nzFlex","2"],[1,"code-output"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"run-code"],["nz-button","","nzType","primary",3,"nzLoading","click"],["nz-icon","","nzType","right-circle"],[3,"ngClass"],[1,"reset"]],template:function(t,n){1&t&&(Oe.TgZ(0,"div",0)(1,"div",1)(2,"div",2),Oe._UZ(3,"div",3),Oe.TgZ(4,"nz-card")(5,"div",4)(6,"div",5)(7,"ngx-monaco-editor",6,7),Oe.NdJ("click",function(){return n.updateSelection()})("ngModelChange",function(o){return n.onCodeChange(o)})("ngModelChange",function(o){return n.code=o}),Oe.qZA()(),Oe.TgZ(9,"div",8)(10,"div",9)(11,"pre"),Oe._uU(12,'Welcome to the Ninja Coder Playground \u{1f44b}\n\nReady! Get started by editing the code on the\nleft side of the screen and clicking "Run code"\n                        '),Oe.qZA(),Oe.YNc(13,xd,4,2,"p",10),Oe.qZA()(),Oe.TgZ(14,"div",11)(15,"button",12),Oe.NdJ("click",function(){return n.runCode()}),Oe._UZ(16,"span",13),Oe._uU(17," Run code! "),Oe.qZA()()()()()()()),2&t&&(Oe.xp6(2),Oe.Q6J("nzSpan",24),Oe.xp6(5),Oe.Q6J("options",n.editorOptions)("ngModel",n.code),Oe.xp6(6),Oe.Q6J("ngForOf",null==n.executedCodes?null:n.executedCodes.reverse()),Oe.xp6(2),Oe.Q6J("nzLoading",n.runningCode))},dependencies:[B.mk,B.sg,cc,ts.JJ,ts.On,lc.Ls,ta.t3,ta.SK,hc.ix,dc.w,fc.dQ,pc.bd],styles:[".code-output[_ngcontent-%COMP%]{background-color:#000;color:#fff;padding:10px;overflow-y:auto;margin:0;cursor:text;height:100vh;font-size:16px;overflow:auto}.run-code[_ngcontent-%COMP%]{position:absolute;bottom:15%;right:35%}.run-code[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#000000de;background-color:#00bcb4;border-color:transparent}nz-select[_ngcontent-%COMP%]{width:200px}.danger[_ngcontent-%COMP%]{color:#ef233c}.success[_ngcontent-%COMP%]{color:#02c39a}.reset[_ngcontent-%COMP%]{font-size:14px;color:#5f6570;display:block}"]}),u})();const Cd=["monacoEditor"],Ed=[{path:"",children:[{path:"",component:wd},{path:"with-pubnub",component:(()=>{class u{constructor(t,n,i,o){this.commonService=t,this.interviewService=n,this.aRouter=i,this.router=o,this.editorOptions=ac,this.executedCodes=[],this.supportedLanguages=Io,this.code="",this.runningCode=!1,this.userId="",this.containerId=""}ngOnInit(){this.aRouter.queryParamMap.subscribe(t=>{this.containerId=t.get("editorId")||this.commonService.getUniqueId(5)})}ngAfterViewInit(){this.router.navigate([],{relativeTo:this.aRouter,queryParams:{editorId:this.containerId}}),this.preferredLanguageInfo=this.supportedLanguages[0],this.initPubNub()}initPubNub(){this.userId=this.commonService.getUniqueId(5),console.log("userId: ",this.userId),this.pubNubInstance=new PubNub({publishKey:"pub-c-17cc7797-8ba3-4d73-8f4a-44761d3f8064",subscribeKey:"sub-c-5dfc70dc-82d8-11ec-9f2b-a2cedba671e8",userId:this.userId}),this.pubNubInstance.addListener({status:n=>{"PNConnectedCategory"===n.category&&console.log("Connected")},message:n=>{switch(n?.channel){case`${this.containerId}_codeChange`:this.updateCode(n);break;case`${this.containerId}_updateSelection`:this.setSelection(n)}},presence:n=>{}}),this.pubNubInstance.subscribe({channels:[`${this.containerId}_codeChange`,`${this.containerId}_updateSelection`]})}onCodeChange(t){var n=this;return(0,l.Z)(function*(){console.log(t),yield n.pubNubInstance.publish({channel:`${n.containerId}_codeChange`,message:t,sendByPost:!0})})()}updateSelection(){var t=this;return(0,l.Z)(function*(){t.monacoEditor?._editor?.getSelection()})()}updateCode(t){t?.message!=this.code&&t?.publisher!=this.userId&&(this.code=t?.message)}setSelection(t){t?.publisher!=this.userId&&(this.setSelection=t?.message,this.monacoEditor?._editor?.focus(),this.monacoEditor?._editor?.setSelection(this.setSelection))}runCode(){const t={language:this.preferredLanguageInfo?.language,version:this.preferredLanguageInfo?.version,files:[{content:this.code}]};this.runningCode=!this.runningCode,this.interviewService.executeCode(t).subscribe(n=>{this.runningCode=!this.runningCode,this.executedCodes.push(n.run)})}}return u.\u0275fac=function(t){return new(t||u)(Oe.Y36(ea.v_),Oe.Y36(ea.nm),Oe.Y36(M.gz),Oe.Y36(M.F0))},u.\u0275cmp=Oe.Xpm({type:u,selectors:[["app-panel-pubnub"]],viewQuery:function(t,n){if(1&t&&Oe.Gf(Cd,5),2&t){let i;Oe.iGM(i=Oe.CRH())&&(n.monacoEditor=i.first)}},decls:13,vars:4,consts:[["nz-col",""],["nz-row","","nzJustify","center","nzAlign","middle",1,"inner-content"],["nz-col","",3,"nzSpan"],["nz-row","","nzJustify","center"],["nz-row","","nzJustify","center",2,"height","100vh"],["nz-col","","nzFlex","4"],[2,"height","100%",3,"options","ngModel","contextmenu","click","ngModelChange"],["monacoEditor",""],[1,"run-code"],["nz-button","","nzType","primary",3,"nzLoading","click"],["nz-icon","","nzType","right-circle"]],template:function(t,n){1&t&&(Oe.TgZ(0,"div",0)(1,"div",1)(2,"div",2),Oe._UZ(3,"div",3),Oe.TgZ(4,"nz-card")(5,"div",4)(6,"div",5)(7,"ngx-monaco-editor",6,7),Oe.NdJ("contextmenu",function(){return n.updateSelection()})("click",function(){return n.updateSelection()})("ngModelChange",function(o){return n.onCodeChange(o)})("ngModelChange",function(o){return n.code=o}),Oe.qZA()(),Oe.TgZ(9,"div",8)(10,"button",9),Oe.NdJ("click",function(){return n.runCode()}),Oe._UZ(11,"span",10),Oe._uU(12," Run code! "),Oe.qZA()()()()()()()),2&t&&(Oe.xp6(2),Oe.Q6J("nzSpan",24),Oe.xp6(5),Oe.Q6J("options",n.editorOptions)("ngModel",n.code),Oe.xp6(3),Oe.Q6J("nzLoading",n.runningCode))},dependencies:[cc,ts.JJ,ts.On,lc.Ls,ta.t3,ta.SK,hc.ix,dc.w,fc.dQ,pc.bd],styles:[".code-output[_ngcontent-%COMP%]{background-color:#000;color:#fff;padding:10px;overflow-y:auto;margin:0;cursor:text;height:100vh;font-size:16px;overflow:auto}.run-code[_ngcontent-%COMP%]{position:absolute;bottom:15%;right:35%}.run-code[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#000000de;background-color:#00bcb4;border-color:transparent}nz-select[_ngcontent-%COMP%]{width:200px}.danger[_ngcontent-%COMP%]{color:#ef233c}.success[_ngcontent-%COMP%]{color:#02c39a}.reset[_ngcontent-%COMP%]{font-size:14px;color:#5f6570;display:block}"]}),u})()}]}];let Ad=(()=>{class u{}return u.\u0275fac=function(t){return new(t||u)},u.\u0275mod=Oe.oAB({type:u}),u.\u0275inj=Oe.cJS({imports:[M.Bz.forChild(Ed),M.Bz]}),u})(),Td=(()=>{class u{}return u.\u0275fac=function(t){return new(t||u)},u.\u0275mod=Oe.oAB({type:u}),u.\u0275inj=Oe.cJS({imports:[B.ez,Ad,bd.forRoot(),ea.m8]}),u})()},552:H=>{"use strict";const{AbortController:q,AbortSignal:v}=typeof self<"u"?self:typeof window<"u"?window:void 0;H.exports=q,H.exports.AbortSignal=v,H.exports.default=q},3014:(H,q,v)=>{H.exports=v(7114)},7729:(H,q,v)=>{"use strict";var R=v(4701),B=v(858),M=v(5738),l=v(1625),E=v(5215),k=v(2099),z=v(6100),S=v(5593),K=v(5867),X=v(1413);H.exports=function(ae){return new Promise(function(V,Te){var se,Ie=ae.data,Me=ae.headers,Be=ae.responseType;function ge(){ae.cancelToken&&ae.cancelToken.unsubscribe(se),ae.signal&&ae.signal.removeEventListener("abort",se)}R.isFormData(Ie)&&delete Me["Content-Type"];var te=new XMLHttpRequest;if(ae.auth){var pe=ae.auth.username||"",Ae=ae.auth.password?unescape(encodeURIComponent(ae.auth.password)):"";Me.Authorization="Basic "+btoa(pe+":"+Ae)}var ue=E(ae.baseURL,ae.url);function he(){if(te){var Pe="getAllResponseHeaders"in te?k(te.getAllResponseHeaders()):null;B(function(be){V(be),ge()},function(be){Te(be),ge()},{data:Be&&"text"!==Be&&"json"!==Be?te.response:te.responseText,status:te.status,statusText:te.statusText,headers:Pe,config:ae,request:te}),te=null}}if(te.open(ae.method.toUpperCase(),l(ue,ae.params,ae.paramsSerializer),!0),te.timeout=ae.timeout,"onloadend"in te?te.onloadend=he:te.onreadystatechange=function(){!te||4!==te.readyState||0===te.status&&(!te.responseURL||0!==te.responseURL.indexOf("file:"))||setTimeout(he)},te.onabort=function(){te&&(Te(S("Request aborted",ae,"ECONNABORTED",te)),te=null)},te.onerror=function(){Te(S("Network Error",ae,null,te)),te=null},te.ontimeout=function(){var we=ae.timeout?"timeout of "+ae.timeout+"ms exceeded":"timeout exceeded";ae.timeoutErrorMessage&&(we=ae.timeoutErrorMessage),Te(S(we,ae,(ae.transitional||K).clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",te)),te=null},R.isStandardBrowserEnv()){var ie=(ae.withCredentials||z(ue))&&ae.xsrfCookieName?M.read(ae.xsrfCookieName):void 0;ie&&(Me[ae.xsrfHeaderName]=ie)}"setRequestHeader"in te&&R.forEach(Me,function(we,de){typeof Ie>"u"&&"content-type"===de.toLowerCase()?delete Me[de]:te.setRequestHeader(de,we)}),R.isUndefined(ae.withCredentials)||(te.withCredentials=!!ae.withCredentials),Be&&"json"!==Be&&(te.responseType=ae.responseType),"function"==typeof ae.onDownloadProgress&&te.addEventListener("progress",ae.onDownloadProgress),"function"==typeof ae.onUploadProgress&&te.upload&&te.upload.addEventListener("progress",ae.onUploadProgress),(ae.cancelToken||ae.signal)&&(se=function(Pe){te&&(Te(!Pe||Pe&&Pe.type?new X("canceled"):Pe),te.abort(),te=null)},ae.cancelToken&&ae.cancelToken.subscribe(se),ae.signal&&(ae.signal.aborted?se():ae.signal.addEventListener("abort",se))),Ie||(Ie=null),te.send(Ie)})}},7114:(H,q,v)=>{"use strict";var R=v(4701),B=v(2414),M=v(6490),l=v(2971),z=function k(S){var K=new M(S),X=B(M.prototype.request,K);return R.extend(X,M.prototype,K),R.extend(X,K),X.create=function(ae){return k(l(S,ae))},X}(v(4498));z.Axios=M,z.Cancel=v(1413),z.CancelToken=v(3056),z.isCancel=v(8827),z.VERSION=v(1773).version,z.all=function(K){return Promise.all(K)},z.spread=v(9211),z.isAxiosError=v(4603),H.exports=z,H.exports.default=z},1413:H=>{"use strict";function q(v){this.message=v}q.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},q.prototype.__CANCEL__=!0,H.exports=q},3056:(H,q,v)=>{"use strict";var R=v(1413);function B(M){if("function"!=typeof M)throw new TypeError("executor must be a function.");var l;this.promise=new Promise(function(z){l=z});var E=this;this.promise.then(function(k){if(E._listeners){var z,S=E._listeners.length;for(z=0;z<S;z++)E._listeners[z](k);E._listeners=null}}),this.promise.then=function(k){var z,S=new Promise(function(K){E.subscribe(K),z=K}).then(k);return S.cancel=function(){E.unsubscribe(z)},S},M(function(z){E.reason||(E.reason=new R(z),l(E.reason))})}B.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},B.prototype.subscribe=function(l){this.reason?l(this.reason):this._listeners?this._listeners.push(l):this._listeners=[l]},B.prototype.unsubscribe=function(l){if(this._listeners){var E=this._listeners.indexOf(l);-1!==E&&this._listeners.splice(E,1)}},B.source=function(){var l;return{token:new B(function(z){l=z}),cancel:l}},H.exports=B},8827:H=>{"use strict";H.exports=function(v){return!(!v||!v.__CANCEL__)}},6490:(H,q,v)=>{"use strict";var R=v(4701),B=v(1625),M=v(607),l=v(957),E=v(2971),k=v(4828),z=k.validators;function S(K){this.defaults=K,this.interceptors={request:new M,response:new M}}S.prototype.request=function(X,ne){"string"==typeof X?(ne=ne||{}).url=X:ne=X||{},(ne=E(this.defaults,ne)).method=ne.method?ne.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var ae=ne.transitional;void 0!==ae&&k.assertOptions(ae,{silentJSONParsing:z.transitional(z.boolean),forcedJSONParsing:z.transitional(z.boolean),clarifyTimeoutError:z.transitional(z.boolean)},!1);var ce=[],V=!0;this.interceptors.request.forEach(function(pe){"function"==typeof pe.runWhen&&!1===pe.runWhen(ne)||(V=V&&pe.synchronous,ce.unshift(pe.fulfilled,pe.rejected))});var Ie,Te=[];if(this.interceptors.response.forEach(function(pe){Te.push(pe.fulfilled,pe.rejected)}),!V){var Me=[l,void 0];for(Array.prototype.unshift.apply(Me,ce),Me=Me.concat(Te),Ie=Promise.resolve(ne);Me.length;)Ie=Ie.then(Me.shift(),Me.shift());return Ie}for(var Be=ne;ce.length;){var se=ce.shift(),ge=ce.shift();try{Be=se(Be)}catch(te){ge(te);break}}try{Ie=l(Be)}catch(te){return Promise.reject(te)}for(;Te.length;)Ie=Ie.then(Te.shift(),Te.shift());return Ie},S.prototype.getUri=function(X){return X=E(this.defaults,X),B(X.url,X.params,X.paramsSerializer).replace(/^\?/,"")},R.forEach(["delete","get","head","options"],function(X){S.prototype[X]=function(ne,ae){return this.request(E(ae||{},{method:X,url:ne,data:(ae||{}).data}))}}),R.forEach(["post","put","patch"],function(X){S.prototype[X]=function(ne,ae,ce){return this.request(E(ce||{},{method:X,url:ne,data:ae}))}}),H.exports=S},607:(H,q,v)=>{"use strict";var R=v(4701);function B(){this.handlers=[]}B.prototype.use=function(l,E,k){return this.handlers.push({fulfilled:l,rejected:E,synchronous:!!k&&k.synchronous,runWhen:k?k.runWhen:null}),this.handlers.length-1},B.prototype.eject=function(l){this.handlers[l]&&(this.handlers[l]=null)},B.prototype.forEach=function(l){R.forEach(this.handlers,function(k){null!==k&&l(k)})},H.exports=B},5215:(H,q,v)=>{"use strict";var R=v(8692),B=v(4554);H.exports=function(l,E){return l&&!R(E)?B(l,E):E}},5593:(H,q,v)=>{"use strict";var R=v(5124);H.exports=function(M,l,E,k,z){var S=new Error(M);return R(S,l,E,k,z)}},957:(H,q,v)=>{"use strict";var R=v(4701),B=v(5134),M=v(8827),l=v(4498),E=v(1413);function k(z){if(z.cancelToken&&z.cancelToken.throwIfRequested(),z.signal&&z.signal.aborted)throw new E("canceled")}H.exports=function(S){return k(S),S.headers=S.headers||{},S.data=B.call(S,S.data,S.headers,S.transformRequest),S.headers=R.merge(S.headers.common||{},S.headers[S.method]||{},S.headers),R.forEach(["delete","get","head","post","put","patch","common"],function(ne){delete S.headers[ne]}),(S.adapter||l.adapter)(S).then(function(ne){return k(S),ne.data=B.call(S,ne.data,ne.headers,S.transformResponse),ne},function(ne){return M(ne)||(k(S),ne&&ne.response&&(ne.response.data=B.call(S,ne.response.data,ne.response.headers,S.transformResponse))),Promise.reject(ne)})}},5124:H=>{"use strict";H.exports=function(v,R,B,M,l){return v.config=R,B&&(v.code=B),v.request=M,v.response=l,v.isAxiosError=!0,v.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},v}},2971:(H,q,v)=>{"use strict";var R=v(4701);H.exports=function(M,l){l=l||{};var E={};function k(ae,ce){return R.isPlainObject(ae)&&R.isPlainObject(ce)?R.merge(ae,ce):R.isPlainObject(ce)?R.merge({},ce):R.isArray(ce)?ce.slice():ce}function z(ae){return R.isUndefined(l[ae])?R.isUndefined(M[ae])?void 0:k(void 0,M[ae]):k(M[ae],l[ae])}function S(ae){if(!R.isUndefined(l[ae]))return k(void 0,l[ae])}function K(ae){return R.isUndefined(l[ae])?R.isUndefined(M[ae])?void 0:k(void 0,M[ae]):k(void 0,l[ae])}function X(ae){return ae in l?k(M[ae],l[ae]):ae in M?k(void 0,M[ae]):void 0}var ne={url:S,method:S,data:S,baseURL:K,transformRequest:K,transformResponse:K,paramsSerializer:K,timeout:K,timeoutMessage:K,withCredentials:K,adapter:K,responseType:K,xsrfCookieName:K,xsrfHeaderName:K,onUploadProgress:K,onDownloadProgress:K,decompress:K,maxContentLength:K,maxBodyLength:K,transport:K,httpAgent:K,httpsAgent:K,cancelToken:K,socketPath:K,responseEncoding:K,validateStatus:X};return R.forEach(Object.keys(M).concat(Object.keys(l)),function(ce){var V=ne[ce]||z,Te=V(ce);R.isUndefined(Te)&&V!==X||(E[ce]=Te)}),E}},858:(H,q,v)=>{"use strict";var R=v(5593);H.exports=function(M,l,E){var k=E.config.validateStatus;E.status&&k&&!k(E.status)?l(R("Request failed with status code "+E.status,E.config,null,E.request,E)):M(E)}},5134:(H,q,v)=>{"use strict";var R=v(4701),B=v(4498);H.exports=function(l,E,k){var z=this||B;return R.forEach(k,function(K){l=K.call(z,l,E)}),l}},4498:(H,q,v)=>{"use strict";var R=v(4701),B=v(5620),M=v(5124),l=v(5867),E={"Content-Type":"application/x-www-form-urlencoded"};function k(X,ne){!R.isUndefined(X)&&R.isUndefined(X["Content-Type"])&&(X["Content-Type"]=ne)}var K={transitional:l,adapter:function z(){var X;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&"[object process]"===Object.prototype.toString.call(process))&&(X=v(7729)),X}(),transformRequest:[function(ne,ae){return B(ae,"Accept"),B(ae,"Content-Type"),R.isFormData(ne)||R.isArrayBuffer(ne)||R.isBuffer(ne)||R.isStream(ne)||R.isFile(ne)||R.isBlob(ne)?ne:R.isArrayBufferView(ne)?ne.buffer:R.isURLSearchParams(ne)?(k(ae,"application/x-www-form-urlencoded;charset=utf-8"),ne.toString()):R.isObject(ne)||ae&&"application/json"===ae["Content-Type"]?(k(ae,"application/json"),function S(X,ne,ae){if(R.isString(X))try{return(ne||JSON.parse)(X),R.trim(X)}catch(ce){if("SyntaxError"!==ce.name)throw ce}return(ae||JSON.stringify)(X)}(ne)):ne}],transformResponse:[function(ne){var ae=this.transitional||K.transitional,Te=!(ae&&ae.silentJSONParsing)&&"json"===this.responseType;if(Te||ae&&ae.forcedJSONParsing&&R.isString(ne)&&ne.length)try{return JSON.parse(ne)}catch(Ie){if(Te)throw"SyntaxError"===Ie.name?M(Ie,this,"E_JSON_PARSE"):Ie}return ne}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(ne){return ne>=200&&ne<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};R.forEach(["delete","get","head"],function(ne){K.headers[ne]={}}),R.forEach(["post","put","patch"],function(ne){K.headers[ne]=R.merge(E)}),H.exports=K},5867:H=>{"use strict";H.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},1773:H=>{H.exports={version:"0.26.1"}},2414:H=>{"use strict";H.exports=function(v,R){return function(){for(var M=new Array(arguments.length),l=0;l<M.length;l++)M[l]=arguments[l];return v.apply(R,M)}}},1625:(H,q,v)=>{"use strict";var R=v(4701);function B(M){return encodeURIComponent(M).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}H.exports=function(l,E,k){if(!E)return l;var z;if(k)z=k(E);else if(R.isURLSearchParams(E))z=E.toString();else{var S=[];R.forEach(E,function(ne,ae){null===ne||typeof ne>"u"||(R.isArray(ne)?ae+="[]":ne=[ne],R.forEach(ne,function(V){R.isDate(V)?V=V.toISOString():R.isObject(V)&&(V=JSON.stringify(V)),S.push(B(ae)+"="+B(V))}))}),z=S.join("&")}if(z){var K=l.indexOf("#");-1!==K&&(l=l.slice(0,K)),l+=(-1===l.indexOf("?")?"?":"&")+z}return l}},4554:H=>{"use strict";H.exports=function(v,R){return R?v.replace(/\/+$/,"")+"/"+R.replace(/^\/+/,""):v}},5738:(H,q,v)=>{"use strict";var R=v(4701);H.exports=R.isStandardBrowserEnv()?{write:function(l,E,k,z,S,K){var X=[];X.push(l+"="+encodeURIComponent(E)),R.isNumber(k)&&X.push("expires="+new Date(k).toGMTString()),R.isString(z)&&X.push("path="+z),R.isString(S)&&X.push("domain="+S),!0===K&&X.push("secure"),document.cookie=X.join("; ")},read:function(l){var E=document.cookie.match(new RegExp("(^|;\\s*)("+l+")=([^;]*)"));return E?decodeURIComponent(E[3]):null},remove:function(l){this.write(l,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},8692:H=>{"use strict";H.exports=function(v){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(v)}},4603:(H,q,v)=>{"use strict";var R=v(4701);H.exports=function(M){return R.isObject(M)&&!0===M.isAxiosError}},6100:(H,q,v)=>{"use strict";var R=v(4701);H.exports=R.isStandardBrowserEnv()?function(){var E,M=/(msie|trident)/i.test(navigator.userAgent),l=document.createElement("a");function k(z){var S=z;return M&&(l.setAttribute("href",S),S=l.href),l.setAttribute("href",S),{href:l.href,protocol:l.protocol?l.protocol.replace(/:$/,""):"",host:l.host,search:l.search?l.search.replace(/^\?/,""):"",hash:l.hash?l.hash.replace(/^#/,""):"",hostname:l.hostname,port:l.port,pathname:"/"===l.pathname.charAt(0)?l.pathname:"/"+l.pathname}}return E=k(window.location.href),function(S){var K=R.isString(S)?k(S):S;return K.protocol===E.protocol&&K.host===E.host}}():function(){return!0}},5620:(H,q,v)=>{"use strict";var R=v(4701);H.exports=function(M,l){R.forEach(M,function(k,z){z!==l&&z.toUpperCase()===l.toUpperCase()&&(M[l]=k,delete M[z])})}},2099:(H,q,v)=>{"use strict";var R=v(4701),B=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];H.exports=function(l){var k,z,S,E={};return l&&R.forEach(l.split("\n"),function(X){if(S=X.indexOf(":"),k=R.trim(X.substr(0,S)).toLowerCase(),z=R.trim(X.substr(S+1)),k){if(E[k]&&B.indexOf(k)>=0)return;E[k]="set-cookie"===k?(E[k]?E[k]:[]).concat([z]):E[k]?E[k]+", "+z:z}}),E}},9211:H=>{"use strict";H.exports=function(v){return function(B){return v.apply(null,B)}}},4828:(H,q,v)=>{"use strict";var R=v(1773).version,B={};["object","boolean","number","function","string","symbol"].forEach(function(E,k){B[E]=function(S){return typeof S===E||"a"+(k<1?"n ":" ")+E}});var M={};B.transitional=function(k,z,S){function K(X,ne){return"[Axios v"+R+"] Transitional option '"+X+"'"+ne+(S?". "+S:"")}return function(X,ne,ae){if(!1===k)throw new Error(K(ne," has been removed"+(z?" in "+z:"")));return z&&!M[ne]&&(M[ne]=!0,console.warn(K(ne," has been deprecated since v"+z+" and will be removed in the near future"))),!k||k(X,ne,ae)}},H.exports={assertOptions:function l(E,k,z){if("object"!=typeof E)throw new TypeError("options must be an object");for(var S=Object.keys(E),K=S.length;K-- >0;){var X=S[K],ne=k[X];if(ne){var ae=E[X],ce=void 0===ae||ne(ae,X,E);if(!0!==ce)throw new TypeError("option "+X+" must be "+ce)}else if(!0!==z)throw Error("Unknown option "+X)}},validators:B}},4701:(H,q,v)=>{"use strict";var R=v(2414),B=Object.prototype.toString;function M(he){return Array.isArray(he)}function l(he){return typeof he>"u"}function k(he){return"[object ArrayBuffer]"===B.call(he)}function ne(he){return null!==he&&"object"==typeof he}function ae(he){if("[object Object]"!==B.call(he))return!1;var ie=Object.getPrototypeOf(he);return null===ie||ie===Object.prototype}function Ie(he){return"[object Function]"===B.call(he)}function te(he,ie){if(!(null===he||typeof he>"u"))if("object"!=typeof he&&(he=[he]),M(he))for(var Pe=0,we=he.length;Pe<we;Pe++)ie.call(null,he[Pe],Pe,he);else for(var de in he)Object.prototype.hasOwnProperty.call(he,de)&&ie.call(null,he[de],de,he)}H.exports={isArray:M,isArrayBuffer:k,isBuffer:function E(he){return null!==he&&!l(he)&&null!==he.constructor&&!l(he.constructor)&&"function"==typeof he.constructor.isBuffer&&he.constructor.isBuffer(he)},isFormData:function z(he){return"[object FormData]"===B.call(he)},isArrayBufferView:function S(he){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(he):he&&he.buffer&&k(he.buffer)},isString:function K(he){return"string"==typeof he},isNumber:function X(he){return"number"==typeof he},isObject:ne,isPlainObject:ae,isUndefined:l,isDate:function ce(he){return"[object Date]"===B.call(he)},isFile:function V(he){return"[object File]"===B.call(he)},isBlob:function Te(he){return"[object Blob]"===B.call(he)},isFunction:Ie,isStream:function Me(he){return ne(he)&&Ie(he.pipe)},isURLSearchParams:function Be(he){return"[object URLSearchParams]"===B.call(he)},isStandardBrowserEnv:function ge(){return(!(typeof navigator<"u")||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&typeof window<"u"&&typeof document<"u"},forEach:te,merge:function pe(){var he={};function ie(de,ve){he[ve]=ae(he[ve])&&ae(de)?pe(he[ve],de):ae(de)?pe({},de):M(de)?de.slice():de}for(var Pe=0,we=arguments.length;Pe<we;Pe++)te(arguments[Pe],ie);return he},extend:function Ae(he,ie,Pe){return te(ie,function(de,ve){he[ve]=Pe&&"function"==typeof de?R(de,Pe):de}),he},trim:function se(he){return he.trim?he.trim():he.replace(/^\s+|\s+$/g,"")},stripBOM:function ue(he){return 65279===he.charCodeAt(0)&&(he=he.slice(1)),he}}},5343:(H,q)=>{"use strict";q.byteLength=function z(ce){var V=k(ce),Ie=V[1];return 3*(V[0]+Ie)/4-Ie},q.toByteArray=function K(ce){var V,te,Te=k(ce),Ie=Te[0],Me=Te[1],Be=new B(function S(ce,V,Te){return 3*(V+Te)/4-Te}(0,Ie,Me)),se=0,ge=Me>0?Ie-4:Ie;for(te=0;te<ge;te+=4)V=R[ce.charCodeAt(te)]<<18|R[ce.charCodeAt(te+1)]<<12|R[ce.charCodeAt(te+2)]<<6|R[ce.charCodeAt(te+3)],Be[se++]=V>>16&255,Be[se++]=V>>8&255,Be[se++]=255&V;return 2===Me&&(V=R[ce.charCodeAt(te)]<<2|R[ce.charCodeAt(te+1)]>>4,Be[se++]=255&V),1===Me&&(V=R[ce.charCodeAt(te)]<<10|R[ce.charCodeAt(te+1)]<<4|R[ce.charCodeAt(te+2)]>>2,Be[se++]=V>>8&255,Be[se++]=255&V),Be},q.fromByteArray=function ae(ce){for(var V,Te=ce.length,Ie=Te%3,Me=[],se=0,ge=Te-Ie;se<ge;se+=16383)Me.push(ne(ce,se,se+16383>ge?ge:se+16383));return 1===Ie?Me.push(v[(V=ce[Te-1])>>2]+v[V<<4&63]+"=="):2===Ie&&Me.push(v[(V=(ce[Te-2]<<8)+ce[Te-1])>>10]+v[V>>4&63]+v[V<<2&63]+"="),Me.join("")};for(var v=[],R=[],B=typeof Uint8Array<"u"?Uint8Array:Array,M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,E=M.length;l<E;++l)v[l]=M[l],R[M.charCodeAt(l)]=l;function k(ce){var V=ce.length;if(V%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var Te=ce.indexOf("=");return-1===Te&&(Te=V),[Te,Te===V?0:4-Te%4]}function X(ce){return v[ce>>18&63]+v[ce>>12&63]+v[ce>>6&63]+v[63&ce]}function ne(ce,V,Te){for(var Me=[],Be=V;Be<Te;Be+=3)Me.push(X((ce[Be]<<16&16711680)+(ce[Be+1]<<8&65280)+(255&ce[Be+2])));return Me.join("")}R["-".charCodeAt(0)]=62,R["_".charCodeAt(0)]=63},8472:function(H,q){var M,v=typeof self<"u"?self:this,R=function(){function M(){this.fetch=!1,this.DOMException=v.DOMException}return M.prototype=v,new M}();M=R,function(E){var k={searchParams:"URLSearchParams"in M,iterable:"Symbol"in M&&"iterator"in Symbol,blob:"FileReader"in M&&"Blob"in M&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in M,arrayBuffer:"ArrayBuffer"in M};if(k.arrayBuffer)var S=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],K=ArrayBuffer.isView||function(de){return de&&S.indexOf(Object.prototype.toString.call(de))>-1};function X(de){if("string"!=typeof de&&(de=String(de)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(de))throw new TypeError("Invalid character in header field name");return de.toLowerCase()}function ne(de){return"string"!=typeof de&&(de=String(de)),de}function ae(de){var ve={next:function(){var be=de.shift();return{done:void 0===be,value:be}}};return k.iterable&&(ve[Symbol.iterator]=function(){return ve}),ve}function ce(de){this.map={},de instanceof ce?de.forEach(function(ve,be){this.append(be,ve)},this):Array.isArray(de)?de.forEach(function(ve){this.append(ve[0],ve[1])},this):de&&Object.getOwnPropertyNames(de).forEach(function(ve){this.append(ve,de[ve])},this)}function V(de){if(de.bodyUsed)return Promise.reject(new TypeError("Already read"));de.bodyUsed=!0}function Te(de){return new Promise(function(ve,be){de.onload=function(){ve(de.result)},de.onerror=function(){be(de.error)}})}function Ie(de){var ve=new FileReader,be=Te(ve);return ve.readAsArrayBuffer(de),be}function se(de){if(de.slice)return de.slice(0);var ve=new Uint8Array(de.byteLength);return ve.set(new Uint8Array(de)),ve.buffer}function ge(){return this.bodyUsed=!1,this._initBody=function(de){this._bodyInit=de,de?"string"==typeof de?this._bodyText=de:k.blob&&Blob.prototype.isPrototypeOf(de)?this._bodyBlob=de:k.formData&&FormData.prototype.isPrototypeOf(de)?this._bodyFormData=de:k.searchParams&&URLSearchParams.prototype.isPrototypeOf(de)?this._bodyText=de.toString():k.arrayBuffer&&k.blob&&function z(de){return de&&DataView.prototype.isPrototypeOf(de)}(de)?(this._bodyArrayBuffer=se(de.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):k.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(de)||K(de))?this._bodyArrayBuffer=se(de):this._bodyText=de=Object.prototype.toString.call(de):this._bodyText="",this.headers.get("content-type")||("string"==typeof de?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):k.searchParams&&URLSearchParams.prototype.isPrototypeOf(de)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},k.blob&&(this.blob=function(){var de=V(this);if(de)return de;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?V(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(Ie)}),this.text=function(){var de=V(this);if(de)return de;if(this._bodyBlob)return function Me(de){var ve=new FileReader,be=Te(ve);return ve.readAsText(de),be}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function Be(de){for(var ve=new Uint8Array(de),be=new Array(ve.length),at=0;at<ve.length;at++)be[at]=String.fromCharCode(ve[at]);return be.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},k.formData&&(this.formData=function(){return this.text().then(ue)}),this.json=function(){return this.text().then(JSON.parse)},this}ce.prototype.append=function(de,ve){de=X(de),ve=ne(ve);var be=this.map[de];this.map[de]=be?be+", "+ve:ve},ce.prototype.delete=function(de){delete this.map[X(de)]},ce.prototype.get=function(de){return de=X(de),this.has(de)?this.map[de]:null},ce.prototype.has=function(de){return this.map.hasOwnProperty(X(de))},ce.prototype.set=function(de,ve){this.map[X(de)]=ne(ve)},ce.prototype.forEach=function(de,ve){for(var be in this.map)this.map.hasOwnProperty(be)&&de.call(ve,this.map[be],be,this)},ce.prototype.keys=function(){var de=[];return this.forEach(function(ve,be){de.push(be)}),ae(de)},ce.prototype.values=function(){var de=[];return this.forEach(function(ve){de.push(ve)}),ae(de)},ce.prototype.entries=function(){var de=[];return this.forEach(function(ve,be){de.push([be,ve])}),ae(de)},k.iterable&&(ce.prototype[Symbol.iterator]=ce.prototype.entries);var te=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Ae(de,ve){var be=(ve=ve||{}).body;if(de instanceof Ae){if(de.bodyUsed)throw new TypeError("Already read");this.url=de.url,this.credentials=de.credentials,ve.headers||(this.headers=new ce(de.headers)),this.method=de.method,this.mode=de.mode,this.signal=de.signal,!be&&null!=de._bodyInit&&(be=de._bodyInit,de.bodyUsed=!0)}else this.url=String(de);if(this.credentials=ve.credentials||this.credentials||"same-origin",(ve.headers||!this.headers)&&(this.headers=new ce(ve.headers)),this.method=function pe(de){var ve=de.toUpperCase();return te.indexOf(ve)>-1?ve:de}(ve.method||this.method||"GET"),this.mode=ve.mode||this.mode||null,this.signal=ve.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&be)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(be)}function ue(de){var ve=new FormData;return de.trim().split("&").forEach(function(be){if(be){var at=be.split("="),Ke=at.shift().replace(/\+/g," "),Je=at.join("=").replace(/\+/g," ");ve.append(decodeURIComponent(Ke),decodeURIComponent(Je))}}),ve}function he(de){var ve=new ce;return de.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(at){var Ke=at.split(":"),Je=Ke.shift().trim();if(Je){var Ut=Ke.join(":").trim();ve.append(Je,Ut)}}),ve}function ie(de,ve){ve||(ve={}),this.type="default",this.status=void 0===ve.status?200:ve.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in ve?ve.statusText:"OK",this.headers=new ce(ve.headers),this.url=ve.url||"",this._initBody(de)}Ae.prototype.clone=function(){return new Ae(this,{body:this._bodyInit})},ge.call(Ae.prototype),ge.call(ie.prototype),ie.prototype.clone=function(){return new ie(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new ce(this.headers),url:this.url})},ie.error=function(){var de=new ie(null,{status:0,statusText:""});return de.type="error",de};var Pe=[301,302,303,307,308];ie.redirect=function(de,ve){if(-1===Pe.indexOf(ve))throw new RangeError("Invalid status code");return new ie(null,{status:ve,headers:{location:de}})},E.DOMException=M.DOMException;try{new E.DOMException}catch{E.DOMException=function(ve,be){this.message=ve,this.name=be;var at=Error(ve);this.stack=at.stack},E.DOMException.prototype=Object.create(Error.prototype),E.DOMException.prototype.constructor=E.DOMException}function we(de,ve){return new Promise(function(be,at){var Ke=new Ae(de,ve);if(Ke.signal&&Ke.signal.aborted)return at(new E.DOMException("Aborted","AbortError"));var Je=new XMLHttpRequest;function Ut(){Je.abort()}Je.onload=function(){var _e={status:Je.status,statusText:Je.statusText,headers:he(Je.getAllResponseHeaders()||"")};_e.url="responseURL"in Je?Je.responseURL:_e.headers.get("X-Request-URL"),be(new ie("response"in Je?Je.response:Je.responseText,_e))},Je.onerror=function(){at(new TypeError("Network request failed"))},Je.ontimeout=function(){at(new TypeError("Network request failed"))},Je.onabort=function(){at(new E.DOMException("Aborted","AbortError"))},Je.open(Ke.method,Ke.url,!0),"include"===Ke.credentials?Je.withCredentials=!0:"omit"===Ke.credentials&&(Je.withCredentials=!1),"responseType"in Je&&k.blob&&(Je.responseType="blob"),Ke.headers.forEach(function(_e,je){Je.setRequestHeader(je,_e)}),Ke.signal&&(Ke.signal.addEventListener("abort",Ut),Je.onreadystatechange=function(){4===Je.readyState&&Ke.signal.removeEventListener("abort",Ut)}),Je.send(typeof Ke._bodyInit>"u"?null:Ke._bodyInit)})}we.polyfill=!0,M.fetch||(M.fetch=we,M.Headers=ce,M.Request=Ae,M.Response=ie),E.Headers=ce,E.Request=Ae,E.Response=ie,E.fetch=we,Object.defineProperty(E,"__esModule",{value:!0})}({}),R.fetch.ponyfill=!0,delete R.fetch.polyfill;var B=R;(q=B.fetch).default=B.fetch,q.fetch=B.fetch,q.Headers=B.Headers,q.Request=B.Request,q.Response=B.Response,H.exports=q},1455:(H,q,v)=>{q.formatArgs=function B(z){if(z[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+z[0]+(this.useColors?"%c ":" ")+"+"+H.exports.humanize(this.diff),!this.useColors)return;const S="color: "+this.color;z.splice(1,0,S,"color: inherit");let K=0,X=0;z[0].replace(/%[a-zA-Z%]/g,ne=>{"%%"!==ne&&(K++,"%c"===ne&&(X=K))}),z.splice(X,0,S)},q.save=function M(z){try{z?q.storage.setItem("debug",z):q.storage.removeItem("debug")}catch{}},q.load=function l(){let z;try{z=q.storage.getItem("debug")}catch{}return!z&&typeof process<"u"&&"env"in process&&(z=process.env.DEBUG),z},q.useColors=function R(){return!(!(typeof window<"u"&&window.process)||"renderer"!==window.process.type&&!window.process.__nwjs)||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},q.storage=function E(){try{return localStorage}catch{}}(),q.destroy=(()=>{let z=!1;return()=>{z||(z=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),q.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],q.log=console.debug||console.log||(()=>{}),H.exports=v(3283)(q);const{formatters:k}=H.exports;k.j=function(z){try{return JSON.stringify(z)}catch(S){return"[UnexpectedJSONParseError]: "+S.message}}},3283:(H,q,v)=>{H.exports=function R(B){function l(ae){let ce,Te,Ie,V=null;function Me(...Be){if(!Me.enabled)return;const se=Me,ge=Number(new Date);se.diff=ge-(ce||ge),se.prev=ce,se.curr=ge,ce=ge,Be[0]=l.coerce(Be[0]),"string"!=typeof Be[0]&&Be.unshift("%O");let pe=0;Be[0]=Be[0].replace(/%([a-zA-Z%])/g,(ue,he)=>{if("%%"===ue)return"%";pe++;const ie=l.formatters[he];return"function"==typeof ie&&(ue=ie.call(se,Be[pe]),Be.splice(pe,1),pe--),ue}),l.formatArgs.call(se,Be),(se.log||l.log).apply(se,Be)}return Me.namespace=ae,Me.useColors=l.useColors(),Me.color=l.selectColor(ae),Me.extend=E,Me.destroy=l.destroy,Object.defineProperty(Me,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==V?V:(Te!==l.namespaces&&(Te=l.namespaces,Ie=l.enabled(ae)),Ie),set:Be=>{V=Be}}),"function"==typeof l.init&&l.init(Me),Me}function E(ae,ce){const V=l(this.namespace+(typeof ce>"u"?":":ce)+ae);return V.log=this.log,V}function K(ae){return ae.toString().substring(2,ae.toString().length-2).replace(/\.\*\?$/,"*")}return l.debug=l,l.default=l,l.coerce=function X(ae){return ae instanceof Error?ae.stack||ae.message:ae},l.disable=function z(){const ae=[...l.names.map(K),...l.skips.map(K).map(ce=>"-"+ce)].join(",");return l.enable(""),ae},l.enable=function k(ae){let ce;l.save(ae),l.namespaces=ae,l.names=[],l.skips=[];const V=("string"==typeof ae?ae:"").split(/[\s,]+/),Te=V.length;for(ce=0;ce<Te;ce++)V[ce]&&("-"===(ae=V[ce].replace(/\*/g,".*?"))[0]?l.skips.push(new RegExp("^"+ae.slice(1)+"$")):l.names.push(new RegExp("^"+ae+"$")))},l.enabled=function S(ae){if("*"===ae[ae.length-1])return!0;let ce,V;for(ce=0,V=l.skips.length;ce<V;ce++)if(l.skips[ce].test(ae))return!1;for(ce=0,V=l.names.length;ce<V;ce++)if(l.names[ce].test(ae))return!0;return!1},l.humanize=v(4366),l.destroy=function ne(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(B).forEach(ae=>{l[ae]=B[ae]}),l.names=[],l.skips=[],l.formatters={},l.selectColor=function M(ae){let ce=0;for(let V=0;V<ae.length;V++)ce=(ce<<5)-ce+ae.charCodeAt(V),ce|=0;return l.colors[Math.abs(ce)%l.colors.length]},l.enable(l.load()),l}},2429:H=>{"use strict";function q(l){if(this._capacity=M(l),this._length=0,this._front=0,v(l)){for(var E=l.length,k=0;k<E;++k)this[k]=l[k];this._length=E}}q.prototype.toArray=function(){for(var E=this._length,k=new Array(E),z=this._front,S=this._capacity,K=0;K<E;++K)k[K]=this[z+K&S-1];return k},q.prototype.push=function(E){var k=arguments.length,z=this._length;if(k>1){var S=this._capacity;if(z+k>S){for(var X=0;X<k;++X)this._checkCapacity(z+1),this[K=this._front+z&this._capacity-1]=arguments[X],z++,this._length=z;return z}var K=this._front;for(X=0;X<k;++X)this[K+z&S-1]=arguments[X],K++;return this._length=z+k,z+k}return 0===k?z:(this._checkCapacity(z+1),this[X=this._front+z&this._capacity-1]=E,this._length=z+1,z+1)},q.prototype.pop=function(){var E=this._length;if(0!==E){var k=this._front+E-1&this._capacity-1,z=this[k];return this[k]=void 0,this._length=E-1,z}},q.prototype.shift=function(){var E=this._length;if(0!==E){var k=this._front,z=this[k];return this[k]=void 0,this._front=k+1&this._capacity-1,this._length=E-1,z}},q.prototype.unshift=function(E){var k=this._length,z=arguments.length;if(z>1){if(k+z>(X=this._capacity)){for(var ne=z-1;ne>=0;ne--){var X;this._checkCapacity(k+1),this[S=(this._front-1&(X=this._capacity)-1^X)-X]=arguments[ne],k++,this._length=k,this._front=S}return k}var K=this._front;for(ne=z-1;ne>=0;ne--){var S;this[S=(K-1&X-1^X)-X]=arguments[ne],K=S}return this._front=K,this._length=k+z,k+z}return 0===z?k:(this._checkCapacity(k+1),this[ne=(this._front-1&(X=this._capacity)-1^X)-X]=E,this._length=k+1,this._front=ne,k+1)},q.prototype.peekBack=function(){var E=this._length;if(0!==E)return this[this._front+E-1&this._capacity-1]},q.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},q.prototype.get=function(E){var k=E;if(k===(0|k)){var z=this._length;if(k<0&&(k+=z),!(k<0||k>=z))return this[this._front+k&this._capacity-1]}},q.prototype.isEmpty=function(){return 0===this._length},q.prototype.clear=function(){for(var E=this._length,k=this._front,z=this._capacity,S=0;S<E;++S)this[k+S&z-1]=void 0;this._length=0,this._front=0},q.prototype.valueOf=q.prototype.toString=function(){return this.toArray().toString()},q.prototype.removeFront=q.prototype.shift,q.prototype.removeBack=q.prototype.pop,q.prototype.insertFront=q.prototype.unshift,q.prototype.insertBack=q.prototype.push,q.prototype.enqueue=q.prototype.push,q.prototype.dequeue=q.prototype.shift,q.prototype.toJSON=q.prototype.toArray,Object.defineProperty(q.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),q.prototype._checkCapacity=function(E){this._capacity<E&&this._resizeTo(M(1.5*this._capacity+16))},q.prototype._resizeTo=function(E){var k=this._capacity;this._capacity=E;var z=this._front,S=this._length;z+S>k&&function R(l,E,k,z,S){for(var K=0;K<S;++K)k[K+z]=l[K+E],l[K+E]=void 0}(this,0,this,k,z+S&k-1)};var v=Array.isArray;function M(l){if("number"!=typeof l){if(!v(l))return 16;l=l.length}return function B(l){return l>>>=0,l-=1,l|=l>>1,l|=l>>2,l|=l>>4,1+((l|=l>>8)|l>>16)}(Math.min(Math.max(16,l),1073741824))}H.exports=q},9069:H=>{"use strict";var R,q="object"==typeof Reflect?Reflect:null,v=q&&"function"==typeof q.apply?q.apply:function(ge,te,pe){return Function.prototype.apply.call(ge,te,pe)};R=q&&"function"==typeof q.ownKeys?q.ownKeys:Object.getOwnPropertySymbols?function(ge){return Object.getOwnPropertyNames(ge).concat(Object.getOwnPropertySymbols(ge))}:function(ge){return Object.getOwnPropertyNames(ge)};var M=Number.isNaN||function(ge){return ge!=ge};function l(){l.init.call(this)}H.exports=l,H.exports.once=function Ie(se,ge){return new Promise(function(te,pe){function Ae(he){se.removeListener(ge,ue),pe(he)}function ue(){"function"==typeof se.removeListener&&se.removeListener("error",Ae),te([].slice.call(arguments))}Be(se,ge,ue,{once:!0}),"error"!==ge&&function Me(se,ge,te){"function"==typeof se.on&&Be(se,"error",ge,te)}(se,Ae,{once:!0})})},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var E=10;function k(se){if("function"!=typeof se)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof se)}function z(se){return void 0===se._maxListeners?l.defaultMaxListeners:se._maxListeners}function S(se,ge,te,pe){var Ae,ue,he;if(k(te),void 0===(ue=se._events)?(ue=se._events=Object.create(null),se._eventsCount=0):(void 0!==ue.newListener&&(se.emit("newListener",ge,te.listener?te.listener:te),ue=se._events),he=ue[ge]),void 0===he)he=ue[ge]=te,++se._eventsCount;else if("function"==typeof he?he=ue[ge]=pe?[te,he]:[he,te]:pe?he.unshift(te):he.push(te),(Ae=z(se))>0&&he.length>Ae&&!he.warned){he.warned=!0;var ie=new Error("Possible EventEmitter memory leak detected. "+he.length+" "+String(ge)+" listeners added. Use emitter.setMaxListeners() to increase limit");ie.name="MaxListenersExceededWarning",ie.emitter=se,ie.type=ge,ie.count=he.length,function B(se){console&&console.warn&&console.warn(se)}(ie)}return se}function K(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function X(se,ge,te){var pe={fired:!1,wrapFn:void 0,target:se,type:ge,listener:te},Ae=K.bind(pe);return Ae.listener=te,pe.wrapFn=Ae,Ae}function ne(se,ge,te){var pe=se._events;if(void 0===pe)return[];var Ae=pe[ge];return void 0===Ae?[]:"function"==typeof Ae?te?[Ae.listener||Ae]:[Ae]:te?function Te(se){for(var ge=new Array(se.length),te=0;te<ge.length;++te)ge[te]=se[te].listener||se[te];return ge}(Ae):ce(Ae,Ae.length)}function ae(se){var ge=this._events;if(void 0!==ge){var te=ge[se];if("function"==typeof te)return 1;if(void 0!==te)return te.length}return 0}function ce(se,ge){for(var te=new Array(ge),pe=0;pe<ge;++pe)te[pe]=se[pe];return te}function Be(se,ge,te,pe){if("function"==typeof se.on)pe.once?se.once(ge,te):se.on(ge,te);else{if("function"!=typeof se.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof se);se.addEventListener(ge,function Ae(ue){pe.once&&se.removeEventListener(ge,Ae),te(ue)})}}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return E},set:function(se){if("number"!=typeof se||se<0||M(se))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+se+".");E=se}}),l.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(ge){if("number"!=typeof ge||ge<0||M(ge))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ge+".");return this._maxListeners=ge,this},l.prototype.getMaxListeners=function(){return z(this)},l.prototype.emit=function(ge){for(var te=[],pe=1;pe<arguments.length;pe++)te.push(arguments[pe]);var Ae="error"===ge,ue=this._events;if(void 0!==ue)Ae=Ae&&void 0===ue.error;else if(!Ae)return!1;if(Ae){var he;if(te.length>0&&(he=te[0]),he instanceof Error)throw he;var ie=new Error("Unhandled error."+(he?" ("+he.message+")":""));throw ie.context=he,ie}var Pe=ue[ge];if(void 0===Pe)return!1;if("function"==typeof Pe)v(Pe,this,te);else{var we=Pe.length,de=ce(Pe,we);for(pe=0;pe<we;++pe)v(de[pe],this,te)}return!0},l.prototype.on=l.prototype.addListener=function(ge,te){return S(this,ge,te,!1)},l.prototype.prependListener=function(ge,te){return S(this,ge,te,!0)},l.prototype.once=function(ge,te){return k(te),this.on(ge,X(this,ge,te)),this},l.prototype.prependOnceListener=function(ge,te){return k(te),this.prependListener(ge,X(this,ge,te)),this},l.prototype.off=l.prototype.removeListener=function(ge,te){var pe,Ae,ue,he,ie;if(k(te),void 0===(Ae=this._events))return this;if(void 0===(pe=Ae[ge]))return this;if(pe===te||pe.listener===te)0==--this._eventsCount?this._events=Object.create(null):(delete Ae[ge],Ae.removeListener&&this.emit("removeListener",ge,pe.listener||te));else if("function"!=typeof pe){for(ue=-1,he=pe.length-1;he>=0;he--)if(pe[he]===te||pe[he].listener===te){ie=pe[he].listener,ue=he;break}if(ue<0)return this;0===ue?pe.shift():function V(se,ge){for(;ge+1<se.length;ge++)se[ge]=se[ge+1];se.pop()}(pe,ue),1===pe.length&&(Ae[ge]=pe[0]),void 0!==Ae.removeListener&&this.emit("removeListener",ge,ie||te)}return this},l.prototype.removeAllListeners=function(ge){var te,pe,Ae;if(void 0===(pe=this._events))return this;if(void 0===pe.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==pe[ge]&&(0==--this._eventsCount?this._events=Object.create(null):delete pe[ge]),this;if(0===arguments.length){var he,ue=Object.keys(pe);for(Ae=0;Ae<ue.length;++Ae)"removeListener"!==(he=ue[Ae])&&this.removeAllListeners(he);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(te=pe[ge]))this.removeListener(ge,te);else if(void 0!==te)for(Ae=te.length-1;Ae>=0;Ae--)this.removeListener(ge,te[Ae]);return this},l.prototype.listeners=function(ge){return ne(this,ge,!0)},l.prototype.rawListeners=function(ge){return ne(this,ge,!1)},l.listenerCount=function(se,ge){return"function"==typeof se.listenerCount?se.listenerCount(ge):ae.call(se,ge)},l.prototype.listenerCount=ae,l.prototype.eventNames=function(){return this._eventsCount>0?R(this._events):[]}},642:(H,q)=>{function R(B,M){var l=[],E=[];return null==M&&(M=function(k,z){return l[0]===z?"[Circular ~]":"[Circular ~."+E.slice(0,l.indexOf(z)).join(".")+"]"}),function(k,z){if(l.length>0){var S=l.indexOf(this);~S?l.splice(S+1):l.push(this),~S?E.splice(S,1/0,k):E.push(k),~l.indexOf(z)&&(z=M.call(this,k,z))}else l.push(z);return null==B?z:B.call(this,k,z)}}(H.exports=function v(B,M,l,E){return JSON.stringify(B,R(M,E),l)}).getSerialize=R},2573:(H,q)=>{var r,s,c,f,p,g,m,x,A,N,b,a,R={userAgent:!1},B={},E=E||(r=Math,c=(s={}).lib={},f=c.Base=function(){function y(){}return{extend:function(F){y.prototype=this;var C=new y;return F&&C.mixIn(F),C.hasOwnProperty("init")||(C.init=function(){C.$super.init.apply(this,arguments)}),C.init.prototype=C,C.$super=this,C},create:function(){var F=this.extend();return F.init.apply(F,arguments),F},init:function(){},mixIn:function(F){for(var C in F)F.hasOwnProperty(C)&&(this[C]=F[C]);F.hasOwnProperty("toString")&&(this.toString=F.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),p=c.WordArray=f.extend({init:function(y,F){y=this.words=y||[],this.sigBytes=null!=F?F:4*y.length},toString:function(y){return(y||m).stringify(this)},concat:function(y){var F=this.words,C=y.words,I=this.sigBytes,T=y.sigBytes;if(this.clamp(),I%4)for(var L=0;L<T;L++)F[I+L>>>2]|=(C[L>>>2]>>>24-L%4*8&255)<<24-(I+L)%4*8;else for(L=0;L<T;L+=4)F[I+L>>>2]=C[L>>>2];return this.sigBytes+=T,this},clamp:function(){var y=this.words,F=this.sigBytes;y[F>>>2]&=4294967295<<32-F%4*8,y.length=r.ceil(F/4)},clone:function(){var y=f.clone.call(this);return y.words=this.words.slice(0),y},random:function(y){for(var F=[],C=0;C<y;C+=4)F.push(4294967296*r.random()|0);return new p.init(F,y)}}),g=s.enc={},m=g.Hex={stringify:function(y){for(var F=y.words,C=y.sigBytes,I=[],T=0;T<C;T++){var L=F[T>>>2]>>>24-T%4*8&255;I.push((L>>>4).toString(16)),I.push((15&L).toString(16))}return I.join("")},parse:function(y){for(var F=y.length,C=[],I=0;I<F;I+=2)C[I>>>3]|=parseInt(y.substr(I,2),16)<<24-I%8*4;return new p.init(C,F/2)}},x=g.Latin1={stringify:function(y){for(var F=y.words,C=y.sigBytes,I=[],T=0;T<C;T++)I.push(String.fromCharCode(F[T>>>2]>>>24-T%4*8&255));return I.join("")},parse:function(y){for(var F=y.length,C=[],I=0;I<F;I++)C[I>>>2]|=(255&y.charCodeAt(I))<<24-I%4*8;return new p.init(C,F)}},A=g.Utf8={stringify:function(y){try{return decodeURIComponent(escape(x.stringify(y)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(y){return x.parse(unescape(encodeURIComponent(y)))}},N=c.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new p.init,this._nDataBytes=0},_append:function(y){"string"==typeof y&&(y=A.parse(y)),this._data.concat(y),this._nDataBytes+=y.sigBytes},_process:function(y){var F=this._data,C=F.words,I=F.sigBytes,T=this.blockSize,Z=I/(4*T),W=(Z=y?r.ceil(Z):r.max((0|Z)-this._minBufferSize,0))*T,G=r.min(4*W,I);if(W){for(var me=0;me<W;me+=T)this._doProcessBlock(C,me);var Se=C.splice(0,W);F.sigBytes-=G}return new p.init(Se,G)},clone:function(){var y=f.clone.call(this);return y._data=this._data.clone(),y},_minBufferSize:0}),c.Hasher=N.extend({cfg:f.extend(),init:function(y){this.cfg=this.cfg.extend(y),this.reset()},reset:function(){N.reset.call(this),this._doReset()},update:function(y){return this._append(y),this._process(),this},finalize:function(y){return y&&this._append(y),this._doFinalize()},blockSize:16,_createHelper:function(y){return function(F,C){return new y.init(C).finalize(F)}},_createHmacHelper:function(y){return function(F,C){return new b.HMAC.init(y,C).finalize(F)}}}),b=s.algo={},s);(function(r){var f,a=(f=E).lib,s=a.Base,c=a.WordArray;(f=f.x64={}).Word=s.extend({init:function(p,g){this.high=p,this.low=g}}),f.WordArray=s.extend({init:function(p,g){p=this.words=p||[],this.sigBytes=null!=g?g:8*p.length},toX32:function(){for(var p=this.words,g=p.length,m=[],x=0;x<g;x++){var A=p[x];m.push(A.high),m.push(A.low)}return c.create(m,this.sigBytes)},clone:function(){for(var p=s.clone.call(this),g=p.words=this.words.slice(0),m=g.length,x=0;x<m;x++)g[x]=g[x].clone();return p}})})(),E.lib.Cipher||function(r){var a=(y=E).lib,s=a.Base,c=a.WordArray,f=a.BufferedBlockAlgorithm,p=y.enc.Base64,g=y.algo.EvpKDF,m=a.Cipher=f.extend({cfg:s.extend(),createEncryptor:function(C,I){return this.create(this._ENC_XFORM_MODE,C,I)},createDecryptor:function(C,I){return this.create(this._DEC_XFORM_MODE,C,I)},init:function(C,I,T){this.cfg=this.cfg.extend(T),this._xformMode=C,this._key=I,this.reset()},reset:function(){f.reset.call(this),this._doReset()},process:function(C){return this._append(C),this._process()},finalize:function(C){return C&&this._append(C),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(C){return{encrypt:function(I,T,L){return("string"==typeof T?F:b).encrypt(C,I,T,L)},decrypt:function(I,T,L){return("string"==typeof T?F:b).decrypt(C,I,T,L)}}}});a.StreamCipher=m.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var P=y.mode={},x=function(C,I,T){var L=this._iv;L?this._iv=void 0:L=this._prevBlock;for(var Z=0;Z<T;Z++)C[I+Z]^=L[Z]},A=(a.BlockCipherMode=s.extend({createEncryptor:function(C,I){return this.Encryptor.create(C,I)},createDecryptor:function(C,I){return this.Decryptor.create(C,I)},init:function(C,I){this._cipher=C,this._iv=I}})).extend();A.Encryptor=A.extend({processBlock:function(C,I){var T=this._cipher,L=T.blockSize;x.call(this,C,I,L),T.encryptBlock(C,I),this._prevBlock=C.slice(I,I+L)}}),A.Decryptor=A.extend({processBlock:function(C,I){var T=this._cipher,L=T.blockSize,Z=C.slice(I,I+L);T.decryptBlock(C,I),x.call(this,C,I,L),this._prevBlock=Z}}),P=P.CBC=A,A=(y.pad={}).Pkcs7={pad:function(C,I){for(var T,L=(T=(T=4*I)-C.sigBytes%T)<<24|T<<16|T<<8|T,Z=[],W=0;W<T;W+=4)Z.push(L);T=c.create(Z,T),C.concat(T)},unpad:function(C){C.sigBytes-=255&C.words[C.sigBytes-1>>>2]}},a.BlockCipher=m.extend({cfg:m.cfg.extend({mode:P,padding:A}),reset:function(){m.reset.call(this);var C=(I=this.cfg).iv,I=I.mode;if(this._xformMode==this._ENC_XFORM_MODE)var T=I.createEncryptor;else T=I.createDecryptor,this._minBufferSize=1;this._mode=T.call(I,this,C&&C.words)},_doProcessBlock:function(C,I){this._mode.processBlock(C,I)},_doFinalize:function(){var C=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){C.pad(this._data,this.blockSize);var I=this._process(!0)}else I=this._process(!0),C.unpad(I);return I},blockSize:4});var N=a.CipherParams=s.extend({init:function(C){this.mixIn(C)},toString:function(C){return(C||this.formatter).stringify(this)}}),b=(P=(y.format={}).OpenSSL={stringify:function(C){var I=C.ciphertext;return((C=C.salt)?c.create([1398893684,1701076831]).concat(C).concat(I):I).toString(p)},parse:function(C){var I=(C=p.parse(C)).words;if(1398893684==I[0]&&1701076831==I[1]){var T=c.create(I.slice(2,4));I.splice(0,4),C.sigBytes-=16}return N.create({ciphertext:C,salt:T})}},a.SerializableCipher=s.extend({cfg:s.extend({format:P}),encrypt:function(C,I,T,L){L=this.cfg.extend(L);var Z=C.createEncryptor(T,L);return I=Z.finalize(I),N.create({ciphertext:I,key:T,iv:(Z=Z.cfg).iv,algorithm:C,mode:Z.mode,padding:Z.padding,blockSize:C.blockSize,formatter:L.format})},decrypt:function(C,I,T,L){return L=this.cfg.extend(L),I=this._parse(I,L.format),C.createDecryptor(T,L).finalize(I.ciphertext)},_parse:function(C,I){return"string"==typeof C?I.parse(C,this):C}})),y=(y.kdf={}).OpenSSL={execute:function(C,I,T,L){return L||(L=c.random(8)),C=g.create({keySize:I+T}).compute(C,L),T=c.create(C.words.slice(I),4*T),C.sigBytes=4*I,N.create({key:C,iv:T,salt:L})}},F=a.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:y}),encrypt:function(C,I,T,L){return T=(L=this.cfg.extend(L)).kdf.execute(T,C.keySize,C.ivSize),L.iv=T.iv,(C=b.encrypt.call(this,C,I,T.key,L)).mixIn(T),C},decrypt:function(C,I,T,L){return L=this.cfg.extend(L),I=this._parse(I,L.format),T=L.kdf.execute(T,C.keySize,C.ivSize,I.salt),L.iv=T.iv,b.decrypt.call(this,C,I,T.key,L)}})}(),function(){for(var r=E,a=r.lib.BlockCipher,me=r.algo,s=[],c=[],f=[],p=[],g=[],m=[],x=[],A=[],N=[],P=[],b=[],y=0;256>y;y++)b[y]=128>y?y<<1:y<<1^283;var F=0,C=0;for(y=0;256>y;y++){var I;s[F]=I=(I=C^C<<1^C<<2^C<<3^C<<4)>>>8^255&I^99,c[I]=F;var T=b[F],L=b[T],Z=b[L],W=257*b[I]^16843008*I;f[F]=W<<24|W>>>8,p[F]=W<<16|W>>>16,g[F]=W<<8|W>>>24,m[F]=W,x[I]=(W=16843009*Z^65537*L^257*T^16843008*F)<<24|W>>>8,A[I]=W<<16|W>>>16,N[I]=W<<8|W>>>24,P[I]=W,F?(F=T^b[b[b[Z^T]]],C^=b[b[C]]):F=C=1}var G=[0,1,2,4,8,16,32,64,128,27,54];me=me.AES=a.extend({_doReset:function(){for(var Se=(j=this._key).words,O=j.sigBytes/4,j=4*((this._nRounds=O+6)+1),$=this._keySchedule=[],J=0;J<j;J++)if(J<O)$[J]=Se[J];else{var re=$[J-1];J%O?6<O&&J%O==4&&(re=s[re>>>24]<<24|s[re>>>16&255]<<16|s[re>>>8&255]<<8|s[255&re]):(re=s[(re=re<<8|re>>>24)>>>24]<<24|s[re>>>16&255]<<16|s[re>>>8&255]<<8|s[255&re],re^=G[J/O|0]<<24),$[J]=$[J-O]^re}for(Se=this._invKeySchedule=[],O=0;O<j;O++)J=j-O,re=O%4?$[J]:$[J-4],Se[O]=4>O||4>=J?re:x[s[re>>>24]]^A[s[re>>>16&255]]^N[s[re>>>8&255]]^P[s[255&re]]},encryptBlock:function(Se,O){this._doCryptBlock(Se,O,this._keySchedule,f,p,g,m,s)},decryptBlock:function(Se,O){var j=Se[O+1];Se[O+1]=Se[O+3],Se[O+3]=j,this._doCryptBlock(Se,O,this._invKeySchedule,x,A,N,P,c),j=Se[O+1],Se[O+1]=Se[O+3],Se[O+3]=j},_doCryptBlock:function(Se,O,j,$,J,re,le,ee){for(var oe=this._nRounds,Ye=Se[O]^j[0],Ft=Se[O+1]^j[1],vt=Se[O+2]^j[2],et=Se[O+3]^j[3],fe=4,xe=1;xe<oe;xe++){var qe=$[Ye>>>24]^J[Ft>>>16&255]^re[vt>>>8&255]^le[255&et]^j[fe++],Ue=$[Ft>>>24]^J[vt>>>16&255]^re[et>>>8&255]^le[255&Ye]^j[fe++],Ze=$[vt>>>24]^J[et>>>16&255]^re[Ye>>>8&255]^le[255&Ft]^j[fe++];et=$[et>>>24]^J[Ye>>>16&255]^re[Ft>>>8&255]^le[255&vt]^j[fe++],Ye=qe,Ft=Ue,vt=Ze}qe=(ee[Ye>>>24]<<24|ee[Ft>>>16&255]<<16|ee[vt>>>8&255]<<8|ee[255&et])^j[fe++],Ue=(ee[Ft>>>24]<<24|ee[vt>>>16&255]<<16|ee[et>>>8&255]<<8|ee[255&Ye])^j[fe++],Ze=(ee[vt>>>24]<<24|ee[et>>>16&255]<<16|ee[Ye>>>8&255]<<8|ee[255&Ft])^j[fe++],et=(ee[et>>>24]<<24|ee[Ye>>>16&255]<<16|ee[Ft>>>8&255]<<8|ee[255&vt])^j[fe++],Se[O]=qe,Se[O+1]=Ue,Se[O+2]=Ze,Se[O+3]=et},keySize:8}),r.AES=a._createHelper(me)}(),function(){function r(b,y){var F=(this._lBlock>>>b^this._rBlock)&y;this._rBlock^=F,this._lBlock^=F<<b}function a(b,y){var F=(this._rBlock>>>b^this._lBlock)&y;this._lBlock^=F,this._rBlock^=F<<b}var f,s=E,c=(f=s.lib).WordArray,p=s.algo,g=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],m=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],x=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],A=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],N=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],P=p.DES=(f=f.BlockCipher).extend({_doReset:function(){for(var b=this._key.words,y=[],F=0;56>F;F++){var C=g[F]-1;y[F]=b[C>>>5]>>>31-C%32&1}for(b=this._subKeys=[],C=0;16>C;C++){var I=b[C]=[],T=x[C];for(F=0;24>F;F++)I[F/6|0]|=y[(m[F]-1+T)%28]<<31-F%6,I[4+(F/6|0)]|=y[28+(m[F+24]-1+T)%28]<<31-F%6;for(I[0]=I[0]<<1|I[0]>>>31,F=1;7>F;F++)I[F]>>>=4*(F-1)+3;I[7]=I[7]<<5|I[7]>>>27}for(y=this._invSubKeys=[],F=0;16>F;F++)y[F]=b[15-F]},encryptBlock:function(b,y){this._doCryptBlock(b,y,this._subKeys)},decryptBlock:function(b,y){this._doCryptBlock(b,y,this._invSubKeys)},_doCryptBlock:function(b,y,F){this._lBlock=b[y],this._rBlock=b[y+1],r.call(this,4,252645135),r.call(this,16,65535),a.call(this,2,858993459),a.call(this,8,16711935),r.call(this,1,1431655765);for(var C=0;16>C;C++){for(var I=F[C],T=this._lBlock,L=this._rBlock,Z=0,W=0;8>W;W++)Z|=A[W][((L^I[W])&N[W])>>>0];this._lBlock=L,this._rBlock=T^Z}F=this._lBlock,this._lBlock=this._rBlock,this._rBlock=F,r.call(this,1,1431655765),a.call(this,8,16711935),a.call(this,2,858993459),r.call(this,16,65535),r.call(this,4,252645135),b[y]=this._lBlock,b[y+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});s.DES=f._createHelper(P),p=p.TripleDES=f.extend({_doReset:function(){var b=this._key.words;this._des1=P.createEncryptor(c.create(b.slice(0,2))),this._des2=P.createEncryptor(c.create(b.slice(2,4))),this._des3=P.createEncryptor(c.create(b.slice(4,6)))},encryptBlock:function(b,y){this._des1.encryptBlock(b,y),this._des2.decryptBlock(b,y),this._des3.encryptBlock(b,y)},decryptBlock:function(b,y){this._des3.decryptBlock(b,y),this._des2.encryptBlock(b,y),this._des1.decryptBlock(b,y)},keySize:6,ivSize:2,blockSize:2}),s.TripleDES=f._createHelper(p)}(),a=E.lib.WordArray,E.enc.Base64={stringify:function(s){var c=s.words,f=s.sigBytes,p=this._map;s.clamp(),s=[];for(var g=0;g<f;g+=3)for(var m=(c[g>>>2]>>>24-g%4*8&255)<<16|(c[g+1>>>2]>>>24-(g+1)%4*8&255)<<8|c[g+2>>>2]>>>24-(g+2)%4*8&255,x=0;4>x&&g+.75*x<f;x++)s.push(p.charAt(m>>>6*(3-x)&63));if(c=p.charAt(64))for(;s.length%4;)s.push(c);return s.join("")},parse:function(s){var c=s.length,f=this._map;(p=f.charAt(64))&&-1!=(p=s.indexOf(p))&&(c=p);for(var p=[],g=0,m=0;m<c;m++)if(m%4){var x=f.indexOf(s.charAt(m-1))<<m%4*2,A=f.indexOf(s.charAt(m))>>>6-m%4*2;p[g>>>2]|=(x|A)<<24-g%4*8,g++}return a.create(p,g)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(r){function a(P,b,y,F,C,I,T){return((P=P+(b&y|~b&F)+C+T)<<I|P>>>32-I)+b}function s(P,b,y,F,C,I,T){return((P=P+(b&F|y&~F)+C+T)<<I|P>>>32-I)+b}function c(P,b,y,F,C,I,T){return((P=P+(b^y^F)+C+T)<<I|P>>>32-I)+b}function f(P,b,y,F,C,I,T){return((P=P+(y^(b|~F))+C+T)<<I|P>>>32-I)+b}for(var p=E,g=(x=p.lib).WordArray,m=x.Hasher,x=p.algo,A=[],N=0;64>N;N++)A[N]=4294967296*r.abs(r.sin(N+1))|0;x=x.MD5=m.extend({_doReset:function(){this._hash=new g.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(P,b){for(var y=0;16>y;y++)P[F=b+y]=16711935&((C=P[F])<<8|C>>>24)|4278255360&(C<<24|C>>>8);var F,C=P[b+1],I=P[b+2],T=P[b+3],L=P[b+4],Z=P[b+5],W=P[b+6],G=P[b+7],me=P[b+8],Se=P[b+9],O=P[b+10],j=P[b+11],$=P[b+12],J=P[b+13],re=P[b+14],le=P[b+15],ee=a(ee=(y=this._hash.words)[0],xe=y[1],fe=y[2],oe=y[3],F=P[b+0],7,A[0]),oe=a(oe,ee,xe,fe,C,12,A[1]),fe=a(fe,oe,ee,xe,I,17,A[2]),xe=a(xe,fe,oe,ee,T,22,A[3]);ee=a(ee,xe,fe,oe,L,7,A[4]),oe=a(oe,ee,xe,fe,Z,12,A[5]),fe=a(fe,oe,ee,xe,W,17,A[6]),xe=a(xe,fe,oe,ee,G,22,A[7]),ee=a(ee,xe,fe,oe,me,7,A[8]),oe=a(oe,ee,xe,fe,Se,12,A[9]),fe=a(fe,oe,ee,xe,O,17,A[10]),xe=a(xe,fe,oe,ee,j,22,A[11]),ee=a(ee,xe,fe,oe,$,7,A[12]),oe=a(oe,ee,xe,fe,J,12,A[13]),fe=a(fe,oe,ee,xe,re,17,A[14]),ee=s(ee,xe=a(xe,fe,oe,ee,le,22,A[15]),fe,oe,C,5,A[16]),oe=s(oe,ee,xe,fe,W,9,A[17]),fe=s(fe,oe,ee,xe,j,14,A[18]),xe=s(xe,fe,oe,ee,F,20,A[19]),ee=s(ee,xe,fe,oe,Z,5,A[20]),oe=s(oe,ee,xe,fe,O,9,A[21]),fe=s(fe,oe,ee,xe,le,14,A[22]),xe=s(xe,fe,oe,ee,L,20,A[23]),ee=s(ee,xe,fe,oe,Se,5,A[24]),oe=s(oe,ee,xe,fe,re,9,A[25]),fe=s(fe,oe,ee,xe,T,14,A[26]),xe=s(xe,fe,oe,ee,me,20,A[27]),ee=s(ee,xe,fe,oe,J,5,A[28]),oe=s(oe,ee,xe,fe,I,9,A[29]),fe=s(fe,oe,ee,xe,G,14,A[30]),ee=c(ee,xe=s(xe,fe,oe,ee,$,20,A[31]),fe,oe,Z,4,A[32]),oe=c(oe,ee,xe,fe,me,11,A[33]),fe=c(fe,oe,ee,xe,j,16,A[34]),xe=c(xe,fe,oe,ee,re,23,A[35]),ee=c(ee,xe,fe,oe,C,4,A[36]),oe=c(oe,ee,xe,fe,L,11,A[37]),fe=c(fe,oe,ee,xe,G,16,A[38]),xe=c(xe,fe,oe,ee,O,23,A[39]),ee=c(ee,xe,fe,oe,J,4,A[40]),oe=c(oe,ee,xe,fe,F,11,A[41]),fe=c(fe,oe,ee,xe,T,16,A[42]),xe=c(xe,fe,oe,ee,W,23,A[43]),ee=c(ee,xe,fe,oe,Se,4,A[44]),oe=c(oe,ee,xe,fe,$,11,A[45]),fe=c(fe,oe,ee,xe,le,16,A[46]),ee=f(ee,xe=c(xe,fe,oe,ee,I,23,A[47]),fe,oe,F,6,A[48]),oe=f(oe,ee,xe,fe,G,10,A[49]),fe=f(fe,oe,ee,xe,re,15,A[50]),xe=f(xe,fe,oe,ee,Z,21,A[51]),ee=f(ee,xe,fe,oe,$,6,A[52]),oe=f(oe,ee,xe,fe,T,10,A[53]),fe=f(fe,oe,ee,xe,O,15,A[54]),xe=f(xe,fe,oe,ee,C,21,A[55]),ee=f(ee,xe,fe,oe,me,6,A[56]),oe=f(oe,ee,xe,fe,le,10,A[57]),fe=f(fe,oe,ee,xe,W,15,A[58]),xe=f(xe,fe,oe,ee,J,21,A[59]),ee=f(ee,xe,fe,oe,L,6,A[60]),oe=f(oe,ee,xe,fe,j,10,A[61]),fe=f(fe,oe,ee,xe,I,15,A[62]),xe=f(xe,fe,oe,ee,Se,21,A[63]),y[0]=y[0]+ee|0,y[1]=y[1]+xe|0,y[2]=y[2]+fe|0,y[3]=y[3]+oe|0},_doFinalize:function(){var P=this._data,b=P.words,y=8*this._nDataBytes,F=8*P.sigBytes;b[F>>>5]|=128<<24-F%32;var C=r.floor(y/4294967296);for(b[15+(F+64>>>9<<4)]=16711935&(C<<8|C>>>24)|4278255360&(C<<24|C>>>8),b[14+(F+64>>>9<<4)]=16711935&(y<<8|y>>>24)|4278255360&(y<<24|y>>>8),P.sigBytes=4*(b.length+1),this._process(),b=(P=this._hash).words,y=0;4>y;y++)b[y]=16711935&((F=b[y])<<8|F>>>24)|4278255360&(F<<24|F>>>8);return P},clone:function(){var P=m.clone.call(this);return P._hash=this._hash.clone(),P}}),p.MD5=m._createHelper(x),p.HmacMD5=m._createHmacHelper(x)}(Math),function(){var r=E,a=(f=r.lib).WordArray,s=f.Hasher,c=[],f=r.algo.SHA1=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(p,g){for(var m=this._hash.words,x=m[0],A=m[1],N=m[2],P=m[3],b=m[4],y=0;80>y;y++){if(16>y)c[y]=0|p[g+y];else{var F=c[y-3]^c[y-8]^c[y-14]^c[y-16];c[y]=F<<1|F>>>31}F=(x<<5|x>>>27)+b+c[y],F=20>y?F+(1518500249+(A&N|~A&P)):40>y?F+(1859775393+(A^N^P)):60>y?F+((A&N|A&P|N&P)-1894007588):F+((A^N^P)-899497514),b=P,P=N,N=A<<30|A>>>2,A=x,x=F}m[0]=m[0]+x|0,m[1]=m[1]+A|0,m[2]=m[2]+N|0,m[3]=m[3]+P|0,m[4]=m[4]+b|0},_doFinalize:function(){var p=this._data,g=p.words,m=8*this._nDataBytes,x=8*p.sigBytes;return g[x>>>5]|=128<<24-x%32,g[14+(x+64>>>9<<4)]=Math.floor(m/4294967296),g[15+(x+64>>>9<<4)]=m,p.sigBytes=4*g.length,this._process(),this._hash},clone:function(){var p=s.clone.call(this);return p._hash=this._hash.clone(),p}});r.SHA1=s._createHelper(f),r.HmacSHA1=s._createHmacHelper(f)}(),function(r){for(var a=E,s=(y=a.lib).WordArray,c=y.Hasher,y=a.algo,f=[],p=[],g=function(C){return 4294967296*(C-(0|C))|0},m=2,x=0;64>x;){var A;e:{for(var N=r.sqrt(A=m),P=2;P<=N;P++)if(!(A%P)){A=!1;break e}A=!0}A&&(8>x&&(f[x]=g(r.pow(m,.5))),p[x]=g(r.pow(m,1/3)),x++),m++}var b=[];y=y.SHA256=c.extend({_doReset:function(){this._hash=new s.init(f.slice(0))},_doProcessBlock:function(F,C){for(var I=this._hash.words,T=I[0],L=I[1],Z=I[2],W=I[3],G=I[4],me=I[5],Se=I[6],O=I[7],j=0;64>j;j++){if(16>j)b[j]=0|F[C+j];else{var $=b[j-15],J=b[j-2];b[j]=(($<<25|$>>>7)^($<<14|$>>>18)^$>>>3)+b[j-7]+((J<<15|J>>>17)^(J<<13|J>>>19)^J>>>10)+b[j-16]}$=O+((G<<26|G>>>6)^(G<<21|G>>>11)^(G<<7|G>>>25))+(G&me^~G&Se)+p[j]+b[j],J=((T<<30|T>>>2)^(T<<19|T>>>13)^(T<<10|T>>>22))+(T&L^T&Z^L&Z),O=Se,Se=me,me=G,G=W+$|0,W=Z,Z=L,L=T,T=$+J|0}I[0]=I[0]+T|0,I[1]=I[1]+L|0,I[2]=I[2]+Z|0,I[3]=I[3]+W|0,I[4]=I[4]+G|0,I[5]=I[5]+me|0,I[6]=I[6]+Se|0,I[7]=I[7]+O|0},_doFinalize:function(){var F=this._data,C=F.words,I=8*this._nDataBytes,T=8*F.sigBytes;return C[T>>>5]|=128<<24-T%32,C[14+(T+64>>>9<<4)]=r.floor(I/4294967296),C[15+(T+64>>>9<<4)]=I,F.sigBytes=4*C.length,this._process(),this._hash},clone:function(){var F=c.clone.call(this);return F._hash=this._hash.clone(),F}}),a.SHA256=c._createHelper(y),a.HmacSHA256=c._createHmacHelper(y)}(Math),function(){var r=E,a=r.lib.WordArray,s=(c=r.algo).SHA256,c=c.SHA224=s.extend({_doReset:function(){this._hash=new a.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var f=s._doFinalize.call(this);return f.sigBytes-=4,f}});r.SHA224=s._createHelper(c),r.HmacSHA224=s._createHmacHelper(c)}(),function(){function r(){return c.create.apply(c,arguments)}for(var a=E,s=a.lib.Hasher,c=(p=a.x64).Word,f=p.WordArray,p=a.algo,g=[r(1116352408,3609767458),r(1899447441,602891725),r(3049323471,3964484399),r(3921009573,2173295548),r(961987163,4081628472),r(1508970993,3053834265),r(2453635748,2937671579),r(2870763221,3664609560),r(3624381080,2734883394),r(310598401,1164996542),r(607225278,1323610764),r(1426881987,3590304994),r(1925078388,4068182383),r(2162078206,991336113),r(2614888103,633803317),r(3248222580,3479774868),r(3835390401,2666613458),r(4022224774,944711139),r(264347078,2341262773),r(604807628,2007800933),r(770255983,1495990901),r(1249150122,1856431235),r(1555081692,3175218132),r(1996064986,2198950837),r(2554220882,3999719339),r(2821834349,766784016),r(2952996808,2566594879),r(3210313671,3203337956),r(3336571891,1034457026),r(3584528711,2466948901),r(113926993,3758326383),r(338241895,168717936),r(666307205,1188179964),r(773529912,1546045734),r(1294757372,1522805485),r(1396182291,2643833823),r(1695183700,2343527390),r(1986661051,1014477480),r(2177026350,1206759142),r(2456956037,344077627),r(2730485921,1290863460),r(2820302411,3158454273),r(3259730800,3505952657),r(3345764771,106217008),r(3516065817,3606008344),r(3600352804,1432725776),r(4094571909,1467031594),r(275423344,851169720),r(430227734,3100823752),r(506948616,1363258195),r(659060556,3750685593),r(883997877,3785050280),r(958139571,3318307427),r(1322822218,3812723403),r(1537002063,2003034995),r(1747873779,3602036899),r(1955562222,1575990012),r(2024104815,1125592928),r(2227730452,2716904306),r(2361852424,442776044),r(2428436474,593698344),r(2756734187,3733110249),r(3204031479,2999351573),r(3329325298,3815920427),r(3391569614,3928383900),r(3515267271,566280711),r(3940187606,3454069534),r(4118630271,4000239992),r(116418474,1914138554),r(174292421,2731055270),r(289380356,3203993006),r(460393269,320620315),r(685471733,587496836),r(852142971,1086792851),r(1017036298,365543100),r(1126000580,2618297676),r(1288033470,3409855158),r(1501505948,4234509866),r(1607167915,987167468),r(1816402316,1246189591)],m=[],x=0;80>x;x++)m[x]=r();p=p.SHA512=s.extend({_doReset:function(){this._hash=new f.init([new c.init(1779033703,4089235720),new c.init(3144134277,2227873595),new c.init(1013904242,4271175723),new c.init(2773480762,1595750129),new c.init(1359893119,2917565137),new c.init(2600822924,725511199),new c.init(528734635,4215389547),new c.init(1541459225,327033209)])},_doProcessBlock:function(A,N){for(var L,P=(L=this._hash.words)[0],b=L[1],y=L[2],F=L[3],C=L[4],I=L[5],T=L[6],Z=P.high,W=P.low,G=b.high,me=b.low,Se=y.high,O=y.low,j=F.high,$=F.low,J=C.high,re=C.low,le=I.high,ee=I.low,oe=T.high,fe=T.low,xe=(L=L[7]).high,qe=L.low,Ue=Z,Ze=W,et=G,Ye=me,Ft=Se,vt=O,cn=j,Pn=$,an=J,gn=re,ln=le,yt=ee,Kt=oe,kt=fe,zt=xe,mn=qe,Ct=0;80>Ct;Ct++){var Yn=m[Ct];if(16>Ct)var bn=Yn.high=0|A[N+2*Ct],ht=Yn.low=0|A[N+2*Ct+1];else{bn=((ht=(bn=m[Ct-15]).high)>>>1|(Xn=bn.low)<<31)^(ht>>>8|Xn<<24)^ht>>>7;var Xn=(Xn>>>1|ht<<31)^(Xn>>>8|ht<<24)^(Xn>>>7|ht<<25),br=((ht=(br=m[Ct-2]).high)>>>19|(It=br.low)<<13)^(ht<<3|It>>>29)^ht>>>6,It=(It>>>19|ht<<13)^(It<<3|ht>>>29)^(It>>>6|ht<<26);Yn.high=bn=(bn=(bn=bn+(Fr=(ht=m[Ct-7]).high)+((ht=Xn+ht.low)>>>0<Xn>>>0?1:0))+br+((ht+=It)>>>0<It>>>0?1:0))+(jn=(Bt=m[Ct-16]).high)+((ht+=Bt=Bt.low)>>>0<Bt>>>0?1:0),Yn.low=ht}var Fr=an&ln^~an&Kt,Bt=gn&yt^~gn&kt,Ha=(Yn=Ue&et^Ue&Ft^et&Ft,Ze&Ye^Ze&vt^Ye&vt),zo=(It=g[Ct]).high,gi=It.low,jn=zt+((an>>>14|gn<<18)^(an>>>18|gn<<14)^(an<<23|gn>>>9))+((It=mn+((gn>>>14|an<<18)^(gn>>>18|an<<14)^(gn<<23|an>>>9)))>>>0<mn>>>0?1:0);zt=Kt,mn=kt,Kt=ln,kt=yt,ln=an,yt=gn,an=cn+(jn=(jn=(jn=jn+Fr+((It+=Bt)>>>0<Bt>>>0?1:0))+zo+((It+=gi)>>>0<gi>>>0?1:0))+bn+((It+=ht)>>>0<ht>>>0?1:0))+((gn=Pn+It|0)>>>0<Pn>>>0?1:0)|0,cn=Ft,Pn=vt,Ft=et,vt=Ye,et=Ue,Ye=Ze,Ue=jn+(Yn=(Xn=(Ue>>>28|Ze<<4)^(Ue<<30|Ze>>>2)^(Ue<<25|Ze>>>7))+Yn+((ht=(br=(Ze>>>28|Ue<<4)^(Ze<<30|Ue>>>2)^(Ze<<25|Ue>>>7))+Ha)>>>0<br>>>0?1:0))+((Ze=It+ht|0)>>>0<It>>>0?1:0)|0}W=P.low=W+Ze,P.high=Z+Ue+(W>>>0<Ze>>>0?1:0),me=b.low=me+Ye,b.high=G+et+(me>>>0<Ye>>>0?1:0),O=y.low=O+vt,y.high=Se+Ft+(O>>>0<vt>>>0?1:0),$=F.low=$+Pn,F.high=j+cn+($>>>0<Pn>>>0?1:0),re=C.low=re+gn,C.high=J+an+(re>>>0<gn>>>0?1:0),ee=I.low=ee+yt,I.high=le+ln+(ee>>>0<yt>>>0?1:0),fe=T.low=fe+kt,T.high=oe+Kt+(fe>>>0<kt>>>0?1:0),qe=L.low=qe+mn,L.high=xe+zt+(qe>>>0<mn>>>0?1:0)},_doFinalize:function(){var A=this._data,N=A.words,P=8*this._nDataBytes,b=8*A.sigBytes;return N[b>>>5]|=128<<24-b%32,N[30+(b+128>>>10<<5)]=Math.floor(P/4294967296),N[31+(b+128>>>10<<5)]=P,A.sigBytes=4*N.length,this._process(),this._hash.toX32()},clone:function(){var A=s.clone.call(this);return A._hash=this._hash.clone(),A},blockSize:32}),a.SHA512=s._createHelper(p),a.HmacSHA512=s._createHmacHelper(p)}(),function(){var r=E,a=(f=r.x64).Word,s=f.WordArray,c=(f=r.algo).SHA512,f=f.SHA384=c.extend({_doReset:function(){this._hash=new s.init([new a.init(3418070365,3238371032),new a.init(1654270250,914150663),new a.init(2438529370,812702999),new a.init(355462360,4144912697),new a.init(1731405415,4290775857),new a.init(2394180231,1750603025),new a.init(3675008525,1694076839),new a.init(1203062813,3204075428)])},_doFinalize:function(){var p=c._doFinalize.call(this);return p.sigBytes-=16,p}});r.SHA384=c._createHelper(f),r.HmacSHA384=c._createHmacHelper(f)}(),function(){var r=E,a=(A=r.lib).WordArray,s=A.Hasher,A=r.algo,c=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),f=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),p=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),g=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),m=a.create([0,1518500249,1859775393,2400959708,2840853838]),x=a.create([1352829926,1548603684,1836072691,2053994217,0]);A=A.RIPEMD160=s.extend({_doReset:function(){this._hash=a.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(N,P){for(var b=0;16>b;b++)N[y=P+b]=16711935&((F=N[y])<<8|F>>>24)|4278255360&(F<<24|F>>>8);var y,W,G,me,Se,O,j,$,J,re,le,ee,F=m.words,C=x.words,I=c.words,T=f.words,L=p.words,Z=g.words;for(j=W=(y=this._hash.words)[0],$=G=y[1],J=me=y[2],re=Se=y[3],le=O=y[4],b=0;80>b;b+=1)ee=W+N[P+I[b]]|0,ee=16>b?ee+((G^me^Se)+F[0]):32>b?ee+((G&me|~G&Se)+F[1]):48>b?ee+(((G|~me)^Se)+F[2]):64>b?ee+((G&Se|me&~Se)+F[3]):ee+((G^(me|~Se))+F[4]),ee=(ee=(ee|=0)<<L[b]|ee>>>32-L[b])+O|0,W=O,O=Se,Se=me<<10|me>>>22,me=G,G=ee,ee=j+N[P+T[b]]|0,ee=16>b?ee+(($^(J|~re))+C[0]):32>b?ee+(($&re|J&~re)+C[1]):48>b?ee+((($|~J)^re)+C[2]):64>b?ee+(($&J|~$&re)+C[3]):ee+(($^J^re)+C[4]),ee=(ee=(ee|=0)<<Z[b]|ee>>>32-Z[b])+le|0,j=le,le=re,re=J<<10|J>>>22,J=$,$=ee;ee=y[1]+me+re|0,y[1]=y[2]+Se+le|0,y[2]=y[3]+O+j|0,y[3]=y[4]+W+$|0,y[4]=y[0]+G+J|0,y[0]=ee},_doFinalize:function(){var N=this._data,P=N.words,b=8*this._nDataBytes,y=8*N.sigBytes;for(P[y>>>5]|=128<<24-y%32,P[14+(y+64>>>9<<4)]=16711935&(b<<8|b>>>24)|4278255360&(b<<24|b>>>8),N.sigBytes=4*(P.length+1),this._process(),P=(N=this._hash).words,b=0;5>b;b++)P[b]=16711935&((y=P[b])<<8|y>>>24)|4278255360&(y<<24|y>>>8);return N},clone:function(){var N=s.clone.call(this);return N._hash=this._hash.clone(),N}}),r.RIPEMD160=s._createHelper(A),r.HmacRIPEMD160=s._createHmacHelper(A)}(Math),function(){var a=E.enc.Utf8;E.algo.HMAC=E.lib.Base.extend({init:function(s,c){s=this._hasher=new s.init,"string"==typeof c&&(c=a.parse(c));var f=s.blockSize,p=4*f;c.sigBytes>p&&(c=s.finalize(c)),c.clamp();for(var g=this._oKey=c.clone(),m=this._iKey=c.clone(),x=g.words,A=m.words,N=0;N<f;N++)x[N]^=1549556828,A[N]^=909522486;g.sigBytes=m.sigBytes=p,this.reset()},reset:function(){var s=this._hasher;s.reset(),s.update(this._iKey)},update:function(s){return this._hasher.update(s),this},finalize:function(s){var c=this._hasher;return s=c.finalize(s),c.reset(),c.finalize(this._oKey.clone().concat(s))}})}(),function(){var c,r=E,a=(c=r.lib).Base,s=c.WordArray,f=(c=r.algo).HMAC,p=c.PBKDF2=a.extend({cfg:a.extend({keySize:4,hasher:c.SHA1,iterations:1}),init:function(g){this.cfg=this.cfg.extend(g)},compute:function(g,m){for(var x=f.create((F=this.cfg).hasher,g),A=s.create(),N=s.create([1]),P=A.words,b=N.words,y=F.keySize,F=F.iterations;P.length<y;){var C=x.update(m).finalize(N);x.reset();for(var I=C.words,T=I.length,L=C,Z=1;Z<F;Z++){L=x.finalize(L),x.reset();for(var W=L.words,G=0;G<T;G++)I[G]^=W[G]}A.concat(C),b[0]++}return A.sigBytes=4*y,A}});r.PBKDF2=function(g,m,x){return p.create(x).compute(g,m)}}();var ne,k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",z="=";function S(r){var a,s,c="";for(a=0;a+3<=r.length;a+=3)s=parseInt(r.substring(a,a+3),16),c+=k.charAt(s>>6)+k.charAt(63&s);if(a+1==r.length?(s=parseInt(r.substring(a,a+1),16),c+=k.charAt(s<<2)):a+2==r.length&&(s=parseInt(r.substring(a,a+2),16),c+=k.charAt(s>>2)+k.charAt((3&s)<<4)),z)for(;(3&c.length)>0;)c+=z;return c}function K(r){var s,f,p,a="",c=0;for(s=0;s<r.length&&r.charAt(s)!=z;++s)!((p=k.indexOf(r.charAt(s)))<0)&&(0==c?(a+=ue(p>>2),f=3&p,c=1):1==c?(a+=ue(f<<2|p>>4),f=15&p,c=2):2==c?(a+=ue(f),a+=ue(p>>2),f=3&p,c=3):(a+=ue(f<<2|p>>4),a+=ue(15&p),c=0));return 1==c&&(a+=ue(f<<2)),a}function V(r,a,s){null!=r&&("number"==typeof r?this.fromNumber(r,a,s):this.fromString(r,null==a&&"string"!=typeof r?256:a))}function Te(){return new V(null)}"Microsoft Internet Explorer"==R.appName?(V.prototype.am=function Me(r,a,s,c,f,p){for(var g=32767&a,m=a>>15;--p>=0;){var x=32767&this[r],A=this[r++]>>15,N=m*x+A*g;f=((x=g*x+((32767&N)<<15)+s[c]+(1073741823&f))>>>30)+(N>>>15)+m*A+(f>>>30),s[c++]=1073741823&x}return f},ne=30):"Netscape"!=R.appName?(V.prototype.am=function Ie(r,a,s,c,f,p){for(;--p>=0;){var g=a*this[r++]+s[c]+f;f=Math.floor(g/67108864),s[c++]=67108863&g}return f},ne=26):(V.prototype.am=function Be(r,a,s,c,f,p){for(var g=16383&a,m=a>>14;--p>=0;){var x=16383&this[r],A=this[r++]>>14,N=m*x+A*g;f=((x=g*x+((16383&N)<<14)+s[c]+f)>>28)+(N>>14)+m*A,s[c++]=268435455&x}return f},ne=28),V.prototype.DB=ne,V.prototype.DM=(1<<ne)-1,V.prototype.DV=1<<ne,V.prototype.FV=Math.pow(2,52),V.prototype.F1=52-ne,V.prototype.F2=2*ne-52;var pe,Ae,ge="0123456789abcdefghijklmnopqrstuvwxyz",te=new Array;for(pe="0".charCodeAt(0),Ae=0;Ae<=9;++Ae)te[pe++]=Ae;for(pe="a".charCodeAt(0),Ae=10;Ae<36;++Ae)te[pe++]=Ae;for(pe="A".charCodeAt(0),Ae=10;Ae<36;++Ae)te[pe++]=Ae;function ue(r){return ge.charAt(r)}function he(r,a){return te[r.charCodeAt(a)]??-1}function we(r){var a=Te();return a.fromInt(r),a}function Ut(r){var s,a=1;return 0!=(s=r>>>16)&&(r=s,a+=16),0!=(s=r>>8)&&(r=s,a+=8),0!=(s=r>>4)&&(r=s,a+=4),0!=(s=r>>2)&&(r=s,a+=2),0!=(s=r>>1)&&(r=s,a+=1),a}function ot(r){this.m=r}function $t(r){this.m=r,this.mp=r.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<r.DB-15)-1,this.mt2=2*r.t}function rt(r,a){return r&a}function it(r,a){return r|a}function Ai(r,a){return r^a}function qn(r,a){return r&~a}function Cn(r){if(0==r)return-1;var a=0;return 65535&r||(r>>=16,a+=16),255&r||(r>>=8,a+=8),15&r||(r>>=4,a+=4),3&r||(r>>=2,a+=2),1&r||++a,a}function Rr(r){for(var a=0;0!=r;)r&=r-1,++a;return a}function _r(){}function as(r){return r}function wr(r){this.r2=Te(),this.q3=Te(),V.ONE.dlShiftTo(2*r.t,this.r2),this.mu=this.r2.divide(r),this.m=r}ot.prototype.convert=function Nt(r){return r.s<0||r.compareTo(this.m)>=0?r.mod(this.m):r},ot.prototype.revert=function gt(r){return r},ot.prototype.reduce=function xt(r){r.divRemTo(this.m,null,r)},ot.prototype.mulTo=function Zt(r,a,s){r.multiplyTo(a,s),this.reduce(s)},ot.prototype.sqrTo=function on(r,a){r.squareTo(a),this.reduce(a)},$t.prototype.convert=function st(r){var a=Te();return r.abs().dlShiftTo(this.m.t,a),a.divRemTo(this.m,null,a),r.s<0&&a.compareTo(V.ZERO)>0&&this.m.subTo(a,a),a},$t.prototype.revert=function Nn(r){var a=Te();return r.copyTo(a),this.reduce(a),a},$t.prototype.reduce=function fn(r){for(;r.t<=this.mt2;)r[r.t++]=0;for(var a=0;a<this.m.t;++a){var s=32767&r[a],c=s*this.mpl+((s*this.mph+(r[a]>>15)*this.mpl&this.um)<<15)&r.DM;for(r[s=a+this.m.t]+=this.m.am(0,c,r,a,0,this.m.t);r[s]>=r.DV;)r[s]-=r.DV,r[++s]++}r.clamp(),r.drShiftTo(this.m.t,r),r.compareTo(this.m)>=0&&r.subTo(this.m,r)},$t.prototype.mulTo=function xr(r,a,s){r.multiplyTo(a,s),this.reduce(s)},$t.prototype.sqrTo=function lr(r,a){r.squareTo(a),this.reduce(a)},V.prototype.copyTo=function ie(r){for(var a=this.t-1;a>=0;--a)r[a]=this[a];r.t=this.t,r.s=this.s},V.prototype.fromInt=function Pe(r){this.t=1,this.s=r<0?-1:0,r>0?this[0]=r:r<-1?this[0]=r+this.DV:this.t=0},V.prototype.fromString=function de(r,a){var s;if(16==a)s=4;else if(8==a)s=3;else if(256==a)s=8;else if(2==a)s=1;else if(32==a)s=5;else{if(4!=a)return void this.fromRadix(r,a);s=2}this.t=0,this.s=0;for(var c=r.length,f=!1,p=0;--c>=0;){var g=8==s?255&r[c]:he(r,c);g<0?"-"==r.charAt(c)&&(f=!0):(f=!1,0==p?this[this.t++]=g:p+s>this.DB?(this[this.t-1]|=(g&(1<<this.DB-p)-1)<<p,this[this.t++]=g>>this.DB-p):this[this.t-1]|=g<<p,(p+=s)>=this.DB&&(p-=this.DB))}8==s&&128&r[0]&&(this.s=-1,p>0&&(this[this.t-1]|=(1<<this.DB-p)-1<<p)),this.clamp(),f&&V.ZERO.subTo(this,this)},V.prototype.clamp=function ve(){for(var r=this.s&this.DM;this.t>0&&this[this.t-1]==r;)--this.t},V.prototype.dlShiftTo=function je(r,a){var s;for(s=this.t-1;s>=0;--s)a[s+r]=this[s];for(s=r-1;s>=0;--s)a[s]=0;a.t=this.t+r,a.s=this.s},V.prototype.drShiftTo=function Re(r,a){for(var s=r;s<this.t;++s)a[s-r]=this[s];a.t=Math.max(this.t-r,0),a.s=this.s},V.prototype.lShiftTo=function tt(r,a){var m,s=r%this.DB,c=this.DB-s,f=(1<<c)-1,p=Math.floor(r/this.DB),g=this.s<<s&this.DM;for(m=this.t-1;m>=0;--m)a[m+p+1]=this[m]>>c|g,g=(this[m]&f)<<s;for(m=p-1;m>=0;--m)a[m]=0;a[p]=g,a.t=this.t+p+1,a.s=this.s,a.clamp()},V.prototype.rShiftTo=function Xe(r,a){a.s=this.s;var s=Math.floor(r/this.DB);if(s>=this.t)a.t=0;else{var c=r%this.DB,f=this.DB-c,p=(1<<c)-1;a[0]=this[s]>>c;for(var g=s+1;g<this.t;++g)a[g-s-1]|=(this[g]&p)<<f,a[g-s]=this[g]>>c;c>0&&(a[this.t-s-1]|=(this.s&p)<<f),a.t=this.t-s,a.clamp()}},V.prototype.subTo=function Ot(r,a){for(var s=0,c=0,f=Math.min(r.t,this.t);s<f;)c+=this[s]-r[s],a[s++]=c&this.DM,c>>=this.DB;if(r.t<this.t){for(c-=r.s;s<this.t;)c+=this[s],a[s++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;s<r.t;)c-=r[s],a[s++]=c&this.DM,c>>=this.DB;c-=r.s}a.s=c<0?-1:0,c<-1?a[s++]=this.DV+c:c>0&&(a[s++]=c),a.t=s,a.clamp()},V.prototype.multiplyTo=function He(r,a){var s=this.abs(),c=r.abs(),f=s.t;for(a.t=f+c.t;--f>=0;)a[f]=0;for(f=0;f<c.t;++f)a[f+s.t]=s.am(0,c[f],a,f,0,s.t);a.s=0,a.clamp(),this.s!=r.s&&V.ZERO.subTo(a,a)},V.prototype.squareTo=function nt(r){for(var a=this.abs(),s=r.t=2*a.t;--s>=0;)r[s]=0;for(s=0;s<a.t-1;++s){var c=a.am(s,a[s],r,2*s,0,1);(r[s+a.t]+=a.am(s+1,2*a[s],r,2*s+1,c,a.t-s-1))>=a.DV&&(r[s+a.t]-=a.DV,r[s+a.t+1]=1)}r.t>0&&(r[r.t-1]+=a.am(s,a[s],r,2*s,0,1)),r.s=0,r.clamp()},V.prototype.divRemTo=function At(r,a,s){var c=r.abs();if(!(c.t<=0)){var f=this.abs();if(f.t<c.t)return a?.fromInt(0),void(null!=s&&this.copyTo(s));null==s&&(s=Te());var p=Te(),g=this.s,m=r.s,x=this.DB-Ut(c[c.t-1]);x>0?(c.lShiftTo(x,p),f.lShiftTo(x,s)):(c.copyTo(p),f.copyTo(s));var A=p.t,N=p[A-1];if(0!=N){var P=N*(1<<this.F1)+(A>1?p[A-2]>>this.F2:0),b=this.FV/P,y=(1<<this.F1)/P,F=1<<this.F2,C=s.t,I=C-A,T=a??Te();for(p.dlShiftTo(I,T),s.compareTo(T)>=0&&(s[s.t++]=1,s.subTo(T,s)),V.ONE.dlShiftTo(A,T),T.subTo(p,p);p.t<A;)p[p.t++]=0;for(;--I>=0;){var L=s[--C]==N?this.DM:Math.floor(s[C]*b+(s[C-1]+F)*y);if((s[C]+=p.am(0,L,s,I,0,A))<L)for(p.dlShiftTo(I,T),s.subTo(T,s);s[C]<--L;)s.subTo(T,s)}null!=a&&(s.drShiftTo(A,a),g!=m&&V.ZERO.subTo(a,a)),s.t=A,s.clamp(),x>0&&s.rShiftTo(x,s),g<0&&V.ZERO.subTo(s,s)}}},V.prototype.invDigit=function ut(){if(this.t<1)return 0;var r=this[0];if(!(1&r))return 0;var a=3&r;return(a=(a=(a=(a=a*(2-(15&r)*a)&15)*(2-(255&r)*a)&255)*(2-((65535&r)*a&65535))&65535)*(2-r*a%this.DV)%this.DV)>0?this.DV-a:-a},V.prototype.isEven=function Ln(){return 0==(this.t>0?1&this[0]:this.s)},V.prototype.exp=function Rt(r,a){if(r>4294967295||r<1)return V.ONE;var s=Te(),c=Te(),f=a.convert(this),p=Ut(r)-1;for(f.copyTo(s);--p>=0;)if(a.sqrTo(s,c),(r&1<<p)>0)a.mulTo(c,f,s);else{var g=s;s=c,c=g}return a.revert(s)},V.prototype.toString=function be(r){if(this.s<0)return"-"+this.negate().toString(r);var a;if(16==r)a=4;else if(8==r)a=3;else if(2==r)a=1;else if(32==r)a=5;else{if(4!=r)return this.toRadix(r);a=2}var c,s=(1<<a)-1,f=!1,p="",g=this.t,m=this.DB-g*this.DB%a;if(g-- >0)for(m<this.DB&&(c=this[g]>>m)>0&&(f=!0,p=ue(c));g>=0;)m<a?(c=(this[g]&(1<<m)-1)<<a-m,c|=this[--g]>>(m+=this.DB-a)):(c=this[g]>>(m-=a)&s,m<=0&&(m+=this.DB,--g)),c>0&&(f=!0),f&&(p+=ue(c));return f?p:"0"},V.prototype.negate=function at(){var r=Te();return V.ZERO.subTo(this,r),r},V.prototype.abs=function Ke(){return this.s<0?this.negate():this},V.prototype.compareTo=function Je(r){var a=this.s-r.s;if(0!=a)return a;var s=this.t;if(0!=(a=s-r.t))return this.s<0?-a:a;for(;--s>=0;)if(0!=(a=this[s]-r[s]))return a;return 0},V.prototype.bitLength=function _e(){return this.t<=0?0:this.DB*(this.t-1)+Ut(this[this.t-1]^this.s&this.DM)},V.prototype.mod=function Pt(r){var a=Te();return this.abs().divRemTo(r,null,a),this.s<0&&a.compareTo(V.ZERO)>0&&r.subTo(a,a),a},V.prototype.modPowInt=function nr(r,a){var s;return s=r<256||a.isEven()?new ot(a):new $t(a),this.exp(r,s)},V.ZERO=we(0),V.ONE=we(1),_r.prototype.convert=as,_r.prototype.revert=as,_r.prototype.mulTo=function Mr(r,a,s){r.multiplyTo(a,s)},_r.prototype.sqrTo=function os(r,a){r.squareTo(a)},wr.prototype.convert=function Di(r){if(r.s<0||r.t>2*this.m.t)return r.mod(this.m);if(r.compareTo(this.m)<0)return r;var a=Te();return r.copyTo(a),this.reduce(a),a},wr.prototype.revert=function la(r){return r},wr.prototype.reduce=function cs(r){for(r.drShiftTo(this.m.t-1,this.r2),r.t>this.m.t+1&&(r.t=this.m.t+1,r.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);r.compareTo(this.r2)<0;)r.dAddOffset(1,this.m.t+1);for(r.subTo(this.r2,r);r.compareTo(this.m)>=0;)r.subTo(this.m,r)},wr.prototype.mulTo=function _n(r,a,s){r.multiplyTo(a,s),this.reduce(s)},wr.prototype.sqrTo=function Mo(r,a){r.squareTo(a),this.reduce(a)};var un=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],da=(1<<26)/un[un.length-1];function Vn(){this.i=0,this.j=0,this.S=new Array}V.prototype.chunkSize=function Pr(r){return Math.floor(Math.LN2*this.DB/Math.log(r))},V.prototype.toRadix=function Ei(r){if(null==r&&(r=10),0==this.signum()||r<2||r>36)return"0";var a=this.chunkSize(r),s=Math.pow(r,a),c=we(s),f=Te(),p=Te(),g="";for(this.divRemTo(c,f,p);f.signum()>0;)g=(s+p.intValue()).toString(r).substr(1)+g,f.divRemTo(c,f,p);return p.intValue().toString(r)+g},V.prototype.fromRadix=function Qr(r,a){this.fromInt(0),null==a&&(a=10);for(var s=this.chunkSize(a),c=Math.pow(a,s),f=!1,p=0,g=0,m=0;m<r.length;++m){var x=he(r,m);x<0?"-"==r.charAt(m)&&0==this.signum()&&(f=!0):(g=a*g+x,++p>=s&&(this.dMultiply(c),this.dAddOffset(g,0),p=0,g=0))}p>0&&(this.dMultiply(Math.pow(a,p)),this.dAddOffset(g,0)),f&&V.ZERO.subTo(this,this)},V.prototype.fromNumber=function Hn(r,a,s){if("number"==typeof a)if(r<2)this.fromInt(1);else for(this.fromNumber(r,s),this.testBit(r-1)||this.bitwiseTo(V.ONE.shiftLeft(r-1),it,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(a);)this.dAddOffset(2,0),this.bitLength()>r&&this.subTo(V.ONE.shiftLeft(r-1),this);else{var c=new Array,f=7&r;c.length=1+(r>>3),a.nextBytes(c),f>0?c[0]&=(1<<f)-1:c[0]=0,this.fromString(c,256)}},V.prototype.bitwiseTo=function na(r,a,s){var c,f,p=Math.min(r.t,this.t);for(c=0;c<p;++c)s[c]=a(this[c],r[c]);if(r.t<this.t){for(f=r.s&this.DM,c=p;c<this.t;++c)s[c]=a(this[c],f);s.t=this.t}else{for(f=this.s&this.DM,c=p;c<r.t;++c)s[c]=a(f,r[c]);s.t=r.t}s.s=a(this.s,r.s),s.clamp()},V.prototype.changeBit=function Xr(r,a){var s=V.ONE.shiftLeft(r);return this.bitwiseTo(s,a,s),s},V.prototype.addTo=function Fi(r,a){for(var s=0,c=0,f=Math.min(r.t,this.t);s<f;)c+=this[s]+r[s],a[s++]=c&this.DM,c>>=this.DB;if(r.t<this.t){for(c+=r.s;s<this.t;)c+=this[s],a[s++]=c&this.DM,c>>=this.DB;c+=this.s}else{for(c+=this.s;s<r.t;)c+=r[s],a[s++]=c&this.DM,c>>=this.DB;c+=r.s}a.s=c<0?-1:0,c>0?a[s++]=c:c<-1&&(a[s++]=this.DV+c),a.t=s,a.clamp()},V.prototype.dMultiply=function Wn(r){this[this.t]=this.am(0,r-1,this,0,0,this.t),++this.t,this.clamp()},V.prototype.dAddOffset=function oa(r,a){if(0!=r){for(;this.t<=a;)this[this.t++]=0;for(this[a]+=r;this[a]>=this.DV;)this[a]-=this.DV,++a>=this.t&&(this[this.t++]=0),++this[a]}},V.prototype.multiplyLowerTo=function ua(r,a,s){var f,c=Math.min(this.t+r.t,a);for(s.s=0,s.t=c;c>0;)s[--c]=0;for(f=s.t-this.t;c<f;++c)s[c+this.t]=this.am(0,r[c],s,c,0,this.t);for(f=Math.min(r.t,a);c<f;++c)this.am(0,r[c],s,c,0,a-c);s.clamp()},V.prototype.multiplyUpperTo=function ca(r,a,s){--a;var c=s.t=this.t+r.t-a;for(s.s=0;--c>=0;)s[c]=0;for(c=Math.max(a-this.t,0);c<r.t;++c)s[this.t+c-a]=this.am(a-c,r[c],s,0,0,this.t+c-a);s.clamp(),s.drShiftTo(1,s)},V.prototype.modInt=function ls(r){if(r<=0)return 0;var a=this.DV%r,s=this.s<0?r-1:0;if(this.t>0)if(0==a)s=this[0]%r;else for(var c=this.t-1;c>=0;--c)s=(a*s+this[c])%r;return s},V.prototype.millerRabin=function ko(r){var a=this.subtract(V.ONE),s=a.getLowestSetBit();if(s<=0)return!1;var c=a.shiftRight(s);(r=r+1>>1)>un.length&&(r=un.length);for(var f=Te(),p=0;p<r;++p){f.fromInt(un[Math.floor(Math.random()*un.length)]);var g=f.modPow(c,this);if(0!=g.compareTo(V.ONE)&&0!=g.compareTo(a)){for(var m=1;m++<s&&0!=g.compareTo(a);)if(0==(g=g.modPowInt(2,this)).compareTo(V.ONE))return!1;if(0!=g.compareTo(a))return!1}}return!0},V.prototype.clone=function Kn(){var r=Te();return this.copyTo(r),r},V.prototype.intValue=function Ci(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},V.prototype.byteValue=function hr(){return 0==this.t?this.s:this[0]<<24>>24},V.prototype.shortValue=function Gn(){return 0==this.t?this.s:this[0]<<16>>16},V.prototype.signum=function Nr(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},V.prototype.toByteArray=function bt(){var r=this.t,a=new Array;a[0]=this.s;var c,s=this.DB-r*this.DB%8,f=0;if(r-- >0)for(s<this.DB&&(c=this[r]>>s)!=(this.s&this.DM)>>s&&(a[f++]=c|this.s<<this.DB-s);r>=0;)s<8?(c=(this[r]&(1<<s)-1)<<8-s,c|=this[--r]>>(s+=this.DB-8)):(c=this[r]>>(s-=8)&255,s<=0&&(s+=this.DB,--r)),128&c&&(c|=-256),0==f&&(128&this.s)!=(128&c)&&++f,(f>0||c!=this.s)&&(a[f++]=c);return a},V.prototype.equals=function rs(r){return 0==this.compareTo(r)},V.prototype.min=function Tt(r){return this.compareTo(r)<0?this:r},V.prototype.max=function Xt(r){return this.compareTo(r)>0?this:r},V.prototype.and=function ra(r){var a=Te();return this.bitwiseTo(r,rt,a),a},V.prototype.or=function _o(r){var a=Te();return this.bitwiseTo(r,it,a),a},V.prototype.xor=function rr(r){var a=Te();return this.bitwiseTo(r,Ai,a),a},V.prototype.andNot=function Ti(r){var a=Te();return this.bitwiseTo(r,qn,a),a},V.prototype.not=function wt(){for(var r=Te(),a=0;a<this.t;++a)r[a]=this.DM&~this[a];return r.t=this.t,r.s=~this.s,r},V.prototype.shiftLeft=function ia(r){var a=Te();return r<0?this.rShiftTo(-r,a):this.lShiftTo(r,a),a},V.prototype.shiftRight=function zn(r){var a=Te();return r<0?this.lShiftTo(-r,a):this.rShiftTo(r,a),a},V.prototype.getLowestSetBit=function dr(){for(var r=0;r<this.t;++r)if(0!=this[r])return r*this.DB+Cn(this[r]);return this.s<0?this.t*this.DB:-1},V.prototype.bitCount=function Mt(){for(var r=0,a=this.s&this.DM,s=0;s<this.t;++s)r+=Rr(this[s]^a);return r},V.prototype.testBit=function En(r){var a=Math.floor(r/this.DB);return a>=this.t?0!=this.s:0!=(this[a]&1<<r%this.DB)},V.prototype.setBit=function is(r){return this.changeBit(r,it)},V.prototype.clearBit=function ss(r){return this.changeBit(r,qn)},V.prototype.flipBit=function sa(r){return this.changeBit(r,Ai)},V.prototype.add=function fr(r){var a=Te();return this.addTo(r,a),a},V.prototype.subtract=function aa(r){var a=Te();return this.subTo(r,a),a},V.prototype.multiply=function Ir(r){var a=Te();return this.multiplyTo(r,a),a},V.prototype.divide=function Or(r){var a=Te();return this.divRemTo(r,a,null),a},V.prototype.remainder=function Le(r){var a=Te();return this.divRemTo(r,null,a),a},V.prototype.divideAndRemainder=function jt(r){var a=Te(),s=Te();return this.divRemTo(r,a,s),new Array(a,s)},V.prototype.modPow=function sn(r,a){var c,p,s=r.bitLength(),f=we(1);if(s<=0)return f;c=s<18?1:s<48?3:s<144?4:s<768?5:6,p=s<8?new ot(a):a.isEven()?new wr(a):new $t(a);var g=new Array,m=3,x=c-1,A=(1<<c)-1;if(g[1]=p.convert(this),c>1){var N=Te();for(p.sqrTo(g[1],N);m<=A;)g[m]=Te(),p.mulTo(N,g[m-2],g[m]),m+=2}var b,C,P=r.t-1,y=!0,F=Te();for(s=Ut(r[P])-1;P>=0;){for(s>=x?b=r[P]>>s-x&A:(b=(r[P]&(1<<s+1)-1)<<x-s,P>0&&(b|=r[P-1]>>this.DB+s-x)),m=c;!(1&b);)b>>=1,--m;if((s-=m)<0&&(s+=this.DB,--P),y)g[b].copyTo(f),y=!1;else{for(;m>1;)p.sqrTo(f,F),p.sqrTo(F,f),m-=2;m>0?p.sqrTo(f,F):(C=f,f=F,F=C),p.mulTo(F,g[b],f)}for(;P>=0&&!(r[P]&1<<s);)p.sqrTo(f,F),C=f,f=F,F=C,--s<0&&(s=this.DB-1,--P)}return p.revert(f)},V.prototype.modInverse=function Pi(r){var a=r.isEven();if(this.isEven()&&a||0==r.signum())return V.ZERO;for(var s=r.clone(),c=this.clone(),f=we(1),p=we(0),g=we(0),m=we(1);0!=s.signum();){for(;s.isEven();)s.rShiftTo(1,s),a?((!f.isEven()||!p.isEven())&&(f.addTo(this,f),p.subTo(r,p)),f.rShiftTo(1,f)):p.isEven()||p.subTo(r,p),p.rShiftTo(1,p);for(;c.isEven();)c.rShiftTo(1,c),a?((!g.isEven()||!m.isEven())&&(g.addTo(this,g),m.subTo(r,m)),g.rShiftTo(1,g)):m.isEven()||m.subTo(r,m),m.rShiftTo(1,m);s.compareTo(c)>=0?(s.subTo(c,s),a&&f.subTo(g,f),p.subTo(m,p)):(c.subTo(s,c),a&&g.subTo(f,g),m.subTo(p,m))}return 0!=c.compareTo(V.ONE)?V.ZERO:m.compareTo(r)>=0?m.subtract(r):m.signum()<0?(m.addTo(r,m),m.signum()<0?m.add(r):m):m},V.prototype.pow=function us(r){return this.exp(r,new _r)},V.prototype.gcd=function ha(r){var a=this.s<0?this.negate():this.clone(),s=r.s<0?r.negate():r.clone();if(a.compareTo(s)<0){var c=a;a=s,s=c}var f=a.getLowestSetBit(),p=s.getLowestSetBit();if(p<0)return a;for(f<p&&(p=f),p>0&&(a.rShiftTo(p,a),s.rShiftTo(p,s));a.signum()>0;)(f=a.getLowestSetBit())>0&&a.rShiftTo(f,a),(f=s.getLowestSetBit())>0&&s.rShiftTo(f,s),a.compareTo(s)>=0?(a.subTo(s,a),a.rShiftTo(1,a)):(s.subTo(a,s),s.rShiftTo(1,s));return p>0&&s.lShiftTo(p,s),s},V.prototype.isProbablePrime=function fa(r){var a,s=this.abs();if(1==s.t&&s[0]<=un[un.length-1]){for(a=0;a<un.length;++a)if(s[0]==un[a])return!0;return!1}if(s.isEven())return!1;for(a=1;a<un.length;){for(var c=un[a],f=a+1;f<un.length&&c<da;)c*=un[f++];for(c=s.modInt(c);a<f;)if(c%un[a++]==0)return!1}return s.millerRabin(r)},V.prototype.square=function Yr(){var r=Te();return this.squareTo(r),r},Vn.prototype.init=function pa(r){var a,s,c;for(a=0;a<256;++a)this.S[a]=a;for(s=0,a=0;a<256;++a)c=this.S[a],this.S[a]=this.S[s=s+this.S[a]+r[a%r.length]&255],this.S[s]=c;this.i=0,this.j=0},Vn.prototype.next=function hs(){var r;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,r=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=r,this.S[r+this.S[this.i]&255]};var An,Tn,Yt,ei=256;function Ni(){!function Mn(r){Tn[Yt++]^=255&r,Tn[Yt++]^=r>>8&255,Tn[Yt++]^=r>>16&255,Tn[Yt++]^=r>>24&255,Yt>=ei&&(Yt-=ei)}((new Date).getTime())}if(null==Tn){var Fn;if(Tn=new Array,Yt=0,void 0!==B&&(void 0!==B.crypto||void 0!==B.msCrypto)){var ti=B.crypto||B.msCrypto;if(ti.getRandomValues){var ni=new Uint8Array(32);for(ti.getRandomValues(ni),Fn=0;Fn<32;++Fn)Tn[Yt++]=ni[Fn]}else if("Netscape"==R.appName&&R.appVersion<"5"){var fs=B.crypto.random(32);for(Fn=0;Fn<fs.length;++Fn)Tn[Yt++]=255&fs.charCodeAt(Fn)}}for(;Yt<ei;)Fn=Math.floor(65536*Math.random()),Tn[Yt++]=Fn>>>8,Tn[Yt++]=255&Fn;Yt=0,Ni()}function kr(){if(null==An){for(Ni(),(An=function ds(){return new Vn}()).init(Tn),Yt=0;Yt<Tn.length;++Yt)Tn[Yt]=0;Yt=0}return An.next()}function $n(){}function pt(r,a){return new V(r,a)}function ri(r,a,s){for(var c="",f=0;c.length<a;)c+=s(String.fromCharCode.apply(String,r.concat([(4278190080&f)>>24,(16711680&f)>>16,(65280&f)>>8,255&f]))),f+=1;return c}function Ve(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function Br(r,a,s){for(var c="",f=0;c.length<a;)c+=s(r+String.fromCharCode.apply(String,[(4278190080&f)>>24,(16711680&f)>>16,(65280&f)>>8,255&f])),f+=1;return c}function Vt(r,a){this.x=a,this.q=r}function ft(r,a,s,c){this.curve=r,this.x=a,this.y=s,this.z=null==c?V.ONE:c,this.zinv=null}function Qn(r,a,s){this.q=r,this.a=this.fromBigInteger(a),this.b=this.fromBigInteger(s),this.infinity=new ft(this,null,null)}$n.prototype.nextBytes=function ps(r){var a;for(a=0;a<r.length;++a)r[a]=kr()},Ve.prototype.doPublic=function ya(r){return r.modPowInt(this.e,this.n)},Ve.prototype.setPublic=function Bo(r,a){if(this.isPublic=!0,this.isPrivate=!1,"string"!=typeof r)this.n=r,this.e=a;else{if(!(null!=r&&null!=a&&r.length>0&&a.length>0))throw"Invalid RSA public key";this.n=pt(r,16),this.e=parseInt(a,16)}},Ve.prototype.encrypt=function Ri(r){var a=function ma(r,a){if(a<r.length+11)throw"Message too long for RSA";for(var s=new Array,c=r.length-1;c>=0&&a>0;){var f=r.charCodeAt(c--);f<128?s[--a]=f:f>127&&f<2048?(s[--a]=63&f|128,s[--a]=f>>6|192):(s[--a]=63&f|128,s[--a]=f>>6&63|128,s[--a]=f>>12|224)}s[--a]=0;for(var p=new $n,g=new Array;a>2;){for(g[0]=0;0==g[0];)p.nextBytes(g);s[--a]=g[0]}return s[--a]=2,s[--a]=0,new V(s)}(r,this.n.bitLength()+7>>3);if(null==a)return null;var s=this.doPublic(a);if(null==s)return null;var c=s.toString(16);return 1&c.length?"0"+c:c},Ve.prototype.encryptOAEP=function ba(r,a,s){var c=function va(r,a,s,c){var f=d.crypto.MessageDigest,p=d.crypto.Util,g=null;if(s||(s="sha1"),"string"==typeof s&&(g=f.getCanonicalAlgName(s),c=f.getHashLength(g),s=function(C){return tn(p.hashHex(Rn(C),g))}),r.length+2*c+2>a)throw"Message too long for RSA";var x,m="";for(x=0;x<a-r.length-2*c-2;x+=1)m+="\0";var A=s("")+m+"\x01"+r,N=new Array(c);(new $n).nextBytes(N);var P=ri(N,A.length,s),b=[];for(x=0;x<A.length;x+=1)b[x]=A.charCodeAt(x)^P.charCodeAt(x);var y=ri(b,N.length,s),F=[0];for(x=0;x<N.length;x+=1)F[x+1]=N[x]^y.charCodeAt(x);return new V(F.concat(b))}(r,this.n.bitLength()+7>>3,a,s);if(null==c)return null;var f=this.doPublic(c);if(null==f)return null;var p=f.toString(16);return 1&p.length?"0"+p:p},Ve.prototype.type="RSA",Ve.prototype.doPrivate=function gs(r){if(null==this.p||null==this.q)return r.modPow(this.d,this.n);for(var a=r.mod(this.p).modPow(this.dmp1,this.p),s=r.mod(this.q).modPow(this.dmq1,this.q);a.compareTo(s)<0;)a=a.add(this.p);return a.subtract(s).multiply(this.coeff).mod(this.p).multiply(this.q).add(s)},Ve.prototype.setPrivate=function jr(r,a,s){if(this.isPrivate=!0,"string"!=typeof r)this.n=r,this.e=a,this.d=s;else{if(!(null!=r&&null!=a&&r.length>0&&a.length>0))throw"Invalid RSA private key";this.n=pt(r,16),this.e=parseInt(a,16),this.d=pt(s,16)}},Ve.prototype.setPrivateEx=function Ii(r,a,s,c,f,p,g,m){if(this.isPrivate=!0,this.isPublic=!1,null==r)throw"RSASetPrivateEx N == null";if(null==a)throw"RSASetPrivateEx E == null";if(0==r.length)throw"RSASetPrivateEx N.length == 0";if(0==a.length)throw"RSASetPrivateEx E.length == 0";if(!(null!=r&&null!=a&&r.length>0&&a.length>0))throw"Invalid RSA private key in RSASetPrivateEx";this.n=pt(r,16),this.e=parseInt(a,16),this.d=pt(s,16),this.p=pt(c,16),this.q=pt(f,16),this.dmp1=pt(p,16),this.dmq1=pt(g,16),this.coeff=pt(m,16)},Ve.prototype.generate=function kn(r,a){var s=new $n,c=r>>1;this.e=parseInt(a,16);for(var f=new V(a,16),p=r/2-100,g=V.ONE.shiftLeft(p);;){for(;this.p=new V(r-c,1,s),0!=this.p.subtract(V.ONE).gcd(f).compareTo(V.ONE)||!this.p.isProbablePrime(10););for(;this.q=new V(c,1,s),0!=this.q.subtract(V.ONE).gcd(f).compareTo(V.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var m=this.p;this.p=this.q,this.q=m}var x=this.q.subtract(this.p).abs();if(!(x.bitLength()<p||x.compareTo(g)<=0)){var A=this.p.subtract(V.ONE),N=this.q.subtract(V.ONE),P=A.multiply(N);if(0==P.gcd(f).compareTo(V.ONE)&&(this.n=this.p.multiply(this.q),this.n.bitLength()==r)){this.d=f.modInverse(P),this.dmp1=this.d.mod(A),this.dmq1=this.d.mod(N),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0},Ve.prototype.decrypt=function jo(r){if(r.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var a=pt(r,16),s=this.doPrivate(a);return null==s?null:function Un(r,a){for(var s=r.toByteArray(),c=0;c<s.length&&0==s[c];)++c;if(s.length-c!=a-1||2!=s[c])return null;for(++c;0!=s[c];)if(++c>=s.length)return null;for(var f="";++c<s.length;){var p=255&s[c];p<128?f+=String.fromCharCode(p):p>191&&p<224?(f+=String.fromCharCode((31&p)<<6|63&s[c+1]),++c):(f+=String.fromCharCode((15&p)<<12|(63&s[c+1])<<6|63&s[c+2]),c+=2)}return f}(s,this.n.bitLength()+7>>3)},Ve.prototype.decryptOAEP=function Sa(r,a,s){if(r.length!=Math.ceil(this.n.bitLength()/4))throw new Error("wrong ctext length");var c=pt(r,16),f=this.doPrivate(c);return null==f?null:function ii(r,a,s,c){var f=d.crypto.MessageDigest,p=d.crypto.Util,g=null;for(s||(s="sha1"),"string"==typeof s&&(g=f.getCanonicalAlgName(s),c=f.getHashLength(g),s=function(I){return tn(p.hashHex(Rn(I),g))}),r=r.toByteArray(),P=0;P<r.length;P+=1)r[P]&=255;for(;r.length<a;)r.unshift(0);if((r=String.fromCharCode.apply(String,r)).length<2*c+2)throw"Cipher too short";var P,m=r.substr(1,c),x=r.substr(c+1),A=Br(x,c,s),N=[];for(P=0;P<m.length;P+=1)N[P]=m.charCodeAt(P)^A.charCodeAt(P);var b=Br(String.fromCharCode.apply(String,N),r.length-c,s),y=[];for(P=0;P<x.length;P+=1)y[P]=x.charCodeAt(P)^b.charCodeAt(P);if((y=String.fromCharCode.apply(String,y)).substr(0,c)!==s(""))throw"Hash mismatch";var F=(y=y.substr(c)).indexOf("\x01");if((-1!=F?y.substr(0,F).lastIndexOf("\0"):-1)+1!=F)throw"Malformed data";return y.substr(F+1)}(f,this.n.bitLength()+7>>3,a,s)},Vt.prototype.equals=function xa(r){return r==this||this.q.equals(r.q)&&this.x.equals(r.x)},Vt.prototype.toBigInteger=function Oi(){return this.x},Vt.prototype.negate=function Dn(){return new Vt(this.q,this.x.negate().mod(this.q))},Vt.prototype.add=function vn(r){return new Vt(this.q,this.x.add(r.toBigInteger()).mod(this.q))},Vt.prototype.subtract=function _i(r){return new Vt(this.q,this.x.subtract(r.toBigInteger()).mod(this.q))},Vt.prototype.multiply=function Cr(r){return new Vt(this.q,this.x.multiply(r.toBigInteger()).mod(this.q))},Vt.prototype.square=function wa(){return new Vt(this.q,this.x.square().mod(this.q))},Vt.prototype.divide=function gr(r){return new Vt(this.q,this.x.multiply(r.toBigInteger().modInverse(this.q)).mod(this.q))},Vt.prototype.sqrt=function(){return new Vt(this.q,this.x.sqrt().mod(this.q))},ft.prototype.getX=function ms(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))},ft.prototype.getY=function Ca(){return null==this.zinv&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))},ft.prototype.equals=function Ea(r){return r==this||(this.isInfinity()?r.isInfinity():r.isInfinity()?this.isInfinity():!!r.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(r.z)).mod(this.curve.q).equals(V.ZERO)&&r.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(r.z)).mod(this.curve.q).equals(V.ZERO))},ft.prototype.isInfinity=function Mi(){return null==this.x&&null==this.y||this.z.equals(V.ZERO)&&!this.y.toBigInteger().equals(V.ZERO)},ft.prototype.negate=function Jn(){return new ft(this.curve,this.x,this.y.negate(),this.z)},ft.prototype.add=function ki(r){if(this.isInfinity())return r;if(r.isInfinity())return this;var a=r.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(r.z)).mod(this.curve.q),s=r.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(r.z)).mod(this.curve.q);if(V.ZERO.equals(s))return V.ZERO.equals(a)?this.twice():this.curve.getInfinity();var c=new V("3"),f=this.x.toBigInteger(),p=this.y.toBigInteger(),x=(r.x.toBigInteger(),r.y.toBigInteger(),s.square()),A=x.multiply(s),N=f.multiply(x),P=a.square().multiply(this.z),b=P.subtract(N.shiftLeft(1)).multiply(r.z).subtract(A).multiply(s).mod(this.curve.q),y=N.multiply(c).multiply(a).subtract(p.multiply(A)).subtract(P.multiply(a)).multiply(r.z).add(a.multiply(A)).mod(this.curve.q),F=A.multiply(this.z).multiply(r.z).mod(this.curve.q);return new ft(this.curve,this.curve.fromBigInteger(b),this.curve.fromBigInteger(y),F)},ft.prototype.twice=function Bi(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var r=new V("3"),a=this.x.toBigInteger(),s=this.y.toBigInteger(),c=s.multiply(this.z),f=c.multiply(s).mod(this.curve.q),p=this.curve.a.toBigInteger(),g=a.square().multiply(r);V.ZERO.equals(p)||(g=g.add(this.z.square().multiply(p)));var m=(g=g.mod(this.curve.q)).square().subtract(a.shiftLeft(3).multiply(f)).shiftLeft(1).multiply(c).mod(this.curve.q),x=g.multiply(r).multiply(a).subtract(f.shiftLeft(1)).shiftLeft(2).multiply(f).subtract(g.square().multiply(g)).mod(this.curve.q),A=c.square().multiply(c).shiftLeft(3).mod(this.curve.q);return new ft(this.curve,this.curve.fromBigInteger(m),this.curve.fromBigInteger(x),A)},ft.prototype.multiply=function vs(r){if(this.isInfinity())return this;if(0==r.signum())return this.curve.getInfinity();var A,a=r,s=a.multiply(new V("3")),c=this.negate(),f=this,p=this.curve.q.subtract(r),g=p.multiply(new V("3")),m=new ft(this.curve,this.x,this.y),x=m.negate();for(A=s.bitLength()-2;A>0;--A){f=f.twice();var N=s.testBit(A);N!=a.testBit(A)&&(f=f.add(N?this:c))}for(A=g.bitLength()-2;A>0;--A){m=m.twice();var b=g.testBit(A);b!=p.testBit(A)&&(m=m.add(b?m:x))}return f},ft.prototype.multiplyTwo=function si(r,a,s){var c;c=r.bitLength()>s.bitLength()?r.bitLength()-1:s.bitLength()-1;for(var f=this.curve.getInfinity(),p=this.add(a);c>=0;)f=f.twice(),r.testBit(c)?f=s.testBit(c)?f.add(p):f.add(this):s.testBit(c)&&(f=f.add(a)),--c;return f},Qn.prototype.getQ=function Aa(){return this.q},Qn.prototype.getA=function ai(){return this.a},Qn.prototype.getB=function Lo(){return this.b},Qn.prototype.equals=function Ta(r){return r==this||this.q.equals(r.q)&&this.a.equals(r.a)&&this.b.equals(r.b)},Qn.prototype.getInfinity=function Fa(){return this.infinity},Qn.prototype.fromBigInteger=function Er(r){return new Vt(this.q,r)},Qn.prototype.decodePointHex=function Lr(r){switch(parseInt(r.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var a=r.substr(0,2),c=(r.substr(2),this.fromBigInteger(new V(A,16))),f=this.getA(),p=this.getB(),m=c.square().add(f).multiply(c).add(p).sqrt();return"03"==a&&(m=m.negate()),new ft(this,c,m);case 4:case 6:case 7:var x=(r.length-2)/2,A=r.substr(2,x),N=r.substr(x+2,x);return new ft(this,this.fromBigInteger(new V(A,16)),this.fromBigInteger(new V(N,16)));default:return null}},Vt.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},ft.prototype.getEncoded=function(r){var a=function(p,g){var m=p.toByteArrayUnsigned();if(g<m.length)m=m.slice(m.length-g);else for(;g>m.length;)m.unshift(0);return m},s=this.getX().toBigInteger(),c=this.getY().toBigInteger(),f=a(s,32);return r?c.isEven()?f.unshift(2):f.unshift(3):(f.unshift(4),f=f.concat(a(c,32))),f},ft.decodeFrom=function(r,a){var c=a.length-1,f=a.slice(1,1+c/2),p=a.slice(1+c/2,1+c);f.unshift(0),p.unshift(0);var g=new V(f),m=new V(p);return new ft(r,r.fromBigInteger(g),r.fromBigInteger(m))},ft.decodeFromHex=function(r,a){a.substr(0,2);var c=a.length-2,f=a.substr(2,c/2),p=a.substr(2+c/2,c/2),g=new V(f,16),m=new V(p,16);return new ft(r,r.fromBigInteger(g),r.fromBigInteger(m))},ft.prototype.add2D=function(r){if(this.isInfinity())return r;if(r.isInfinity())return this;if(this.x.equals(r.x))return this.y.equals(r.y)?this.twice():this.curve.getInfinity();var a=r.x.subtract(this.x),c=r.y.subtract(this.y).divide(a),f=c.square().subtract(this.x).subtract(r.x),p=c.multiply(this.x.subtract(f)).subtract(this.y);return new ft(this.curve,f,p)},ft.prototype.twice2D=function(){if(this.isInfinity())return this;if(0==this.y.toBigInteger().signum())return this.curve.getInfinity();var r=this.curve.fromBigInteger(V.valueOf(2)),a=this.curve.fromBigInteger(V.valueOf(3)),s=this.x.square().multiply(a).add(this.curve.a).divide(this.y.multiply(r)),c=s.square().subtract(this.x.multiply(r)),f=s.multiply(this.x.subtract(c)).subtract(this.y);return new ft(this.curve,c,f)},ft.prototype.multiply2D=function(r){if(this.isInfinity())return this;if(0==r.signum())return this.curve.getInfinity();var p,a=r,s=a.multiply(new V("3")),c=this.negate(),f=this;for(p=s.bitLength()-2;p>0;--p){f=f.twice();var g=s.testBit(p);g!=a.testBit(p)&&(f=f.add2D(g?this:c))}return f},ft.prototype.isOnCurve=function(){var r=this.getX().toBigInteger(),a=this.getY().toBigInteger(),s=this.curve.getA().toBigInteger(),c=this.curve.getB().toBigInteger(),f=this.curve.getQ(),p=a.multiply(a).mod(f),g=r.multiply(r).multiply(r).add(s.multiply(r)).add(c).mod(f);return p.equals(g)},ft.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},ft.prototype.validate=function(){var r=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var a=this.getX().toBigInteger(),s=this.getY().toBigInteger();if(a.compareTo(V.ONE)<0||a.compareTo(r.subtract(V.ONE))>0)throw new Error("x coordinate out of bounds");if(s.compareTo(V.ONE)<0||s.compareTo(r.subtract(V.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(r).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var ji=function(){var c=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),f=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),p={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function g(P,b,y){return b?p[b]:String.fromCharCode(parseInt(y,16))}var m=new String(""),N=Object.hasOwnProperty;return function(P,b){var F,y=P.match(c),C=y[0],I=!1;"{"===C?F={}:"["===C?F=[]:(F=[],I=!0);for(var T,L=[F],Z=1-I,W=y.length;Z<W;++Z){var G;switch((C=y[Z]).charCodeAt(0)){default:(G=L[0])[T||G.length]=+C,T=void 0;break;case 34:if(-1!==(C=C.substring(1,C.length-1)).indexOf("\\")&&(C=C.replace(f,g)),G=L[0],!T){if(!(G instanceof Array)){T=C||m;break}T=G.length}G[T]=C,T=void 0;break;case 91:L.unshift((G=L[0])[T||G.length]=[]),T=void 0;break;case 93:case 125:L.shift();break;case 102:(G=L[0])[T||G.length]=!1,T=void 0;break;case 110:(G=L[0])[T||G.length]=null,T=void 0;break;case 116:(G=L[0])[T||G.length]=!0,T=void 0;break;case 123:L.unshift((G=L[0])[T||G.length]={}),T=void 0}}if(I){if(1!==L.length)throw new Error;F=F[0]}else if(L.length)throw new Error;if(b){var me=function(Se,O){var j=Se[O];if(j&&"object"==typeof j){var $=null;for(var J in j)if(N.call(j,J)&&j!==Se){var re=me(j,J);void 0!==re?j[J]=re:($||($=[]),$.push(J))}if($)for(var le=$.length;--le>=0;)delete j[$[le]]}return b.call(Se,O,j)};F=me({"":F},"")}return F}}();(typeof d>"u"||!d)&&(d={}),(typeof d.asn1>"u"||!d.asn1)&&(d.asn1={}),d.asn1.ASN1Util=new function(){this.integerToByteHex=function(r){var a=r.toString(16);return a.length%2==1&&(a="0"+a),a},this.bigIntToMinTwosComplementsHex=function(r){var a=r.toString(16);if("-"!=a.substr(0,1))a.length%2==1?a="0"+a:a.match(/^[0-7]/)||(a="00"+a);else{var c=a.substr(1).length;c%2==1?c+=1:a.match(/^[0-7]/)||(c+=2);for(var f="",p=0;p<c;p++)f+="f";a=new V(f,16).xor(r).add(V.ONE).toString(16).replace(/^-/,"")}return a},this.getPEMStringFromHex=function(r,a){return nn(r,a)},this.newObject=function(r){var s=d.asn1,c=s.ASN1Object,f=s.DERBoolean,p=s.DERInteger,g=s.DERBitString,m=s.DEROctetString,x=s.DERNull,A=s.DERObjectIdentifier,N=s.DEREnumerated,P=s.DERUTF8String,b=s.DERNumericString,y=s.DERPrintableString,F=s.DERTeletexString,C=s.DERIA5String,I=s.DERUTCTime,T=s.DERGeneralizedTime,L=s.DERVisibleString,Z=s.DERBMPString,W=s.DERSequence,G=s.DERSet,me=s.DERTaggedObject,Se=s.ASN1Util.newObject;if(r instanceof s.ASN1Object)return r;var O=Object.keys(r);if(1!=O.length)throw new Error("key of param shall be only one.");var j=O[0];if(-1==":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+j+":"))throw new Error("undefined key: "+j);if("bool"==j)return new f(r[j]);if("int"==j)return new p(r[j]);if("bitstr"==j)return new g(r[j]);if("octstr"==j)return new m(r[j]);if("null"==j)return new x(r[j]);if("oid"==j)return new A(r[j]);if("enum"==j)return new N(r[j]);if("utf8str"==j)return new P(r[j]);if("numstr"==j)return new b(r[j]);if("prnstr"==j)return new y(r[j]);if("telstr"==j)return new F(r[j]);if("ia5str"==j)return new C(r[j]);if("utctime"==j)return new I(r[j]);if("gentime"==j)return new T(r[j]);if("visstr"==j)return new L(r[j]);if("bmpstr"==j)return new Z(r[j]);if("asn1"==j)return new c(r[j]);if("seq"==j){for(var $=r[j],J=[],re=0;re<$.length;re++){var le=Se($[re]);J.push(le)}return new W({array:J})}if("set"==j){for($=r[j],J=[],re=0;re<$.length;re++)le=Se($[re]),J.push(le);return new G({array:J})}if("tag"==j){var ee=r[j];if("[object Array]"===Object.prototype.toString.call(ee)&&3==ee.length){var oe=Se(ee[2]);return new me({tag:ee[0],explicit:ee[1],obj:oe})}return new me(ee)}},this.jsonToASN1HEX=function(r){return this.newObject(r).tohex()}},d.asn1.ASN1Util.oidHexToInt=function(r){for(var f="",a=parseInt(r.substr(0,2),16),p=(f=Math.floor(a/40)+"."+a%40,""),g=2;g<r.length;g+=2){var x=("00000000"+parseInt(r.substr(g,2),16).toString(2)).slice(-8);p+=x.substr(1,7),"0"==x.substr(0,1)&&(f=f+"."+new V(p,2).toString(10),p="")}return f},d.asn1.ASN1Util.oidIntToHex=function(r){var a=function(m){var x=m.toString(16);return 1==x.length&&(x="0"+x),x},s=function(m){var x="",N=new V(m,10).toString(2),P=7-N.length%7;7==P&&(P=0);for(var b="",y=0;y<P;y++)b+="0";for(N=b+N,y=0;y<N.length-1;y+=7){var F=N.substr(y,7);y!=N.length-7&&(F="1"+F),x+=a(parseInt(F,2))}return x};if(!r.match(/^[0-9.]+$/))throw"malformed oid string: "+r;var c="",f=r.split("."),p=40*parseInt(f[0])+parseInt(f[1]);c+=a(p),f.splice(0,2);for(var g=0;g<f.length;g++)c+=s(f[g]);return c},d.asn1.ASN1Object=function(r){this.params=null,this.getLengthHexFromValue=function(){if(typeof this.hV>"u"||null==this.hV)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+"".length+",v="+this.hV);var g=this.hV.length/2,m=g.toString(16);if(m.length%2==1&&(m="0"+m),g<128)return m;var x=m.length/2;if(x>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+g.toString(16));return(128+x).toString(16)+m},this.tohex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(g){this.params=g},null!=r&&null!=r.tlv&&(this.hTLV=r.tlv,this.isModified=!1)},d.asn1.DERAbstractString=function(r){d.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(c){this.hTLV=null,this.isModified=!0,this.s=c,this.hV=zr(this.s).toLowerCase()},this.setStringHex=function(c){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=c},this.getFreshValueHex=function(){return this.hV},typeof r<"u"&&("string"==typeof r?this.setString(r):typeof r.str<"u"?this.setString(r.str):typeof r.hex<"u"&&this.setStringHex(r.hex))},Ce(d.asn1.DERAbstractString,d.asn1.ASN1Object),d.asn1.DERAbstractTime=function(r){d.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(c){var f=c.getTime()+6e4*c.getTimezoneOffset();return new Date(f)},this.formatDate=function(c,f,p){var g=this.zeroPadding,m=this.localDateToUTC(c),x=String(m.getFullYear());"utc"==f&&(x=x.substr(2,2));var F=x+g(String(m.getMonth()+1),2)+g(String(m.getDate()),2)+g(String(m.getHours()),2)+g(String(m.getMinutes()),2)+g(String(m.getSeconds()),2);if(!0===p){var C=m.getMilliseconds();if(0!=C){var I=g(String(C),3);F=F+"."+(I=I.replace(/[0]+$/,""))}}return F+"Z"},this.zeroPadding=function(c,f){return c.length>=f?c:new Array(f-c.length+1).join("0")+c},this.setByParam=function(c){this.hV=null,this.hTLV=null,this.params=c},this.getString=function(){},this.setString=function(c){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.str=c},this.setByDate=function(c){this.hTLV=null,this.isModified=!0,null==this.params&&(this.params={}),this.params.date=c},this.setByDateValue=function(c,f,p,g,m,x){var A=new Date(Date.UTC(c,f-1,p,g,m,x,0));this.setByDate(A)},this.getFreshValueHex=function(){return this.hV}},Ce(d.asn1.DERAbstractTime,d.asn1.ASN1Object),d.asn1.DERAbstractStructured=function(r){d.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(s){this.hTLV=null,this.isModified=!0,this.asn1Array=s},this.appendASN1Object=function(s){this.hTLV=null,this.isModified=!0,this.asn1Array.push(s)},this.asn1Array=new Array,typeof r<"u"&&typeof r.array<"u"&&(this.asn1Array=r.array)},Ce(d.asn1.DERAbstractStructured,d.asn1.ASN1Object),d.asn1.DERBoolean=function(r){d.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV=0==r?"010100":"0101ff"},Ce(d.asn1.DERBoolean,d.asn1.ASN1Object),d.asn1.DERInteger=function(r){d.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var a=d.asn1.ASN1Util.bigIntToMinTwosComplementsHex;this.setByBigInteger=function(s){this.isModified=!0,this.params={bigint:s}},this.setByInteger=function(s){this.isModified=!0,this.params=s},this.setValueHex=function(s){this.isModified=!0,this.params={hex:s}},this.getFreshValueHex=function(){var s=this.params,c=null;if(null==s)throw new Error("value not set");if("object"==typeof s&&null!=s.hex)return this.hV=s.hex,this.hV;if("number"==typeof s)c=new V(String(s),10);else if(null!=s.int)c=new V(String(s.int),10);else{if(null==s.bigint)throw new Error("wrong parameter");c=s.bigint}return this.hV=a(c),this.hV},null!=r&&(this.params=r)},Ce(d.asn1.DERInteger,d.asn1.ASN1Object),d.asn1.DERBitString=function(r){if(void 0!==r&&typeof r.obj<"u"){var a=d.asn1.ASN1Util.newObject(r.obj);r.hex="00"+a.tohex()}d.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(s){this.hTLV=null,this.isModified=!0,this.hV=s},this.setUnusedBitsAndHexValue=function(s,c){if(s<0||7<s)throw"unused bits shall be from 0 to 7: u = "+s;var f="0"+s;this.hTLV=null,this.isModified=!0,this.hV=f+c},this.setByBinaryString=function(s){var c=8-(s=s.replace(/0+$/,"")).length%8;8==c&&(c=0),s+="0000000".substr(0,c);for(var f="",p=0;p<s.length-1;p+=8){var g=s.substr(p,8),m=parseInt(g,2).toString(16);1==m.length&&(m="0"+m),f+=m}this.hTLV=null,this.isModified=!0,this.hV="0"+c+f},this.setByBooleanArray=function(s){for(var c="",f=0;f<s.length;f++)c+=1==s[f]?"1":"0";this.setByBinaryString(c)},this.newFalseArray=function(s){for(var c=new Array(s),f=0;f<s;f++)c[f]=!1;return c},this.getFreshValueHex=function(){return this.hV},typeof r<"u"&&("string"==typeof r&&r.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(r):typeof r.hex<"u"?this.setHexValueIncludingUnusedBits(r.hex):typeof r.bin<"u"?this.setByBinaryString(r.bin):typeof r.array<"u"&&this.setByBooleanArray(r.array))},Ce(d.asn1.DERBitString,d.asn1.ASN1Object),d.asn1.DEROctetString=function(r){if(void 0!==r&&typeof r.obj<"u"){var a=d.asn1.ASN1Util.newObject(r.obj);r.hex=a.tohex()}d.asn1.DEROctetString.superclass.constructor.call(this,r),this.hT="04"},Ce(d.asn1.DEROctetString,d.asn1.DERAbstractString),d.asn1.DERNull=function(){d.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},Ce(d.asn1.DERNull,d.asn1.ASN1Object),d.asn1.DERObjectIdentifier=function(r){d.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(a){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=a},this.setValueOidString=function(a){var s=function pi(r){var a=function(m){var x=m.toString(16);return 1==x.length&&(x="0"+x),x},s=function(m){var x="",N=parseInt(m,10).toString(2),P=7-N.length%7;7==P&&(P=0);for(var b="",y=0;y<P;y++)b+="0";for(N=b+N,y=0;y<N.length-1;y+=7){var F=N.substr(y,7);y!=N.length-7&&(F="1"+F),x+=a(parseInt(F,2))}return x};try{if(!r.match(/^[0-9.]+$/))return null;var c="",f=r.split("."),p=40*parseInt(f[0],10)+parseInt(f[1],10);c+=a(p),f.splice(0,2);for(var g=0;g<f.length;g++)c+=s(f[g]);return c}catch{return null}}(a);if(null==s)throw new Error("malformed oid string: "+a);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=s},this.setValueName=function(a){var s=d.asn1.x509.OID.name2oid(a);if(""===s)throw new Error("DERObjectIdentifier oidName undefined: "+a);this.setValueOidString(s)},this.setValueNameOrOid=function(a){a.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(a):this.setValueName(a)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(a){"string"==typeof a?this.setValueNameOrOid(a):void 0!==a.oid?this.setValueNameOrOid(a.oid):void 0!==a.name?this.setValueNameOrOid(a.name):void 0!==a.hex&&this.setValueHex(a.hex)},void 0!==r&&this.setByParam(r)},Ce(d.asn1.DERObjectIdentifier,d.asn1.ASN1Object),d.asn1.DEREnumerated=function(r){d.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(a){this.hTLV=null,this.isModified=!0,this.hV=d.asn1.ASN1Util.bigIntToMinTwosComplementsHex(a)},this.setByInteger=function(a){var s=new V(String(a),10);this.setByBigInteger(s)},this.setValueHex=function(a){this.hV=a},this.getFreshValueHex=function(){return this.hV},typeof r<"u"&&(typeof r.int<"u"?this.setByInteger(r.int):"number"==typeof r?this.setByInteger(r):typeof r.hex<"u"&&this.setValueHex(r.hex))},Ce(d.asn1.DEREnumerated,d.asn1.ASN1Object),d.asn1.DERUTF8String=function(r){d.asn1.DERUTF8String.superclass.constructor.call(this,r),this.hT="0c"},Ce(d.asn1.DERUTF8String,d.asn1.DERAbstractString),d.asn1.DERNumericString=function(r){d.asn1.DERNumericString.superclass.constructor.call(this,r),this.hT="12"},Ce(d.asn1.DERNumericString,d.asn1.DERAbstractString),d.asn1.DERPrintableString=function(r){d.asn1.DERPrintableString.superclass.constructor.call(this,r),this.hT="13"},Ce(d.asn1.DERPrintableString,d.asn1.DERAbstractString),d.asn1.DERTeletexString=function(r){d.asn1.DERTeletexString.superclass.constructor.call(this,r),this.hT="14"},Ce(d.asn1.DERTeletexString,d.asn1.DERAbstractString),d.asn1.DERIA5String=function(r){d.asn1.DERIA5String.superclass.constructor.call(this,r),this.hT="16"},Ce(d.asn1.DERIA5String,d.asn1.DERAbstractString),d.asn1.DERVisibleString=function(r){d.asn1.DERIA5String.superclass.constructor.call(this,r),this.hT="1a"},Ce(d.asn1.DERVisibleString,d.asn1.DERAbstractString),d.asn1.DERBMPString=function(r){d.asn1.DERBMPString.superclass.constructor.call(this,r),this.hT="1e"},Ce(d.asn1.DERBMPString,d.asn1.DERAbstractString),d.asn1.DERUTCTime=function(r){d.asn1.DERUTCTime.superclass.constructor.call(this,r),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var a=this.params;if(null==this.params&&(a={date:new Date}),"string"==typeof a){if(!a.match(/^[0-9]{12}Z$/)&&!a.match(/^[0-9]{12}\.[0-9]+Z$/))throw new Error("malformed string for UTCTime: "+a);this.hV=en(a)}else null!=a.str?this.hV=en(a.str):null==a.date&&1==a.millis?this.hV=en(this.formatDate(new Date,"utc",!0)):null!=a.date&&a.date instanceof Date?this.hV=en(this.formatDate(a.date,"utc",!0===a.millis)):a instanceof Date&&(this.hV=en(this.formatDate(a,"utc")));if(null==this.hV)throw new Error("parameter not specified properly for UTCTime");return this.hV},null!=r&&this.setByParam(r)},Ce(d.asn1.DERUTCTime,d.asn1.DERAbstractTime),d.asn1.DERGeneralizedTime=function(r){d.asn1.DERGeneralizedTime.superclass.constructor.call(this,r),this.hT="18",this.params=r,this.getFreshValueHex=function(){var a=this.params;if(null==this.params&&(a={date:new Date}),"string"==typeof a){if(!a.match(/^[0-9]{14}Z$/)&&!a.match(/^[0-9]{14}\.[0-9]+Z$/))throw new Error("malformed string for GeneralizedTime: "+a);this.hV=en(a)}else null!=a.str?this.hV=en(a.str):null==a.date&&1==a.millis?this.hV=en(this.formatDate(new Date,"gen",!0)):null!=a.date&&a.date instanceof Date?this.hV=en(this.formatDate(a.date,"gen",!0===a.millis)):a instanceof Date&&(this.hV=en(this.formatDate(a,"gen")));if(null==this.hV)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},null!=r&&this.setByParam(r)},Ce(d.asn1.DERGeneralizedTime,d.asn1.DERAbstractTime),d.asn1.DERSequence=function(r){d.asn1.DERSequence.superclass.constructor.call(this,r),this.hT="30",this.getFreshValueHex=function(){for(var a="",s=0;s<this.asn1Array.length;s++)a+=this.asn1Array[s].tohex();return this.hV=a,this.hV}},Ce(d.asn1.DERSequence,d.asn1.DERAbstractStructured),d.asn1.DERSet=function(r){d.asn1.DERSet.superclass.constructor.call(this,r),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var a=new Array,s=0;s<this.asn1Array.length;s++)a.push(this.asn1Array[s].tohex());return 1==this.sortFlag&&a.sort(),this.hV=a.join(""),this.hV},typeof r<"u"&&typeof r.sortflag<"u"&&0==r.sortflag&&(this.sortFlag=!1)},Ce(d.asn1.DERSet,d.asn1.DERAbstractStructured),d.asn1.DERTaggedObject=function(r){d.asn1.DERTaggedObject.superclass.constructor.call(this);var a=d.asn1,c=Ne.getV,p=a.ASN1Util.newObject;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(g,m,x){this.params={tag:m,explicit:g,obj:x}},this.getFreshValueHex=function(){var g=this.params;if(null==g.explicit&&(g.explicit=!0),null!=g.tage&&(g.tag=g.tage,g.explicit=!0),null!=g.tagi&&(g.tag=g.tagi,g.explicit=!1),null!=g.str)this.hV=zr(g.str);else if(null!=g.hex)this.hV=g.hex;else{if(null==g.obj)throw new Error("str, hex nor obj not specified");var m;g.obj instanceof a.ASN1Object?m=g.obj.tohex():"object"==typeof g.obj&&(m=p(g.obj).tohex()),this.hV=g.explicit?m:c(m,0)}return null==g.tag&&(g.tag="a0"),this.hT=g.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(g){this.params=g},void 0!==r&&this.setByParam(r)},Ce(d.asn1.DERTaggedObject,d.asn1.ASN1Object);var d,mr,Bn,Ne=new function(){};function Hr(r){for(var a="",s=0;s<r.length;s++){var c=r[s].toString(16);1==c.length&&(c="0"+c),a+=c}return a}function en(r){return Hr(function Li(r){for(var a=new Array,s=0;s<r.length;s++)a[s]=r.charCodeAt(s);return a}(r))}function ir(r){return(r=(r=r.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function qr(r){return r.length%4==2?r+="==":r.length%4==3&&(r+="="),(r=r.replace(/-/g,"+")).replace(/_/g,"/")}function Lt(r){return r.length%2==1&&(r="0"+r),ir(S(r))}function _t(r){return K(qr(r))}function zr(r){return ci(di(r)).toLowerCase()}function mt(r){try{return decodeURIComponent(li(r))}catch{return null}}function Ss(r){return mt(function Ra(r){for(var a=r.match(/.{1,2}/g),s=[],c=0;c<a.length;c++){var f=parseInt(a[c],16);161<=f&&f<=191?(s.push("c2"),s.push(a[c])):192<=f&&f<=255?(s.push("c3"),s.push((f-64).toString(16))):s.push(a[c])}return s.join("")}(r))}function tn(r){for(var a="",s=0;s<r.length-1;s+=2)a+=String.fromCharCode(parseInt(r.substr(s,2),16));return a}function Rn(r){for(var a="",s=0;s<r.length;s++)a+=("0"+r.charCodeAt(s).toString(16)).slice(-2);return a}function nn(r,a){return"-----BEGIN "+a+"-----\r\n"+function Vr(r,a){return r.replace(new RegExp("(.{"+a+"})","g"),"$1\r\n")}(function xs(r){return S(r)}(r),64)+"\r\n-----END "+a+"-----\r\n"}function Ht(r,a){if(-1==r.indexOf("-----BEGIN "))throw new Error("can't find PEM header");return function Ar(r){return K(r.replace(/[^0-9A-Za-z\/+=]*/g,""))}(r=void 0!==a?(r=r.replace(new RegExp("^[^]*-----BEGIN "+a+"-----"),"")).replace(new RegExp("-----END "+a+"-----[^]*$"),""):(r=r.replace(/^[^]*-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----[^]*$/,""))}function Es(r){return Math.round(function ui(r){var a,s,c,f,p,g,m,N,P,b;if(b=(r=function zi(r){return r.match(/^[0-9]{12}Z$/)||r.match(/^[0-9]{12}[.][0-9]*Z$/)?r.match(/^[0-4]/)?"20"+r:"19"+r:r}(r)).match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/))return a=parseInt(b[1]),s=parseInt(b[2])-1,c=parseInt(b[3]),f=parseInt(b[4]),p=parseInt(b[5]),g=parseInt(b[6]),m=0,""!==(N=b[7])&&(P=(N.substr(1)+"00").substr(0,3),m=parseInt(P)),Date.UTC(a,s,c,f,p,g,m);throw new Error("unsupported zulu format: "+r)}(r)/1e3)}function ci(r){return r.replace(/%/g,"")}function li(r){return r.replace(/(..)/g,"%$1")}function Vi(r){var a="malformed IPv6 address";if(!r.match(/^[0-9A-Fa-f:]+$/))throw a;var s=(r=r.toLowerCase()).split(":").length-1;if(s<2)throw a;var c=":".repeat(7-s+2),f=(r=r.replace("::",c)).split(":");if(8!=f.length)throw a;for(var p=0;p<8;p++)f[p]=("0000"+f[p]).slice(-4);return f.join("")}function Ui(r){if(!r.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+r);var a=(r=r.toLowerCase()).match(/.{1,4}/g);a=a.map(function(f){return f.replace(/^0+/,"")}),a=a.map(function(f){return""==f?"0":f});var s=(r=":"+a.join(":")+":").match(/:(0:){2,}/g);if(null==s)return r.slice(1,-1);var c=s.sort().slice(-1)[0];return"::"!=(r=r.replace(c.substr(0,c.length-1),":")).substr(0,2)&&(r=r.substr(1)),"::"!=r.substr(-2,2)&&(r=r.substr(0,r.length-1)),r}function hi(r){var a=new Error("malformed hex value");if(!r.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw a;if(8==r.length)try{return parseInt(r.substr(0,2),16)+"."+parseInt(r.substr(2,2),16)+"."+parseInt(r.substr(4,2),16)+"."+parseInt(r.substr(6,2),16)}catch{throw a}else{if(16!=r.length){if(32==r.length)return Ui(r);if(64==r.length){try{return Ui(r.substr(0,32))+"/"+As(r.substr(32))}catch{throw a}return}return r}try{return hi(r.substr(0,8))+"/"+As(r.substr(8))}catch{throw a}}}function As(r){var s,a=new Error("malformed mask");try{s=new V(r,16).toString(2)}catch{throw a}if(!s.match(/^1*0*$/))throw a;return s.replace(/0+$/,"").length}function Zi(r){var a=new Error("malformed IP address");if(!(r=r.toLowerCase(r)).match(/^[0-9a-f.:/]+$/))throw a;if(!r.match(/^[0-9.]+$/)){var g;if(r.match(/^[0-9.]+\/[0-9]+$/))return Zi((g=r.split("/"))[0])+Ts(parseInt(g[1]),32);if(r.match(/^[0-9a-f:]+$/)&&-1!==r.indexOf(":"))return Vi(r);if(r.match(/^[0-9a-f:]+\/[0-9]+$/)&&-1!==r.indexOf(":"))return Vi((g=r.split("/"))[0])+Ts(parseInt(g[1]),128);throw a}var s=r.split(".");if(4!==s.length)throw a;var c="";try{for(var f=0;f<4;f++)c+=("0"+parseInt(s[f]).toString(16)).slice(-2);return c}catch{throw a}}function Ts(r,a){return 32==a&&0==r?"00000000":128==a&&0==r?"00000000000000000000000000000000":new V(Array(r+1).join("1")+Array(a-r+1).join("0"),2).toString(16)}function Ur(r){var c=r.match(/.{4}/g).map(function a(f){var p=parseInt(f.substr(0,2),16),g=parseInt(f.substr(2),16);if(0==p&g<128)return String.fromCharCode(g);if(p<8){var x=128|63&g;return mt((192|(7&p)<<3|(192&g)>>6).toString(16)+x.toString(16))}x=128|(15&p)<<2|(192&g)>>6;var A=128|63&g;return mt((224|(240&p)>>4).toString(16)+x.toString(16)+A.toString(16))});return c.join("")}function di(r){for(var a=encodeURIComponent(r),s="",c=0;c<a.length;c++)"%"==a[c]?(s+=a.substr(c,3),c+=2):s=s+"%"+en(a[c]);return s}function yn(r){return!(r.length%2!=0||!r.match(/^[0-9a-f]+$/)&&!r.match(/^[0-9A-F]+$/))}function fi(r){return!!r.match(/^[0-9A-Za-z-_.]+$/)}function Zr(r){return r.length%2==1?"0"+r:r.substr(0,1)>"7"?"00"+r:r}function vr(r){if(!yn(r))return null;try{var a=[],s=r.substr(0,2),c=parseInt(s,16);a[0]=new String(Math.floor(c/40)),a[1]=new String(c%40);for(var f=r.substr(2),p=[],g=0;g<f.length/2;g++)p.push(parseInt(f.substr(2*g,2),16));var m=[],x="";for(g=0;g<p.length;g++)128&p[g]?x+=Kr((127&p[g]).toString(2),7):(x+=Kr((127&p[g]).toString(2),7),m.push(new String(parseInt(x,2))),x="");var A=a.join(".");return m.length>0&&(A=A+"."+m.join(".")),A}catch{return null}}Ne.getLblen=function(r,a){if("8"!=r.substr(a+2,1))return 1;var s=parseInt(r.substr(a+3,1));return 0==s?-1:0<s&&s<10?s+1:-2},Ne.getL=function(r,a){var s=Ne.getLblen(r,a);return s<1?"":r.substr(a+2,2*s)},Ne.getVblen=function(r,a){var s;return""==(s=Ne.getL(r,a))?-1:("8"===s.substr(0,1)?new V(s.substr(2),16):new V(s,16)).intValue()},Ne.getVidx=function(r,a){var s=Ne.getLblen(r,a);return s<0?s:a+2*(s+1)},Ne.getV=function(r,a){var s=Ne.getVidx(r,a),c=Ne.getVblen(r,a);return r.substr(s,2*c)},Ne.getTLV=function(r,a){return r.substr(a,2)+Ne.getL(r,a)+Ne.getV(r,a)},Ne.getTLVblen=function(r,a){return 2+2*Ne.getLblen(r,a)+2*Ne.getVblen(r,a)},Ne.getNextSiblingIdx=function(r,a){return Ne.getVidx(r,a)+2*Ne.getVblen(r,a)},Ne.getChildIdx=function(r,a){var f,p,g,s=Ne,c=[];f=s.getVidx(r,a),p=2*s.getVblen(r,a),"03"==r.substr(a,2)&&(f+=2,p-=2),g=0;for(var m=f;g<=p;){var x=s.getTLVblen(r,m);if((g+=x)<=p&&c.push(m),m+=x,g>=p)break}return c},Ne.getNthChildIdx=function(r,a,s){return Ne.getChildIdx(r,a)[s]},Ne.getIdxbyList=function(r,a,s,c){var p,g,f=Ne;return 0==s.length?void 0!==c&&r.substr(a,2)!==c?-1:a:(p=s.shift())>=(g=f.getChildIdx(r,a)).length?-1:f.getIdxbyList(r,g[p],s,c)},Ne.getIdxbyListEx=function(r,a,s,c){var p,g,f=Ne;if(0==s.length)return void 0!==c&&r.substr(a,2)!==c?-1:a;p=s.shift(),g=f.getChildIdx(r,a);for(var m=0,x=0;x<g.length;x++){var A=r.substr(g[x],2);if("number"==typeof p&&!f.isContextTag(A)&&m==p||"string"==typeof p&&f.isContextTag(A,p))return f.getIdxbyListEx(r,g[x],s,c);f.isContextTag(A)||m++}return-1},Ne.getTLVbyList=function(r,a,s,c){var f=Ne,p=f.getIdxbyList(r,a,s,c);return-1==p||p>=r.length?null:f.getTLV(r,p)},Ne.getTLVbyListEx=function(r,a,s,c){var f=Ne,p=f.getIdxbyListEx(r,a,s,c);return-1==p?null:f.getTLV(r,p)},Ne.getVbyList=function(r,a,s,c,f){var g,m,p=Ne;return-1==(g=p.getIdxbyList(r,a,s,c))||g>=r.length?null:(m=p.getV(r,g),!0===f&&(m=m.substr(2)),m)},Ne.getVbyListEx=function(r,a,s,c,f){var g,x,p=Ne;return-1==(g=p.getIdxbyListEx(r,a,s,c))?null:(x=p.getV(r,g),"03"==r.substr(g,2)&&!1!==f&&(x=x.substr(2)),x)},Ne.getInt=function(r,a,s){null==s&&(s=-1);try{var c=r.substr(a,2);if("02"!=c&&"03"!=c)return s;var f=Ne.getV(r,a);return"02"==c?parseInt(f,16):function Gi(r){if(r.length%2!=0||null==(r=r.toLowerCase()).match(/^[0-9a-f]+$/))return-1;try{var a=r.substr(0,2);if("00"==a)return parseInt(r.substr(2),16);var s=parseInt(a,16);if(s>7)return-1;var c=r.substr(2),f=parseInt(c,16).toString(2);"0"==f&&(f="00000000"),f=f.slice(0,0-s);var p=parseInt(f,2);return NaN==p?-1:p}catch{return-1}}(f)}catch{return s}},Ne.getOID=function(r,a,s){null==s&&(s=null);try{return"06"!=r.substr(a,2)?s:vr(Ne.getV(r,a))}catch{return s}},Ne.getOIDName=function(r,a,s){null==s&&(s=null);try{var c=Ne.getOID(r,a,s);if(c==s)return s;var f=d.asn1.x509.OID.oid2name(c);return""==f?c:f}catch{return s}},Ne.getString=function(r,a,s){null==s&&(s=null);try{return tn(Ne.getV(r,a))}catch{return s}},Ne.hextooidstr=function(r){var a=function(P,b){return P.length>=b?P:new Array(b-P.length+1).join("0")+P},s=[],c=r.substr(0,2),f=parseInt(c,16);s[0]=new String(Math.floor(f/40)),s[1]=new String(f%40);for(var p=r.substr(2),g=[],m=0;m<p.length/2;m++)g.push(parseInt(p.substr(2*m,2),16));var x=[],A="";for(m=0;m<g.length;m++)128&g[m]?A+=a((127&g[m]).toString(2),7):(A+=a((127&g[m]).toString(2),7),x.push(new String(parseInt(A,2))),A="");var N=s.join(".");return x.length>0&&(N=N+"."+x.join(".")),N},Ne.dump=function(r,a,s,c){var f=Ne,p=f.getV,g=f.dump,m=f.getChildIdx,x=r;r instanceof d.asn1.ASN1Object&&(x=r.tohex());var A=function(Se,O){return Se.length<=2*O?Se:Se.substr(0,O)+"..(total "+Se.length/2+"bytes).."+Se.substr(Se.length-O,O)};void 0===a&&(a={ommit_long_octet:32}),void 0===s&&(s=0),void 0===c&&(c="");var G,N=a.ommit_long_octet;if("01"==(G=x.substr(s,2)))return"00"==(P=p(x,s))?c+"BOOLEAN FALSE\n":c+"BOOLEAN TRUE\n";if("02"==G)return c+"INTEGER "+A(P=p(x,s),N)+"\n";if("03"==G){var P=p(x,s);return f.isASN1HEX(P.substr(2))?(b=c+"BITSTRING, encapsulates\n")+g(P.substr(2),a,0,c+"  "):c+"BITSTRING "+A(P,N)+"\n"}if("04"==G)return P=p(x,s),f.isASN1HEX(P)?(b=c+"OCTETSTRING, encapsulates\n")+g(P,a,0,c+"  "):c+"OCTETSTRING "+A(P,N)+"\n";if("05"==G)return c+"NULL\n";if("06"==G){var y=p(x,s),F=d.asn1.ASN1Util.oidHexToInt(y),C=d.asn1.x509.OID.oid2name(F),I=F.replace(/\./g," ");return""!=C?c+"ObjectIdentifier "+C+" ("+I+")\n":c+"ObjectIdentifier ("+I+")\n"}if("0a"==G)return c+"ENUMERATED "+parseInt(p(x,s))+"\n";if("0c"==G)return c+"UTF8String '"+mt(p(x,s))+"'\n";if("13"==G)return c+"PrintableString '"+mt(p(x,s))+"'\n";if("14"==G)return c+"TeletexString '"+mt(p(x,s))+"'\n";if("16"==G)return c+"IA5String '"+mt(p(x,s))+"'\n";if("17"==G)return c+"UTCTime "+mt(p(x,s))+"\n";if("18"==G)return c+"GeneralizedTime "+mt(p(x,s))+"\n";if("1a"==G)return c+"VisualString '"+mt(p(x,s))+"'\n";if("1e"==G)return c+"BMPString '"+Ur(p(x,s))+"'\n";if("30"==G){if("3000"==x.substr(s,4))return c+"SEQUENCE {}\n";b=c+"SEQUENCE\n";var L=a;if((2==(T=m(x,s)).length||3==T.length)&&"06"==x.substr(T[0],2)&&"04"==x.substr(T[T.length-1],2)){C=f.oidname(p(x,T[0]));var Z=JSON.parse(JSON.stringify(a));Z.x509ExtName=C,L=Z}for(var W=0;W<T.length;W++)b+=g(x,L,T[W],c+"  ");return b}if("31"==G){b=c+"SET\n";var T=m(x,s);for(W=0;W<T.length;W++)b+=g(x,a,T[W],c+"  ");return b}if(128&(G=parseInt(G,16))){var b,me=31&G;if(32&G){for(b=c+"["+me+"]\n",T=m(x,s),W=0;W<T.length;W++)b+=g(x,a,T[W],c+"  ");return b}return P=p(x,s),Ne.isASN1HEX(P)?(b=c+"["+me+"]\n")+g(P,a,0,c+"  "):(("68747470"==P.substr(0,8)||"subjectAltName"===a.x509ExtName&&2==me)&&(P=mt(P)),c+"["+me+"] "+P+"\n")}return c+"UNKNOWN("+G+") "+p(x,s)+"\n"},Ne.parse=function(r){var s=Ne.parse,c=Ne.isASN1HEX,f=Ne.getV,p=Ne.getTLV,g=Ne.getChildIdx,m=d.asn1,x=m.ASN1Util.oidHexToInt,A=m.x509.OID.oid2name,N=mt,P=Ur,b=Ss,y={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},C=r.substr(0,2),I={},T=f(r,0);if("01"==C)return"0101ff"==r?{bool:!0}:{bool:!1};if("02"==C)return{int:{hex:T}};if("03"==C)try{if("00"!=T.substr(0,2))throw"not encap";var L=T.substr(2);if(!c(L))throw"not encap";return{bitstr:{obj:s(L)}}}catch{var Z=null;return T.length<=10&&(Z=function Ba(r){if("string"!=typeof r||r.length%2!=0||!r.match(/^[0-9a-f]+$/))return null;try{var a=parseInt(r.substr(0,2),16);if(a<0||7<a)return null;for(var s=r.substr(2),c="",f=0;f<s.length;f+=2){var p=s.substr(f,2),g=parseInt(p,16).toString(2);c+=g=("0000000"+g).slice(-8)}return c.substr(0,c.length-a)}catch{return null}}(T)),null==Z?{bitstr:{hex:T}}:{bitstr:{bin:Z}}}else if("04"==C)try{if(!c(T))throw"not encap";return{octstr:{obj:s(T)}}}catch{return{octstr:{hex:T}}}else{if("05"==C)return{null:""};if("06"==C){var W=x(T),G=A(W);return""==G?{oid:W}:{oid:G}}if("0a"==C)return T.length>4?{enum:{hex:T}}:{enum:parseInt(T,16)};if("30"==C||"31"==C)return I[y[C]]=function(j){for(var $=[],J=g(j,0),re=0;re<J.length;re++){var ee=p(j,J[re]),oe=s(ee);$.push(oe)}return $}(r),I;if("14"==C){var me=b(T);return I[y[C]]={str:me},I}if("1e"==C)return me=P(T),I[y[C]]={str:me},I;if(-1!=":0c:12:13:16:17:18:1a:".indexOf(C))return me=N(T),I[y[C]]={str:me},I;if(C.match(/^8[0-9]$/))return null==(me=N(T))|""==me||null!=me.match(/[\x00-\x1F\x7F-\x9F]/)||null!=me.match(/[\u0000-\u001F\u0080\u2013\u009F]/)?{tag:{tag:C,explicit:!1,hex:T}}:{tag:{tag:C,explicit:!1,str:me}};if(!C.match(/^a[0-9]$/)){var Se=new d.asn1.ASN1Object;return Se.hV=T,{asn1:{tlv:C+Se.getLengthHexFromValue()+T}}}try{if(!c(T))throw new Error("not encap");return{tag:{tag:C,explicit:!0,obj:s(T)}}}catch{return{tag:{tag:C,explicit:!0,hex:T}}}}},Ne.isContextTag=function(r,a){var s,c;r=r.toLowerCase();try{s=parseInt(r,16)}catch{return-1}if(void 0===a)return 128==(192&s);try{return!(null==a.match(/^\[[0-9]+\]$/)||(c=parseInt(a.substr(1,a.length-1),10),c>31))&&128==(192&s)&&(31&s)==c}catch{return!1}},Ne.isASN1HEX=function(r){var a=Ne;if(r.length%2==1)return!1;var s=a.getVblen(r,0),c=r.substr(0,2),f=a.getL(r,0);return r.length-c.length-f.length==2*s},Ne.checkStrictDER=function(r,a,s,c,f){var p=Ne;if(void 0===s){if("string"!=typeof r)throw new Error("not hex string");if(r=r.toLowerCase(),!d.lang.String.isHex(r))throw new Error("not hex string");s=r.length,f=(c=r.length/2)<128?1:Math.ceil(c.toString(16))+1}if(p.getL(r,a).length>2*f)throw new Error("L of TLV too long: idx="+a);var m=p.getVblen(r,a);if(m>c)throw new Error("value of L too long than hex: idx="+a);var x=p.getTLV(r,a),A=x.length-2-p.getL(r,a).length;if(A!==2*m)throw new Error("V string length and L's value not the same:"+A+"/"+2*m);if(0===a&&r.length!=x.length)throw new Error("total length and TLV length unmatch:"+r.length+"!="+x.length);var N=r.substr(a,2);if("02"===N){var P=p.getVidx(r,a);if("00"==r.substr(P,2)&&r.charCodeAt(P+2)<56)throw new Error("not least zeros for DER INTEGER")}if(32&parseInt(N,16)){for(var b=p.getVblen(r,a),y=0,F=p.getChildIdx(r,a),C=0;C<F.length;C++)y+=p.getTLV(r,F[C]).length,p.checkStrictDER(r,F[C],s,c,f);if(2*b!=y)throw new Error("sum of children's TLV length and L unmatch: "+2*b+"!="+y)}},Ne.oidname=function(r){var a=d.asn1;d.lang.String.isHex(r)&&(r=a.ASN1Util.oidHexToInt(r));var s=a.x509.OID.oid2name(r);return""===s&&(s=r),s},(typeof d>"u"||!d)&&(d={}),(typeof d.asn1>"u"||!d.asn1)&&(d.asn1={}),(typeof d.asn1.x509>"u"||!d.asn1.x509)&&(d.asn1.x509={}),d.asn1.x509.Certificate=function(r){d.asn1.x509.Certificate.superclass.constructor.call(this);var s=d.asn1,c=s.DERBitString,f=s.DERSequence,p=s.x509,g=p.TBSCertificate,m=p.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(x){this.params=x},this.sign=function(){var x=this.params,A=x.sigalg;null!=x.sigalg.name&&(A=x.sigalg.name);var N=x.tbsobj.tohex(),P=new d.crypto.Signature({alg:A});P.init(x.cakey),P.updateHex(N),x.sighex=P.sign()},this.getPEM=function(){return nn(this.tohex(),"CERTIFICATE")},this.tohex=function(){var x=this.params;if((null==x.tbsobj||null==x.tbsobj)&&(x.tbsobj=new g(x)),null==x.sighex&&null!=x.cakey&&this.sign(),null==x.sighex)throw new Error("sighex or cakey parameter not defined");var A=[];return A.push(x.tbsobj),A.push(new m({name:x.sigalg})),A.push(new c({hex:"00"+x.sighex})),new f({array:A}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&(this.params=r)},Ce(d.asn1.x509.Certificate,d.asn1.ASN1Object),d.asn1.x509.TBSCertificate=function(r){d.asn1.x509.TBSCertificate.superclass.constructor.call(this);var s=d.asn1,c=s.x509,f=s.DERTaggedObject,p=s.DERInteger,g=s.DERSequence,m=c.AlgorithmIdentifier,x=c.Time,A=c.X500Name,N=c.Extensions,P=c.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(b){this.params=b},this.tohex=function(){var b=[],y=this.params;if(null!=y.version||1!=y.version){var F=2;null!=y.version&&(F=y.version-1);var C=new f({obj:new p({int:F})});b.push(C)}return b.push(new p(y.serial)),b.push(new m({name:y.sigalg})),b.push(new A(y.issuer)),b.push(new g({array:[new x(y.notbefore),new x(y.notafter)]})),b.push(new A(y.subject)),b.push(new P(ct.getKey(y.sbjpubkey))),void 0!==y.ext&&y.ext.length>0&&b.push(new f({tag:"a3",obj:new N(y.ext)})),new d.asn1.DERSequence({array:b}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.x509.TBSCertificate,d.asn1.ASN1Object),d.asn1.x509.Extensions=function(r){d.asn1.x509.Extensions.superclass.constructor.call(this);var s=d.asn1,c=s.DERSequence,f=s.x509;this.aParam=[],this.setByParam=function(p){this.aParam=p},this.tohex=function(){for(var p=[],g=0;g<this.aParam.length;g++){var m=this.aParam[g],x=m.extname,A=null;if(null!=m.extn)A=new f.PrivateExtension(m);else if("subjectKeyIdentifier"==x)A=new f.SubjectKeyIdentifier(m);else if("keyUsage"==x)A=new f.KeyUsage(m);else if("subjectAltName"==x)A=new f.SubjectAltName(m);else if("issuerAltName"==x)A=new f.IssuerAltName(m);else if("basicConstraints"==x)A=new f.BasicConstraints(m);else if("nameConstraints"==x)A=new f.NameConstraints(m);else if("cRLDistributionPoints"==x)A=new f.CRLDistributionPoints(m);else if("certificatePolicies"==x)A=new f.CertificatePolicies(m);else if("policyMappings"==x)A=new f.PolicyMappings(m);else if("policyConstraints"==x)A=new f.PolicyConstraints(m);else if("inhibitAnyPolicy"==x)A=new f.InhibitAnyPolicy(m);else if("authorityKeyIdentifier"==x)A=new f.AuthorityKeyIdentifier(m);else if("extKeyUsage"==x)A=new f.ExtKeyUsage(m);else if("authorityInfoAccess"==x)A=new f.AuthorityInfoAccess(m);else if("cRLNumber"==x)A=new f.CRLNumber(m);else if("cRLReason"==x)A=new f.CRLReason(m);else if("ocspNonce"==x)A=new f.OCSPNonce(m);else if("ocspNoCheck"==x)A=new f.OCSPNoCheck(m);else if("adobeTimeStamp"==x)A=new f.AdobeTimeStamp(m);else{if("subjectDirectoryAttributes"!=x)throw new Error("extension not supported:"+JSON.stringify(m));A=new f.SubjectDirectoryAttributes(m)}null!=A&&p.push(A)}return new c({array:p}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.x509.Extensions,d.asn1.ASN1Object),d.asn1.x509.Extension=function(r){d.asn1.x509.Extension.superclass.constructor.call(this);var c=d.asn1,f=c.DERObjectIdentifier,p=c.DEROctetString,m=c.DERBoolean,x=c.DERSequence;this.tohex=function(){var A=new f({oid:this.oid}),N=new p({hex:this.getExtnValueHex()}),P=new Array;return P.push(A),this.critical&&P.push(new m),P.push(N),new x({array:P}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,void 0!==r&&void 0!==r.critical&&(this.critical=r.critical)},Ce(d.asn1.x509.Extension,d.asn1.ASN1Object),d.asn1.x509.KeyUsage=function(r){d.asn1.x509.KeyUsage.superclass.constructor.call(this,r);var a=Error,s={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var c=this.getBinValue();return this.asn1ExtnValue=new d.asn1.DERBitString({bin:c}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var c=this.params;if("object"!=typeof c||"object"!=typeof c.names&&"string"!=typeof c.bin)throw new a("parameter not yet set");if(null!=c.names)return Tr(c.names,s);if(null!=c.bin)return c.bin;throw new a("parameter not set properly")},this.oid="2.5.29.15",void 0!==r&&(this.params=r)},Ce(d.asn1.x509.KeyUsage,d.asn1.x509.Extension),d.asn1.x509.BasicConstraints=function(r){d.asn1.x509.BasicConstraints.superclass.constructor.call(this,r);var a=d.asn1,s=a.DERBoolean,c=a.DERInteger,f=a.DERSequence;this.getExtnValueHex=function(){var m=new Array;this.cA&&m.push(new s),this.pathLen>-1&&m.push(new c({int:this.pathLen}));var x=new f({array:m});return this.asn1ExtnValue=x,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,void 0!==r&&(void 0!==r.cA&&(this.cA=r.cA),void 0!==r.pathLen&&(this.pathLen=r.pathLen))},Ce(d.asn1.x509.BasicConstraints,d.asn1.x509.Extension),d.asn1.x509.CRLDistributionPoints=function(r){d.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,r);var s=d.asn1,c=s.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(f){for(var p=[],g=0;g<f.length;g++)if(f[g]instanceof d.asn1.ASN1Object)p.push(f[g]);else{var m=new c.DistributionPoint(f[g]);p.push(m)}this.asn1ExtnValue=new s.DERSequence({array:p})},this.setByOneURI=function(f){var p=new c.DistributionPoint({fulluri:f});this.setByDPArray([p])},this.oid="2.5.29.31",void 0!==r&&(void 0!==r.array?this.setByDPArray(r.array):void 0!==r.uri&&this.setByOneURI(r.uri))},Ce(d.asn1.x509.CRLDistributionPoints,d.asn1.x509.Extension),d.asn1.x509.DistributionPoint=function(r){d.asn1.x509.DistributionPoint.superclass.constructor.call(this);var c=d.asn1,f=c.x509.DistributionPointName;this.tohex=function(){var p=new c.DERSequence;if(null!=this.asn1DP){var g=new c.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});p.appendASN1Object(g)}return this.hTLV=p.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&(void 0!==r.dpobj?this.asn1DP=r.dpobj:void 0!==r.dpname?this.asn1DP=new f(r.dpname):void 0!==r.fulluri&&(this.asn1DP=new f({full:[{uri:r.fulluri}]})))},Ce(d.asn1.x509.DistributionPoint,d.asn1.ASN1Object),d.asn1.x509.DistributionPointName=function(r){d.asn1.x509.DistributionPointName.superclass.constructor.call(this);var g=d.asn1,m=g.DERTaggedObject;if(this.tohex=function(){if("full"!=this.type)throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new m({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r)if(g.x509.GeneralNames.prototype.isPrototypeOf(r))this.type="full",this.tag="a0",this.asn1V=r;else{if(void 0===r.full)throw new Error("This class supports GeneralNames only as argument");this.type="full",this.tag="a0",this.asn1V=new g.x509.GeneralNames(r.full)}},Ce(d.asn1.x509.DistributionPointName,d.asn1.ASN1Object),d.asn1.x509.CertificatePolicies=function(r){d.asn1.x509.CertificatePolicies.superclass.constructor.call(this,r);var s=d.asn1,f=s.DERSequence,p=s.x509.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var g=[],m=0;m<this.params.array.length;m++)g.push(new p(this.params.array[m]));var x=new f({array:g});return this.asn1ExtnValue=x,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",void 0!==r&&(this.params=r)},Ce(d.asn1.x509.CertificatePolicies,d.asn1.x509.Extension),d.asn1.x509.PolicyInformation=function(r){d.asn1.x509.PolicyInformation.superclass.constructor.call(this,r);var a=d.asn1,s=a.DERSequence,c=a.DERObjectIdentifier,f=a.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(void 0===this.params.policyoid&&void 0===this.params.array)throw new Error("parameter oid and array missing");var p=[new c(this.params.policyoid)];if(void 0!==this.params.array){for(var g=[],m=0;m<this.params.array.length;m++)g.push(new f(this.params.array[m]));g.length>0&&p.push(new s({array:g}))}return new s({array:p}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&(this.params=r)},Ce(d.asn1.x509.PolicyInformation,d.asn1.ASN1Object),d.asn1.x509.PolicyQualifierInfo=function(r){d.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,r);var a=d.asn1,s=a.DERSequence,c=a.DERIA5String,f=a.DERObjectIdentifier,p=a.x509.UserNotice;this.params=null,this.tohex=function(){return void 0!==this.params.cps?new s({array:[new f({oid:"1.3.6.1.5.5.7.2.1"}),new c({str:this.params.cps})]}).tohex():null!=this.params.unotice?new s({array:[new f({oid:"1.3.6.1.5.5.7.2.2"}),new p(this.params.unotice)]}).tohex():void 0},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&(this.params=r)},Ce(d.asn1.x509.PolicyQualifierInfo,d.asn1.ASN1Object),d.asn1.x509.UserNotice=function(r){d.asn1.x509.UserNotice.superclass.constructor.call(this,r);var a=d.asn1.DERSequence,c=d.asn1.x509.DisplayText,f=d.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var p=[];return void 0!==this.params.noticeref&&p.push(new f(this.params.noticeref)),void 0!==this.params.exptext&&p.push(new c(this.params.exptext)),new a({array:p}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&(this.params=r)},Ce(d.asn1.x509.UserNotice,d.asn1.ASN1Object),d.asn1.x509.NoticeReference=function(r){d.asn1.x509.NoticeReference.superclass.constructor.call(this,r);var a=d.asn1.DERSequence,s=d.asn1.DERInteger,c=d.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var f=[];if(void 0!==this.params.org&&f.push(new c(this.params.org)),void 0!==this.params.noticenum){for(var p=[],g=this.params.noticenum,m=0;m<g.length;m++)p.push(new s(g[m]));f.push(new a({array:p}))}if(0==f.length)throw new Error("parameter is empty");return new a({array:f}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&(this.params=r)},Ce(d.asn1.x509.NoticeReference,d.asn1.ASN1Object),d.asn1.x509.DisplayText=function(r){d.asn1.x509.DisplayText.superclass.constructor.call(this,r),this.hT="0c",void 0!==r&&("ia5"===r.type?this.hT="16":"vis"===r.type?this.hT="1a":"bmp"===r.type&&(this.hT="1e"))},Ce(d.asn1.x509.DisplayText,d.asn1.DERAbstractString),d.asn1.x509.PolicyMappings=function(r){d.asn1.x509.PolicyMappings.superclass.constructor.call(this,r);var f=d.asn1.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){for(var p=this.params,g=[],m=0;m<p.array.length;m++){var x=p.array[m];g.push({seq:[{oid:x[0]},{oid:x[1]}]})}return this.asn1ExtnValue=f({seq:g}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",void 0!==r&&(this.params=r)},Ce(d.asn1.x509.PolicyMappings,d.asn1.x509.Extension),d.asn1.x509.PolicyConstraints=function(r){d.asn1.x509.PolicyConstraints.superclass.constructor.call(this,r);var f=d.asn1.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){var p=this.params,g=[];return null!=p.reqexp&&g.push({tag:{tagi:"80",obj:{int:p.reqexp}}}),null!=p.inhibit&&g.push({tag:{tagi:"81",obj:{int:p.inhibit}}}),this.asn1ExtnValue=f({seq:g}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",void 0!==r&&(this.params=r)},Ce(d.asn1.x509.PolicyConstraints,d.asn1.x509.Extension),d.asn1.x509.InhibitAnyPolicy=function(r){d.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,r);var f=d.asn1.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=f({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",void 0!==r&&(this.params=r)},Ce(d.asn1.x509.InhibitAnyPolicy,d.asn1.x509.Extension),d.asn1.x509.NameConstraints=function(r){d.asn1.x509.NameConstraints.superclass.constructor.call(this,r);var s=d.asn1,f=s.ASN1Util.newObject,p=s.x509.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var g=this.params,m=[];if(null!=g.permit&&null!=g.permit.length){for(var x=[],A=0;A<g.permit.length;A++)x.push(new p(g.permit[A]));m.push({tag:{tagi:"a0",obj:{seq:x}}})}if(null!=g.exclude&&null!=g.exclude.length){var N=[];for(A=0;A<g.exclude.length;A++)N.push(new p(g.exclude[A]));m.push({tag:{tagi:"a1",obj:{seq:N}}})}return this.asn1ExtnValue=f({seq:m}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",void 0!==r&&(this.params=r)},Ce(d.asn1.x509.NameConstraints,d.asn1.x509.Extension),d.asn1.x509.GeneralSubtree=function(r){d.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var a=d.asn1,c=a.x509.GeneralName,f=a.ASN1Util.newObject;this.params=null,this.setByParam=function(p){this.params=p},this.tohex=function(){var p=this.params,g=[new c(p)];return null!=p.min&&g.push({tag:{tagi:"80",obj:{int:p.min}}}),null!=p.max&&g.push({tag:{tagi:"81",obj:{int:p.max}}}),f({seq:g}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.x509.GeneralSubtree,d.asn1.ASN1Object),d.asn1.x509.ExtKeyUsage=function(r){d.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,r);var s=d.asn1;this.setPurposeArray=function(c){this.asn1ExtnValue=new s.DERSequence;for(var f=0;f<c.length;f++){var p=new s.DERObjectIdentifier(c[f]);this.asn1ExtnValue.appendASN1Object(p)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",void 0!==r&&void 0!==r.array&&this.setPurposeArray(r.array)},Ce(d.asn1.x509.ExtKeyUsage,d.asn1.x509.Extension),d.asn1.x509.AuthorityKeyIdentifier=function(r){d.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,r);var s=d.asn1,c=s.DERTaggedObject,f=s.x509.GeneralNames;this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var g=new Array;this.asn1KID&&g.push(new c({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&g.push(new c({explicit:!1,tag:"a1",obj:new f([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&g.push(new c({explicit:!1,tag:"82",obj:this.asn1CertSN}));var m=new s.DERSequence({array:g});return this.asn1ExtnValue=m,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(g){if(void 0!==g.str||void 0!==g.hex)this.asn1KID=new d.asn1.DEROctetString(g);else if("object"==typeof g&&d.crypto.Util.isKey(g)||"string"==typeof g&&-1!=g.indexOf("BEGIN ")){var m=g;"string"==typeof g&&(m=ct.getKey(g));var x=ct.getKeyID(m);this.asn1KID=new d.asn1.DEROctetString({hex:x})}},this.setCertIssuerByParam=function(g){void 0!==g.str||void 0!==g.ldapstr||void 0!==g.hex||void 0!==g.certsubject||void 0!==g.certissuer?this.asn1CertIssuer=new d.asn1.x509.X500Name(g):"string"==typeof g&&-1!=g.indexOf("BEGIN ")&&-1!=g.indexOf("CERTIFICATE")&&(this.asn1CertIssuer=new d.asn1.x509.X500Name({certissuer:g}))},this.setCertSNByParam=function(g){if(void 0!==g.str||void 0!==g.bigint||void 0!==g.hex)this.asn1CertSN=new d.asn1.DERInteger(g);else if("string"==typeof g&&-1!=g.indexOf("BEGIN ")&&g.indexOf("CERTIFICATE")){var m=new Ge;m.readCertPEM(g);var x=m.getSerialNumberHex();this.asn1CertSN=new d.asn1.DERInteger({hex:x})}},this.oid="2.5.29.35",void 0!==r&&(void 0!==r.kid&&this.setKIDByParam(r.kid),void 0!==r.issuer&&this.setCertIssuerByParam(r.issuer),void 0!==r.sn&&this.setCertSNByParam(r.sn),void 0!==r.issuersn&&"string"==typeof r.issuersn&&-1!=r.issuersn.indexOf("BEGIN ")&&r.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(r.issuersn),this.setCertIssuerByParam(r.issuersn)))},Ce(d.asn1.x509.AuthorityKeyIdentifier,d.asn1.x509.Extension),d.asn1.x509.SubjectKeyIdentifier=function(r){d.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,r);var c=d.asn1.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(f){if(void 0!==f.str||void 0!==f.hex)this.asn1KID=new c(f);else if("object"==typeof f&&d.crypto.Util.isKey(f)||"string"==typeof f&&-1!=f.indexOf("BEGIN")){var p=f;"string"==typeof f&&(p=ct.getKey(f));var g=ct.getKeyID(p);this.asn1KID=new d.asn1.DEROctetString({hex:g})}},this.oid="2.5.29.14",void 0!==r&&void 0!==r.kid&&this.setKIDByParam(r.kid)},Ce(d.asn1.x509.SubjectKeyIdentifier,d.asn1.x509.Extension),d.asn1.x509.AuthorityInfoAccess=function(r){d.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,r),this.setAccessDescriptionArray=function(a){for(var s=new Array,f=d.asn1,p=f.DERSequence,g=f.DERObjectIdentifier,m=f.x509.GeneralName,x=0;x<a.length;x++){var A,N=a[x];if(void 0!==N.ocsp)A=new p({array:[new g({oid:"1.3.6.1.5.5.7.48.1"}),new m({uri:N.ocsp})]});else{if(void 0===N.caissuer)throw new Error("unknown AccessMethod parameter: "+JSON.stringify(N));A=new p({array:[new g({oid:"1.3.6.1.5.5.7.48.2"}),new m({uri:N.caissuer})]})}s.push(A)}this.asn1ExtnValue=new p({array:s})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",void 0!==r&&void 0!==r.array&&this.setAccessDescriptionArray(r.array)},Ce(d.asn1.x509.AuthorityInfoAccess,d.asn1.x509.Extension),d.asn1.x509.SubjectAltName=function(r){d.asn1.x509.SubjectAltName.superclass.constructor.call(this,r),this.setNameArray=function(a){this.asn1ExtnValue=new d.asn1.x509.GeneralNames(a)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",void 0!==r&&void 0!==r.array&&this.setNameArray(r.array)},Ce(d.asn1.x509.SubjectAltName,d.asn1.x509.Extension),d.asn1.x509.IssuerAltName=function(r){d.asn1.x509.IssuerAltName.superclass.constructor.call(this,r),this.setNameArray=function(a){this.asn1ExtnValue=new d.asn1.x509.GeneralNames(a)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",void 0!==r&&void 0!==r.array&&this.setNameArray(r.array)},Ce(d.asn1.x509.IssuerAltName,d.asn1.x509.Extension),d.asn1.x509.SubjectDirectoryAttributes=function(r){d.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,r);var a=d.asn1,s=a.DERSequence,c=a.ASN1Util.newObject,f=a.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var p=[],g=0;g<this.params.array.length;g++){var m=this.params.array[g],x={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if("dateOfBirth"==m.attr)x.seq[0].oid=f(m.attr),x.seq[1].set[0]={gentime:m.str};else if("placeOfBirth"==m.attr)x.seq[0].oid=f(m.attr),x.seq[1].set[0]={utf8str:m.str};else if("gender"==m.attr)x.seq[0].oid=f(m.attr),x.seq[1].set[0]={prnstr:m.str};else if("countryOfCitizenship"==m.attr)x.seq[0].oid=f(m.attr),x.seq[1].set[0]={prnstr:m.str};else{if("countryOfResidence"!=m.attr)throw new Error("unsupported attribute: "+m.attr);x.seq[0].oid=f(m.attr),x.seq[1].set[0]={prnstr:m.str}}p.push(new c(x))}var A=new s({array:p});return this.asn1ExtnValue=A,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",void 0!==r&&(this.params=r)},Ce(d.asn1.x509.SubjectDirectoryAttributes,d.asn1.x509.Extension),d.asn1.x509.PrivateExtension=function(r){d.asn1.x509.PrivateExtension.superclass.constructor.call(this,r);var s=d.lang.String.isHex,c=d.asn1,f=c.x509.OID.name2oid,p=c.ASN1Util.newObject;this.params=null,this.setByParam=function(g){this.oid=f(g.extname),this.params=g},this.getExtnValueHex=function(){if(null==this.params.extname||null==this.params.extn)throw new Error("extname or extnhex not specified");var g=this.params.extn;if("string"==typeof g&&s(g))return g;if("object"==typeof g)try{return p(g).tohex()}catch{}throw new Error("unsupported extn value")},null!=r&&this.setByParam(r)},Ce(d.asn1.x509.PrivateExtension,d.asn1.x509.Extension),d.asn1.x509.CRL=function(r){d.asn1.x509.CRL.superclass.constructor.call(this);var s=d.asn1,c=s.DERSequence,f=s.DERBitString,p=s.x509,g=p.AlgorithmIdentifier,m=p.TBSCertList;this.params=void 0,this.setByParam=function(x){this.params=x},this.sign=function(){var x=new m(this.params).tohex(),A=new d.crypto.Signature({alg:this.params.sigalg});A.init(this.params.cakey),A.updateHex(x);var N=A.sign();this.params.sighex=N},this.getPEM=function(){return nn(this.tohex(),"X509 CRL")},this.tohex=function(){var x=this.params;if(null==x.tbsobj&&(x.tbsobj=new m(x)),null==x.sighex&&null!=x.cakey&&this.sign(),null==x.sighex)throw new Error("sighex or cakey parameter not defined");var A=[];return A.push(x.tbsobj),A.push(new g({name:x.sigalg})),A.push(new f({hex:"00"+x.sighex})),new c({array:A}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&(this.params=r)},Ce(d.asn1.x509.CRL,d.asn1.ASN1Object),d.asn1.x509.TBSCertList=function(r){d.asn1.x509.TBSCertList.superclass.constructor.call(this);var s=d.asn1,c=s.DERInteger,f=s.DERSequence,p=s.DERTaggedObject,m=s.x509,x=m.AlgorithmIdentifier,A=m.Time,N=m.Extensions,P=m.X500Name;this.params=null,this.setByParam=function(b){this.params=b},this.getRevCertSequence=function(){for(var b=[],y=this.params.revcert,F=0;F<y.length;F++){var C=[new c(y[F].sn),new A(y[F].date)];null!=y[F].ext&&C.push(new N(y[F].ext)),b.push(new f({array:C}))}return new f({array:b})},this.tohex=function(){var b=[],y=this.params;if(null!=y.version){var C=new c({int:y.version-1});b.push(C)}if(b.push(new x({name:y.sigalg})),b.push(new P(y.issuer)),b.push(new A(y.thisupdate)),null!=y.nextupdate&&b.push(new A(y.nextupdate)),null!=y.revcert&&b.push(this.getRevCertSequence()),null!=y.ext){var I=new N(y.ext);b.push(new p({tag:"a0",explicit:!0,obj:I}))}return new f({array:b}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.x509.TBSCertList,d.asn1.ASN1Object),d.asn1.x509.CRLEntry=function(r){d.asn1.x509.CRLEntry.superclass.constructor.call(this);var f=d.asn1;this.setCertSerial=function(p){this.sn=new f.DERInteger(p)},this.setRevocationDate=function(p){this.time=new f.x509.Time(p)},this.tohex=function(){var p=new f.DERSequence({array:[this.sn,this.time]});return this.TLV=p.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&(void 0!==r.time&&this.setRevocationDate(r.time),void 0!==r.sn&&this.setCertSerial(r.sn))},Ce(d.asn1.x509.CRLEntry,d.asn1.ASN1Object),d.asn1.x509.CRLNumber=function(r){d.asn1.x509.CRLNumber.superclass.constructor.call(this,r),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new d.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",null!=r&&(this.params=r)},Ce(d.asn1.x509.CRLNumber,d.asn1.x509.Extension),d.asn1.x509.CRLReason=function(r){d.asn1.x509.CRLReason.superclass.constructor.call(this,r),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new d.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",null!=r&&(this.params=r)},Ce(d.asn1.x509.CRLReason,d.asn1.x509.Extension),d.asn1.x509.OCSPNonce=function(r){d.asn1.x509.OCSPNonce.superclass.constructor.call(this,r),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new d.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",null!=r&&(this.params=r)},Ce(d.asn1.x509.OCSPNonce,d.asn1.x509.Extension),d.asn1.x509.OCSPNoCheck=function(r){d.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,r),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new d.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",null!=r&&(this.params=r)},Ce(d.asn1.x509.OCSPNoCheck,d.asn1.x509.Extension),d.asn1.x509.AdobeTimeStamp=function(r){d.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,r);var s=d.asn1,c=s.DERInteger,f=s.DERBoolean,p=s.DERSequence,g=s.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var m=this.params,x=[new c(1)];return x.push(new g({uri:m.uri})),null!=m.reqauth&&x.push(new f(m.reqauth)),this.asn1ExtnValue=new p({array:x}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",void 0!==r&&this.setByParam(r)},Ce(d.asn1.x509.AdobeTimeStamp,d.asn1.x509.Extension),d.asn1.x509.X500Name=function(r){d.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var s=d.asn1,c=s.x509,f=c.RDN;this.setByString=function(g,m){void 0!==m&&(this.sRule=m);var x=g.split("/");x.shift();for(var A=[],N=0;N<x.length;N++)if(x[N].match(/^[^=]+=.+$/))A.push(x[N]);else{var P=A.length-1;A[P]=A[P]+"/"+x[N]}for(N=0;N<A.length;N++)this.asn1Array.push(new f({str:A[N],rule:this.sRule}))},this.setByLdapString=function(g,m){void 0!==m&&(this.sRule=m);var x=c.X500Name.ldapToCompat(g);this.setByString(x,m)},this.setByObject=function(g,m){for(var x in void 0!==m&&(this.sRule=m),g)if(g.hasOwnProperty(x)){var A=new f({str:x+"="+g[x],rule:this.sRule});this.asn1Array?this.asn1Array.push(A):this.asn1Array=[A]}},this.setByParam=function(g){if(void 0!==g.rule&&(this.sRule=g.rule),void 0!==g.array)this.paramArray=g.array;else if(void 0!==g.str)this.setByString(g.str);else if(void 0!==g.ldapstr)this.setByLdapString(g.ldapstr);else if(void 0!==g.hex)this.hTLV=g.hex;else if(void 0!==g.certissuer)(m=new Ge).readCertPEM(g.certissuer),this.hTLV=m.getIssuerHex();else if(void 0!==g.certsubject){var m;(m=new Ge).readCertPEM(g.certsubject),this.hTLV=m.getSubjectHex()}else"object"==typeof g&&void 0===g.certsubject&&void 0===g.certissuer&&this.setByObject(g)},this.tohex=function(){if("string"==typeof this.hTLV)return this.hTLV;if(0==this.asn1Array.length&&this.paramArray.length>0)for(var g=0;g<this.paramArray.length;g++){var m={array:this.paramArray[g]};"utf8"!=this.sRule&&(m.rule=this.sRule);var x=new f(m);this.asn1Array.push(x)}var A=new s.DERSequence({array:this.asn1Array});return this.hTLV=A.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.x509.X500Name,d.asn1.ASN1Object),d.asn1.x509.X500Name.compatToLDAP=function(r){if("/"!==r.substr(0,1))throw"malformed input";var s=(r=r.substr(1)).split("/");return s.reverse(),s=s.map(function(c){return c.replace(/,/,"\\,")}),s.join(",")},d.asn1.x509.X500Name.onelineToLDAP=function(r){return d.asn1.x509.X500Name.compatToLDAP(r)},d.asn1.x509.X500Name.ldapToCompat=function(r){for(var a=r.split(","),s=!1,c=[],f=0;a.length>0;f++){var p=a.shift();if(!0===s){var m=(c.pop()+","+p).replace(/\\,/g,",");c.push(m),s=!1}else c.push(p);"\\"===p.substr(-1,1)&&(s=!0)}return c=c.map(function(x){return x.replace("/","\\/")}),c.reverse(),"/"+c.join("/")},d.asn1.x509.X500Name.ldapToOneline=function(r){return d.asn1.x509.X500Name.ldapToCompat(r)},d.asn1.x509.RDN=function(r){d.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var a=d.asn1.x509.AttributeTypeAndValue;this.setByParam=function(s){void 0!==s.rule&&(this.sRule=s.rule),void 0!==s.str&&this.addByMultiValuedString(s.str),void 0!==s.array&&(this.paramArray=s.array)},this.addByString=function(s){this.asn1Array.push(new d.asn1.x509.AttributeTypeAndValue({str:s,rule:this.sRule}))},this.addByMultiValuedString=function(s){for(var c=d.asn1.x509.RDN.parseString(s),f=0;f<c.length;f++)this.addByString(c[f])},this.tohex=function(){if(0==this.asn1Array.length&&this.paramArray.length>0)for(var s=0;s<this.paramArray.length;s++){var c=this.paramArray[s];void 0!==c.rule&&"utf8"!=this.sRule&&(c.rule=this.sRule);var f=new a(c);this.asn1Array.push(f)}var p=new d.asn1.DERSet({array:this.asn1Array});return this.TLV=p.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.x509.RDN,d.asn1.ASN1Object),d.asn1.x509.RDN.parseString=function(r){for(var a=r.split(/\+/),s=!1,c=[],f=0;a.length>0;f++){var p=a.shift();if(!0===s){var m=(c.pop()+"+"+p).replace(/\\\+/g,"+");c.push(m),s=!1}else c.push(p);"\\"===p.substr(-1,1)&&(s=!0)}var x=!1,A=[];for(f=0;c.length>0;f++){if(p=c.shift(),!0===x){var N=A.pop();p.match(/"$/)?(m=(N+"+"+p).replace(/^([^=]+)="(.*)"$/,"$1=$2"),A.push(m),x=!1):A.push(N+"+"+p)}else A.push(p);p.match(/^[^=]+="/)&&(x=!0)}return A},d.asn1.x509.AttributeTypeAndValue=function(r){d.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var s=d.asn1,c=s.DERSequence,f=s.DERUTF8String,p=s.DERPrintableString,g=s.DERTeletexString,m=s.DERIA5String,x=s.DERVisibleString,A=s.DERBMPString,N=d.lang.String.isMail,P=d.lang.String.isPrintable;this.setByParam=function(b){if(void 0!==b.rule&&(this.sRule=b.rule),void 0!==b.ds&&(this.dsType=b.ds),void 0===b.value&&void 0!==b.str){var F=b.str.match(/^([^=]+)=(.+)$/);if(!F)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.sType=F[1],this.sValue=F[2]}else this.sType=b.type,this.sValue=b.value},this.setByString=function(b,y){void 0!==y&&(this.sRule=y);var F=b.match(/^([^=]+)=(.+)$/);if(!F)throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr);this.setByAttrTypeAndValueStr(F[1],F[2])},this._getDsType=function(){var b=this.sType,y=this.sValue,F=this.sRule;return"prn"===F?"CN"==b&&N(y)?"ia5":P(y)?"prn":"utf8":"utf8"===F?"CN"==b&&N(y)?"ia5":"C"==b?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(b,y,F){void 0!==F&&(this.sRule=F),this.sType=b,this.sValue=y},this.getValueObj=function(b,y){if("utf8"==b)return new f({str:y});if("prn"==b)return new p({str:y});if("tel"==b)return new g({str:y});if("ia5"==b)return new m({str:y});if("vis"==b)return new x({str:y});if("bmp"==b)return new A({str:y});throw new Error("unsupported directory string type: type="+b+" value="+y)},this.tohex=function(){null==this.dsType&&(this.dsType=this._getDsType());var b=d.asn1.x509.OID.atype2obj(this.sType),y=this.getValueObj(this.dsType,this.sValue),F=new c({array:[b,y]});return this.TLV=F.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.x509.AttributeTypeAndValue,d.asn1.ASN1Object),d.asn1.x509.SubjectPublicKeyInfo=function(r){d.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var f=d.asn1,p=f.DERInteger,g=f.DERBitString,m=f.DERObjectIdentifier,x=f.DERSequence,A=f.ASN1Util.newObject,P=f.x509.AlgorithmIdentifier;this.getASN1Object=function(){if(null==this.asn1AlgId||null==this.asn1SubjPKey)throw"algId and/or subjPubKey not set";return new x({array:[this.asn1AlgId,this.asn1SubjPKey]})},this.tohex=function(){var C=this.getASN1Object();return this.hTLV=C.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(C){try{if(C instanceof Ve){var T=A({seq:[{int:{bigint:C.n}},{int:{int:C.e}}]}).tohex();this.asn1AlgId=new P({name:"rsaEncryption"}),this.asn1SubjPKey=new g({hex:"00"+T})}}catch{}try{if(C instanceof d.crypto.ECDSA){var L=new m({name:C.curveName});this.asn1AlgId=new P({name:"ecPublicKey",asn1params:L}),this.asn1SubjPKey=new g({hex:"00"+C.pubKeyHex})}}catch{}try{if(C instanceof d.crypto.DSA){L=new A({seq:[{int:{bigint:C.p}},{int:{bigint:C.q}},{int:{bigint:C.g}}]}),this.asn1AlgId=new P({name:"dsa",asn1params:L});var Z=new p({bigint:C.y});this.asn1SubjPKey=new g({hex:"00"+Z.tohex()})}}catch{}},void 0!==r&&this.setPubKey(r)},Ce(d.asn1.x509.SubjectPublicKeyInfo,d.asn1.ASN1Object),d.asn1.x509.Time=function(r){d.asn1.x509.Time.superclass.constructor.call(this);var f=d.asn1,p=f.DERUTCTime,g=f.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(m){this.timeParams=m},this.setByParam=function(m){this.params=m},this.getType=function(m){return m.match(/^[0-9]{12}Z$/)?"utc":m.match(/^[0-9]{14}Z$/)?"gen":m.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":m.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var m=this.params,x=null;if("string"==typeof m&&(m={str:m}),null!=m&&m.str&&(null==m.type||null==m.type)&&(m.type=this.getType(m.str)),null!=m&&m.str?("utc"==m.type&&(x=new p(m.str)),"gen"==m.type&&(x=new g(m.str))):x="gen"==this.type?new g:new p,null==x)throw new Error("wrong setting for Time");return this.TLV=x.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},d.asn1.x509.Time_bak=function(r){d.asn1.x509.Time_bak.superclass.constructor.call(this);var f=d.asn1,p=f.DERUTCTime,g=f.DERGeneralizedTime;this.setTimeParams=function(m){this.timeParams=m},this.tohex=function(){var m=null;return m=null!=this.timeParams?"utc"==this.type?new p(this.timeParams):new g(this.timeParams):"utc"==this.type?new p:new g,this.TLV=m.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",void 0!==r&&(void 0!==r.type?this.type=r.type:void 0!==r.str&&(r.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),r.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=r)},Ce(d.asn1.x509.Time,d.asn1.ASN1Object),d.asn1.x509.AlgorithmIdentifier=function(r){d.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var s=d.asn1,c=s.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(null===this.nameAlg&&null===this.asn1Alg)throw new Error("algorithm not specified");if(null!==this.nameAlg){var p=null;for(var g in c)g===this.nameAlg&&(p=c[g]);if(null!==p)return this.hTLV=p,this.hTLV}null!==this.nameAlg&&null===this.asn1Alg&&(this.asn1Alg=s.x509.OID.name2obj(this.nameAlg));var m=[this.asn1Alg];null!==this.asn1Params&&m.push(this.asn1Params);var x=new s.DERSequence({array:m});return this.hTLV=x.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&(void 0!==r.name&&(this.nameAlg=r.name),void 0!==r.asn1params&&(this.asn1Params=r.asn1params),void 0!==r.paramempty&&(this.paramEmpty=r.paramempty)),null===this.asn1Params&&!1===this.paramEmpty&&null!==this.nameAlg){void 0!==this.nameAlg.name&&(this.nameAlg=this.nameAlg.name);var f=this.nameAlg.toLowerCase();"withdsa"!==f.substr(-7,7)&&"withecdsa"!==f.substr(-9,9)&&(this.asn1Params=new s.DERNull)}},Ce(d.asn1.x509.AlgorithmIdentifier,d.asn1.ASN1Object),d.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},d.asn1.x509.GeneralName=function(r){d.asn1.x509.GeneralName.superclass.constructor.call(this);var c=d.asn1,f=c.x509,p=f.X500Name,g=f.OtherName,m=c.DERIA5String,A=c.DEROctetString,N=c.DERTaggedObject,P=c.ASN1Object,b=Error;this.params=null,this.setByParam=function(y){this.params=y},this.tohex=function(){var F,C,y=this.params,I=!1;if(void 0!==y.other)F="a0",C=new g(y.other);else if(void 0!==y.rfc822)F="81",C=new m({str:y.rfc822});else if(void 0!==y.dns)F="82",C=new m({str:y.dns});else if(void 0!==y.dn)F="a4",I=!0,C="string"==typeof y.dn?new p({str:y.dn}):y.dn instanceof d.asn1.x509.X500Name?y.dn:new p(y.dn);else if(void 0!==y.ldapdn)F="a4",I=!0,C=new p({ldapstr:y.ldapdn});else if(void 0!==y.certissuer||void 0!==y.certsubj){F="a4",I=!0;var T,L,Z=null;if(void 0!==y.certsubj?(T=!1,L=y.certsubj):(T=!0,L=y.certissuer),L.match(/^[0-9A-Fa-f]+$/),-1!=L.indexOf("-----BEGIN ")&&(Z=Ht(L)),null==Z)throw new Error("certsubj/certissuer not cert");var G,W=new Ge;W.hex=Z,G=T?W.getIssuerHex():W.getSubjectHex(),(C=new P).hTLV=G}else if(void 0!==y.uri)F="86",C=new m({str:y.uri});else{if(void 0===y.ip)throw new b("improper params");F="87";var me,Se=y.ip;try{if(Se.match(/^[0-9a-f]+$/)){var O=Se.length;if(8!=O&&16!=O&&32!=O&&64!=O)throw"err";me=Se}else me=Zi(Se)}catch($){throw new b("malformed IP address: "+y.ip+":"+$.message)}C=new A({hex:me})}return new N({tag:F,explicit:I,obj:C}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.x509.GeneralName,d.asn1.ASN1Object),d.asn1.x509.GeneralNames=function(r){d.asn1.x509.GeneralNames.superclass.constructor.call(this);var c=d.asn1;this.setByParamArray=function(f){for(var p=0;p<f.length;p++){var g=new c.x509.GeneralName(f[p]);this.asn1Array.push(g)}},this.tohex=function(){return new c.DERSequence({array:this.asn1Array}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,typeof r<"u"&&this.setByParamArray(r)},Ce(d.asn1.x509.GeneralNames,d.asn1.ASN1Object),d.asn1.x509.OtherName=function(r){d.asn1.x509.OtherName.superclass.constructor.call(this);var f=d.asn1,p=f.DERObjectIdentifier,g=f.DERSequence,m=f.ASN1Util.newObject;this.params=null,this.setByParam=function(x){this.params=x},this.tohex=function(){var x=this.params;if(null==x.oid||null==x.value)throw new Error("oid or value not specified");var A=new p({oid:x.oid}),N=m({tag:{tag:"a0",explicit:!0,obj:x.value}});return new g({array:[A,N]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.x509.OtherName,d.asn1.ASN1Object),d.asn1.x509.OID=new function(){var r=d.asn1.DERObjectIdentifier;this.name2oidList={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(a){if(typeof this.objCache[a]<"u")return this.objCache[a];if(typeof this.name2oidList[a]>"u")throw"Name of ObjectIdentifier not defined: "+a;var c=new r({oid:this.name2oidList[a]});return this.objCache[a]=c,c},this.atype2obj=function(a){if(void 0!==this.objCache[a])return this.objCache[a];var s;if(a.match(/^\d+\.\d+\.[0-9.]+$/))s=a;else if(void 0!==this.atype2oidList[a])s=this.atype2oidList[a];else{if(void 0===this.name2oidList[a])throw new Error("AttributeType name undefined: "+a);s=this.name2oidList[a]}var c=new r({oid:s});return this.objCache[a]=c,c},this.registerOIDs=function(a){if(this.checkOIDs(a))for(var s in a)this.name2oidList[s]=a[s]},this.checkOIDs=function(a){try{var s=Object.keys(a);return 0!=s.length&&(s.map(function(c,f,p){if(!this[c].match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")},a),!0)}catch{return!1}}},d.asn1.x509.OID.oid2name=function(r){var a=d.asn1.x509.OID.name2oidList;for(var s in a)if(a[s]==r)return s;return""},d.asn1.x509.OID.oid2atype=function(r){var a=d.asn1.x509.OID.atype2oidList;for(var s in a)if(a[s]==r)return s;return r},d.asn1.x509.OID.name2oid=function(r){if(r.match(/^[0-9.]+$/))return r;var a=d.asn1.x509.OID.name2oidList;return void 0===a[r]?"":a[r]},d.asn1.x509.X509Util={},d.asn1.x509.X509Util.newCertPEM=function(r){return new(0,d.asn1.x509.Certificate)(r).getPEM()},(typeof d>"u"||!d)&&(d={}),(typeof d.asn1>"u"||!d.asn1)&&(d.asn1={}),(typeof d.asn1.cms>"u"||!d.asn1.cms)&&(d.asn1.cms={}),d.asn1.cms.Attribute=function(r){var a=Error,c=d.asn1,f=c.DERSequence,p=c.DERSet,g=c.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(m){this.params=m},this.getValueArray=function(){throw new a("not yet implemented abstract")},this.tohex=function(){var m=new g({oid:this.typeOid}),x=new p({array:this.getValueArray()});return new f({array:[m,x]}).tohex()},this.getEncodedHex=function(){return this.tohex()}},Ce(d.asn1.cms.Attribute,d.asn1.ASN1Object),d.asn1.cms.ContentType=function(r){var s=d.asn1;s.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){return[new s.DERObjectIdentifier(this.params.type)]},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.ContentType,d.asn1.cms.Attribute),d.asn1.cms.MessageDigest=function(r){var s=d.asn1,c=s.DEROctetString;s.cms.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){return[new c(this.params)]},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.MessageDigest,d.asn1.cms.Attribute),d.asn1.cms.SigningTime=function(r){var s=d.asn1;s.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){return[new s.x509.Time(this.params)]},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.SigningTime,d.asn1.cms.Attribute),d.asn1.cms.SigningCertificate=function(r){var a=Error,c=d.asn1,f=c.DERSequence,p=c.cms,g=p.ESSCertID;p.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new a("parameter 'array' not specified");for(var x=this.params.array,A=[],N=0;N<x.length;N++){var P=x[N];0==r.hasis&&"string"==typeof P&&(-1!=P.indexOf("-----BEGIN")||Ne.isASN1HEX(P))&&(P={cert:P}),0!=P.hasis&&0==r.hasis&&(P.hasis=!1),A.push(new g(P))}var b=new f({array:A});return[new f({array:[b]})]},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.SigningCertificate,d.asn1.cms.Attribute),d.asn1.cms.ESSCertID=function(r){d.asn1.cms.ESSCertID.superclass.constructor.call(this);var a=Error,s=d,c=s.asn1,f=c.DEROctetString,p=c.DERSequence,g=c.cms.IssuerSerial;this.params=null,this.getCertHash=function(m,x){if(null!=m.hash)return m.hash;if("string"==typeof m&&-1==m.indexOf("-----BEGIN")&&!Ne.isASN1HEX(m))return m;var A,N,P;if("string"==typeof m)A=m;else{if(null==m.cert)throw new a("hash nor cert unspecified");A=m.cert}if(N=-1!=A.indexOf("-----BEGIN")?Ht(A):A,"string"==typeof m&&(-1!=m.indexOf("-----BEGIN")?N=Ht(m):Ne.isASN1HEX(m)&&(N=m)),null!=m.alg)P=m.alg;else{if(null==x)throw new a("hash alg unspecified");P=x}return s.crypto.Util.hashHex(N,P)},this.tohex=function(){var m=this.params,x=this.getCertHash(m,"sha1"),A=[];return A.push(new f({hex:x})),("string"==typeof m&&-1!=m.indexOf("-----BEGIN")||null!=m.cert&&0!=m.hasis||null!=m.issuer&&null!=m.serial)&&A.push(new g(m)),new p({array:A}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.ESSCertID,d.asn1.ASN1Object),d.asn1.cms.SigningCertificateV2=function(r){var a=Error,c=d.asn1,f=c.DERSequence,g=c.cms,m=g.ESSCertIDv2;g.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(null==this.params||null==this.params||null==this.params.array)throw new a("parameter 'array' not specified");for(var A=this.params.array,N=[],P=0;P<A.length;P++){var b=A[P];(null!=r.alg||0==r.hasis)&&"string"==typeof b&&(-1!=b.indexOf("-----BEGIN")||Ne.isASN1HEX(b))&&(b={cert:b}),null==b.alg&&null!=r.alg&&(b.alg=r.alg),0!=b.hasis&&0==r.hasis&&(b.hasis=!1),N.push(new m(b))}var y=new f({array:N});return[new f({array:[y]})]},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.SigningCertificateV2,d.asn1.cms.Attribute),d.asn1.cms.ESSCertIDv2=function(r){d.asn1.cms.ESSCertIDv2.superclass.constructor.call(this),Error;var c=d.asn1,f=c.DEROctetString,p=c.DERSequence,g=c.cms.IssuerSerial,m=c.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var x=this.params,A=this.getCertHash(x,"sha256"),N=[];return null!=x.alg&&"sha256"!=x.alg&&N.push(new m({name:x.alg})),N.push(new f({hex:A})),("string"==typeof x&&-1!=x.indexOf("-----BEGIN")||null!=x.cert&&0!=x.hasis||null!=x.issuer&&null!=x.serial)&&N.push(new g(x)),new p({array:N}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.ESSCertIDv2,d.asn1.cms.ESSCertID),d.asn1.cms.IssuerSerial=function(r){var a=Error,c=d.asn1,f=c.DERInteger,p=c.DERSequence,x=c.x509.GeneralNames,A=Ge;c.cms.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(N){this.params=N},this.tohex=function(){var P,b,N=this.params;if("string"==typeof N&&-1!=N.indexOf("-----BEGIN")||null!=N.cert){var y;y=null!=N.cert?N.cert:N;var F=new A;F.readCertPEM(y),P=F.getIssuer(),b={hex:F.getSerialNumberHex()}}else{if(null==N.issuer||!N.serial)throw new a("cert or issuer and serial parameter not specified");P=N.issuer,b=N.serial}var C=new x([{dn:P}]),I=new f(b);return new p({array:[C,I]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.IssuerSerial,d.asn1.ASN1Object),d.asn1.cms.SignerIdentifier=function(r){var p=d.asn1.cms,g=p.IssuerAndSerialNumber,m=p.SubjectKeyIdentifier;Error,p.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var b=this.params;if("isssn"==b.type)return new g(b).tohex();if("skid"==b.type)return new m(b).tohex();throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.SignerIdentifier,d.asn1.ASN1Object),d.asn1.cms.IssuerAndSerialNumber=function(r){var s=d.asn1,c=s.DERInteger,f=s.DERSequence,m=s.x509.X500Name,x=Ge,A=Error;s.cms.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var P,b,N=this.params;if("string"==typeof N&&-1!=N.indexOf("-----BEGIN")||null!=N.cert){var y;y=null!=N.cert?N.cert:N;var F=new x;F.readCertPEM(y),P=F.getIssuer(),b={hex:F.getSerialNumberHex()}}else{if(null==N.issuer||!N.serial)throw new A("cert or issuer and serial parameter not specified");P=N.issuer,b=N.serial}var C=new m(P),I=new c(b);return new f({array:[C,I]}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(N){this.params=N},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.IssuerAndSerialNumber,d.asn1.ASN1Object),d.asn1.cms.SubjectKeyIdentifier=function(r){var s=d.asn1,p=s.ASN1Util.newObject,P=Ge,b=Error;s.cms.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var F,y=this.params;if(null==y.cert&&null==y.skid)throw new b("property cert nor skid undefined");return null!=y.cert?F=new P(y.cert).getExtSubjectKeyIdentifier().kid.hex:null!=y.skid&&(F=y.skid),p({tag:{tage:"a0",obj:{octstr:{hex:F}}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.SubjectKeyIdentifier,d.asn1.ASN1Object),d.asn1.cms.AttributeList=function(r){var a=Error,c=d.asn1,f=c.DERSet,p=c.cms;p.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(g){this.params=g},this.tohex=function(){var g=this.params;if(null!=this.hTLV)return this.hTLV;var m=!0;null!=g.sortflag&&(m=g.sortflag);for(var x=g.array,A=[],N=0;N<x.length;N++){var P=x[N],b=P.attr;if("contentType"==b)A.push(new p.ContentType(P));else if("messageDigest"==b)A.push(new p.MessageDigest(P));else if("signingTime"==b)A.push(new p.SigningTime(P));else if("signingCertificate"==b)A.push(new p.SigningCertificate(P));else if("signingCertificateV2"==b)A.push(new p.SigningCertificateV2(P));else if("signaturePolicyIdentifier"==b)A.push(new d.asn1.cades.SignaturePolicyIdentifier(P));else{if("signatureTimeStamp"!=b&&"timeStampToken"!=b)throw new a("unknown attr: "+b);A.push(new d.asn1.cades.SignatureTimeStamp(P))}}var y=new f({array:A,sortflag:m});return this.hTLV=y.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.AttributeList,d.asn1.ASN1Object),d.asn1.cms.SignerInfo=function(r){var a=Error,c=d.asn1,f=c.DERInteger,p=c.DEROctetString,g=c.DERSequence,m=c.DERTaggedObject,x=c.cms,A=x.SignerIdentifier,N=x.AttributeList,I=c.x509.AlgorithmIdentifier,T=d.crypto,L=ct;x.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var Z=this.params,W=Z.sigalg,G=new N(Z.sattrs).tohex(),me=L.getKey(Z.signkey),Se=new T.Signature({alg:W});Se.init(me),Se.updateHex(G);var O=Se.sign();Z.sighex=O},this.tohex=function(){var Z=this.params,W=[];if(W.push(new f({int:Z.version})),W.push(new A(Z.id)),W.push(new I({name:Z.hashalg})),null!=Z.sattrs){var G=new N(Z.sattrs);try{W.push(new m({tag:"a0",explicit:!1,obj:G}))}catch(Se){throw new a("si sattr error: "+Se)}}if(W.push(new I(null!=Z.sigalgfield?{name:Z.sigalgfield}:{name:Z.sigalg})),null==Z.sighex&&null!=Z.signkey&&this.sign(),W.push(new p({hex:Z.sighex})),null!=Z.uattrs){G=new N(Z.uattrs);try{W.push(new m({tag:"a1",explicit:!1,obj:G}))}catch(O){throw new a("si uattr error: "+O)}}return new g({array:W}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.SignerInfo,d.asn1.ASN1Object),d.asn1.cms.EncapsulatedContentInfo=function(r){var s=d.asn1,c=s.DERTaggedObject,f=s.DERSequence,p=s.DERObjectIdentifier,g=s.DEROctetString;s.cms.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var x=this.params,A=[];if(A.push(new p(x.type)),null!=x.content&&(null!=x.content.hex||null!=x.content.str)&&1!=x.isDetached){var N=new g(x.content),P=new c({tag:"a0",explicit:!0,obj:N});A.push(P)}return new f({array:A}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(x){this.params=x},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.EncapsulatedContentInfo,d.asn1.ASN1Object),d.asn1.cms.ContentInfo=function(r){var s=d.asn1,c=s.DERTaggedObject,f=s.DERSequence,p=s.DERObjectIdentifier;d.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var x=this.params,A=[];A.push(new p(x.type));var N=new c({tag:"a0",explicit:!0,obj:x.obj});return A.push(N),new f({array:A}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(x){this.params=x},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.ContentInfo,d.asn1.ASN1Object),d.asn1.cms.SignedData=function(r){Error;var c=d.asn1,p=c.DERInteger,g=c.DERSet,m=c.DERSequence,A=c.cms,N=A.EncapsulatedContentInfo,P=A.SignerInfo,b=A.ContentInfo,y=A.CertificateSet,F=A.RevocationInfoChoices,I=c.x509.AlgorithmIdentifier;d.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var T=this.params;this._setDigestAlgs(T),this._setContentTypeByEContent(T),this._setMessageDigestByEContent(T),this._setSignerInfoVersion(T),this._setSignedDataVersion(T)},this._setDigestAlgs=function(T){for(var L={},Z=T.sinfos,W=0;W<Z.length;W++)L[Z[W].hashalg]=1;T.hashalgs=Object.keys(L).sort()},this._setContentTypeByEContent=function(T){for(var L=T.econtent.type,Z=T.sinfos,W=0;W<Z.length;W++)this._getAttrParamByName(Z[W],"contentType").type=L},this._setMessageDigestByEContent=function(T){var L=T.econtent,W=L.content.hex;null==W&&"data"==L.type&&null!=L.content.str&&(W=Rn(L.content.str));for(var G=T.sinfos,me=0;me<G.length;me++){var Se=G[me],O=Se.hashalg,j=this._getAttrParamByName(Se,"messageDigest"),$=d.crypto.Util.hashHex(W,O);j.hex=$}},this._getAttrParamByName=function(T,L){for(var Z=T.sattrs.array,W=0;W<Z.length;W++)if(Z[W].attr==L)return Z[W]},this._setSignerInfoVersion=function(T){for(var L=T.sinfos,Z=0;Z<L.length;Z++){var W=L[Z],G=1;"skid"==W.id.type&&(G=3),W.version=G}},this._setSignedDataVersion=function(T){var L=this._getSignedDataVersion(T);T.version=L},this._getSignedDataVersion=function(T){if(null!=T.revinfos)for(var L=T.revinfos,Z=0;Z<L.length;Z++)if(null!=L[Z].ocsp)return 5;var G=T.sinfos;for(Z=0;Z<G.length;Z++)if(3==T.sinfos[Z].version)return 3;return"data"!=T.econtent.type?3:1},this.tohex=function(){var T=this.params;null!=this.getEncodedHexPrepare&&this.getEncodedHexPrepare(),1!=T.fixed&&this.checkAndFixParam();var L=[];L.push(new p({int:T.version}));for(var Z=[],W=0;W<T.hashalgs.length;W++)Z.push(new I({name:T.hashalgs[W]}));L.push(new g({array:Z})),L.push(new N(T.econtent)),null!=T.certs&&L.push(new y(T.certs)),null!=T.revinfos&&L.push(new F(T.revinfos));var me=[];for(W=0;W<T.sinfos.length;W++)me.push(new P(T.sinfos[W]));return L.push(new g({array:me})),new m({array:L}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){return new b({type:"signed-data",obj:this})},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.SignedData,d.asn1.ASN1Object),d.asn1.cms.CertificateSet=function(r){d.asn1.cms.CertificateSet.superclass.constructor.call(this);var a=Error,s=d.asn1,c=s.DERTaggedObject,f=s.DERSet,p=s.ASN1Object;this.params=null,this.tohex=function(){var x,g=this.params,m=[];if(g instanceof Array)x=g;else{if(null==g.array)throw new a("cert array not specified");x=g.array}for(var A=0;A<x.length;A++){var P=Ht(x[A]),b=new p;b.hTLV=P,m.push(b)}var y={array:m};0==g.sortflag&&(y.sortflag=!1);var F=new f(y);return new c({tag:"a0",explicit:!1,obj:F}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.CertificateSet,d.asn1.ASN1Object),d.asn1.cms.RevocationInfoChoices=function(r){d.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var a=this.params;if(!a instanceof Array)throw new Error("params is not array");for(var s=[],c=0;c<a.length;c++)s.push(new d.asn1.cms.RevocationInfoChoice(a[c]));return d.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:s}}}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.RevocationInfoChoices,d.asn1.ASN1Object),d.asn1.cms.RevocationInfoChoice=function(r){d.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var a=this.params;if(null!=a.crl&&"string"==typeof a.crl){var s=a.crl;return-1!=a.crl.indexOf("-----BEGIN")&&(s=Ht(a.crl)),s}if(null!=a.ocsp)return d.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new d.asn1.cms.OtherRevocationFormat(a)}}).tohex();throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.RevocationInfoChoice,d.asn1.ASN1Object),d.asn1.cms.OtherRevocationFormat=function(r){d.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var a=Error,f=d.asn1.ASN1Util.newObject,p=d.lang.String.isHex;this.params=null,this.tohex=function(){var g=this.params;if(null==g.ocsp)throw new a("property ocsp not specified");if(!p(g.ocsp)||!Ne.isASN1HEX(g.ocsp))throw new a("ocsp value not ASN.1 hex string");return f({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:g.ocsp}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cms.OtherRevocationFormat,d.asn1.ASN1Object),d.asn1.cms.CMSUtil=new function(){},d.asn1.cms.CMSUtil.newSignedData=function(r){return new d.asn1.cms.SignedData(r)},d.asn1.cms.CMSUtil.verifySignedData=function(r){var y=Ne.getVbyList,F=Ne.getTLVbyList,C=Ne.getIdxbyList,I=Ne.getChildIdx,T=Ne.getTLV,L=Ne.oidname,Z=d.crypto.Util.hashHex;void 0===r.cms&&(0,d.lang.String.isHex)(r.cms);var W=r.cms,Se=function(oe,fe){var xe=fe.idx;fe.signerid_issuer1=F(oe,xe,[1,0],"30"),fe.signerid_serial1=y(oe,xe,[1,1],"02"),fe.hashalg=L(y(oe,xe,[2,0],"06"));var qe=C(oe,xe,[3],"a0");fe.idxSignedAttrs=qe,O(oe,fe,qe);var Ze=I(oe,xe).length;if(Ze<6)throw"malformed SignerInfo";fe.sigalg=L(y(oe,xe,[Ze-2,0],"06")),fe.sigval=y(oe,xe,[Ze-1],"04")},O=function(oe,fe,xe){var qe=I(oe,xe);fe.signedAttrIdxList=qe;for(var Ue=0;Ue<qe.length;Ue++){var Ye,Ze=qe[Ue],et=y(oe,Ze,[0],"06");"2a864886f70d010905"===et?(Ye=mt(y(oe,Ze,[1,0])),fe.saSigningTime=Ye):"2a864886f70d010904"===et&&(Ye=y(oe,Ze,[1,0],"04"),fe.saMessageDigest=Ye)}},re=function(oe,fe,xe,qe){xe.verifyDetail={};var Ue=xe.verifyDetail,Ze=fe.parse.econtent,et=xe.hashalg,Ye=xe.saMessageDigest;Ue.validMessageDigest=!1,Z(Ze,et)===Ye&&(Ue.validMessageDigest=!0),function(oe,fe,xe,qe){var Ze,Ue=fe.parse.certsIdx;if(void 0===fe.certs){Ze=[],fe.certkeys=[];for(var et=I(oe,Ue),Ye=0;Ye<et.length;Ye++){var Ft=T(oe,et[Ye]),vt=new Ge;vt.readCertHex(Ft),Ze[Ye]=vt,fe.certkeys[Ye]=vt.getPublicKey()}fe.certs=Ze}else Ze=fe.certs;for(fe.cccc=Ze.length,fe.cccci=et.length,Ye=0;Ye<Ze.length;Ye++){var cn=vt.getIssuerHex(),Pn=vt.getSerialNumberHex();xe.signerid_issuer1===cn&&xe.signerid_serial1===Pn&&(xe.certkey_idx=Ye)}}(oe,fe,xe),Ue.validSignatureValue=!1;var Ft=xe.sigalg,vt="31"+T(oe,xe.idxSignedAttrs).substr(2);xe.signedattrshex=vt;var cn=fe.certs[xe.certkey_idx].getPublicKey(),Pn=new d.crypto.Signature({alg:Ft});Pn.init(cn),Pn.updateHex(vt);var an=Pn.verify(xe.sigval);Ue.validSignatureValue_isValid=an,!0===an&&(Ue.validSignatureValue=!0),xe.isValid=!1,Ue.validMessageDigest&&Ue.validSignatureValue&&(xe.isValid=!0)},ee={isValid:!1,parse:{}};return function(oe,fe){if("2a864886f70d010702"!==y(oe,0,[0],"06"))return fe;fe.cmsType="signedData",fe.econtent=y(oe,0,[1,0,2,1,0]),function(oe,fe){for(var xe,qe=3;qe<6;qe++)if(void 0!==(xe=C(oe,0,[1,0,qe]))){var Ue=oe.substr(xe,2);"a0"===Ue&&(fe.certsIdx=xe),"a1"===Ue&&(fe.revinfosIdx=xe),"31"===Ue&&(fe.signerinfosIdx=xe)}}(oe,fe),fe.signerInfos=[],function(oe,fe){var xe=fe.signerinfosIdx;if(void 0!==xe){var qe=I(oe,xe);fe.signerInfoIdxList=qe;for(var Ue=0;Ue<qe.length;Ue++){var et={idx:qe[Ue]};Se(oe,et),fe.signerInfos.push(et)}}}(oe,fe)}(W,ee.parse),function(oe,fe){for(var xe=fe.parse.signerInfos,qe=xe.length,Ue=!0,Ze=0;Ze<qe;Ze++){var et=xe[Ze];re(oe,fe,et),et.isValid||(Ue=!1)}fe.isValid=Ue}(W,ee),ee},d.asn1.cms.CMSParser=function(){var r=Error,a=Ge,s=new a,c=Ne,f=c.getV,p=c.getTLV,m=c.getTLVbyList,x=c.getTLVbyListEx,A=c.getVbyList,N=c.getVbyListEx,P=c.getChildIdx;this.getCMSSignedData=function(b){var y=m(b,0,[1,0]);return this.getSignedData(y)},this.getSignedData=function(b){var y=P(b,0),F={},C=f(b,y[0]),I=parseInt(C,16);F.version=I;var T=p(b,y[1]);F.hashalgs=this.getHashAlgArray(T);var L=p(b,y[2]);F.econtent=this.getEContent(L);var Z=x(b,0,["[0]"]);null!=Z&&(F.certs=this.getCertificateSet(Z)),x(b,0,["[1]"]);var G=x(b,0,[3]);return F.sinfos=this.getSignerInfos(G),F},this.getHashAlgArray=function(b){for(var y=P(b,0),F=new a,C=[],I=0;I<y.length;I++){var T=p(b,y[I]),L=F.getAlgorithmIdentifierName(T);C.push(L)}return C},this.getEContent=function(b){var y={},F=A(b,0,[0]),C=A(b,0,[1,0]);return y.type=d.asn1.x509.OID.oid2name(Ne.hextooidstr(F)),y.content={hex:C},y},this.getSignerInfos=function(b){for(var y=[],F=P(b,0),C=0;C<F.length;C++){var I=p(b,F[C]),T=this.getSignerInfo(I);y.push(T)}return y},this.getSignerInfo=function(b){var y={},F=P(b,0),C=c.getInt(b,F[0],-1);-1!=C&&(y.version=C);var I=p(b,F[1]),T=this.getIssuerAndSerialNumber(I);y.id=T;var L=p(b,F[2]),Z=s.getAlgorithmIdentifierName(L);y.hashalg=Z;var W=x(b,0,["[0]"]);if(null!=W){var G=this.getAttributeList(W);y.sattrs=G}var me=x(b,0,[3]),Se=s.getAlgorithmIdentifierName(me);y.sigalg=Se;var O=N(b,0,[4]);y.sighex=O;var j=x(b,0,["[1]"]);if(null!=j){var $=this.getAttributeList(j);y.uattrs=$}return y},this.getSignerIdentifier=function(b){if("30"==b.substr(0,2))return this.getIssuerAndSerialNumber(b);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(b){var y={type:"isssn"},F=P(b,0),C=p(b,F[0]);y.issuer=s.getX500Name(C);var I=f(b,F[1]);return y.serial={hex:I},y},this.getAttributeList=function(b){for(var y=[],F=P(b,0),C=0;C<F.length;C++){var I=p(b,F[C]),T=this.getAttribute(I);y.push(T)}return{array:y}},this.getAttribute=function(b){var y={},F=P(b,0),C=c.getOID(b,F[0]),I=d.asn1.x509.OID.oid2name(C);y.attr=I;var T=p(b,F[1]),L=P(T,0);if(1==L.length)y.valhex=p(T,L[0]);else{for(var Z=[],W=0;W<L.length;W++)Z.push(p(T,L[W]));y.valhex=Z}return"contentType"==I?this.setContentType(y):"messageDigest"==I?this.setMessageDigest(y):"signingTime"==I?this.setSigningTime(y):"signingCertificate"==I?this.setSigningCertificate(y):"signingCertificateV2"==I?this.setSigningCertificateV2(y):"signaturePolicyIdentifier"==I&&this.setSignaturePolicyIdentifier(y),y},this.setContentType=function(b){var y=c.getOIDName(b.valhex,0,null);null!=y&&(b.type=y,delete b.valhex)},this.setSigningTime=function(b){var F=mt(f(b.valhex,0));b.str=F,delete b.valhex},this.setMessageDigest=function(b){var y=f(b.valhex,0);b.hex=y,delete b.valhex},this.setSigningCertificate=function(b){var y=P(b.valhex,0);if(y.length>0){for(var F=p(b.valhex,y[0]),C=P(F,0),I=[],T=0;T<C.length;T++){var L=p(F,C[T]),Z=this.getESSCertID(L);I.push(Z)}b.array=I}if(y.length>1){var W=p(b.valhex,y[1]);b.polhex=W}delete b.valhex},this.setSignaturePolicyIdentifier=function(b){var y=P(b.valhex,0);if(y.length>0){var F=c.getOID(b.valhex,y[0]);b.oid=F}if(y.length>1){var C=new a,I=P(b.valhex,y[1]),T=p(b.valhex,I[0]),L=C.getAlgorithmIdentifierName(T);b.alg=L;var Z=f(b.valhex,I[1]);b.hash=Z}delete b.valhex},this.setSigningCertificateV2=function(b){var y=P(b.valhex,0);if(y.length>0){for(var F=p(b.valhex,y[0]),C=P(F,0),I=[],T=0;T<C.length;T++){var L=p(F,C[T]),Z=this.getESSCertIDv2(L);I.push(Z)}b.array=I}if(y.length>1){var W=p(b.valhex,y[1]);b.polhex=W}delete b.valhex},this.getESSCertID=function(b){var y={},F=P(b,0);if(F.length>0){var C=f(b,F[0]);y.hash=C}if(F.length>1){var I=p(b,F[1]),T=this.getIssuerSerial(I);null!=T.serial&&(y.serial=T.serial),null!=T.issuer&&(y.issuer=T.issuer)}return y},this.getESSCertIDv2=function(b){var y={},F=P(b,0);if(F.length<1||3<F.length)throw new r("wrong number of elements");var C=0;if("30"==b.substr(F[0],2)){var I=p(b,F[0]);y.alg=s.getAlgorithmIdentifierName(I),C++}else y.alg="sha256";var T=f(b,F[C]);if(y.hash=T,F.length>C+1){var L=p(b,F[C+1]),Z=this.getIssuerSerial(L);y.issuer=Z.issuer,y.serial=Z.serial}return y},this.getIssuerSerial=function(b){var y={},F=P(b,0),C=p(b,F[0]),I=s.getGeneralNames(C);y.issuer=I[0].dn;var L=f(b,F[1]);return y.serial={hex:L},y},this.getCertificateSet=function(b){for(var y=P(b,0),F=[],C=0;C<y.length;C++){var I=p(b,y[C]);if("30"==I.substr(0,2)){var T=nn(I,"CERTIFICATE");F.push(T)}}return{array:F,sortflag:!1}}},(typeof d>"u"||!d)&&(d={}),(typeof d.asn1>"u"||!d.asn1)&&(d.asn1={}),(typeof d.asn1.tsp>"u"||!d.asn1.tsp)&&(d.asn1.tsp={}),d.asn1.tsp.TimeStampToken=function(r){var c=d.asn1.tsp;c.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var f=new c.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=f.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.tsp.TimeStampToken,d.asn1.cms.SignedData),d.asn1.tsp.TSTInfo=function(r){Error;var c=d.asn1,f=c.DERSequence,p=c.DERInteger,g=c.DERBoolean,m=c.DERGeneralizedTime,x=c.DERObjectIdentifier,A=c.DERTaggedObject,N=c.tsp,P=N.MessageImprint,b=N.Accuracy,F=c.x509.GeneralName;if(N.TSTInfo.superclass.constructor.call(this),this.dVersion=new p({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var C=[this.dVersion];if(null==this.dPolicy)throw new Error("policy shall be specified.");if(C.push(this.dPolicy),null==this.dMessageImprint)throw new Error("messageImprint shall be specified.");if(C.push(this.dMessageImprint),null==this.dSerial)throw new Error("serialNumber shall be specified.");if(C.push(this.dSerial),null==this.dGenTime)throw new Error("genTime shall be specified.");C.push(this.dGenTime),null!=this.dAccuracy&&C.push(this.dAccuracy),null!=this.dOrdering&&C.push(this.dOrdering),null!=this.dNonce&&C.push(this.dNonce),null!=this.dTsa&&C.push(this.dTsa);var I=new f({array:C});return this.hTLV=I.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r){if("string"==typeof r.policy){if(!r.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new x({oid:r.policy})}void 0!==r.messageImprint&&(this.dMessageImprint=new P(r.messageImprint)),void 0!==r.serial&&(this.dSerial=new p(r.serial)),void 0!==r.genTime&&(this.dGenTime=new m(r.genTime)),void 0!==r.accuracy&&(this.dAccuracy=new b(r.accuracy)),void 0!==r.ordering&&1==r.ordering&&(this.dOrdering=new g),void 0!==r.nonce&&(this.dNonce=new p(r.nonce)),void 0!==r.tsa&&(this.dTsa=new A({tag:"a0",explicit:!0,obj:new F({dn:r.tsa})}))}},Ce(d.asn1.tsp.TSTInfo,d.asn1.ASN1Object),d.asn1.tsp.Accuracy=function(r){var s=d.asn1,c=s.ASN1Util.newObject;s.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var f=this.params,p=[];return null!=f.seconds&&"number"==typeof f.seconds&&p.push({int:f.seconds}),null!=f.millis&&"number"==typeof f.millis&&p.push({tag:{tagi:"80",obj:{int:f.millis}}}),null!=f.micros&&"number"==typeof f.micros&&p.push({tag:{tagi:"81",obj:{int:f.micros}}}),c({seq:p}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.tsp.Accuracy,d.asn1.ASN1Object),d.asn1.tsp.MessageImprint=function(r){var s=d.asn1,c=s.DERSequence,f=s.DEROctetString,g=s.x509.AlgorithmIdentifier;s.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var m=this.params,x=new g({name:m.alg}),A=new f({hex:m.hash});return new c({array:[x,A]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.tsp.MessageImprint,d.asn1.ASN1Object),d.asn1.tsp.TimeStampReq=function(r){var s=d.asn1,c=s.DERSequence,f=s.DERInteger,p=s.DERBoolean,m=s.DERObjectIdentifier,x=s.tsp,A=x.MessageImprint;x.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var N=this.params,P=[];return P.push(new f({int:1})),P.push(N.messageImprint instanceof d.asn1.ASN1Object?N.messageImprint:new A(N.messageImprint)),null!=N.policy&&P.push(new m(N.policy)),null!=N.nonce&&P.push(new f(N.nonce)),1==N.certreq&&P.push(new p),new c({array:P}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.tsp.TimeStampReq,d.asn1.ASN1Object),d.asn1.tsp.TimeStampResp=function(r){var s=d.asn1,c=s.DERSequence,p=s.tsp,g=p.PKIStatusInfo;p.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var m=this.params,x=[];if(null!=m.econtent||null!=m.tst)if(x.push(new g(null!=m.statusinfo?m.statusinfo:"granted")),null!=m.econtent)x.push(new p.TimeStampToken(m).getContentInfo());else{if(!(m.tst instanceof s.ASN1Object))throw new Error("improper member tst value");x.push(m.tst)}else{if(null==m.statusinfo)throw new Error("parameter for token nor statusinfo not specified");x.push(new g(m.statusinfo))}return new c({array:x}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.tsp.TimeStampResp,d.asn1.ASN1Object),d.asn1.tsp.PKIStatusInfo=function(r){var a=Error,c=d.asn1,f=c.DERSequence,p=c.tsp,g=p.PKIStatus,m=p.PKIFreeText,x=p.PKIFailureInfo;p.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var A=this.params,N=[];if("string"==typeof A)N.push(new g(A));else{if(null==A.status)throw new a("property 'status' unspecified");N.push(new g(A.status)),null!=A.statusstr&&N.push(new m(A.statusstr)),null!=A.failinfo&&N.push(new x(A.failinfo))}return new f({array:N}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.tsp.PKIStatusInfo,d.asn1.ASN1Object),d.asn1.tsp.PKIStatus=function(r){var a=Error,c=d.asn1,f=c.DERInteger;c.tsp.PKIStatus.superclass.constructor.call(this);var g={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var A,m=this.params;if("string"==typeof m)try{A=g[m]}catch{throw new a("undefined name: "+m)}else{if("number"!=typeof m)throw new a("unsupported params");A=m}return new f({int:A}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.tsp.PKIStatus,d.asn1.ASN1Object),d.asn1.tsp.PKIFreeText=function(r){var a=Error,c=d.asn1,f=c.DERSequence,p=c.DERUTF8String;c.tsp.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var m=this.params;if(!m instanceof Array)throw new a("wrong params: not array");for(var x=[],A=0;A<m.length;A++)x.push(new p({str:m[A]}));return new f({array:x}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.tsp.PKIFreeText,d.asn1.ASN1Object),d.asn1.tsp.PKIFailureInfo=function(r){var a=Error,c=d.asn1,f=c.DERBitString,m={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};c.tsp.PKIFailureInfo.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var x=this.params,A=0;if("number"==typeof x&&0<=x&&x<=25){for(var N=(A|=1<<x).toString(2),P="",b=N.length-1;b>=0;b--)P+=N[b];return P}if("string"==typeof x&&null!=m[x])return Tr([x],m);if("object"==typeof x&&null!=x.length)return Tr(x,m);throw new a("wrong params")},this.tohex=function(){var A=this.getBinValue();return new f({bin:A}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.tsp.PKIFailureInfo,d.asn1.ASN1Object),d.asn1.tsp.AbstractTSAAdapter=function(r){this.getTSTHex=function(a,s){throw"not implemented yet"}},d.asn1.tsp.SimpleTSAAdapter=function(r){var c=d.asn1.tsp,f=d.crypto.Util.hashHex;c.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(p,g){var m=f(p,g);this.params.econtent.content.messageImprint={alg:g,hash:m},this.params.econtent.content.serial={int:this.serial++};var x=Math.floor(1e9*Math.random());return this.params.econtent.content.nonce={int:x},new c.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==r&&(this.params=r)},Ce(d.asn1.tsp.SimpleTSAAdapter,d.asn1.tsp.AbstractTSAAdapter),d.asn1.tsp.FixedTSAAdapter=function(r){var c=d.asn1.tsp,f=d.crypto.Util.hashHex;c.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(p,g){var m=f(p,g);return this.params.econtent.content.messageImprint={alg:g,hash:m},new c.TimeStampToken(this.params).getContentInfoEncodedHex()},void 0!==r&&(this.params=r)},Ce(d.asn1.tsp.FixedTSAAdapter,d.asn1.tsp.AbstractTSAAdapter),d.asn1.tsp.TSPUtil=new function(){},d.asn1.tsp.TSPUtil.newTimeStampToken=function(r){return new d.asn1.tsp.TimeStampToken(r)},d.asn1.tsp.TSPUtil.parseTimeStampReq=function(r){return(new d.asn1.tsp.TSPParser).getTimeStampReq(r)},d.asn1.tsp.TSPUtil.parseMessageImprint=function(r){return(new d.asn1.tsp.TSPParser).getMessageImprint(r)},d.asn1.tsp.TSPParser=function(){Error;var s=new Ge,c=Ne,f=c.getV,p=c.getTLV,g=c.getIdxbyList,x=c.getChildIdx,A=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],N={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(P){var b=x(P,0);if(1==b.length)return this.getPKIStatusInfo(p(P,b[0]));if(b.length>1){var y=this.getPKIStatusInfo(p(P,b[0])),F=p(P,b[1]),C=this.getToken(F);return C.statusinfo=y,C}},this.getToken=function(P){var y=(new d.asn1.cms.CMSParser).getCMSSignedData(P);return this.setTSTInfo(y),y},this.setTSTInfo=function(P){var b=P.econtent;if("tstinfo"==b.type){var F=this.getTSTInfo(b.content.hex);b.content=F}},this.getTSTInfo=function(P){var b={},y=x(P,0),F=f(P,y[1]);b.policy=vr(F);var C=p(P,y[2]);b.messageImprint=this.getMessageImprint(C);var I=f(P,y[3]);b.serial={hex:I};var T=f(P,y[4]);b.genTime={str:mt(T)};var L=0;if(y.length>5&&"30"==P.substr(y[5],2)){var Z=p(P,y[5]);b.accuracy=this.getAccuracy(Z),L++}if(y.length>5+L&&"01"==P.substr(y[5+L],2)&&("ff"==f(P,y[5+L])&&(b.ordering=!0),L++),y.length>5+L&&"02"==P.substr(y[5+L],2)){var G=f(P,y[5+L]);b.nonce={hex:G},L++}if(y.length>5+L&&"a0"==P.substr(y[5+L],2)){var me=p(P,y[5+L]);me="30"+me.substr(2),pGeneralNames=s.getGeneralNames(me);var Se=pGeneralNames[0].dn;b.tsa=Se,L++}if(y.length>5+L&&"a1"==P.substr(y[5+L],2)){var O=p(P,y[5+L]);O="30"+O.substr(2);var j=s.getExtParamArray(O);b.ext=j,L++}return b},this.getAccuracy=function(P){for(var b={},y=x(P,0),F=0;F<y.length;F++){var C=P.substr(y[F],2),I=f(P,y[F]),T=parseInt(I,16);"02"==C?b.seconds=T:"80"==C?b.millis=T:"81"==C&&(b.micros=T)}return b},this.getMessageImprint=function(P){if("30"!=P.substr(0,2))throw new Error("head of messageImprint hex shall be x30");var b={},F=(x(P,0),g(P,0,[0,0])),C=f(P,F),I=c.hextooidstr(C),T=d.asn1.x509.OID.oid2name(I);if(""==T)throw new Error("hashAlg name undefined: "+I);var L=T,Z=g(P,0,[1]);return b.alg=L,b.hash=f(P,Z),b},this.getPKIStatusInfo=function(P){var b={},y=x(P,0),F=0;try{var C=f(P,y[0]),I=parseInt(C,16);b.status=A[I]}catch{}if(y.length>1&&"30"==P.substr(y[1],2)){var T=p(P,y[1]);b.statusstr=this.getPKIFreeText(T),F++}if(y.length>F&&"03"==P.substr(y[1+F],2)){var L=p(P,y[1+F]);b.failinfo=this.getPKIFailureInfo(L)}return b},this.getPKIFreeText=function(P){for(var b=[],y=x(P,0),F=0;F<y.length;F++)b.push(c.getString(P,y[F]));return b},this.getPKIFailureInfo=function(P){var b=c.getInt(P,0);return null!=N[b]?N[b]:b},this.getTimeStampReq=function(P){var b={certreq:!1},y=x(P,0);if(y.length<2)throw new Error("TimeStampReq must have at least 2 items");var F=p(P,y[1]);b.messageImprint=d.asn1.tsp.TSPUtil.parseMessageImprint(F);for(var C=2;C<y.length;C++){var I=y[C],T=P.substr(I,2);if("06"==T){var L=f(P,I);b.policy=c.hextooidstr(L)}"02"==T&&(b.nonce=f(P,I)),"01"==T&&(b.certreq=!0)}return b}},(typeof d>"u"||!d)&&(d={}),(typeof d.asn1>"u"||!d.asn1)&&(d.asn1={}),(typeof d.asn1.cades>"u"||!d.asn1.cades)&&(d.asn1.cades={}),d.asn1.cades.SignaturePolicyIdentifier=function(r){var c=d.asn1.cades,f=c.SignaturePolicyId;c.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new f(this.params)]},this.setByParam=function(p){this.params=p},null!=r&&this.setByParam(r)},Ce(d.asn1.cades.SignaturePolicyIdentifier,d.asn1.cms.Attribute),d.asn1.cades.SignaturePolicyId=function(r){var s=d.asn1,c=s.DERSequence,f=s.DERObjectIdentifier,m=s.cades,A=m.OtherHashAlgAndValue;m.SignaturePolicyId.superclass.constructor.call(this),this.params=null,this.tohex=function(){var N=this.params,P=[];return P.push(new f(N.oid)),P.push(new A(N)),new c({array:P}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(N){this.params=N},null!=r&&this.setByParam(r)},Ce(d.asn1.cades.SignaturePolicyId,d.asn1.ASN1Object),d.asn1.cades.OtherHashAlgAndValue=function(r){var a=Error,c=d.asn1,f=c.DERSequence,p=c.DEROctetString,m=c.x509.AlgorithmIdentifier;c.cades.OtherHashAlgAndValue.superclass.constructor.call(this),this.params=null,this.tohex=function(){var N=this.params;if(null==N.alg)throw new a("property 'alg' not specified");if(null==N.hash&&null==N.cert)throw new a("property 'hash' nor 'cert' not specified");var P=null;if(null!=N.hash)P=N.hash;else if(null!=N.cert){if("string"!=typeof N.cert)throw new a("cert not string");var b=N.cert;-1!=N.cert.indexOf("-----BEGIN")&&(b=Ht(N.cert)),P=d.crypto.Util.hashHex(b,N.alg)}var y=[];return y.push(new m({name:N.alg})),y.push(new p({hex:P})),new f({array:y}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cades.OtherHashAlgAndValue,d.asn1.ASN1Object),d.asn1.cades.OtherHashValue=function(r){d.asn1.cades.OtherHashValue.superclass.constructor.call(this);var a=Error,p=d.asn1.DEROctetString;this.params=null,this.tohex=function(){var m=this.params;if(null==m.hash&&null==m.cert)throw new a("hash or cert not specified");var x=null;if(null!=m.hash)x=m.hash;else if(null!=m.cert){if("string"!=typeof m.cert)throw new a("cert not string");var A=m.cert;-1!=m.cert.indexOf("-----BEGIN")&&(A=Ht(m.cert)),x=d.crypto.Util.hashHex(A,"sha1")}return new p({hex:x}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cades.OtherHashValue,d.asn1.ASN1Object),d.asn1.cades.SignatureTimeStamp=function(r){var a=Error,c=d.lang.String.isHex,f=d.asn1,p=f.ASN1Object;f.cades.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var x=this.params;if(null!=x.tst){if(c(x.tst))return(A=new p).hTLV=x.tst,[A];if(x.tst instanceof p)return[x.tst];throw new a("params.tst has wrong value")}if(null!=x.res){var A,N=x.res;if(N instanceof p&&(N=N.tohex()),"string"!=typeof N||!c(N))throw new a("params.res has wrong value");return Ne.getTLVbyList(N,0,[1]),(A=new p).hTLV=x.tst,[A]}},null!=r&&this.setByParam(r)},Ce(d.asn1.cades.SignatureTimeStamp,d.asn1.cms.Attribute),d.asn1.cades.CompleteCertificateRefs=function(r){var a=Error,c=d.asn1,f=c.DERSequence,p=c.cades,g=p.OtherCertID,m=d.lang.String.isHex;p.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var x=this.params,A=[],N=0;N<x.array.length;N++){var P=x.array[N];if("string"==typeof P)if(-1!=P.indexOf("-----BEGIN"))P={cert:P};else{if(!m(P))throw new a("unsupported value: "+P);P={hash:P}}null!=x.alg&&null==P.alg&&(P.alg=x.alg),null!=x.hasis&&null==P.hasis&&(P.hasis=x.hasis);var b=new g(P);A.push(b)}return[new f({array:A})]},null!=r&&this.setByParam(r)},Ce(d.asn1.cades.CompleteCertificateRefs,d.asn1.cms.Attribute),d.asn1.cades.OtherCertID=function(r){var s=d.asn1,c=s.DERSequence,p=s.cms.IssuerSerial,g=s.cades,m=g.OtherHashValue,x=g.OtherHashAlgAndValue;g.OtherCertID.superclass.constructor.call(this),this.params=r,this.tohex=function(){var A=this.params;"string"==typeof A&&(-1!=A.indexOf("-----BEGIN")?A={cert:A}:_isHex(A)&&(A={hash:A}));var P,N=[];if(P=null!=A.alg?new x(A):new m(A),N.push(P),null!=A.cert&&1==A.hasis||null!=A.issuer&&null!=A.serial){var b=new p(A);N.push(b)}return new c({array:N}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cades.OtherCertID,d.asn1.ASN1Object),d.asn1.cades.OtherHash=function(r){Error;var p=d.asn1.cades,g=p.OtherHashAlgAndValue,m=p.OtherHashValue,A=d.lang.String.isHex;p.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var N=this.params;return"string"==typeof N&&(-1!=N.indexOf("-----BEGIN")?N={cert:N}:A(N)&&(N={hash:N})),(null!=N.alg?new g(N):new m(N)).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.cades.OtherHash,d.asn1.ASN1Object),d.asn1.cades.CAdESUtil=new function(){},d.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(r){return(new d.asn1.cms.CMSParser).getCMSSignedData(r)},d.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(r,a,s){var p=Ne.getTLV,g=Ne.getV,x=d.asn1,A=x.ASN1Object,N=x.cms,P=N.AttributeList,b=N.SignerInfo,y={},F=(0,Ne.getChildIdx)(r,a);if(6!=F.length)throw"not supported items for SignerInfo (!=6)";var C=F.shift();y.version=p(r,C);var I=F.shift();y.si=p(r,I);var T=F.shift();y.digalg=p(r,T);var L=F.shift();y.sattrs=p(r,L);var Z=F.shift();y.sigalg=p(r,Z);var W=F.shift();y.sig=p(r,W),y.sigval=g(r,W);var G=null;return y.obj=new b,(G=new A).hTLV=y.version,y.obj.dCMSVersion=G,(G=new A).hTLV=y.si,y.obj.dSignerIdentifier=G,(G=new A).hTLV=y.digalg,y.obj.dDigestAlgorithm=G,(G=new A).hTLV=y.sattrs,y.obj.dSignedAttrs=G,(G=new A).hTLV=y.sigalg,y.obj.dSigAlg=G,(G=new A).hTLV=y.sig,y.obj.dSig=G,y.obj.dUnsignedAttrs=new P,y},(typeof d.asn1.csr>"u"||!d.asn1.csr)&&(d.asn1.csr={}),d.asn1.csr.CertificationRequest=function(r){var s=d.asn1,c=s.DERBitString,f=s.DERSequence,p=s.csr,m=p.CertificationRequestInfo;p.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(x){this.params=x},this.sign=function(){var x=new m(this.params).tohex(),A=new d.crypto.Signature({alg:this.params.sigalg});A.init(this.params.sbjprvkey),A.updateHex(x);var N=A.sign();this.params.sighex=N},this.getPEM=function(){return nn(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var x=this.params,A=new d.asn1.csr.CertificationRequestInfo(this.params),N=new d.asn1.x509.AlgorithmIdentifier({name:x.sigalg});if(null==x.sighex&&null!=x.sbjprvkey&&this.sign(),null==x.sighex)throw new Error("sighex or sbjprvkey parameter not defined");var P=new c({hex:"00"+x.sighex});return new f({array:[A,N,P]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.csr.CertificationRequest,d.asn1.ASN1Object),d.asn1.csr.CertificationRequestInfo=function(r){var s=d.asn1,f=s.DERSequence,p=s.DERInteger,g=s.DERUTF8String,m=s.DERTaggedObject,x=s.ASN1Util.newObject,N=s.x509,P=N.X500Name,b=N.Extensions,y=N.SubjectPublicKeyInfo;s.csr.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(I){null!=I&&(this.params=I)},this.tohex=function(){var I=this.params,T=[];if(T.push(new p({int:0})),T.push(new P(I.subject)),T.push(new y(ct.getKey(I.sbjpubkey))),null!=I.attrs){var L=function C(I){for(var T=Error,L=d.asn1.x509.Extensions,Z=[],W=0;W<I.length;W++){var G=I[W],me=G.attr;if("extensionRequest"==me){var Se=new L(G.ext);Z.push({seq:[{oid:"1.2.840.113549.1.9.14"},{set:[Se]}]})}else if("unstructuredName"==me)Z.push({seq:[{oid:"1.2.840.113549.1.9.2"},{set:G.names}]});else{if("challengePassword"!=me)throw new T("unknown CSR attribute");Z.push({seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:G.password}]}]})}}return{set:Z}}(I.attrs),Z=x({tag:{tage:"a0",obj:L}});T.push(Z)}else if(null!=I.extreq){var W=new b(I.extreq);Z=x({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[W]}]}}}),T.push(Z)}else T.push(new m({tag:"a0",explicit:!1,obj:new g({str:""})}));return new f({array:T}).tohex()},this.getEncodedHex=function(){return this.tohex()},null!=r&&this.setByParam(r)},Ce(d.asn1.csr.CertificationRequestInfo,d.asn1.ASN1Object),d.asn1.csr.AttributeList=function(r){},Ce(d.asn1.csr.AttributeList,d.asn1.ASN1Object),d.asn1.csr.CSRUtil=new function(){},d.asn1.csr.CSRUtil.newCSRPEM=function(r){return new d.asn1.csr.CertificationRequest(r).getPEM()},d.asn1.csr.CSRUtil.getParam=function(r,a){var c=Ne.getV,f=Ne.getIdxbyList,p=Ne.getTLVbyList,g=Ne.getTLVbyListEx,m=Ne.getVbyListEx,A={};if(-1==r.indexOf("-----BEGIN CERTIFICATE REQUEST"))throw new Error("argument is not PEM file");var N=Ht(r,"CERTIFICATE REQUEST");a&&(A.tbs=p(N,0,[0]));try{var P=g(N,0,[0,1]);if("3000"==P)A.subject={};else{var C=new Ge;A.subject=C.getX500Name(P)}}catch{}var b=g(N,0,[0,2]),y=ct.getKey(b,null,"pkcs8pub");A.sbjpubkey=ct.getPEM(y,"PKCS8PUB");var L,Z,F=(Z=f(L=N,0,[0,3,0,0],"06"),"2a864886f70d01090e"!=c(L,Z)?null:p(L,0,[0,3,0,1,0],"30"));C=new Ge,null!=F&&(A.extreq=C.getExtParamArray(F));try{var I=g(N,0,[1],"30");C=new Ge,A.sigalg=C.getAlgorithmIdentifierName(I)}catch{}try{var T=m(N,0,[2]);A.sighex=T}catch{}return A},d.asn1.csr.CSRUtil.verifySignature=function(r){try{var a=null;if("string"==typeof r&&-1!=r.indexOf("-----BEGIN CERTIFICATE REQUEST")?a=d.asn1.csr.CSRUtil.getParam(r,!0):"object"==typeof r&&null!=r.sbjpubkey&&null!=r.sigalg&&null!=r.sighex&&null!=r.tbs&&(a=r),null==a)return!1;var s=new d.crypto.Signature({alg:a.sigalg});return s.init(a.sbjpubkey),s.updateHex(a.tbs),s.verify(a.sighex)}catch(c){return alert(c),!1}},(typeof d>"u"||!d)&&(d={}),(typeof d.asn1>"u"||!d.asn1)&&(d.asn1={}),(typeof d.asn1.ocsp>"u"||!d.asn1.ocsp)&&(d.asn1.ocsp={}),d.asn1.ocsp.DEFAULT_HASH="sha1",d.asn1.ocsp.OCSPResponse=function(r){d.asn1.ocsp.OCSPResponse.superclass.constructor.call(this);var s=d.asn1.ASN1Util.newObject,c=d.asn1.ocsp.ResponseBytes,f=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var p=this.params.resstatus;return"number"==typeof p?p:"string"!=typeof p?-1:f.indexOf(p)},this.setByParam=function(p){this.params=p},this.tohex=function(){var p=this.params,g=this._getStatusCode();if(-1==g)throw new Error("responseStatus not supported: "+p.resstatus);if(0!=g)return s({seq:[{enum:{int:g}}]}).tohex();var m=new c(p);return s({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:m}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.ocsp.OCSPResponse,d.asn1.ASN1Object),d.asn1.ocsp.ResponseBytes=function(r){d.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var a=d.asn1,s=a.DERSequence,c=a.DERObjectIdentifier,f=a.DEROctetString,p=a.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(g){this.params=g},this.tohex=function(){var g=this.params;if("ocspBasic"!=g.restype)throw new Error("not supported responseType: "+g.restype);var m=new p(g),x=[];return x.push(new c({name:"ocspBasic"})),x.push(new f({hex:m.tohex()})),new s({array:x}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.ocsp.ResponseBytes,d.asn1.ASN1Object),d.asn1.ocsp.BasicOCSPResponse=function(r){d.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var a=Error,s=d.asn1,c=s.ASN1Object,f=s.DERSequence,g=s.DERTaggedObject,m=s.DERBitString,A=s.x509.AlgorithmIdentifier,N=s.ocsp;_SingleResponseList=N.SingleResponseList,_ResponseData=N.ResponseData,this.params=null,this.setByParam=function(b){this.params=b},this.sign=function(){var b=this.params,y=b.tbsresp.tohex(),F=new d.crypto.Signature({alg:b.sigalg});F.init(b.reskey),F.updateHex(y),b.sighex=F.sign()},this.tohex=function(){var b=this.params;null==b.tbsresp&&(b.tbsresp=new _ResponseData(b)),null==b.sighex&&null!=b.reskey&&this.sign();var y=[];if(y.push(b.tbsresp),y.push(new A({name:b.sigalg})),y.push(new m({hex:"00"+b.sighex})),null!=b.certs&&null!=b.certs.length){for(var F=[],C=0;C<b.certs.length;C++){var I=b.certs[C],T=null;if(Ne.isASN1HEX(I))T=I;else{if(!I.match(/-----BEGIN/))throw new a("certs["+C+"] not hex or PEM");T=Ht(I)}F.push(new c({tlv:T}))}var L=new f({array:F});y.push(new g({tag:"a0",explicit:!0,obj:L}))}return new f({array:y}).tohex()},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.ocsp.BasicOCSPResponse,d.asn1.ASN1Object),d.asn1.ocsp.ResponseData=function(r){d.asn1.ocsp.ResponseData.superclass.constructor.call(this);var a=Error,s=d.asn1,c=s.DERSequence,f=s.DERGeneralizedTime,p=s.DERTaggedObject,g=s.x509.Extensions,m=s.ocsp,x=m.ResponderID;_SingleResponseList=m.SingleResponseList,this.params=null,this.tohex=function(){var A=this.params;null!=A.respid&&new a("respid not specified"),null!=A.prodat&&new a("prodat not specified"),null!=A.array&&new a("array not specified");var N=[];if(N.push(new x(A.respid)),N.push(new f(A.prodat)),N.push(new _SingleResponseList(A.array)),null!=A.ext){var P=new g(A.ext);N.push(new p({tag:"a1",explicit:!0,obj:P}))}return new c({array:N}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(A){this.params=A},void 0!==r&&this.setByParam(r)},Ce(d.asn1.ocsp.ResponseData,d.asn1.ASN1Object),d.asn1.ocsp.ResponderID=function(r){d.asn1.ocsp.ResponderID.superclass.constructor.call(this);var s=d.asn1,c=s.ASN1Util.newObject,f=s.x509.X500Name,p=d.lang.String.isHex,g=Error;this.params=null,this.tohex=function(){var m=this.params;if(null!=m.key){var x=null;if("string"==typeof m.key)p(m.key)&&(x=m.key),m.key.match(/-----BEGIN CERTIFICATE/)&&null!=(N=new Ge(m.key).getExtSubjectKeyIdentifier())&&(x=N.kid.hex);else if(m.key instanceof Ge){var N;null!=(N=m.key.getExtSubjectKeyIdentifier())&&(x=N.kid.hex)}if(null==x)throw new g("wrong key member value");return c({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:x}}}}).tohex()}if(null!=m.name){var b=null;if("string"==typeof m.name&&m.name.match(/-----BEGIN CERTIFICATE/)?b=new Ge(m.name).getSubject():m.name instanceof Ge?b=m.name.getSubject():"object"==typeof m.name&&(null!=m.name.array||null!=m.name.str)&&(b=m.name),null==b)throw new g("wrong name member value");return c({tag:{tag:"a1",explicit:!0,obj:new f(b)}}).tohex()}throw new g("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(m){this.params=m},void 0!==r&&this.setByParam(r)},Ce(d.asn1.ocsp.ResponderID,d.asn1.ASN1Object),d.asn1.ocsp.SingleResponseList=function(r){d.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var a=d.asn1,s=a.DERSequence,c=a.ocsp.SingleResponse;this.params=null,this.tohex=function(){var f=this.params;if("object"!=typeof f||null==f.length)throw new Error("params not specified properly");for(var p=[],g=0;g<f.length;g++)p.push(new c(f[g]));return new s({array:p}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(f){this.params=f},void 0!==r&&this.setByParam(r)},Ce(d.asn1.ocsp.SingleResponseList,d.asn1.ASN1Object),d.asn1.ocsp.SingleResponse=function(r){var a=Error,c=d.asn1,f=c.DERSequence,p=c.DERGeneralizedTime,g=c.DERTaggedObject,m=c.ocsp,x=m.CertID,A=m.CertStatus,P=c.x509.Extensions;m.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var b=this.params,y=[];if(null==b.certid)throw new a("certid unspecified");if(null==b.status)throw new a("status unspecified");if(null==b.thisupdate)throw new a("thisupdate unspecified");if(y.push(new x(b.certid)),y.push(new A(b.status)),y.push(new p(b.thisupdate)),null!=b.nextupdate){var F=new p(b.nextupdate);y.push(new g({tag:"a0",explicit:!0,obj:F}))}if(null!=b.ext){var C=new P(b.ext);y.push(new g({tag:"a1",explicit:!0,obj:C}))}return new f({array:y}).tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(b){this.params=b},void 0!==r&&this.setByParam(r)},Ce(d.asn1.ocsp.SingleResponse,d.asn1.ASN1Object),d.asn1.ocsp.CertID=function(r){var s=d.asn1,c=s.DEROctetString,f=s.DERInteger,p=s.DERSequence,m=s.x509.AlgorithmIdentifier,P=d.crypto.Util.hashHex,b=Ge,F=Ne.getVbyList;s.ocsp.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(C,I,T,L){null==L&&(L=this.DEFAULT_HASH),this.params={alg:L,issname:C,isskey:I,sbjsn:T}},this.setByCert=function(C,I,T){null==T&&(T=this.DEFAULT_HASH),this.params={alg:T,issuerCert:C,subjectCert:I}},this.getParamByCerts=function(C,I,T){null==T&&(T=this.DEFAULT_HASH);var L=new b(C),Z=new b(I),W=P(L.getSubjectHex(),T),G=L.getPublicKeyHex();return{alg:T,issname:W,isskey:P(F(G,0,[1],"03",!0),T),sbjsn:Z.getSerialNumberHex()}},this.tohex=function(){if("object"!=typeof this.params)throw new Error("params not set");var I,T,L,Z,C=this.params;if(Z=null==C.alg?this.DEFAULT_HASH:C.alg,null!=C.issuerCert&&null!=C.subjectCert){var W=this.getParamByCerts(C.issuerCert,C.subjectCert,Z);I=W.issname,T=W.isskey,L=W.sbjsn}else{if(null==C.issname||null==C.isskey||null==C.sbjsn)throw new Error("required param members not defined");I=C.issname,T=C.isskey,L=C.sbjsn}var G=new m({name:Z}),me=new c({hex:I}),Se=new c({hex:T}),O=new f({hex:L}),j=new p({array:[G,me,Se,O]});return this.hTLV=j.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&this.setByParam(r)},Ce(d.asn1.ocsp.CertID,d.asn1.ASN1Object),d.asn1.ocsp.CertStatus=function(r){d.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var a=this.params;if("good"==a.status)return"8000";if("unknown"==a.status)return"8200";if("revoked"==a.status){var s=[{gentime:{str:a.time}}];return null!=a.reason&&s.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:a.reason}}}}),d.asn1.ASN1Util.newObject({tag:{tag:"a1",explicit:!1,obj:{seq:s}}}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(a){this.params=a},void 0!==r&&this.setByParam(r)},Ce(d.asn1.ocsp.CertStatus,d.asn1.ASN1Object),d.asn1.ocsp.Request=function(r){var s=d.asn1,c=s.DERSequence,f=s.ocsp;if(f.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var g=[];if(null===this.dReqCert)throw"reqCert not set";g.push(this.dReqCert);var m=new c({array:g});return this.hTLV=m.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},typeof r<"u"){var p=new f.CertID(r);this.dReqCert=p}},Ce(d.asn1.ocsp.Request,d.asn1.ASN1Object),d.asn1.ocsp.TBSRequest=function(r){var s=d.asn1,c=s.DERSequence,f=s.ocsp;f.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(p){for(var g=[],m=0;m<p.length;m++){var x=new f.Request(p[0]);g.push(x)}this.dRequestList=g},this.tohex=function(){var p=[];if(0!==this.version)throw"not supported version: "+this.version;if(null!==this.dRequestorName)throw"requestorName not supported";var g=new c({array:this.dRequestList});if(p.push(g),null!==this.dRequestExt)throw"requestExtensions not supported";var m=new c({array:p});return this.hTLV=m.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&void 0!==r.reqList&&this.setRequestListByParam(r.reqList)},Ce(d.asn1.ocsp.TBSRequest,d.asn1.ASN1Object),d.asn1.ocsp.OCSPRequest=function(r){var s=d.asn1,c=s.DERSequence,f=s.ocsp;if(f.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var g=[];if(null===this.dTbsRequest)throw"tbsRequest not set";if(g.push(this.dTbsRequest),null!==this.dOptionalSignature)throw"optionalSignature not supported";var m=new c({array:g});return this.hTLV=m.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},void 0!==r&&void 0!==r.reqList){var p=new f.TBSRequest(r);this.dTbsRequest=p}},Ce(d.asn1.ocsp.OCSPRequest,d.asn1.ASN1Object),d.asn1.ocsp.OCSPUtil={},d.asn1.ocsp.OCSPUtil.getRequestHex=function(r,a,s){var p=d.asn1.ocsp;return void 0===s&&(s=p.DEFAULT_HASH),new p.OCSPRequest({reqList:[{alg:s,issuerCert:r,subjectCert:a}]}).tohex()},d.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(r){var s=Ne.getVbyList,c=Ne.getVbyListEx,f=Ne.getIdxbyList,g=Ne.getV,m={};try{var x=c(r,0,[0],"0a");m.responseStatus=parseInt(x,16)}catch{}if(0!==m.responseStatus)return m;try{var A=f(r,0,[1,0,1,0,0,2,0,1]);"80"===r.substr(A,2)?m.certStatus="good":"a1"===r.substr(A,2)?(m.certStatus="revoked",m.revocationTime=mt(s(r,A,[0]))):"82"===r.substr(A,2)&&(m.certStatus="unknown")}catch{}try{var N=f(r,0,[1,0,1,0,0,2,0,2]);m.thisUpdate=mt(g(r,N))}catch{}try{var P=f(r,0,[1,0,1,0,0,2,0,3]);"a0"===r.substr(P,2)&&(m.nextUpdate=mt(s(r,P,[0])))}catch{}return m},d.asn1.ocsp.OCSPParser=function(){var r=Error,a=Ge,s=new a,f=Ne.getV,p=Ne.getTLV,g=Ne.getIdxbyList,m=Ne.getVbyList,x=Ne.getTLVbyList,A=Ne.getVbyListEx,N=Ne.getTLVbyListEx,P=Ne.getChildIdx;this.getOCSPRequest=function(b){var y=P(b,0);if(1!=y.length&&2!=y.length)throw new r("wrong number elements: "+y.length);return this.getTBSRequest(p(b,y[0]))},this.getTBSRequest=function(b){var y={},F=N(b,0,[0],"30");y.array=this.getRequestList(F);var C=N(b,0,["[2]",0],"30");return null!=C&&(y.ext=s.getExtParamArray(C)),y},this.getRequestList=function(b){for(var y=[],F=P(b,0),C=0;C<F.length;C++)b=p(b,F[C]),y.push(this.getRequest(b));return y},this.getRequest=function(b){var y=P(b,0);if(1!=y.length&&2!=y.length)throw new r("wrong number elements: "+y.length);var F=this.getCertID(p(b,y[0]));if(2==y.length){var C=g(b,0,[1,0]);F.ext=s.getExtParamArray(p(b,C))}return F},this.getCertID=function(b){var y=P(b,0);if(4!=y.length)throw new r("wrong number elements: "+y.length);var F=new a,C={};return C.alg=F.getAlgorithmIdentifierName(p(b,y[0])),C.issname=f(b,y[1]),C.isskey=f(b,y[2]),C.sbjsn=f(b,y[3]),C},this.getOCSPResponse=function(b){var F,y=P(b,0),C=f(b,y[0]),I=parseInt(C);if(1==y.length)return{resstatus:I};var T=x(b,0,[1,0]);return(F=this.getResponseBytes(T)).resstatus=I,F},this.getResponseBytes=function(b){var F,y=P(b,0),C=x(b,0,[1,0]);F=this.getBasicOCSPResponse(C);var I=f(b,y[0]);return F.restype=d.asn1.x509.OID.oid2name(vr(I)),F},this.getBasicOCSPResponse=function(b){var F,y=P(b,0);F=this.getResponseData(p(b,y[0]));var C=new Ge;F.alg=C.getAlgorithmIdentifierName(p(b,y[1]));var I=f(b,y[2]);F.sighex=I.substr(2);var T=A(b,0,["[0]"]);if(null!=T){for(var L=P(T,0),Z=[],W=0;W<L.length;W++){var G=p(T,L[W]);Z.push(G)}F.certs=Z}return F},this.getResponseData=function(b){var y=P(b,0),F=y.length,C={},I=0;"a0"==b.substr(y[0],2)&&I++,C.respid=this.getResponderID(p(b,y[I++]));var T=f(b,y[I++]);if(C.prodat=mt(T),C.array=this.getSingleResponseList(p(b,y[I++])),"a1"==b.substr(y[F-1],2)){var L=x(b,y[F-1],[0]),Z=new Ge;C.ext=Z.getExtParamArray(L)}return C},this.getResponderID=function(b){var y={};if("a2"==b.substr(0,2)){var F=m(b,0,[0]);y.key=F}if("a1"==b.substr(0,2)){var C=x(b,0,[0]),I=new Ge;y.name=I.getX500Name(C)}return y},this.getSingleResponseList=function(b){for(var y=P(b,0),F=[],C=0;C<y.length;C++){var I=this.getSingleResponse(p(b,y[C]));F.push(I)}return F},this.getSingleResponse=function(b){var y=P(b,0),F={},C=this.getCertID(p(b,y[0]));F.certid=C;var I=this.getCertStatus(p(b,y[1]));if(F.status=I,"18"==b.substr(y[2],2)){var T=f(b,y[2]);F.thisupdate=mt(T)}for(var L=3;L<y.length;L++){if("a0"==b.substr(y[L],2)){var Z=m(b,y[L],[0],"18");F.nextupdate=mt(Z)}if("a1"==b.substr(y[L],2)){var W=new Ge,G=x(b,0,[L,0]);F.ext=W.getExtParamArray(G)}}return F},this.getCertStatus=function(b){var y={};if("8000"==b)return{status:"good"};if("8200"==b)return{status:"unknown"};if("a1"==b.substr(0,2)){y.status="revoked";var C=mt(m(b,0,[0]));y.time=C}return y}},(typeof d>"u"||!d)&&(d={}),(typeof d.lang>"u"||!d.lang)&&(d.lang={}),d.lang.String=function(){},"function"==typeof Buffer?(mr=function(r){return ir(Buffer.from(r,"utf8").toString("base64"))},Bn=function(r){return Buffer.from(qr(r),"base64").toString("utf8")}):(mr=function(r){return Lt(ci(di(r)))},Bn=function(r){return decodeURIComponent(li(_t(r)))}),d.lang.String.isInteger=function(r){return!!r.match(/^[0-9]+$/)||!!r.match(/^-[0-9]+$/)},d.lang.String.isHex=function(r){return yn(r)},d.lang.String.isBase64=function(r){return!(!(r=r.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||r.length%4!=0)},d.lang.String.isBase64URL=function(r){return!r.match(/[+/=]/)&&(r=qr(r),d.lang.String.isBase64(r))},d.lang.String.isIntegerArray=function(r){return!!(r=r.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)},d.lang.String.isPrintable=function(r){return null!==r.match(/^[0-9A-Za-z '()+,-./:=?]*$/)},d.lang.String.isIA5=function(r){return null!==r.match(/^[\x20-\x21\x23-\x7f]*$/)},d.lang.String.isMail=function(r){return null!==r.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)};var Kr=function(r,a,s){return null==s&&(s="0"),r.length>=a?r:new Array(a-r.length+1).join(s)+r};function Tr(r,a){for(var s=0,c=0;c<r.length;c++)s|=1<<a[r[c]];var f=s.toString(2),p="";for(c=f.length-1;c>=0;c--)p+=f[c];return p}function Gr(r,c,s){if("object"==typeof r){c=String(c).split(".");for(var f=0;f<c.length&&r;f++){var p=c[f];p.match(/^[0-9]+$/)&&(p=parseInt(p)),r=r[p]}return r||!1===r?r:s}}function Ce(r,a){var s=function(){};s.prototype=a.prototype,r.prototype=new s,r.prototype.constructor=r,r.superclass=a.prototype,a.prototype.constructor==Object.prototype.constructor&&(a.prototype.constructor=a)}(typeof d>"u"||!d)&&(d={}),(typeof d.crypto>"u"||!d.crypto)&&(d.crypto={}),d.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:E.algo.MD5,sha1:E.algo.SHA1,sha224:E.algo.SHA224,sha256:E.algo.SHA256,sha384:E.algo.SHA384,sha512:E.algo.SHA512,ripemd160:E.algo.RIPEMD160},this.getDigestInfoHex=function(r,a){if(typeof this.DIGESTINFOHEAD[a]>"u")throw"alg not supported in Util.DIGESTINFOHEAD: "+a;return this.DIGESTINFOHEAD[a]+r},this.getPaddedDigestInfoHex=function(r,a,s){var c=this.getDigestInfoHex(r,a),f=s/4;if(c.length+22>f)throw"key is too short for SigAlg: keylen="+s+","+a;for(var p="0001",g="00"+c,m="",x=f-p.length-g.length,A=0;A<x;A+=2)m+="ff";return p+m+g},this.hashString=function(r,a){return new d.crypto.MessageDigest({alg:a}).digestString(r)},this.hashHex=function(r,a){return new d.crypto.MessageDigest({alg:a}).digestHex(r)},this.sha1=function(r){return this.hashString(r,"sha1")},this.sha256=function(r){return this.hashString(r,"sha256")},this.sha256Hex=function(r){return this.hashHex(r,"sha256")},this.sha512=function(r){return this.hashString(r,"sha512")},this.sha512Hex=function(r){return this.hashHex(r,"sha512")},this.isKey=function(r){return r instanceof Ve||r instanceof d.crypto.DSA||r instanceof d.crypto.ECDSA}},d.crypto.Util.md5=function(r){return new d.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(r)},d.crypto.Util.ripemd160=function(r){return new d.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(r)},d.crypto.Util.SECURERANDOMGEN=new $n,d.crypto.Util.getRandomHexOfNbytes=function(r){var a=new Array(r);return d.crypto.Util.SECURERANDOMGEN.nextBytes(a),Hr(a)},d.crypto.Util.getRandomBigIntegerOfNbytes=function(r){return new V(d.crypto.Util.getRandomHexOfNbytes(r),16)},d.crypto.Util.getRandomHexOfNbits=function(r){var a=r%8,c=new Array((r-a)/8+1);return d.crypto.Util.SECURERANDOMGEN.nextBytes(c),c[0]=(255<<a&255^255)&c[0],Hr(c)},d.crypto.Util.getRandomBigIntegerOfNbits=function(r){return new V(d.crypto.Util.getRandomHexOfNbits(r),16)},d.crypto.Util.getRandomBigIntegerZeroToMax=function(r){for(var a=r.bitLength();;){var s=d.crypto.Util.getRandomBigIntegerOfNbits(a);if(-1!=r.compareTo(s))return s}},d.crypto.Util.getRandomBigIntegerMinToMax=function(r,a){var s=r.compareTo(a);if(1==s)throw"biMin is greater than biMax";if(0==s)return r;var c=a.subtract(r);return d.crypto.Util.getRandomBigIntegerZeroToMax(c).add(r)},d.crypto.MessageDigest=function(r){this.setAlgAndProvider=function(f,p){if(null!==(f=d.crypto.MessageDigest.getCanonicalAlgName(f))&&void 0===p&&(p=d.crypto.Util.DEFAULTPROVIDER[f]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(f)&&"cryptojs"==p){try{this.md=d.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[f].create()}catch(g){throw"setAlgAndProvider hash alg set fail alg="+f+"/"+g}this.updateString=function(g){this.md.update(g)},this.updateHex=function(g){var m=E.enc.Hex.parse(g);this.md.update(m)},this.digest=function(){return this.md.finalize().toString(E.enc.Hex)},this.digestString=function(g){return this.updateString(g),this.digest()},this.digestHex=function(g){return this.updateHex(g),this.digest()}}if(-1!=":sha256:".indexOf(f)&&"sjcl"==p){try{this.md=new sjcl.hash.sha256}catch(g){throw"setAlgAndProvider hash alg set fail alg="+f+"/"+g}this.updateString=function(g){this.md.update(g)},this.updateHex=function(g){var m=sjcl.codec.hex.toBits(g);this.md.update(m)},this.digest=function(){var g=this.md.finalize();return sjcl.codec.hex.fromBits(g)},this.digestString=function(g){return this.updateString(g),this.digest()},this.digestHex=function(g){return this.updateHex(g),this.digest()}}},this.updateString=function(f){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(f){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(f){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(f){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==r&&void 0!==r.alg&&(this.algName=r.alg,void 0===r.prov&&(this.provName=d.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},d.crypto.MessageDigest.getCanonicalAlgName=function(r){return"string"==typeof r&&(r=(r=r.toLowerCase()).replace(/-/,"")),r},d.crypto.MessageDigest.getHashLength=function(r){var a=d.crypto.MessageDigest,s=a.getCanonicalAlgName(r);if(void 0===a.HASHLENGTH[s])throw"not supported algorithm: "+r;return a.HASHLENGTH[s]},d.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},d.crypto.Mac=function(r){this.setAlgAndProvider=function(g,m){if(null==(g=g.toLowerCase())&&(g="hmacsha1"),"hmac"!=(g=g.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+g;void 0===m&&(m=d.crypto.Util.DEFAULTPROVIDER[g]),this.algProv=g+"/"+m;var x=g.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(x)&&"cryptojs"==m){try{this.mac=E.algo.HMAC.create(d.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[x],this.pass)}catch(N){throw"setAlgAndProvider hash alg set fail hashAlg="+x+"/"+N}this.updateString=function(N){this.mac.update(N)},this.updateHex=function(N){var P=E.enc.Hex.parse(N);this.mac.update(P)},this.doFinal=function(){return this.mac.finalize().toString(E.enc.Hex)},this.doFinalString=function(N){return this.updateString(N),this.doFinal()},this.doFinalHex=function(N){return this.updateHex(N),this.doFinal()}}},this.updateString=function(g){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(g){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(g){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(g){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(g){if("string"==typeof g){var m=g;return(g.length%2==1||!g.match(/^[0-9A-Fa-f]+$/))&&(m=Rn(g)),void(this.pass=E.enc.Hex.parse(m))}if("object"!=typeof g)throw"KJUR.crypto.Mac unsupported password type: "+g;if(m=null,void 0!==g.hex){if(g.hex.length%2!=0||!g.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+g.hex;m=g.hex}if(void 0!==g.utf8&&(m=zr(g.utf8)),void 0!==g.rstr&&(m=Rn(g.rstr)),void 0!==g.b64&&(m=K(g.b64)),void 0!==g.b64u&&(m=_t(g.b64u)),null==m)throw"KJUR.crypto.Mac unsupported password type: "+g;this.pass=E.enc.Hex.parse(m)},void 0!==r&&(void 0!==r.pass&&this.setPassword(r.pass),void 0!==r.alg&&(this.algName=r.alg,void 0===r.prov&&(this.provName=d.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},d.crypto.Signature=function(r){var a=null;if(this._setAlgNames=function(){var T=this.algName.match(/^(.+)with(.+)$/);T&&(this.mdAlgName=T[1].toLowerCase(),this.pubkeyAlgName=T[2].toLowerCase(),"rsaandmgf1"==this.pubkeyAlgName&&"sha"==this.mdAlgName&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(T,L){for(var Z="",W=L/4-T.length,G=0;G<W;G++)Z+="0";return Z+T},this.setAlgAndProvider=function(T,L){if(this._setAlgNames(),"cryptojs/jsrsa"!=L)throw new Error("provider not supported: "+L);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new d.crypto.MessageDigest({alg:this.mdAlgName})}catch(Z){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+Z)}this.init=function(Z,W){var G=null;try{G=void 0===W?ct.getKey(Z):ct.getKey(Z,W)}catch(me){throw"init failed:"+me}if(!0===G.isPrivate)this.prvKey=G,this.state="SIGN";else{if(!0!==G.isPublic)throw"init failed.:"+G;this.pubKey=G,this.state="VERIFY"}},this.updateString=function(Z){this.md.updateString(Z)},this.updateHex=function(Z){this.md.updateHex(Z)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0===this.prvKey&&void 0!==this.ecprvhex&&void 0!==this.eccurvename&&void 0!==d.crypto.ECDSA&&(this.prvKey=new d.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof Ve&&"rsaandmgf1"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Ve&&"rsa"===this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof d.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof d.crypto.DSA))throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(Z){return this.updateString(Z),this.sign()},this.signHex=function(Z){return this.updateHex(Z),this.sign()},this.verify=function(Z){if(this.sHashHex=this.md.digest(),void 0===this.pubKey&&void 0!==this.ecpubhex&&void 0!==this.eccurvename&&void 0!==d.crypto.ECDSA&&(this.pubKey=new d.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof Ve&&"rsaandmgf1"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,Z,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Ve&&"rsa"===this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,Z);if(void 0!==d.crypto.ECDSA&&this.pubKey instanceof d.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,Z);if(void 0!==d.crypto.DSA&&this.pubKey instanceof d.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,Z);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(T,L){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(T){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(T){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(T){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(T){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(T){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=r,void 0!==r&&(void 0!==r.alg&&(this.algName=r.alg,this.provName=void 0===r.prov?d.crypto.Util.DEFAULTPROVIDER[this.algName]:r.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==r.psssaltlen&&(this.pssSaltLen=r.psssaltlen),void 0!==r.prvkeypem)){if(void 0!==r.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{a=ct.getKey(r.prvkeypem),this.init(a)}catch(T){throw"fatal error to load pem private key: "+T}}},d.crypto.Cipher=function(r){},d.crypto.Cipher.encrypt=function(r,a,s){if(a instanceof Ve&&a.isPublic){var c=d.crypto.Cipher.getAlgByKeyAndName(a,s);if("RSA"===c)return a.encrypt(r);if("RSAOAEP"===c)return a.encryptOAEP(r,"sha1");var f=c.match(/^RSAOAEP(\d+)$/);if(null!==f)return a.encryptOAEP(r,"sha"+f[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+s}throw"Cipher.encrypt: unsupported key or algorithm"},d.crypto.Cipher.decrypt=function(r,a,s){if(a instanceof Ve&&a.isPrivate){var c=d.crypto.Cipher.getAlgByKeyAndName(a,s);if("RSA"===c)return a.decrypt(r);if("RSAOAEP"===c)return a.decryptOAEP(r,"sha1");var f=c.match(/^RSAOAEP(\d+)$/);if(null!==f)return a.decryptOAEP(r,"sha"+f[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+s}throw"Cipher.decrypt: unsupported key or algorithm"},d.crypto.Cipher.getAlgByKeyAndName=function(r,a){if(r instanceof Ve){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(a))return a;if(null==a)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+a}throw"getAlgByKeyAndName: not supported algorithm name: "+a},d.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},(typeof d>"u"||!d)&&(d={}),(typeof d.crypto>"u"||!d.crypto)&&(d.crypto={}),d.crypto.ECDSA=function(r){var p=Error,g=V,m=ft,x=d.crypto.ECDSA,A=d.crypto.ECParameterDB,N=x.getName,b=Ne.getVbyListEx,y=Ne.isASN1HEX,F=new $n;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(T){return new g(T.bitLength(),F).mod(T.subtract(g.ONE)).add(g.ONE)},this.setNamedCurve=function(T){this.ecparams=A.getByName(T),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=T},this.setPrivateKeyHex=function(T){this.isPrivate=!0,this.prvKeyHex=T},this.setPublicKeyHex=function(T){this.isPublic=!0,this.pubKeyHex=T},this.getPublicKeyXYHex=function(){var T=this.pubKeyHex;if("04"!==T.substr(0,2))throw"this method supports uncompressed format(04) only";var L=this.ecparams.keycharlen;if(T.length!==2+2*L)throw"malformed public key hex length";var Z={};return Z.x=T.substr(2,L),Z.y=T.substr(2+L),Z},this.getShortNISTPCurveName=function(){var T=this.curveName;return"secp256r1"===T||"NIST P-256"===T||"P-256"===T||"prime256v1"===T?"P-256":"secp384r1"===T||"NIST P-384"===T||"P-384"===T?"P-384":"secp521r1"===T||"NIST P-521"===T||"P-521"===T?"P-521":null},this.generateKeyPairHex=function(){var L=this.getBigRandom(this.ecparams.n),Z=this.ecparams.keycharlen,W=("0000000000"+L.toString(16)).slice(-Z);return this.setPrivateKeyHex(W),{ecprvhex:W,ecpubhex:this.generatePublicKeyHex()}},this.generatePublicKeyHex=function(){var T=new g(this.prvKeyHex,16),L=this.ecparams.G.multiply(T),Z=L.getX().toBigInteger(),W=L.getY().toBigInteger(),G=this.ecparams.keycharlen,O="04"+("0000000000"+Z.toString(16)).slice(-G)+("0000000000"+W.toString(16)).slice(-G);return this.setPublicKeyHex(O),O},this.signWithMessageHash=function(T){return this.signHex(T,this.prvKeyHex)},this.signHex=function(T,L){var Z=new g(L,16),W=this.ecparams.n,G=new g(T.substring(0,this.ecparams.keycharlen),16);do{var me=this.getBigRandom(W),j=this.ecparams.G.multiply(me).getX().toBigInteger().mod(W)}while(j.compareTo(g.ZERO)<=0);var $=me.modInverse(W).multiply(G.add(Z.multiply(j))).mod(W);return x.biRSSigToASN1Sig(j,$)},this.sign=function(T,L){var Z=L,W=this.ecparams.n,G=g.fromByteArrayUnsigned(T);do{var me=this.getBigRandom(W),j=this.ecparams.G.multiply(me).getX().toBigInteger().mod(W)}while(j.compareTo(V.ZERO)<=0);var $=me.modInverse(W).multiply(G.add(Z.multiply(j))).mod(W);return this.serializeSig(j,$)},this.verifyWithMessageHash=function(T,L){return this.verifyHex(T,L,this.pubKeyHex)},this.verifyHex=function(T,L,Z){try{var W,G,me=x.parseSigHex(L);W=me.r,G=me.s;var Se=m.decodeFromHex(this.ecparams.curve,Z),O=new g(T.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(O,W,G,Se)}catch{return!1}},this.verify=function(T,L,Z){var W,G,Se;if(Bitcoin.Util.isArray(L)){var me=this.parseSig(L);W=me.r,G=me.s}else{if("object"!=typeof L||!L.r||!L.s)throw"Invalid value for signature";W=L.r,G=L.s}if(Z instanceof ft)Se=Z;else{if(!Bitcoin.Util.isArray(Z))throw"Invalid format for pubkey value, must be byte array or ECPointFp";Se=m.decodeFrom(this.ecparams.curve,Z)}var O=g.fromByteArrayUnsigned(T);return this.verifyRaw(O,W,G,Se)},this.verifyRaw=function(T,L,Z,W){var G=this.ecparams.n,me=this.ecparams.G;if(L.compareTo(g.ONE)<0||L.compareTo(G)>=0||Z.compareTo(g.ONE)<0||Z.compareTo(G)>=0)return!1;var Se=Z.modInverse(G),O=T.multiply(Se).mod(G),j=L.multiply(Se).mod(G);return me.multiply(O).add(W.multiply(j)).getX().toBigInteger().mod(G).equals(L)},this.serializeSig=function(T,L){var Z=T.toByteArraySigned(),W=L.toByteArraySigned(),G=[];return G.push(2),G.push(Z.length),(G=G.concat(Z)).push(2),G.push(W.length),(G=G.concat(W)).unshift(G.length),G.unshift(48),G},this.parseSig=function(T){var L;if(48!=T[0])throw new Error("Signature not a valid DERSequence");if(2!=T[L=2])throw new Error("First element in signature must be a DERInteger");var Z=T.slice(L+2,L+2+T[L+1]);if(2!=T[L+=2+T[L+1]])throw new Error("Second element in signature must be a DERInteger");var W=T.slice(L+2,L+2+T[L+1]);return L+=2+T[L+1],{r:g.fromByteArrayUnsigned(Z),s:g.fromByteArrayUnsigned(W)}},this.parseSigCompact=function(T){if(65!==T.length)throw"Signature has the wrong length";var L=T[0]-27;if(L<0||L>7)throw"Invalid signature type";var Z=this.ecparams.n;return{r:g.fromByteArrayUnsigned(T.slice(1,33)).mod(Z),s:g.fromByteArrayUnsigned(T.slice(33,65)).mod(Z),i:L}},this.readPKCS5PrvKeyHex=function(T){if(!1===y(T))throw new Error("not ASN.1 hex string");var L,Z,W;try{L=b(T,0,["[0]",0],"06"),Z=b(T,0,[1],"04");try{W=b(T,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=N(L),void 0===this.curveName)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(W),this.setPrivateKeyHex(Z),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(T){if(!1===y(T))throw new p("not ASN.1 hex string");var Z,W,G;try{b(T,0,[1,0],"06"),Z=b(T,0,[1,1],"06"),W=b(T,0,[2,0,1],"04");try{G=b(T,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new p("malformed PKCS#8 plain ECC private key")}if(this.curveName=N(Z),void 0===this.curveName)throw new p("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(G),this.setPrivateKeyHex(W),this.isPublic=!1},this.readPKCS8PubKeyHex=function(T){if(!1===y(T))throw new p("not ASN.1 hex string");var Z,W;try{b(T,0,[0,0],"06"),Z=b(T,0,[0,1],"06"),W=b(T,0,[1],"03")}catch{throw new p("malformed PKCS#8 ECC public key")}if(this.curveName=N(Z),null===this.curveName)throw new p("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(W)},this.readCertPubKeyHex=function(T,L){if(!1===y(T))throw new p("not ASN.1 hex string");var Z,W;try{Z=b(T,0,[0,5,0,1],"06"),W=b(T,0,[0,5,1],"03")}catch{throw new p("malformed X.509 certificate ECC public key")}if(this.curveName=N(Z),null===this.curveName)throw new p("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(W)},void 0!==r&&void 0!==r.curve&&(this.curveName=r.curve),void 0===this.curveName&&(this.curveName="secp256r1"),this.setNamedCurve(this.curveName),void 0!==r&&(void 0!==r.prv&&this.setPrivateKeyHex(r.prv),void 0!==r.pub&&this.setPublicKeyHex(r.pub))},d.crypto.ECDSA.parseSigHex=function(r){var a=d.crypto.ECDSA.parseSigHexInHexRS(r);return{r:new V(a.r,16),s:new V(a.s,16)}},d.crypto.ECDSA.parseSigHexInHexRS=function(r){var s=Ne.getChildIdx,c=Ne.getV;if(Ne.checkStrictDER(r,0),"30"!=r.substr(0,2))throw new Error("signature is not a ASN.1 sequence");var f=s(r,0);if(2!=f.length)throw new Error("signature shall have two elements");var p=f[0],g=f[1];if("02"!=r.substr(p,2))throw new Error("1st item not ASN.1 integer");if("02"!=r.substr(g,2))throw new Error("2nd item not ASN.1 integer");return{r:c(r,p),s:c(r,g)}},d.crypto.ECDSA.asn1SigToConcatSig=function(r){var a=d.crypto.ECDSA.parseSigHexInHexRS(r),s=a.r,c=a.s;if(s.length>=130&&s.length<=134){if(s.length%2!=0)throw Error("unknown ECDSA sig r length error");if(c.length%2!=0)throw Error("unknown ECDSA sig s length error");"00"==s.substr(0,2)&&(s=s.substr(2)),"00"==c.substr(0,2)&&(c=c.substr(2));var f=Math.max(s.length,c.length);return(s=("000000"+s).slice(-f))+("000000"+c).slice(-f)}if("00"==s.substr(0,2)&&s.length%32==2&&(s=s.substr(2)),"00"==c.substr(0,2)&&c.length%32==2&&(c=c.substr(2)),s.length%32==30&&(s="00"+s),c.length%32==30&&(c="00"+c),s.length%32!=0)throw Error("unknown ECDSA sig r length error");if(c.length%32!=0)throw Error("unknown ECDSA sig s length error");return s+c},d.crypto.ECDSA.concatSigToASN1Sig=function(r){if(r.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var a=r.substr(0,r.length/2),s=r.substr(r.length/2);return d.crypto.ECDSA.hexRSSigToASN1Sig(a,s)},d.crypto.ECDSA.hexRSSigToASN1Sig=function(r,a){var s=new V(r,16),c=new V(a,16);return d.crypto.ECDSA.biRSSigToASN1Sig(s,c)},d.crypto.ECDSA.biRSSigToASN1Sig=function(r,a){var s=d.asn1,c=new s.DERInteger({bigint:r}),f=new s.DERInteger({bigint:a});return new s.DERSequence({array:[c,f]}).tohex()},d.crypto.ECDSA.getName=function(r){return"2b8104001f"===r?"secp192k1":"2a8648ce3d030107"===r?"secp256r1":"2b8104000a"===r?"secp256k1":"2b81040021"===r?"secp224r1":"2b81040022"===r?"secp384r1":"2b81040023"===r?"secp521r1":-1!=="|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(r)?"secp256r1":-1!=="|secp256k1|".indexOf(r)?"secp256k1":-1!=="|secp224r1|NIST P-224|P-224|".indexOf(r)?"secp224r1":-1!=="|secp384r1|NIST P-384|P-384|".indexOf(r)?"secp384r1":-1!=="|secp521r1|NIST P-521|P-521|".indexOf(r)?"secp521r1":null},(typeof d>"u"||!d)&&(d={}),(typeof d.crypto>"u"||!d.crypto)&&(d.crypto={}),d.crypto.ECParameterDB=new function(){var r={},a={};function s(c){return new V(c,16)}this.getByName=function(c){var f=c;if(typeof a[f]<"u"&&(f=a[c]),typeof r[f]<"u")return r[f];throw"unregistered EC curve name: "+f},this.regist=function(c,f,p,g,m,x,A,N,P,b,y,F){r[c]={};var C=s(p),I=s(g),T=s(m),L=s(x),Z=s(A),W=new Qn(C,I,T),G=W.decodePointHex("04"+N+P);r[c].name=c,r[c].keylen=f,r[c].keycharlen=2*Math.ceil(f/8),r[c].curve=W,r[c].G=G,r[c].n=L,r[c].h=Z,r[c].oid=y,r[c].info=F;for(var me=0;me<b.length;me++)a[b[me]]=c}},d.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),d.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),d.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),d.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),d.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),d.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),d.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),d.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),d.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),d.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),(typeof d>"u"||!d)&&(d={}),(typeof d.crypto>"u"||!d.crypto)&&(d.crypto={}),d.crypto.DSA=function(){var s=Ne.getVbyListEx,c=Ne.isASN1HEX,f=V;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(p,g,m,x,A){this.isPrivate=!0,this.p=p,this.q=g,this.g=m,this.y=x,this.x=A},this.setPrivateHex=function(p,g,m,x,A){var N,P,b,y,F;N=new V(p,16),P=new V(g,16),b=new V(m,16),y="string"==typeof x&&x.length>1?new V(x,16):null,F=new V(A,16),this.setPrivate(N,P,b,y,F)},this.setPublic=function(p,g,m,x){this.isPublic=!0,this.p=p,this.q=g,this.g=m,this.y=x,this.x=null},this.setPublicHex=function(p,g,m,x){var A,N,P,b;A=new V(p,16),N=new V(g,16),P=new V(m,16),b=new V(x,16),this.setPublic(A,N,P,b)},this.signWithMessageHash=function(p){var g=this.p,m=this.q,x=this.g,N=this.x,P=d.crypto.Util.getRandomBigIntegerMinToMax(V.ONE.add(V.ONE),m.subtract(V.ONE)),y=new V(p.substr(0,m.bitLength()/4),16),F=x.modPow(P,g).mod(m),C=P.modInverse(m).multiply(y.add(N.multiply(F))).mod(m);return d.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:F}},{int:{bigint:C}}]})},this.verifyWithMessageHash=function(p,g){var m=this.p,x=this.q,A=this.g,N=this.y,P=this.parseASN1Signature(g),b=P[0],y=P[1],C=new V(p.substr(0,x.bitLength()/4),16);if(V.ZERO.compareTo(b)>0||b.compareTo(x)>0||V.ZERO.compareTo(y)>=0||y.compareTo(x)>0)throw"invalid DSA signature";var I=y.modInverse(x),T=C.multiply(I).mod(x),L=b.multiply(I).mod(x);return 0==A.modPow(T,m).multiply(N.modPow(L,m)).mod(m).mod(x).compareTo(b)},this.parseASN1Signature=function(p){try{return[new f(s(p,0,[0],"02"),16),new f(s(p,0,[1],"02"),16)]}catch{throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(p){var g,m,x,A,N;if(!1===c(p))throw new Error("not ASN.1 hex string");try{g=s(p,0,[1],"02"),m=s(p,0,[2],"02"),x=s(p,0,[3],"02"),A=s(p,0,[4],"02"),N=s(p,0,[5],"02")}catch{throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(g,m,x,A,N)},this.readPKCS8PrvKeyHex=function(p){var g,m,x,A;if(!1===c(p))throw new Error("not ASN.1 hex string");try{g=s(p,0,[1,1,0],"02"),m=s(p,0,[1,1,1],"02"),x=s(p,0,[1,1,2],"02"),A=s(p,0,[2,0],"02")}catch{throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(g,m,x,null,A)},this.readPKCS8PubKeyHex=function(p){var g,m,x,A;if(!1===c(p))throw new Error("not ASN.1 hex string");try{g=s(p,0,[0,1,0],"02"),m=s(p,0,[0,1,1],"02"),x=s(p,0,[0,1,2],"02"),A=s(p,0,[1,0],"02")}catch{throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(g,m,x,A)},this.readCertPubKeyHex=function(p,g){var m,x,A,N;if(!1===c(p))throw new Error("not ASN.1 hex string");try{m=s(p,0,[0,5,0,1,0],"02"),x=s(p,0,[0,5,0,1,1],"02"),A=s(p,0,[0,5,0,1,2],"02"),N=s(p,0,[0,5,1,0],"02")}catch{throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(m,x,A,N)}};var ct=function(){var r=function(C,I,T){return c(E.AES,C,I,T)},c=function(C,I,T,L){var Z=E.enc.Hex.parse(I),W=E.enc.Hex.parse(T),G=E.enc.Hex.parse(L),me={};me.key=W,me.iv=G,me.ciphertext=Z;var Se=C.decrypt(me,W,{iv:G});return E.enc.Hex.stringify(Se)},f=function(C,I,T){return m(E.AES,C,I,T)},m=function(C,I,T,L){var Z=E.enc.Hex.parse(I),W=E.enc.Hex.parse(T),G=E.enc.Hex.parse(L),me=C.encrypt(Z,W,{iv:G}),Se=E.enc.Hex.parse(me.toString());return E.enc.Base64.stringify(Se)},x={"AES-256-CBC":{proc:r,eproc:f,keylen:32,ivlen:16},"AES-192-CBC":{proc:r,eproc:f,keylen:24,ivlen:16},"AES-128-CBC":{proc:r,eproc:f,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(C,I,T){return c(E.TripleDES,C,I,T)},eproc:function(C,I,T){return m(E.TripleDES,C,I,T)},keylen:24,ivlen:8},"DES-CBC":{proc:function(C,I,T){return c(E.DES,C,I,T)},eproc:function(C,I,T){return m(E.DES,C,I,T)},keylen:8,ivlen:8}},P=function(C){var I={},T=C.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));T&&(I.cipher=T[1],I.ivsalt=T[2]);var L=C.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));L&&(I.type=L[1]);var Z=-1,W=0;-1!=C.indexOf("\r\n\r\n")&&(Z=C.indexOf("\r\n\r\n"),W=2),-1!=C.indexOf("\n\n")&&(Z=C.indexOf("\n\n"),W=1);var G=C.indexOf("-----END");if(-1!=Z&&-1!=G){var me=C.substring(Z+2*W,G-W);me=me.replace(/\s+/g,""),I.data=me}return I},b=function(C,I,T){for(var L=T.substring(0,16),Z=E.enc.Hex.parse(L),W=E.enc.Utf8.parse(I),G=x[C].keylen+x[C].ivlen,me="",Se=null;;){var O=E.algo.MD5.create();if(null!=Se&&O.update(Se),O.update(W),O.update(Z),Se=O.finalize(),(me+=E.enc.Hex.stringify(Se)).length>=2*G)break}var j={};return j.keyhex=me.substr(0,2*x[C].keylen),j.ivhex=me.substr(2*x[C].keylen,2*x[C].ivlen),j},y=function(C,I,T,L){var Z=E.enc.Base64.parse(C),W=E.enc.Hex.stringify(Z);return(0,x[I].proc)(W,T,L)};return{version:"1.0.0",parsePKCS5PEM:function(C){return P(C)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(C,I,T){return b(C,I,T)},decryptKeyB64:function(C,I,T,L){return y(C,I,T,L)},getDecryptedKeyHex:function(C,I){var T=P(C),Z=T.cipher,W=T.ivsalt,G=T.data,me=b(Z,I,W);return y(G,Z,me.keyhex,W)},getEncryptedPKCS5PEMFromPrvKeyHex:function(C,I,T,L,Z){var $="";if((typeof L>"u"||null==L)&&(L="AES-256-CBC"),typeof x[L]>"u")throw new Error("KEYUTIL unsupported algorithm: "+L);if(typeof Z>"u"||null==Z){var G=function(C){var I=E.lib.WordArray.random(C);return E.enc.Hex.stringify(I)}(x[L].ivlen);Z=G.toUpperCase()}var O=function(C,I,T,L){return(0,x[I].eproc)(C,T,L)}(I,L,b(L,T,Z).keyhex,Z);return $="-----BEGIN "+C+" PRIVATE KEY-----\r\n",$+="Proc-Type: 4,ENCRYPTED\r\n",$+="DEK-Info: "+L+","+Z+"\r\n",$+="\r\n",($+=O.replace(/(.{64})/g,"$1\r\n"))+"\r\n-----END "+C+" PRIVATE KEY-----\r\n"},parseHexOfEncryptedPKCS8:function(C){var T=Ne.getChildIdx,L=Ne.getV,Z={},W=T(C,0);if(2!=W.length)throw new Error("malformed format: SEQUENCE(0).items != 2: "+W.length);Z.ciphertext=L(C,W[1]);var G=T(C,W[0]);if(2!=G.length)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+G.length);if("2a864886f70d01050d"!=L(C,G[0]))throw new Error("this only supports pkcs5PBES2");var me=T(C,G[1]);if(2!=G.length)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+me.length);var Se=T(C,me[1]);if(2!=Se.length)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+Se.length);if("2a864886f70d0307"!=L(C,Se[0]))throw"this only supports TripleDES";Z.encryptionSchemeAlg="TripleDES",Z.encryptionSchemeIV=L(C,Se[1]);var O=T(C,me[0]);if(2!=O.length)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+O.length);if("2a864886f70d01050c"!=L(C,O[0]))throw new Error("this only supports pkcs5PBKDF2");var j=T(C,O[1]);if(j.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+j.length);Z.pbkdf2Salt=L(C,j[0]);var $=L(C,j[1]);try{Z.pbkdf2Iter=parseInt($,16)}catch{throw new Error("malformed format pbkdf2Iter: "+$)}return Z},getPBKDF2KeyHexFromParam:function(C,I){var T=E.enc.Hex.parse(C.pbkdf2Salt),Z=E.PBKDF2(I,T,{keySize:6,iterations:C.pbkdf2Iter});return E.enc.Hex.stringify(Z)},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(C,I){var T=Ht(C,"ENCRYPTED PRIVATE KEY"),L=this.parseHexOfEncryptedPKCS8(T),Z=ct.getPBKDF2KeyHexFromParam(L,I),W={};W.ciphertext=E.enc.Hex.parse(L.ciphertext);var G=E.enc.Hex.parse(Z),me=E.enc.Hex.parse(L.encryptionSchemeIV),Se=E.TripleDES.decrypt(W,G,{iv:me});return E.enc.Hex.stringify(Se)},getKeyFromEncryptedPKCS8PEM:function(C,I){var T=this._getPlainPKCS8HexFromEncryptedPKCS8PEM(C,I);return this.getKeyFromPlainPrivatePKCS8Hex(T)},parsePlainPrivatePKCS8Hex:function(C){var I=Ne,T=I.getChildIdx,L=I.getV,Z={algparam:null};if("30"!=C.substr(0,2))throw new Error("malformed plain PKCS8 private key(code:001)");var W=T(C,0);if(W.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if("30"!=C.substr(W[1],2))throw new Error("malformed PKCS8 private key(code:003)");var G=T(C,W[1]);if(2!=G.length)throw new Error("malformed PKCS8 private key(code:004)");if("06"!=C.substr(G[0],2))throw new Error("malformed PKCS8 private key(code:005)");if(Z.algoid=L(C,G[0]),"06"==C.substr(G[1],2)&&(Z.algparam=L(C,G[1])),"04"!=C.substr(W[2],2))throw new Error("malformed PKCS8 private key(code:006)");return Z.keyidx=I.getVidx(C,W[2]),Z},getKeyFromPlainPrivatePKCS8PEM:function(C){var I=Ht(C,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(I)},getKeyFromPlainPrivatePKCS8Hex:function(C){var T,I=this.parsePlainPrivatePKCS8Hex(C);if("2a864886f70d010101"==I.algoid)T=new Ve;else if("2a8648ce380401"==I.algoid)T=new d.crypto.DSA;else{if("2a8648ce3d0201"!=I.algoid)throw new Error("unsupported private key algorithm");T=new d.crypto.ECDSA}return T.readPKCS8PrvKeyHex(C),T},_getKeyFromPublicPKCS8Hex:function(C){var I,T=Ne.getVbyList(C,0,[0,0],"06");if("2a864886f70d010101"===T)I=new Ve;else if("2a8648ce380401"===T)I=new d.crypto.DSA;else{if("2a8648ce3d0201"!==T)throw new Error("unsupported PKCS#8 public key hex");I=new d.crypto.ECDSA}return I.readPKCS8PubKeyHex(C),I},parsePublicRawRSAKeyHex:function(C){var T=Ne.getChildIdx,L=Ne.getV,Z={};if("30"!=C.substr(0,2))throw new Error("malformed RSA key(code:001)");var W=T(C,0);if(2!=W.length)throw new Error("malformed RSA key(code:002)");if("02"!=C.substr(W[0],2))throw new Error("malformed RSA key(code:003)");if(Z.n=L(C,W[0]),"02"!=C.substr(W[1],2))throw new Error("malformed RSA key(code:004)");return Z.e=L(C,W[1]),Z},parsePublicPKCS8Hex:function(C){var I=Ne,T=I.getChildIdx,L=I.getV,Z={algparam:null},W=T(C,0);if(2!=W.length)throw new Error("outer DERSequence shall have 2 elements: "+W.length);var G=W[0];if("30"!=C.substr(G,2))throw new Error("malformed PKCS8 public key(code:001)");var me=T(C,G);if(2!=me.length)throw new Error("malformed PKCS8 public key(code:002)");if("06"!=C.substr(me[0],2))throw new Error("malformed PKCS8 public key(code:003)");if(Z.algoid=L(C,me[0]),"06"==C.substr(me[1],2)?Z.algparam=L(C,me[1]):"30"==C.substr(me[1],2)&&(Z.algparam={},Z.algparam.p=I.getVbyList(C,me[1],[0],"02"),Z.algparam.q=I.getVbyList(C,me[1],[1],"02"),Z.algparam.g=I.getVbyList(C,me[1],[2],"02")),"03"!=C.substr(W[1],2))throw new Error("malformed PKCS8 public key(code:004)");return Z.key=L(C,W[1]).substr(2),Z}}}();function La(r,a){for(var s="",c=a/4-r.length,f=0;f<c;f++)s+="0";return s+r}function Ns(r,a,s){for(var c="",f=0;c.length<a;)c+=tn(s(Rn(r+String.fromCharCode.apply(String,[(4278190080&f)>>24,(16711680&f)>>16,(65280&f)>>8,255&f])))),f+=1;return c}function Rs(r){for(var a in d.crypto.Util.DIGESTINFOHEAD){var s=d.crypto.Util.DIGESTINFOHEAD[a],c=s.length;if(r.substring(0,c)==s)return[a,r.substring(c)]}return[]}function Ge(r){var Z,a=Ne,s=a.getChildIdx,c=a.getV,p=a.parse,g=a.getTLV,m=a.getVbyList,x=a.getVbyListEx,A=a.getTLVbyList,N=a.getTLVbyListEx,P=a.getIdxbyList,b=a.getIdxbyListEx,y=a.getVidx,F=a.getInt,C=a.oidname,I=a.hextooidstr,L=Ht,W=Error;try{Z=d.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(null===this.hex||0!==this.version)return this.version;var O=A(this.hex,0,[0,0]);if("a0"==O.substr(0,2)){var j=A(O,0,[0]),$=F(j,0);if($<0||2<$)throw new Error("malformed version field");return this.version=$+1,this.version}return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return x(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var O=N(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(O)},this.getAlgorithmIdentifierName=function(O){for(var j in Z)if(O===Z[j])return j;return C(x(O,0,[0],"06"))},this.getIssuer=function(O,j){return this.getX500Name(this.getIssuerHex(),O,j)},this.getIssuerHex=function(){return A(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){return this.getIssuer().str},this.getSubject=function(O,j){return this.getX500Name(this.getSubjectHex(),O,j)},this.getSubjectHex=function(){return A(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){return this.getSubject().str},this.getNotBefore=function(){var O=m(this.hex,0,[0,4+this.foffset,0]);return O=O.replace(/(..)/g,"%$1"),decodeURIComponent(O)},this.getNotAfter=function(){var O=m(this.hex,0,[0,4+this.foffset,1]);return O=O.replace(/(..)/g,"%$1"),decodeURIComponent(O)},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return A(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var O=this.getSPKI();return null==O?null:m(O,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return P(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var O=this.getPublicKeyIdx();return P(this.hex,O,[1,0],"30")},this.getPublicKey=function(){return ct.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var O=A(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(O)},this.getSignatureValueHex=function(){return m(this.hex,0,[2],"03",!0)},this.verifySignature=function(O){var j=this.getSignatureAlgorithmField(),$=this.getSignatureValueHex(),J=A(this.hex,0,[0],"30"),re=new d.crypto.Signature({alg:j});return re.init(O),re.updateHex(J),re.verify($)},this.parseExt=function(O){var j,$,J;if(void 0===O){if(3!==this.version)return-1;j=P(J=this.hex,0,[0,7,0],"30"),$=s(J,j)}else{J=Ht(O);var re=P(J,0,[0,3,0,0],"06");if("2a864886f70d01090e"!=c(J,re))return void(this.aExtInfo=new Array);j=P(J,0,[0,3,0,1,0],"30"),$=s(J,j),this.hex=J}this.aExtInfo=new Array;for(var le=0;le<$.length;le++){var ee={critical:!1},fe=0;3===s(J,$[le]).length&&(ee.critical=!0,fe=1),ee.oid=a.hextooidstr(m(J,$[le],[0],"06"));var xe=P(J,$[le],[1+fe]);ee.vidx=y(J,xe),this.aExtInfo.push(ee)}},this.getExtInfo=function(O){var j=this.aExtInfo,$=O;if(O.match(/^[0-9.]+$/)||($=d.asn1.x509.OID.name2oid(O)),""!==$)for(var J=0;J<j.length;J++)if(j[J].oid===$)return j[J]},this.getCriticalExtV=function(O,j,$){if(null!=j)return[j,$];var J=this.getExtInfo(O);return null==J?[null,null]:[g(this.hex,J.vidx),J.critical]},this.getExtBasicConstraints=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("basicConstraints");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"basicConstraints"};if(j&&(J.critical=!0),"3000"===O)return J;if("30030101ff"===O)return J.cA=!0,J;if("30060101ff02"===O.substr(0,12)){var re=c(O,10),le=parseInt(re,16);return J.cA=!0,J.pathLen=le,J}throw new Error("hExtV parse error: "+O)},this.getExtNameConstraints=function(O,j){var $=this.getCriticalExtV("nameConstraints",O,j);if(j=$[1],null!=(O=$[0])){var J={extname:"nameConstraints"};j&&(J.critical=!0);for(var re=s(O,0),le=0;le<re.length;le++){for(var ee=[],oe=s(O,re[le]),fe=0;fe<oe.length;fe++){var xe=g(O,oe[fe]),qe=this.getGeneralSubtree(xe);ee.push(qe)}var Ue=O.substr(re[le],2);"a0"==Ue?J.permit=ee:"a1"==Ue&&(J.exclude=ee)}return J}},this.getGeneralSubtree=function(O){var j=s(O,0),$=j.length;if($<1||2<$)throw new Error("wrong num elements");for(var J=this.getGeneralName(g(O,j[0])),re=1;re<$;re++){var le=O.substr(j[re],2),ee=c(O,j[re]),oe=parseInt(ee,16);"80"==le&&(J.min=oe),"81"==le&&(J.max=oe)}return J},this.getExtKeyUsage=function(O,j){var $=this.getCriticalExtV("keyUsage",O,j);if(j=$[1],null!=(O=$[0])){var J={extname:"keyUsage"};return j&&(J.critical=!0),J.names=this.getExtKeyUsageString(O).split(","),J}},this.getExtKeyUsageBin=function(O){if(void 0===O){var j=this.getExtInfo("keyUsage");if(void 0===j)return"";O=g(this.hex,j.vidx)}if(8!=O.length&&10!=O.length)throw new Error("malformed key usage value: "+O);var $="000000000000000"+parseInt(O.substr(6),16).toString(2);return 8==O.length&&($=$.slice(-8)),10==O.length&&($=$.slice(-16)),""==($=$.replace(/0+$/,""))&&($="0"),$},this.getExtKeyUsageString=function(O){for(var j=this.getExtKeyUsageBin(O),$=new Array,J=0;J<j.length;J++)"1"==j.substr(J,1)&&$.push(Ge.KEYUSAGE_NAME[J]);return $.join(",")},this.getExtSubjectKeyIdentifier=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("subjectKeyIdentifier");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"subjectKeyIdentifier"};j&&(J.critical=!0);var re=c(O,0);return J.kid={hex:re},J},this.getExtAuthorityKeyIdentifier=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("authorityKeyIdentifier");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"authorityKeyIdentifier"};j&&(J.critical=!0);for(var re=s(O,0),le=0;le<re.length;le++){var ee=O.substr(re[le],2);if("80"===ee&&(J.kid={hex:c(O,re[le])}),"a1"===ee){var oe=g(O,re[le]),fe=this.getGeneralNames(oe);J.issuer=fe[0].dn}"82"===ee&&(J.sn={hex:c(O,re[le])})}return J},this.getExtExtKeyUsage=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("extKeyUsage");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"extKeyUsage",array:[]};j&&(J.critical=!0);for(var re=s(O,0),le=0;le<re.length;le++)J.array.push(C(c(O,re[le])));return J},this.getExtExtKeyUsageName=function(){var O=this.getExtInfo("extKeyUsage");if(void 0===O)return O;var j=new Array,$=g(this.hex,O.vidx);if(""===$)return j;for(var J=s($,0),re=0;re<J.length;re++)j.push(C(c($,J[re])));return j},this.getExtSubjectAltName=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("subjectAltName");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"subjectAltName",array:[]};return j&&(J.critical=!0),J.array=this.getGeneralNames(O),J},this.getExtIssuerAltName=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("issuerAltName");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"issuerAltName",array:[]};return j&&(J.critical=!0),J.array=this.getGeneralNames(O),J},this.getGeneralNames=function(O){for(var j=s(O,0),$=[],J=0;J<j.length;J++){var re=this.getGeneralName(g(O,j[J]));void 0!==re&&$.push(re)}return $},this.getGeneralName=function(O){var j=O.substr(0,2),$=c(O,0),J=tn($);return"81"==j?{rfc822:J}:"82"==j?{dns:J}:"86"==j?{uri:J}:"87"==j?{ip:hi($)}:"a4"==j?{dn:this.getX500Name($)}:"a0"==j?{other:this.getOtherName(O)}:void 0},this.getExtSubjectAltName2=function(){var O,j,$,J=this.getExtInfo("subjectAltName");if(void 0===J)return J;for(var re=new Array,le=g(this.hex,J.vidx),ee=s(le,0),oe=0;oe<ee.length;oe++)$=le.substr(ee[oe],2),O=c(le,ee[oe]),"81"===$&&(j=mt(O),re.push(["MAIL",j])),"82"===$&&(j=mt(O),re.push(["DNS",j])),"84"===$&&(j=Ge.hex2dn(O,0),re.push(["DN",j])),"86"===$&&(j=mt(O),re.push(["URI",j])),"87"===$&&(j=hi(O),re.push(["IP",j]));return re},this.getExtCRLDistributionPoints=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("cRLDistributionPoints");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"cRLDistributionPoints",array:[]};j&&(J.critical=!0);for(var re=s(O,0),le=0;le<re.length;le++){var ee=g(O,re[le]);J.array.push(this.getDistributionPoint(ee))}return J},this.getDistributionPoint=function(O){for(var j={},$=s(O,0),J=0;J<$.length;J++){var re=O.substr($[J],2),le=g(O,$[J]);"a0"==re&&(j.dpname=this.getDistributionPointName(le))}return j},this.getDistributionPointName=function(O){for(var j={},$=s(O,0),J=0;J<$.length;J++){var re=O.substr($[J],2),le=g(O,$[J]);"a0"==re&&(j.full=this.getGeneralNames(le))}return j},this.getExtCRLDistributionPointsURI=function(){var O=this.getExtCRLDistributionPoints();if(null==O)return O;for(var j=O.array,$=[],J=0;J<j.length;J++)try{null!=j[J].dpname.full[0].uri&&$.push(j[J].dpname.full[0].uri)}catch{}return $},this.getExtAIAInfo=function(){var O=this.getExtInfo("authorityInfoAccess");if(void 0===O)return O;for(var j={ocsp:[],caissuer:[]},$=s(this.hex,O.vidx),J=0;J<$.length;J++){var re=m(this.hex,$[J],[0],"06"),le=m(this.hex,$[J],[1],"86");"2b06010505073001"===re&&j.ocsp.push(mt(le)),"2b06010505073002"===re&&j.caissuer.push(mt(le))}return j},this.getExtAuthorityInfoAccess=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("authorityInfoAccess");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"authorityInfoAccess",array:[]};j&&(J.critical=!0);for(var re=s(O,0),le=0;le<re.length;le++){var ee=x(O,re[le],[0],"06"),fe=mt(m(O,re[le],[1],"86"));if("2b06010505073001"==ee)J.array.push({ocsp:fe});else{if("2b06010505073002"!=ee)throw new Error("unknown method: "+ee);J.array.push({caissuer:fe})}}return J},this.getExtCertificatePolicies=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("certificatePolicies");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"certificatePolicies",array:[]};j&&(J.critical=!0);for(var re=s(O,0),le=0;le<re.length;le++){var ee=g(O,re[le]),oe=this.getPolicyInformation(ee);J.array.push(oe)}return J},this.getPolicyInformation=function(O){var j={},$=m(O,0,[0],"06");j.policyoid=C($);var J=b(O,0,[1],"30");if(-1!=J){j.array=[];for(var re=s(O,J),le=0;le<re.length;le++){var ee=g(O,re[le]),oe=this.getPolicyQualifierInfo(ee);j.array.push(oe)}}return j},this.getOtherName=function(O){var j={},$=s(O,0),J=m(O,$[0],[],"06"),re=m(O,$[1],[]);return j.oid=C(J),j.value=p(re),j},this.getPolicyQualifierInfo=function(O){var j={},$=m(O,0,[0],"06");if("2b06010505070201"===$){var J=x(O,0,[1],"16");j.cps=tn(J)}else if("2b06010505070202"===$){var re=A(O,0,[1],"30");j.unotice=this.getUserNotice(re)}return j},this.getUserNotice=function(O){var j=null;try{return j=a.parse(O),this._asn1ToUnotice(j)}catch{return}},this._asn1ToUnotice=function(O){try{for(var j={},$=Gr(O,"seq"),J=0;J<$.length;J++){var re=this._asn1ToNoticeRef($[J]);null!=re&&(j.noticeref=re);var le=this.asn1ToDisplayText($[J]);null!=le&&(j.exptext=le)}return Object.keys(j).length>0?j:void 0}catch{return}},this._asn1ToNoticeRef=function(O){try{for(var j={},$=Gr(O,"seq"),J=0;J<$.length;J++){var re=this._asn1ToNoticeNum($[J]);null!=re&&(j.noticenum=re);var le=this.asn1ToDisplayText($[J]);null!=le&&(j.org=le)}return Object.keys(j).length>0?j:void 0}catch{return}},this._asn1ToNoticeNum=function(O){try{for(var j=Gr(O,"seq"),$=[],J=0;J<j.length;J++)$.push(parseInt(Gr(j[J],"int.hex"),16));return $}catch{return}},this.getDisplayText=function(O){var $={};return $.type={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"}[O.substr(0,2)],$.str=tn(c(O,0)),$},this.asn1ToDisplayText=function(O){return null!=O.utf8str?{type:"utf8",str:O.utf8str.str}:null!=O.ia5str?{type:"ia5",str:O.ia5str.str}:null!=O.visstr?{type:"vis",str:O.visstr.str}:null!=O.bmpstr?{type:"bmp",str:O.bmpstr.str}:null!=O.prnstr?{type:"prn",str:O.prnstr.str}:void 0},this.getExtPolicyMappings=function(O,j){var $=this.getCriticalExtV("policyMappings",O,j);if(j=$[1],null!=(O=$[0])){var J={extname:"policyMappings"};j&&(J.critical=!0);try{for(var le=p(O).seq,ee=[],oe=0;oe<le.length;oe++){var fe=le[oe].seq;ee.push([fe[0].oid,fe[1].oid])}J.array=ee}catch{throw new W("malformed policyMappings")}return J}},this.getExtPolicyConstraints=function(O,j){var $=this.getCriticalExtV("policyConstraints",O,j);if(j=$[1],null!=(O=$[0])){var J={extname:"policyConstraints"};j&&(J.critical=!0);var re=p(O);try{for(var le=re.seq,ee=0;ee<le.length;ee++){var oe=le[ee].tag;0==oe.explicit&&("80"==oe.tag&&(J.reqexp=parseInt(oe.hex,16)),"81"==oe.tag&&(J.inhibit=parseInt(oe.hex,16)))}}catch{return new W("malformed policyConstraints value")}return J}},this.getExtInhibitAnyPolicy=function(O,j){var $=this.getCriticalExtV("inhibitAnyPolicy",O,j);if(j=$[1],null!=(O=$[0])){var J={extname:"inhibitAnyPolicy"};j&&(J.critical=!0);var re=F(O,0);return-1==re?new W("wrong value"):(J.skip=re,J)}},this.getExtCRLNumber=function(O,j){var $={extname:"cRLNumber"};if(j&&($.critical=!0),"02"==O.substr(0,2))return $.num={hex:c(O,0)},$;throw new W("hExtV parse error: "+O)},this.getExtCRLReason=function(O,j){var $={extname:"cRLReason"};if(j&&($.critical=!0),"0a"==O.substr(0,2))return $.code=parseInt(c(O,0),16),$;throw new Error("hExtV parse error: "+O)},this.getExtOcspNonce=function(O,j){var $={extname:"ocspNonce"};j&&($.critical=!0);var J=c(O,0);return $.hex=J,$},this.getExtOcspNoCheck=function(O,j){var $={extname:"ocspNoCheck"};return j&&($.critical=!0),$},this.getExtAdobeTimeStamp=function(O,j){if(void 0===O&&void 0===j){var $=this.getExtInfo("adobeTimeStamp");if(void 0===$)return;O=g(this.hex,$.vidx),j=$.critical}var J={extname:"adobeTimeStamp"};j&&(J.critical=!0);var re=s(O,0);if(re.length>1){var le=g(O,re[1]),ee=this.getGeneralName(le);null!=ee.uri&&(J.uri=ee.uri)}if(re.length>2){var oe=g(O,re[2]);"0101ff"==oe&&(J.reqauth=!0),"010100"==oe&&(J.reqauth=!1)}return J};var G=function(O){var j={};try{var J=d.asn1.x509.OID.name2oid(O.seq[0].oid);j.type=d.asn1.x509.OID.oid2atype(J);var re=O.seq[1];if(null!=re.utf8str)j.ds="utf8",j.value=re.utf8str.str;else if(null!=re.numstr)j.ds="num",j.value=re.numstr.str;else if(null!=re.telstr)j.ds="tel",j.value=re.telstr.str;else if(null!=re.prnstr)j.ds="prn",j.value=re.prnstr.str;else if(null!=re.ia5str)j.ds="ia5",j.value=re.ia5str.str;else if(null!=re.visstr)j.ds="vis",j.value=re.visstr.str;else{if(null==re.bmpstr)throw"error";j.ds="bmp",j.value=re.bmpstr.str}return j}catch{throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},me=function(O){try{return O.set.map(function(j){return G(j)})}catch(j){throw new Error("improper ASN.1 parsed RDN: "+j)}};this.getX500NameRule=function(O){for(var ee=null,oe=[],fe=0;fe<O.length;fe++)for(var xe=O[fe],qe=0;qe<xe.length;qe++)oe.push(xe[qe]);for(fe=0;fe<oe.length;fe++){var Ue=oe[fe],Ze=Ue.ds,Ye=Ue.type;if("prn"!=Ze&&"utf8"!=Ze&&"ia5"!=Ze)return"mixed";if("ia5"==Ze){if("CN"!=Ye)return"mixed";if(d.lang.String.isMail(Ue.value))continue;return"mixed"}if("C"==Ye){if("prn"==Ze)continue;return"mixed"}if(null==ee)ee=Ze;else if(ee!==Ze)return"mixed"}return ee??"prn"},this.getAttrTypeAndValue=function(O){var j=p(O);return G(j)},this.getRDN=function(O){var j=p(O);return me(j)},this.getX500NameArray=function(O){return function(O){try{return O.seq.map(function(j){return me(j)})}catch(j){throw new Error("improper ASN.1 parsed X500Name: "+j)}}(p(O))},this.getX500Name=function(O,j,$){var J=this.getX500NameArray(O),le={str:this.dnarraytostr(J)};return le.array=J,1==$&&(le.hex=O),1==j&&(le.canon=this.c14nRDNArray(J)),le},this.readCertPEM=function(O){this.readCertHex(L(O))},this.readCertHex=function(O){this.hex=O,this.getVersion();try{P(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(O){var j={};return null==O&&(O={}),j.version=this.getVersion(),j.serial={hex:this.getSerialNumberHex()},j.sigalg=this.getSignatureAlgorithmField(),j.issuer=this.getIssuer(O.dncanon,O.dnhex),j.notbefore=this.getNotBefore(),j.notafter=this.getNotAfter(),j.subject=this.getSubject(O.dncanon,O.dnhex),j.sbjpubkey=nn(this.getPublicKeyHex(),"PUBLIC KEY"),null!=this.aExtInfo&&this.aExtInfo.length>0&&(j.ext=this.getExtParamArray()),j.sighex=this.getSignatureValueHex(),1==O.tbshex&&(j.tbshex=A(this.hex,0,[0])),1==O.nodnarray&&(delete j.issuer.array,delete j.subject.array),j},this.getExtParamArray=function(O){null==O&&-1!=b(this.hex,0,[0,"[3]"])&&(O=N(this.hex,0,[0,"[3]",0],"30"));for(var $=[],J=s(O,0),re=0;re<J.length;re++){var le=g(O,J[re]),ee=this.getExtParam(le);null!=ee&&$.push(ee)}return $},this.getExtParam=function(O){var J=s(O,0).length;if(2!=J&&3!=J)throw new Error("wrong number elements in Extension: "+J+" "+O);var re=I(m(O,0,[0],"06")),le=!1;3==J&&"0101ff"==A(O,0,[1])&&(le=!0);var ee=A(O,0,[J-1,0]),oe=void 0;if("2.5.29.14"==re?oe=this.getExtSubjectKeyIdentifier(ee,le):"2.5.29.15"==re?oe=this.getExtKeyUsage(ee,le):"2.5.29.17"==re?oe=this.getExtSubjectAltName(ee,le):"2.5.29.18"==re?oe=this.getExtIssuerAltName(ee,le):"2.5.29.19"==re?oe=this.getExtBasicConstraints(ee,le):"2.5.29.30"==re?oe=this.getExtNameConstraints(ee,le):"2.5.29.31"==re?oe=this.getExtCRLDistributionPoints(ee,le):"2.5.29.32"==re?oe=this.getExtCertificatePolicies(ee,le):"2.5.29.33"==re?oe=this.getExtPolicyMappings(ee,le):"2.5.29.35"==re?oe=this.getExtAuthorityKeyIdentifier(ee,le):"2.5.29.36"==re?oe=this.getExtPolicyConstraints(ee,le):"2.5.29.37"==re?oe=this.getExtExtKeyUsage(ee,le):"2.5.29.54"==re?oe=this.getExtInhibitAnyPolicy(ee,le):"1.3.6.1.5.5.7.1.1"==re?oe=this.getExtAuthorityInfoAccess(ee,le):"2.5.29.20"==re?oe=this.getExtCRLNumber(ee,le):"2.5.29.21"==re?oe=this.getExtCRLReason(ee,le):"1.3.6.1.5.5.7.48.1.2"==re?oe=this.getExtOcspNonce(ee,le):"1.3.6.1.5.5.7.48.1.5"==re?oe=this.getExtOcspNoCheck(ee,le):"1.2.840.113583.1.1.9.1"==re?oe=this.getExtAdobeTimeStamp(ee,le):null!=Ge.EXT_PARSER[re]&&(oe=Ge.EXT_PARSER[re](re,le,ee)),null!=oe)return oe;var fe={extname:re,extn:ee};return le&&(fe.critical=!0),fe},this.findExt=function(O,j){for(var $=0;$<O.length;$++)if(O[$].extname==j)return O[$];return null},this.updateExtCDPFullURI=function(O,j){var $=this.findExt(O,"cRLDistributionPoints");if(null!=$&&null!=$.array)for(var J=$.array,re=0;re<J.length;re++)if(null!=J[re].dpname&&null!=J[re].dpname.full)for(var le=J[re].dpname.full,ee=0;ee<le.length;ee++){var oe=le[re];null!=oe.uri&&(oe.uri=j)}},this.updateExtAIAOCSP=function(O,j){var $=this.findExt(O,"authorityInfoAccess");if(null!=$&&null!=$.array)for(var J=$.array,re=0;re<J.length;re++)null!=J[re].ocsp&&(J[re].ocsp=j)},this.updateExtAIACAIssuer=function(O,j){var $=this.findExt(O,"authorityInfoAccess");if(null!=$&&null!=$.array)for(var J=$.array,re=0;re<J.length;re++)null!=J[re].caissuer&&(J[re].caissuer=j)},this.dnarraytostr=function(O){return"/"+O.map(function(J){return function j(J){return J.map(function(re){return function $(J){return J.type+"="+J.value}(re).replace(/\+/,"\\+")}).join("+")}(J).replace(/\//,"\\/")}).join("/")},this.setCanonicalizedDN=function(O){var j;if(null!=O.str&&null==O.array){var J=new d.asn1.x509.X500Name({str:O.str}).tohex();j=this.getX500NameArray(J)}else j=O.array;null==O.canon&&(O.canon=this.c14nRDNArray(j))},this.c14nRDNArray=function(O){for(var j=[],$=0;$<O.length;$++){for(var J=O[$],re=[],le=0;le<J.length;le++){var ee=J[le],oe=ee.value;oe=(oe=(oe=(oe=oe.replace(/^\s*/,"")).replace(/\s*$/,"")).replace(/\s+/g," ")).toLowerCase(),re.push(ee.type.toLowerCase()+"="+oe)}j.push(re.join("+"))}return"/"+j.join("/")},this.getInfo=function(){var le,ee,oe,O=function(ln){for(var yt="",Kt="    ",zt=ln.array,mn=0;mn<zt.length;mn++){var Ct=zt[mn];null!=Ct.dn&&(yt+=Kt+"dn: "+Ct.dn.str+"\n"),null!=Ct.ip&&(yt+=Kt+"ip: "+Ct.ip+"\n"),null!=Ct.rfc822&&(yt+=Kt+"rfc822: "+Ct.rfc822+"\n"),null!=Ct.dns&&(yt+=Kt+"dns: "+Ct.dns+"\n"),null!=Ct.uri&&(yt+=Kt+"uri: "+Ct.uri+"\n"),null!=Ct.other&&(yt+=Kt+"other: "+Ct.other.oid+"="+JSON.stringify(Ct.other.value).replace(/\"/g,"")+"\n")}return yt.replace(/\n$/,"")},j=function(ln){for(var yt="",Kt=ln.array,kt=0;kt<Kt.length;kt++){var zt=Kt[kt];if(yt+="    policy oid: "+zt.policyoid+"\n",void 0!==zt.array)for(var mn=0;mn<zt.array.length;mn++){var Ct=zt.array[mn];void 0!==Ct.cps&&(yt+="    cps: "+Ct.cps+"\n")}}return yt},$=function(ln){for(var yt="",Kt=ln.array,kt=0;kt<Kt.length;kt++){var zt=Kt[kt];try{void 0!==zt.dpname.full[0].uri&&(yt+="    "+zt.dpname.full[0].uri+"\n")}catch{}try{void 0!==zt.dname.full[0].dn.hex&&(yt+="    "+Ge.hex2dn(zt.dpname.full[0].dn.hex)+"\n")}catch{}}return yt},J=function(ln){for(var yt="",Kt=ln.array,kt=0;kt<Kt.length;kt++){var zt=Kt[kt];void 0!==zt.caissuer&&(yt+="    caissuer: "+zt.caissuer+"\n"),void 0!==zt.ocsp&&(yt+="    ocsp: "+zt.ocsp+"\n")}return yt};if(le="Basic Fields\n",le+="  serial number: "+this.getSerialNumberHex()+"\n",le+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n",le+="  issuer: "+this.getIssuerString()+"\n",le+="  notBefore: "+this.getNotBefore()+"\n",le+="  notAfter: "+this.getNotAfter()+"\n",le+="  subject: "+this.getSubjectString()+"\n",le+="  subject public key info: \n",le+="    key algorithm: "+(ee=this.getPublicKey()).type+"\n","RSA"===ee.type&&(le+="    n="+Zr(ee.n.toString(16)).substr(0,16)+"...\n",le+="    e="+Zr(ee.e.toString(16))+"\n"),null!=(oe=this.aExtInfo)){le+="X509v3 Extensions:\n";for(var fe=0;fe<oe.length;fe++){var xe=oe[fe],qe=d.asn1.x509.OID.oid2name(xe.oid);""===qe&&(qe=xe.oid);var Ue="";if(!0===xe.critical&&(Ue="CRITICAL"),le+="  "+qe+" "+Ue+":\n","basicConstraints"===qe){var Ze=this.getExtBasicConstraints();void 0===Ze.cA?le+="    {}\n":(le+="    cA=true",void 0!==Ze.pathLen&&(le+=", pathLen="+Ze.pathLen),le+="\n")}else if("policyMappings"==qe)le+="    "+this.getExtPolicyMappings().array.map(function(ln){return ln[0]+":"+ln[1]}).join(", ")+"\n";else if("policyConstraints"==qe)le+="    ",null!=(Ft=this.getExtPolicyConstraints()).reqexp&&(le+=" reqexp="+Ft.reqexp),null!=Ft.inhibit&&(le+=" inhibit="+Ft.inhibit),le+="\n";else if("inhibitAnyPolicy"==qe){var Ft;le+="    skip="+(Ft=this.getExtInhibitAnyPolicy()).skip+"\n"}else if("keyUsage"==qe)le+="    "+this.getExtKeyUsageString()+"\n";else if("subjectKeyIdentifier"==qe)le+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n";else if("authorityKeyIdentifier"==qe){var vt=this.getExtAuthorityKeyIdentifier();void 0!==vt.kid&&(le+="    kid="+vt.kid.hex+"\n")}else"extKeyUsage"==qe?le+="    "+this.getExtExtKeyUsage().array.join(", ")+"\n":"subjectAltName"==qe?le+=O(this.getExtSubjectAltName())+"\n":"cRLDistributionPoints"==qe?le+=$(this.getExtCRLDistributionPoints()):"authorityInfoAccess"==qe?le+=J(this.getExtAuthorityInfoAccess()):"certificatePolicies"==qe&&(le+=j(this.getExtCertificatePolicies()))}}return(le+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n")+"signature: "+this.getSignatureValueHex().substr(0,16)+"...\n"},"string"==typeof r&&(-1!=r.indexOf("-----BEGIN")?this.readCertPEM(r):d.lang.String.isHex(r)&&this.readCertHex(r))}ct.getKey=function(r,a,s){var O,f=(c=Ne).getChildIdx,g=c.getVbyList,m=d.crypto,x=m.ECDSA,A=m.DSA,N=Ve,P=Ht,b=ct;if(typeof N<"u"&&r instanceof N||typeof x<"u"&&r instanceof x||typeof A<"u"&&r instanceof A)return r;if(void 0!==r.curve&&void 0!==r.xy&&void 0===r.d)return new x({pub:r.xy,curve:r.curve});if(void 0!==r.curve&&void 0!==r.d)return new x({prv:r.d,curve:r.curve});if(void 0===r.kty&&void 0!==r.n&&void 0!==r.e&&void 0===r.d)return(y=new N).setPublic(r.n,r.e),y;if(void 0===r.kty&&void 0!==r.n&&void 0!==r.e&&void 0!==r.d&&void 0!==r.p&&void 0!==r.q&&void 0!==r.dp&&void 0!==r.dq&&void 0!==r.co&&void 0===r.qi)return(y=new N).setPrivateEx(r.n,r.e,r.d,r.p,r.q,r.dp,r.dq,r.co),y;if(void 0===r.kty&&void 0!==r.n&&void 0!==r.e&&void 0!==r.d&&void 0===r.p)return(y=new N).setPrivate(r.n,r.e,r.d),y;if(void 0!==r.p&&void 0!==r.q&&void 0!==r.g&&void 0!==r.y&&void 0===r.x)return(y=new A).setPublic(r.p,r.q,r.g,r.y),y;if(void 0!==r.p&&void 0!==r.q&&void 0!==r.g&&void 0!==r.y&&void 0!==r.x)return(y=new A).setPrivate(r.p,r.q,r.g,r.y,r.x),y;if("RSA"===r.kty&&void 0!==r.n&&void 0!==r.e&&void 0===r.d)return(y=new N).setPublic(_t(r.n),_t(r.e)),y;if("RSA"===r.kty&&void 0!==r.n&&void 0!==r.e&&void 0!==r.d&&void 0!==r.p&&void 0!==r.q&&void 0!==r.dp&&void 0!==r.dq&&void 0!==r.qi)return(y=new N).setPrivateEx(_t(r.n),_t(r.e),_t(r.d),_t(r.p),_t(r.q),_t(r.dp),_t(r.dq),_t(r.qi)),y;if("RSA"===r.kty&&void 0!==r.n&&void 0!==r.e&&void 0!==r.d)return(y=new N).setPrivate(_t(r.n),_t(r.e),_t(r.d)),y;if("EC"===r.kty&&void 0!==r.crv&&void 0!==r.x&&void 0!==r.y&&void 0===r.d){var C=(F=new x({curve:r.crv})).ecparams.keycharlen,I=("0000000000"+_t(r.x)).slice(-C),T=("0000000000"+_t(r.y)).slice(-C);return F.setPublicKeyHex(L="04"+I+T),F}if("EC"===r.kty&&void 0!==r.crv&&void 0!==r.x&&void 0!==r.y&&void 0!==r.d){C=(F=new x({curve:r.crv})).ecparams.keycharlen;var L="04"+(I=("0000000000"+_t(r.x)).slice(-C))+(T=("0000000000"+_t(r.y)).slice(-C)),Z=("0000000000"+_t(r.d)).slice(-C);return F.setPublicKeyHex(L),F.setPrivateKeyHex(Z),F}if("pkcs5prv"===s){var G,W=r,c=Ne;if(9===(G=f(W,0)).length)(y=new N).readPKCS5PrvKeyHex(W);else if(6===G.length)(y=new A).readPKCS5PrvKeyHex(W);else{if(!(G.length>2&&"04"===W.substr(G[1],2)))throw new Error("unsupported PKCS#1/5 hexadecimal key");(y=new x).readPKCS5PrvKeyHex(W)}return y}if("pkcs8prv"===s)return b.getKeyFromPlainPrivatePKCS8Hex(r);if("pkcs8pub"===s)return b._getKeyFromPublicPKCS8Hex(r);if("x509pub"===s)return Ge.getPublicKeyFromCertHex(r);if(-1!=r.indexOf("-END CERTIFICATE-",0)||-1!=r.indexOf("-END X509 CERTIFICATE-",0)||-1!=r.indexOf("-END TRUSTED CERTIFICATE-",0))return Ge.getPublicKeyFromCertPEM(r);if(-1!=r.indexOf("-END PUBLIC KEY-")){var me=Ht(r,"PUBLIC KEY");return b._getKeyFromPublicPKCS8Hex(me)}if(-1!=r.indexOf("-END RSA PRIVATE KEY-")&&-1==r.indexOf("4,ENCRYPTED")){var Se=P(r,"RSA PRIVATE KEY");return b.getKey(Se,null,"pkcs5prv")}if(-1!=r.indexOf("-END DSA PRIVATE KEY-")&&-1==r.indexOf("4,ENCRYPTED")){var j=g(O=P(r,"DSA PRIVATE KEY"),0,[1],"02"),$=g(O,0,[2],"02"),J=g(O,0,[3],"02"),re=g(O,0,[4],"02"),le=g(O,0,[5],"02");return(y=new A).setPrivate(new V(j,16),new V($,16),new V(J,16),new V(re,16),new V(le,16)),y}if(-1!=r.indexOf("-END EC PRIVATE KEY-")&&-1==r.indexOf("4,ENCRYPTED"))return Se=P(r,"EC PRIVATE KEY"),b.getKey(Se,null,"pkcs5prv");if(-1!=r.indexOf("-END PRIVATE KEY-"))return b.getKeyFromPlainPrivatePKCS8PEM(r);if(-1!=r.indexOf("-END RSA PRIVATE KEY-")&&-1!=r.indexOf("4,ENCRYPTED")){var ee=b.getDecryptedKeyHex(r,a),oe=new Ve;return oe.readPKCS5PrvKeyHex(ee),oe}if(-1!=r.indexOf("-END EC PRIVATE KEY-")&&-1!=r.indexOf("4,ENCRYPTED")){var F,y=g(O=b.getDecryptedKeyHex(r,a),0,[1],"04"),fe=g(O,0,[2,0],"06"),xe=g(O,0,[3,0],"03").substr(2);if(void 0===d.crypto.OID.oidhex2name[fe])throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+fe);return(F=new x({curve:d.crypto.OID.oidhex2name[fe]})).setPublicKeyHex(xe),F.setPrivateKeyHex(y),F.isPublic=!1,F}if(-1!=r.indexOf("-END DSA PRIVATE KEY-")&&-1!=r.indexOf("4,ENCRYPTED"))return j=g(O=b.getDecryptedKeyHex(r,a),0,[1],"02"),$=g(O,0,[2],"02"),J=g(O,0,[3],"02"),re=g(O,0,[4],"02"),le=g(O,0,[5],"02"),(y=new A).setPrivate(new V(j,16),new V($,16),new V(J,16),new V(re,16),new V(le,16)),y;if(-1!=r.indexOf("-END ENCRYPTED PRIVATE KEY-"))return b.getKeyFromEncryptedPKCS8PEM(r,a);throw new Error("not supported argument")},ct.generateKeypair=function(r,a){if("RSA"==r){var s=a;(c=new Ve).generate(s,"10001"),c.isPrivate=!0,c.isPublic=!0;var f=new Ve,p=c.n.toString(16),g=c.e.toString(16);return f.setPublic(p,g),f.isPrivate=!1,f.isPublic=!0,(m={}).prvKeyObj=c,m.pubKeyObj=f,m}if("EC"==r){var c,m,x=a,N=new d.crypto.ECDSA({curve:x}).generateKeyPairHex();return(c=new d.crypto.ECDSA({curve:x})).setPublicKeyHex(N.ecpubhex),c.setPrivateKeyHex(N.ecprvhex),c.isPrivate=!0,c.isPublic=!1,(f=new d.crypto.ECDSA({curve:x})).setPublicKeyHex(N.ecpubhex),f.isPrivate=!1,f.isPublic=!0,(m={}).prvKeyObj=c,m.pubKeyObj=f,m}throw new Error("unknown algorithm: "+r)},ct.getPEM=function(r,a,s,c,f,p){var m=d.asn1,x=m.DERObjectIdentifier,A=m.DERInteger,N=m.ASN1Util.newObject,y=d.crypto,F=y.DSA,C=y.ECDSA,I=Ve;function T(fe){return N({seq:[{int:0},{int:{bigint:fe.n}},{int:fe.e},{int:{bigint:fe.d}},{int:{bigint:fe.p}},{int:{bigint:fe.q}},{int:{bigint:fe.dmp1}},{int:{bigint:fe.dmq1}},{int:{bigint:fe.coeff}}]})}function L(fe){return N({seq:[{int:1},{octstr:{hex:fe.prvKeyHex}},{tag:["a0",!0,{oid:{name:fe.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+fe.pubKeyHex}}]}]})}function Z(fe){return N({seq:[{int:0},{int:{bigint:fe.p}},{int:{bigint:fe.q}},{int:{bigint:fe.g}},{int:{bigint:fe.y}},{int:{bigint:fe.x}}]})}if((void 0!==I&&r instanceof I||void 0!==F&&r instanceof F||void 0!==C&&r instanceof C)&&1==r.isPublic&&(void 0===a||"PKCS8PUB"==a))return nn(G=new(0,m.x509.SubjectPublicKeyInfo)(r).tohex(),"PUBLIC KEY");if("PKCS1PRV"==a&&void 0!==I&&r instanceof I&&(void 0===s||null==s)&&1==r.isPrivate)return nn(G=T(r).tohex(),"RSA PRIVATE KEY");if("PKCS1PRV"==a&&void 0!==C&&r instanceof C&&(void 0===s||null==s)&&1==r.isPrivate){var Se=new x({name:r.curveName}).tohex(),j=L(r).tohex(),$="";return($+=nn(Se,"EC PARAMETERS"))+nn(j,"EC PRIVATE KEY")}if("PKCS1PRV"==a&&void 0!==F&&r instanceof F&&(void 0===s||null==s)&&1==r.isPrivate)return nn(G=Z(r).tohex(),"DSA PRIVATE KEY");if("PKCS5PRV"==a&&void 0!==I&&r instanceof I&&void 0!==s&&null!=s&&1==r.isPrivate){var G=T(r).tohex();return void 0===c&&(c="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",G,s,c,p)}if("PKCS5PRV"==a&&void 0!==C&&r instanceof C&&void 0!==s&&null!=s&&1==r.isPrivate)return G=L(r).tohex(),void 0===c&&(c="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",G,s,c,p);if("PKCS5PRV"==a&&void 0!==F&&r instanceof F&&void 0!==s&&null!=s&&1==r.isPrivate)return G=Z(r).tohex(),void 0===c&&(c="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",G,s,c,p);var J=function(fe,xe){var qe=re(fe,xe);return new N({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:qe.pbkdf2Salt}},{int:qe.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:qe.encryptionSchemeIV}}]}]}]},{octstr:{hex:qe.ciphertext}}]}).tohex()},re=function(fe,xe){var Ue=E.lib.WordArray.random(8),et=E.lib.WordArray.random(8),Ye=E.PBKDF2(xe,Ue,{keySize:6,iterations:100}),Ft=E.enc.Hex.parse(fe),vt=E.TripleDES.encrypt(Ft,Ye,{iv:et})+"",cn={};return cn.ciphertext=vt,cn.pbkdf2Salt=E.enc.Hex.stringify(Ue),cn.pbkdf2Iter=100,cn.encryptionSchemeAlg="DES-EDE3-CBC",cn.encryptionSchemeIV=E.enc.Hex.stringify(et),cn};if("PKCS8PRV"==a&&null!=I&&r instanceof I&&1==r.isPrivate){var ee=T(r).tohex();return G=N({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:ee}}]}).tohex(),void 0===s||null==s?nn(G,"PRIVATE KEY"):nn(j=J(G,s),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==a&&void 0!==C&&r instanceof C&&1==r.isPrivate){var oe={seq:[{int:1},{octstr:{hex:r.prvKeyHex}}]};return"string"==typeof r.pubKeyHex&&oe.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+r.pubKeyHex}}]}),ee=new N(oe).tohex(),G=N({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:r.curveName}}]},{octstr:{hex:ee}}]}).tohex(),void 0===s||null==s?nn(G,"PRIVATE KEY"):nn(j=J(G,s),"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==a&&void 0!==F&&r instanceof F&&1==r.isPrivate)return ee=new A({bigint:r.x}).tohex(),G=N({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:r.p}},{int:{bigint:r.q}},{int:{bigint:r.g}}]}]},{octstr:{hex:ee}}]}).tohex(),void 0===s||null==s?nn(G,"PRIVATE KEY"):nn(j=J(G,s),"ENCRYPTED PRIVATE KEY");throw new Error("unsupported object nor format")},ct.getKeyFromCSRPEM=function(r){var a=Ht(r,"CERTIFICATE REQUEST");return ct.getKeyFromCSRHex(a)},ct.getKeyFromCSRHex=function(r){var a=ct.parseCSRHex(r);return ct.getKey(a.p8pubkeyhex,null,"pkcs8pub")},ct.parseCSRHex=function(r){var s=Ne.getChildIdx,c=Ne.getTLV,f={},p=r;if("30"!=p.substr(0,2))throw new Error("malformed CSR(code:001)");var g=s(p,0);if(g.length<1)throw new Error("malformed CSR(code:002)");if("30"!=p.substr(g[0],2))throw new Error("malformed CSR(code:003)");var m=s(p,g[0]);if(m.length<3)throw new Error("malformed CSR(code:004)");return f.p8pubkeyhex=c(p,m[2]),f},ct.getKeyID=function(r){var a=ct,s=Ne;"string"==typeof r&&-1!=r.indexOf("BEGIN ")&&(r=a.getKey(r));var c=Ht(a.getPEM(r)),f=s.getIdxbyList(c,0,[1]),p=s.getV(c,f).substring(2);return d.crypto.Util.hashHex(p,"sha1")},ct.getJWK=function(r,a,s,c,f){var p,m,g={},x=d.crypto.Util.hashHex;if("string"==typeof r)p=ct.getKey(r),-1!=r.indexOf("CERTIFICATE")&&(m=Ht(r));else{if("object"!=typeof r)throw new Error("unsupported keyinfo type");r instanceof Ge?(p=r.getPublicKey(),m=r.hex):p=r}if(p instanceof Ve&&p.isPrivate)g.kty="RSA",g.n=Lt(p.n.toString(16)),g.e=Lt(p.e.toString(16)),g.d=Lt(p.d.toString(16)),g.p=Lt(p.p.toString(16)),g.q=Lt(p.q.toString(16)),g.dp=Lt(p.dmp1.toString(16)),g.dq=Lt(p.dmq1.toString(16)),g.qi=Lt(p.coeff.toString(16));else if(p instanceof Ve&&p.isPublic)g.kty="RSA",g.n=Lt(p.n.toString(16)),g.e=Lt(p.e.toString(16));else if(p instanceof d.crypto.ECDSA&&p.isPrivate){if("P-256"!==(A=p.getShortNISTPCurveName())&&"P-384"!==A&&"P-521"!==A)throw new Error("unsupported curve name for JWT: "+A);var N=p.getPublicKeyXYHex();g.kty="EC",g.crv=A,g.x=Lt(N.x),g.y=Lt(N.y),g.d=Lt(p.prvKeyHex)}else if(p instanceof d.crypto.ECDSA&&p.isPublic){var A;if("P-256"!==(A=p.getShortNISTPCurveName())&&"P-384"!==A&&"P-521"!==A)throw new Error("unsupported curve name for JWT: "+A);N=p.getPublicKeyXYHex(),g.kty="EC",g.crv=A,g.x=Lt(N.x),g.y=Lt(N.y)}if(null==g.kty)throw new Error("unsupported keyinfo");return!p.isPrivate&&1!=a&&(g.kid=d.jws.JWS.getJWKthumbprint(g)),null!=m&&1!=s&&(g.x5c=[S(m)]),null!=m&&1!=c&&(g.x5t=ir(S(x(m,"sha1")))),null!=m&&1!=f&&(g["x5t#S256"]=ir(S(x(m,"sha256")))),g},ct.getJWKFromKey=function(r){return ct.getJWK(r,!0,!0,!0,!0)},Ve.getPosArrayOfChildrenFromHex=function(r){return Ne.getChildIdx(r,0)},Ve.getHexValueArrayOfChildrenFromHex=function(r){var b,s=Ne.getV,c=s(r,(b=Ve.getPosArrayOfChildrenFromHex(r))[0]),f=s(r,b[1]),p=s(r,b[2]),g=s(r,b[3]),m=s(r,b[4]),x=s(r,b[5]),A=s(r,b[6]),N=s(r,b[7]),P=s(r,b[8]);return(b=new Array).push(c,f,p,g,m,x,A,N,P),b},Ve.prototype.readPrivateKeyFromPEMString=function(r){var a=Ht(r),s=Ve.getHexValueArrayOfChildrenFromHex(a);this.setPrivateEx(s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8])},Ve.prototype.readPKCS5PrvKeyHex=function(r){var a=Ve.getHexValueArrayOfChildrenFromHex(r);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},Ve.prototype.readPKCS8PrvKeyHex=function(r){var a,s,c,f,p,g,m,x,N=Ne.getVbyListEx;if(!1===Ne.isASN1HEX(r))throw new Error("not ASN.1 hex string");try{a=N(r,0,[2,0,1],"02"),s=N(r,0,[2,0,2],"02"),c=N(r,0,[2,0,3],"02"),f=N(r,0,[2,0,4],"02"),p=N(r,0,[2,0,5],"02"),g=N(r,0,[2,0,6],"02"),m=N(r,0,[2,0,7],"02"),x=N(r,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(a,s,c,f,p,g,m,x)},Ve.prototype.readPKCS5PubKeyHex=function(r){var a=Ne,s=a.getV;if(!1===a.isASN1HEX(r))throw new Error("keyHex is not ASN.1 hex string");var c=a.getChildIdx(r,0);if(2!==c.length||"02"!==r.substr(c[0],2)||"02"!==r.substr(c[1],2))throw new Error("wrong hex for PKCS#5 public key");var f=s(r,c[0]),p=s(r,c[1]);this.setPublic(f,p)},Ve.prototype.readPKCS8PubKeyHex=function(r){var a=Ne;if(!1===a.isASN1HEX(r))throw new Error("not ASN.1 hex string");if("06092a864886f70d010101"!==a.getTLVbyListEx(r,0,[0,0]))throw new Error("not PKCS8 RSA public key");var s=a.getTLVbyListEx(r,0,[1,0]);this.readPKCS5PubKeyHex(s)},Ve.prototype.readCertPubKeyHex=function(r,a){var s,c;(s=new Ge).readCertHex(r),c=s.getPublicKeyHex(),this.readPKCS8PubKeyHex(c)},Ve.prototype.sign=function(r,a){var c=function(f){return d.crypto.Util.hashString(f,a)}(r);return this.signWithMessageHash(c,a)},Ve.prototype.signWithMessageHash=function(r,a){var c=pt(d.crypto.Util.getPaddedDigestInfoHex(r,a,this.n.bitLength()),16);return La(this.doPrivate(c).toString(16),this.n.bitLength())},Ve.prototype.signPSS=function(r,a,s){var f=function(p){return d.crypto.Util.hashHex(p,a)}(Rn(r));return void 0===s&&(s=-1),this.signWithMessageHashPSS(f,a,s)},Ve.prototype.signWithMessageHashPSS=function(r,a,s){var m,c=tn(r),f=c.length,p=this.n.bitLength()-1,g=Math.ceil(p/8),x=function(I){return d.crypto.Util.hashHex(I,a)};if(-1===s||void 0===s)s=f;else if(-2===s)s=g-f-2;else if(s<-2)throw new Error("invalid salt length");if(g<f+s+2)throw new Error("data too long");var A="";s>0&&(A=new Array(s),(new $n).nextBytes(A),A=String.fromCharCode.apply(String,A));var N=tn(x(Rn("\0\0\0\0\0\0\0\0"+c+A))),P=[];for(m=0;m<g-s-f-2;m+=1)P[m]=0;var b=String.fromCharCode.apply(String,P)+"\x01"+A,y=Ns(N,b.length,x),F=[];for(m=0;m<b.length;m+=1)F[m]=b.charCodeAt(m)^y.charCodeAt(m);for(F[0]&=~(65280>>8*g-p&255),m=0;m<f;m++)F.push(N.charCodeAt(m));return F.push(188),La(this.doPrivate(new V(F)).toString(16),this.n.bitLength())},Ve.prototype.verify=function(r,a){if(null==(a=a.toLowerCase()).match(/^[0-9a-f]+$/))return!1;var s=pt(a,16),c=this.n.bitLength();if(s.bitLength()>c)return!1;var p=this.doPublic(s).toString(16);if(p.length+3!=c/4)return!1;var m=Rs(p.replace(/^1f+00/,""));if(0==m.length)return!1;var x=m[0],A=m[1],P=function(b){return d.crypto.Util.hashString(b,x)}(r);return A==P},Ve.prototype.verifyWithMessageHash=function(r,a){if(a.length!=Math.ceil(this.n.bitLength()/4))return!1;var s=pt(a,16);if(s.bitLength()>this.n.bitLength())return 0;var p=Rs(this.doPublic(s).toString(16).replace(/^1f+00/,""));return 0!=p.length&&p[1]==r},Ve.prototype.verifyPSS=function(r,a,s,c){var p=function(g){return d.crypto.Util.hashHex(g,s)}(Rn(r));return void 0===c&&(c=-1),this.verifyWithMessageHashPSS(p,a,s,c)},Ve.prototype.verifyWithMessageHashPSS=function(r,a,s,c){if(a.length!=Math.ceil(this.n.bitLength()/4))return!1;var N,f=new V(a,16),p=function(L){return d.crypto.Util.hashHex(L,s)},g=tn(r),m=g.length,x=this.n.bitLength()-1,A=Math.ceil(x/8);if(-1===c||void 0===c)c=m;else if(-2===c)c=A-m-2;else if(c<-2)throw new Error("invalid salt length");if(A<m+c+2)throw new Error("data too long");var P=this.doPublic(f).toByteArray();for(N=0;N<P.length;N+=1)P[N]&=255;for(;P.length<A;)P.unshift(0);if(188!==P[A-1])throw new Error("encoded message does not end in 0xbc");var b=(P=String.fromCharCode.apply(String,P)).substr(0,A-m-1),y=P.substr(b.length,m),F=65280>>8*A-x&255;if(b.charCodeAt(0)&F)throw new Error("bits beyond keysize not zero");var C=Ns(y,b.length,p),I=[];for(N=0;N<b.length;N+=1)I[N]=b.charCodeAt(N)^C.charCodeAt(N);I[0]&=~F;var T=A-m-c-2;for(N=0;N<T;N+=1)if(0!==I[N])throw new Error("leftmost octets not zero");if(1!==I[T])throw new Error("0x01 marker not found");return y===tn(p(Rn("\0\0\0\0\0\0\0\0"+g+String.fromCharCode.apply(String,I.slice(-c)))))},Ve.SALT_LEN_HLEN=-1,Ve.SALT_LEN_MAX=-2,Ve.SALT_LEN_RECOVER=-2,Ge.EXT_PARSER={},Ge.registExtParser=function(r,a){Ge.EXT_PARSER[r]=a},Ge.hex2dn=function(r,a){void 0===a&&(a=0);var s=new Ge;return Ne.getTLV(r,a),s.getX500Name(r).str},Ge.hex2rdn=function(r,a){if(void 0===a&&(a=0),"31"!==r.substr(a,2))throw new Error("malformed RDN");for(var s=new Array,c=Ne.getChildIdx(r,a),f=0;f<c.length;f++)s.push(Ge.hex2attrTypeValue(r,c[f]));return s=s.map(function(p){return p.replace("+","\\+")}),s.join("+")},Ge.hex2attrTypeValue=function(r,a){var s=Ne,c=s.getV;if(void 0===a&&(a=0),"30"!==r.substr(a,2))throw new Error("malformed attribute type and value");var f=s.getChildIdx(r,a);2!==f.length||r.substr(f[0],2);var p=c(r,f[0]),g=d.asn1.ASN1Util.oidHexToInt(p);return d.asn1.x509.OID.oid2atype(g)+"="+tn(c(r,f[1]))},Ge.getPublicKeyFromCertHex=function(r){var a=new Ge;return a.readCertHex(r),a.getPublicKey()},Ge.getPublicKeyFromCertPEM=function(r){var a=new Ge;return a.readCertPEM(r),a.getPublicKey()},Ge.getPublicKeyInfoPropOfCertPEM=function(r){var f,p,s=Ne.getVbyList,c={algparam:null};return(f=new Ge).readCertPEM(r),p=f.getPublicKeyHex(),c.keyhex=s(p,0,[1],"03").substr(2),c.algoid=s(p,0,[0,0],"06"),"2a8648ce3d0201"===c.algoid&&(c.algparam=s(p,0,[0,1],"06")),c},Ge.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],(typeof d>"u"||!d)&&(d={}),(typeof d.jws>"u"||!d.jws)&&(d.jws={}),d.jws.JWS=function(){var s=d.jws.JWS.isSafeJSONString;this.parseJWS=function(c,f){if(void 0===this.parsedJWS||!f&&void 0===this.parsedJWS.sigvalH){var p=c.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==p)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var g=p[1],m=p[2],x=p[3],A=g+"."+m;if(this.parsedJWS={},this.parsedJWS.headB64U=g,this.parsedJWS.payloadB64U=m,this.parsedJWS.sigvalB64U=x,this.parsedJWS.si=A,!f){var N=_t(x),P=pt(N,16);this.parsedJWS.sigvalH=N,this.parsedJWS.sigvalBI=P}var b=Bn(g),y=Bn(m);if(this.parsedJWS.headS=b,this.parsedJWS.payloadS=y,!s(b,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+b}}},d.jws.JWS.sign=function(r,a,s,c,f){var C,I,T,m=d.jws.JWS,x=m.readSafeJSONString,A=m.isSafeJSONString,N=d.crypto,b=N.Mac,y=N.Signature,F=JSON;if("string"!=typeof a&&"object"!=typeof a)throw"spHeader must be JSON string or object: "+a;if("object"==typeof a&&(C=F.stringify(I=a)),"string"==typeof a){if(!A(C=a))throw"JWS Head is not safe JSON string: "+C;I=x(C)}if(T=s,"object"==typeof s&&(T=F.stringify(s)),(""==r||null==r)&&void 0!==I.alg&&(r=I.alg),""!=r&&null!=r&&void 0===I.alg&&(I.alg=r,C=F.stringify(I)),r!==I.alg)throw"alg and sHeader.alg doesn't match: "+r+"!="+I.alg;var L=null;if(void 0===m.jwsalg2sigalg[r])throw"unsupported alg name: "+r;L=m.jwsalg2sigalg[r];var G=mr(C)+"."+mr(T),me="";if("Hmac"==L.substr(0,4)){if(void 0===c)throw"mac key shall be specified for HS* alg";var Se=new b({alg:L,prov:"cryptojs",pass:c});Se.updateString(G),me=Se.doFinal()}else if(-1!=L.indexOf("withECDSA")){(O=new y({alg:L})).init(c,f),O.updateString(G);var j=O.sign();me=d.crypto.ECDSA.asn1SigToConcatSig(j)}else if("none"!=L){var O;(O=new y({alg:L})).init(c,f),O.updateString(G),me=O.sign()}return G+"."+Lt(me)},d.jws.JWS.verify=function(r,a,s){var P,p=d.jws.JWS,g=p.readSafeJSONString,m=d.crypto,x=m.ECDSA,A=m.Mac,N=m.Signature;if(P=Ve,!fi(r))return!1;var b=r.split(".");if(3!==b.length)return!1;var Z,C=b[0]+"."+b[1],I=_t(b[2]),T=g(Bn(b[0])),L=null;if(void 0===T.alg)throw"algorithm not specified in header";if(Z=(L=T.alg).substr(0,2),null!=s&&"[object Array]"===Object.prototype.toString.call(s)&&s.length>0&&-1==(":"+s.join(":")+":").indexOf(":"+L+":"))throw"algorithm '"+L+"' not accepted in the list";if("none"!=L&&null===a)throw"key shall be specified to verify.";if("string"==typeof a&&-1!=a.indexOf("-----BEGIN ")&&(a=ct.getKey(a)),!("RS"!=Z&&"PS"!=Z||a instanceof P))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==Z&&!(a instanceof x))throw"key shall be a ECDSA obj for ES* algs";var G=null;if(void 0===p.jwsalg2sigalg[T.alg])throw"unsupported alg name: "+L;if("none"==(G=p.jwsalg2sigalg[L]))throw"not supported";if("Hmac"==G.substr(0,4)){if(void 0===a)throw"hexadecimal key shall be specified for HMAC";var Se=new A({alg:G,pass:a});return Se.updateString(C),I==Se.doFinal()}if(-1!=G.indexOf("withECDSA")){var j,O=null;try{O=x.concatSigToASN1Sig(I)}catch{return!1}return(j=new N({alg:G})).init(a),j.updateString(C),j.verify(O)}return(j=new N({alg:G})).init(a),j.updateString(C),j.verify(I)},d.jws.JWS.parse=function(r){var f,p,a=r.split("."),s={};if(2!=a.length&&3!=a.length)throw"malformed sJWS: wrong number of '.' splitted elements";return f=a[1],3==a.length&&(p=a[2]),s.headerObj=d.jws.JWS.readSafeJSONString(Bn(a[0])),s.payloadObj=d.jws.JWS.readSafeJSONString(Bn(f)),s.headerPP=JSON.stringify(s.headerObj,null,"  "),s.payloadPP=null==s.payloadObj?Bn(f):JSON.stringify(s.payloadObj,null,"  "),void 0!==p&&(s.sigHex=_t(p)),s},d.jws.JWS.verifyJWT=function(r,a,s){var f=d.jws,p=f.JWS,g=p.readSafeJSONString,m=p.inArray,x=p.includedArray;if(!fi(r))return!1;var A=r.split(".");if(3!=A.length)return!1;var N=A[0],P=A[1],F=(_t(A[2]),g(Bn(N))),C=g(Bn(P));if(void 0===F.alg)return!1;if(void 0===s.alg)throw"acceptField.alg shall be specified";if(!m(F.alg,s.alg)||void 0!==C.iss&&"object"==typeof s.iss&&!m(C.iss,s.iss)||void 0!==C.sub&&"object"==typeof s.sub&&!m(C.sub,s.sub))return!1;if(void 0!==C.aud&&"object"==typeof s.aud)if("string"==typeof C.aud){if(!m(C.aud,s.aud))return!1}else if("object"==typeof C.aud&&!x(C.aud,s.aud))return!1;var I=f.IntDate.getNow();return void 0!==s.verifyAt&&"number"==typeof s.verifyAt&&(I=s.verifyAt),(void 0===s.gracePeriod||"number"!=typeof s.gracePeriod)&&(s.gracePeriod=0),!(void 0!==C.exp&&"number"==typeof C.exp&&C.exp+s.gracePeriod<I||void 0!==C.nbf&&"number"==typeof C.nbf&&I<C.nbf-s.gracePeriod||void 0!==C.iat&&"number"==typeof C.iat&&I<C.iat-s.gracePeriod||void 0!==C.jti&&void 0!==s.jti&&C.jti!==s.jti||!p.verify(r,a,s.alg))},d.jws.JWS.includedArray=function(r,a){var s=d.jws.JWS.inArray;if(null===r||"object"!=typeof r||"number"!=typeof r.length)return!1;for(var c=0;c<r.length;c++)if(!s(r[c],a))return!1;return!0},d.jws.JWS.inArray=function(r,a){if(null===a||"object"!=typeof a||"number"!=typeof a.length)return!1;for(var s=0;s<a.length;s++)if(a[s]==r)return!0;return!1},d.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},d.jws.JWS.isSafeJSONString=function(r,a,s){var c=null;try{return"object"!=typeof(c=ji(r))||c.constructor===Array?0:(a&&(a[s]=c),1)}catch{return 0}},d.jws.JWS.readSafeJSONString=function(r){var a=null;try{return"object"!=typeof(a=ji(r))||a.constructor===Array?null:a}catch{return null}},d.jws.JWS.getEncodedSignatureValueFromJWS=function(r){var a=r.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==a)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return a[1]},d.jws.JWS.getJWKthumbprint=function(r){if("RSA"!==r.kty&&"EC"!==r.kty&&"oct"!==r.kty)throw"unsupported algorithm for JWK Thumprint";var a="{";if("RSA"===r.kty){if("string"!=typeof r.n||"string"!=typeof r.e)throw"wrong n and e value for RSA key";a+='"e":"'+r.e+'",',a+='"kty":"'+r.kty+'",',a+='"n":"'+r.n+'"}'}else if("EC"===r.kty){if("string"!=typeof r.crv||"string"!=typeof r.x||"string"!=typeof r.y)throw"wrong crv, x and y value for EC key";a+='"crv":"'+r.crv+'",',a+='"kty":"'+r.kty+'",',a+='"x":"'+r.x+'",',a+='"y":"'+r.y+'"}'}else if("oct"===r.kty){if("string"!=typeof r.k)throw"wrong k value for oct(symmetric) key";a+='"kty":"'+r.kty+'",',a+='"k":"'+r.k+'"}'}var s=Rn(a);return Lt(d.crypto.Util.hashHex(s,"sha256"))},d.jws.IntDate={},d.jws.IntDate.get=function(r){var a=d.jws.IntDate,s=a.getNow,c=a.getZulu;if("now"==r)return s();if("now + 1hour"==r)return s()+3600;if("now + 1day"==r)return s()+86400;if("now + 1month"==r)return s()+2592e3;if("now + 1year"==r)return s()+31536e3;if(r.match(/Z$/))return c(r);if(r.match(/^[0-9]+$/))return parseInt(r);throw"unsupported format: "+r},d.jws.IntDate.getZulu=function(r){return Es(r)},d.jws.IntDate.getNow=function(){return~~(new Date/1e3)},d.jws.IntDate.intDate2UTCString=function(r){return new Date(1e3*r).toUTCString()},d.jws.IntDate.intDate2Zulu=function(r){var a=new Date(1e3*r);return("0000"+a.getUTCFullYear()).slice(-4)+("00"+(a.getUTCMonth()+1)).slice(-2)+("00"+a.getUTCDate()).slice(-2)+("00"+a.getUTCHours()).slice(-2)+("00"+a.getUTCMinutes()).slice(-2)+("00"+a.getUTCSeconds()).slice(-2)+"Z"},(typeof d>"u"||!d)&&(d={}),(typeof d.jws>"u"||!d.jws)&&(d.jws={}),d.jws.JWSJS=function(){var s=d.jws.JWS,c=s.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(f){this.init();var p=f.split(".");if(3!=p.length)throw"malformed input JWS";this.aHeader.push(p[0]),this.sPayload=p[1],this.aSignature.push(p[2])},this.addSignature=function(f,p,g,m){if(null==this.sPayload)throw"there's no JSON-JS signature to add.";var x=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var N=d.jws.JWS.sign(f,p,this.sPayload,g,m).split(".");this.aHeader.push(N[0]),this.aSignature.push(N[2])}catch(y){throw this.aHeader.length>x&&this.aHeader.pop(),this.aSignature.length>x&&this.aSignature.pop(),"addSignature failed: "+y}},this.verifyAll=function(f){if(this.aHeader.length!==f.length||this.aSignature.length!==f.length)return!1;for(var p=0;p<f.length;p++){var g=f[p];if(2!==g.length)return!1;if(!1===this.verifyNth(p,g[0],g[1]))return!1}return!0},this.verifyNth=function(f,p,g){if(this.aHeader.length<=f||this.aSignature.length<=f)return!1;var A=this.aHeader[f]+"."+this.sPayload+"."+this.aSignature[f],N=!1;try{N=s.verify(A,p,g)}catch{return!1}return N},this.readJWSJS=function(f){if("string"==typeof f){var p=c(f);if(null==p)throw"argument is not safe JSON object string";this.aHeader=p.headers,this.sPayload=p.payload,this.aSignature=p.signatures}else try{if(!(f.headers.length>0))throw"malformed header";if(this.aHeader=f.headers,"string"!=typeof f.payload)throw"malformed signatures";if(this.sPayload=f.payload,!(f.signatures.length>0))throw"malformed signatures";this.aSignature=f.signatures}catch(g){throw"malformed JWS-JS JSON object: "+g}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return 0==this.aHeader.length?1:0}},q.fs=d},7244:(H,q,v)=>{var M=v(3436)(v(2119),"DataView");H.exports=M},4994:(H,q,v)=>{var R=v(4312),B=v(6421),M=v(5764),l=v(8685),E=v(6676);function k(z){var S=-1,K=null==z?0:z.length;for(this.clear();++S<K;){var X=z[S];this.set(X[0],X[1])}}k.prototype.clear=R,k.prototype.delete=B,k.prototype.get=M,k.prototype.has=l,k.prototype.set=E,H.exports=k},9215:(H,q,v)=>{var R=v(1840),B=v(4378),M=v(4981),l=v(7343),E=v(8895);function k(z){var S=-1,K=null==z?0:z.length;for(this.clear();++S<K;){var X=z[S];this.set(X[0],X[1])}}k.prototype.clear=R,k.prototype.delete=B,k.prototype.get=M,k.prototype.has=l,k.prototype.set=E,H.exports=k},1501:(H,q,v)=>{var M=v(3436)(v(2119),"Map");H.exports=M},9850:(H,q,v)=>{var R=v(638),B=v(1184),M=v(866),l=v(3771),E=v(1772);function k(z){var S=-1,K=null==z?0:z.length;for(this.clear();++S<K;){var X=z[S];this.set(X[0],X[1])}}k.prototype.clear=R,k.prototype.delete=B,k.prototype.get=M,k.prototype.has=l,k.prototype.set=E,H.exports=k},4267:(H,q,v)=>{var M=v(3436)(v(2119),"Promise");H.exports=M},6323:(H,q,v)=>{var M=v(3436)(v(2119),"Set");H.exports=M},4763:(H,q,v)=>{var R=v(9215),B=v(3720),M=v(4410),l=v(5576),E=v(2247),k=v(1585);function z(S){var K=this.__data__=new R(S);this.size=K.size}z.prototype.clear=B,z.prototype.delete=M,z.prototype.get=l,z.prototype.has=E,z.prototype.set=k,H.exports=z},443:(H,q,v)=>{var R=v(2119);H.exports=R.Symbol},3457:(H,q,v)=>{var R=v(2119);H.exports=R.Uint8Array},4243:(H,q,v)=>{var M=v(3436)(v(2119),"WeakMap");H.exports=M},6999:H=>{H.exports=function q(v,R,B){switch(B.length){case 0:return v.call(R);case 1:return v.call(R,B[0]);case 2:return v.call(R,B[0],B[1]);case 3:return v.call(R,B[0],B[1],B[2])}return v.apply(R,B)}},6837:H=>{H.exports=function q(v,R){for(var B=-1,M=null==v?0:v.length;++B<M&&!1!==R(v[B],B,v););return v}},9779:H=>{H.exports=function q(v,R){for(var B=-1,M=null==v?0:v.length,l=0,E=[];++B<M;){var k=v[B];R(k,B,v)&&(E[l++]=k)}return E}},2271:(H,q,v)=>{var R=v(5334),B=v(7151),M=v(1503),l=v(891),E=v(8442),k=v(8159),S=Object.prototype.hasOwnProperty;H.exports=function K(X,ne){var ae=M(X),ce=!ae&&B(X),V=!ae&&!ce&&l(X),Te=!ae&&!ce&&!V&&k(X),Ie=ae||ce||V||Te,Me=Ie?R(X.length,String):[],Be=Me.length;for(var se in X)(ne||S.call(X,se))&&(!Ie||!("length"==se||V&&("offset"==se||"parent"==se)||Te&&("buffer"==se||"byteLength"==se||"byteOffset"==se)||E(se,Be)))&&Me.push(se);return Me}},5059:H=>{H.exports=function q(v,R){for(var B=-1,M=R.length,l=v.length;++B<M;)v[l+B]=R[B];return v}},9276:(H,q,v)=>{var R=v(5683),B=v(217);H.exports=function M(l,E,k){(void 0!==k&&!B(l[E],k)||void 0===k&&!(E in l))&&R(l,E,k)}},9719:(H,q,v)=>{var R=v(5683),B=v(217),l=Object.prototype.hasOwnProperty;H.exports=function E(k,z,S){var K=k[z];(!l.call(k,z)||!B(K,S)||void 0===S&&!(z in k))&&R(k,z,S)}},3503:(H,q,v)=>{var R=v(217);H.exports=function B(M,l){for(var E=M.length;E--;)if(R(M[E][0],l))return E;return-1}},4121:(H,q,v)=>{var R=v(1989),B=v(118);H.exports=function M(l,E){return l&&R(E,B(E),l)}},9287:(H,q,v)=>{var R=v(1989),B=v(6555);H.exports=function M(l,E){return l&&R(E,B(E),l)}},5683:(H,q,v)=>{var R=v(6713);H.exports=function B(M,l,E){"__proto__"==l&&R?R(M,l,{configurable:!0,enumerable:!0,value:E,writable:!0}):M[l]=E}},4462:(H,q,v)=>{var R=v(4763),B=v(6837),M=v(9719),l=v(4121),E=v(9287),k=v(9292),z=v(9454),S=v(4444),K=v(9905),X=v(7597),ne=v(6967),ae=v(8794),ce=v(6782),V=v(7878),Te=v(4264),Ie=v(1503),Me=v(891),Be=v(3222),se=v(5940),ge=v(799),te=v(118),pe=v(6555),ie="[object Arguments]",be="[object Function]",Ut="[object Object]",ut={};ut[ie]=ut["[object Array]"]=ut["[object ArrayBuffer]"]=ut["[object DataView]"]=ut["[object Boolean]"]=ut["[object Date]"]=ut["[object Float32Array]"]=ut["[object Float64Array]"]=ut["[object Int8Array]"]=ut["[object Int16Array]"]=ut["[object Int32Array]"]=ut["[object Map]"]=ut["[object Number]"]=ut[Ut]=ut["[object RegExp]"]=ut["[object Set]"]=ut["[object String]"]=ut["[object Symbol]"]=ut["[object Uint8Array]"]=ut["[object Uint8ClampedArray]"]=ut["[object Uint16Array]"]=ut["[object Uint32Array]"]=!0,ut["[object Error]"]=ut[be]=ut["[object WeakMap]"]=!1,H.exports=function $t(st,Nn,fn,lr,xr,Ln){var Rt,nr=1&Nn,Kn=2&Nn,Ci=4&Nn;if(fn&&(Rt=xr?fn(st,lr,xr,Ln):fn(st)),void 0!==Rt)return Rt;if(!se(st))return st;var hr=Ie(st);if(hr){if(Rt=ce(st),!nr)return z(st,Rt)}else{var Gn=ae(st),Pr=Gn==be||"[object GeneratorFunction]"==Gn;if(Me(st))return k(st,nr);if(Gn==Ut||Gn==ie||Pr&&!xr){if(Rt=Kn||Pr?{}:Te(st),!nr)return Kn?K(st,E(Rt,st)):S(st,l(Rt,st))}else{if(!ut[Gn])return xr?st:{};Rt=V(st,Gn,nr)}}Ln||(Ln=new R);var Nr=Ln.get(st);if(Nr)return Nr;Ln.set(st,Rt),ge(st)?st.forEach(function(Hn){Rt.add($t(Hn,Nn,fn,Hn,st,Ln))}):Be(st)&&st.forEach(function(Hn,bt){Rt.set(bt,$t(Hn,Nn,fn,bt,st,Ln))});var Qr=hr?void 0:(Ci?Kn?ne:X:Kn?pe:te)(st);return B(Qr||st,function(Hn,bt){Qr&&(Hn=st[bt=Hn]),M(Rt,bt,$t(Hn,Nn,fn,bt,st,Ln))}),Rt}},8858:(H,q,v)=>{var R=v(5940),B=Object.create,M=function(){function l(){}return function(E){if(!R(E))return{};if(B)return B(E);l.prototype=E;var k=new l;return l.prototype=void 0,k}}();H.exports=M},755:(H,q,v)=>{var B=v(456)();H.exports=B},8247:(H,q,v)=>{var R=v(5059),B=v(1503);H.exports=function M(l,E,k){var z=E(l);return B(l)?z:R(z,k(l))}},3337:(H,q,v)=>{var R=v(443),B=v(1318),M=v(2902),k=R?R.toStringTag:void 0;H.exports=function z(S){return null==S?void 0===S?"[object Undefined]":"[object Null]":k&&k in Object(S)?B(S):M(S)}},186:(H,q,v)=>{var R=v(3337),B=v(2671);H.exports=function l(E){return B(E)&&"[object Arguments]"==R(E)}},7021:(H,q,v)=>{var R=v(8794),B=v(2671);H.exports=function l(E){return B(E)&&"[object Map]"==R(E)}},7304:(H,q,v)=>{var R=v(5946),B=v(1943),M=v(5940),l=v(2827),k=/^\[object .+?Constructor\]$/,ne=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");H.exports=function ae(ce){return!(!M(ce)||B(ce))&&(R(ce)?ne:k).test(l(ce))}},771:(H,q,v)=>{var R=v(8794),B=v(2671);H.exports=function l(E){return B(E)&&"[object Set]"==R(E)}},1083:(H,q,v)=>{var R=v(3337),B=v(6231),M=v(2671),we={};we["[object Float32Array]"]=we["[object Float64Array]"]=we["[object Int8Array]"]=we["[object Int16Array]"]=we["[object Int32Array]"]=we["[object Uint8Array]"]=we["[object Uint8ClampedArray]"]=we["[object Uint16Array]"]=we["[object Uint32Array]"]=!0,we["[object Arguments]"]=we["[object Array]"]=we["[object ArrayBuffer]"]=we["[object Boolean]"]=we["[object DataView]"]=we["[object Date]"]=we["[object Error]"]=we["[object Function]"]=we["[object Map]"]=we["[object Number]"]=we["[object Object]"]=we["[object RegExp]"]=we["[object Set]"]=we["[object String]"]=we["[object WeakMap]"]=!1,H.exports=function de(ve){return M(ve)&&B(ve.length)&&!!we[R(ve)]}},1172:(H,q,v)=>{var R=v(5488),B=v(5491),l=Object.prototype.hasOwnProperty;H.exports=function E(k){if(!R(k))return B(k);var z=[];for(var S in Object(k))l.call(k,S)&&"constructor"!=S&&z.push(S);return z}},2809:(H,q,v)=>{var R=v(5940),B=v(5488),M=v(2158),E=Object.prototype.hasOwnProperty;H.exports=function k(z){if(!R(z))return M(z);var S=B(z),K=[];for(var X in z)"constructor"==X&&(S||!E.call(z,X))||K.push(X);return K}},7316:(H,q,v)=>{var R=v(4763),B=v(9276),M=v(755),l=v(3675),E=v(5940),k=v(6555),z=v(9351);H.exports=function S(K,X,ne,ae,ce){K!==X&&M(X,function(V,Te){if(ce||(ce=new R),E(V))l(K,X,Te,ne,S,ae,ce);else{var Ie=ae?ae(z(K,Te),V,Te+"",K,X,ce):void 0;void 0===Ie&&(Ie=V),B(K,Te,Ie)}},k)}},3675:(H,q,v)=>{var R=v(9276),B=v(9292),M=v(5208),l=v(9454),E=v(4264),k=v(7151),z=v(1503),S=v(1330),K=v(891),X=v(5946),ne=v(5940),ae=v(7614),ce=v(8159),V=v(9351),Te=v(8067);H.exports=function Ie(Me,Be,se,ge,te,pe,Ae){var ue=V(Me,se),he=V(Be,se),ie=Ae.get(he);if(ie)R(Me,se,ie);else{var Pe=pe?pe(ue,he,se+"",Me,Be,Ae):void 0,we=void 0===Pe;if(we){var de=z(he),ve=!de&&K(he),be=!de&&!ve&&ce(he);Pe=he,de||ve||be?z(ue)?Pe=ue:S(ue)?Pe=l(ue):ve?(we=!1,Pe=B(he,!0)):be?(we=!1,Pe=M(he,!0)):Pe=[]:ae(he)||k(he)?(Pe=ue,k(ue)?Pe=Te(ue):(!ne(ue)||X(ue))&&(Pe=E(he))):we=!1}we&&(Ae.set(he,Pe),te(Pe,he,ge,pe,Ae),Ae.delete(he)),R(Me,se,Pe)}}},6652:(H,q,v)=>{var R=v(2608),B=v(3983),M=v(2185);H.exports=function l(E,k){return M(B(E,k,R),E+"")}},9510:(H,q,v)=>{var R=v(6684),B=v(6713),M=v(2608);H.exports=B?function(E,k){return B(E,"toString",{configurable:!0,enumerable:!1,value:R(k),writable:!0})}:M},5334:H=>{H.exports=function q(v,R){for(var B=-1,M=Array(v);++B<v;)M[B]=R(B);return M}},5647:H=>{H.exports=function q(v){return function(R){return v(R)}}},3362:(H,q,v)=>{var R=v(3457);H.exports=function B(M){var l=new M.constructor(M.byteLength);return new R(l).set(new R(M)),l}},9292:(H,q,v)=>{H=v.nmd(H);var R=v(2119),B=q&&!q.nodeType&&q,M=B&&H&&!H.nodeType&&H,E=M&&M.exports===B?R.Buffer:void 0,k=E?E.allocUnsafe:void 0;H.exports=function z(S,K){if(K)return S.slice();var X=S.length,ne=k?k(X):new S.constructor(X);return S.copy(ne),ne}},7e3:(H,q,v)=>{var R=v(3362);H.exports=function B(M,l){var E=l?R(M.buffer):M.buffer;return new M.constructor(E,M.byteOffset,M.byteLength)}},4098:H=>{var q=/\w*$/;H.exports=function v(R){var B=new R.constructor(R.source,q.exec(R));return B.lastIndex=R.lastIndex,B}},2533:(H,q,v)=>{var R=v(443),B=R?R.prototype:void 0,M=B?B.valueOf:void 0;H.exports=function l(E){return M?Object(M.call(E)):{}}},5208:(H,q,v)=>{var R=v(3362);H.exports=function B(M,l){var E=l?R(M.buffer):M.buffer;return new M.constructor(E,M.byteOffset,M.length)}},9454:H=>{H.exports=function q(v,R){var B=-1,M=v.length;for(R||(R=Array(M));++B<M;)R[B]=v[B];return R}},1989:(H,q,v)=>{var R=v(9719),B=v(5683);H.exports=function M(l,E,k,z){var S=!k;k||(k={});for(var K=-1,X=E.length;++K<X;){var ne=E[K],ae=z?z(k[ne],l[ne],ne,k,l):void 0;void 0===ae&&(ae=l[ne]),S?B(k,ne,ae):R(k,ne,ae)}return k}},4444:(H,q,v)=>{var R=v(1989),B=v(9383);H.exports=function M(l,E){return R(l,B(l),E)}},9905:(H,q,v)=>{var R=v(1989),B=v(3051);H.exports=function M(l,E){return R(l,B(l),E)}},4610:(H,q,v)=>{var R=v(2119);H.exports=R["__core-js_shared__"]},4944:(H,q,v)=>{var R=v(6652),B=v(3342);H.exports=function M(l){return R(function(E,k){var z=-1,S=k.length,K=S>1?k[S-1]:void 0,X=S>2?k[2]:void 0;for(K=l.length>3&&"function"==typeof K?(S--,K):void 0,X&&B(k[0],k[1],X)&&(K=S<3?void 0:K,S=1),E=Object(E);++z<S;){var ne=k[z];ne&&l(E,ne,z,K)}return E})}},456:H=>{H.exports=function q(v){return function(R,B,M){for(var l=-1,E=Object(R),k=M(R),z=k.length;z--;){var S=k[v?z:++l];if(!1===B(E[S],S,E))break}return R}}},6713:(H,q,v)=>{var R=v(3436),B=function(){try{var M=R(Object,"defineProperty");return M({},"",{}),M}catch{}}();H.exports=B},9122:H=>{var q="object"==typeof global&&global&&global.Object===Object&&global;H.exports=q},7597:(H,q,v)=>{var R=v(8247),B=v(9383),M=v(118);H.exports=function l(E){return R(E,M,B)}},6967:(H,q,v)=>{var R=v(8247),B=v(3051),M=v(6555);H.exports=function l(E){return R(E,M,B)}},4537:(H,q,v)=>{var R=v(3819);H.exports=function B(M,l){var E=M.__data__;return R(l)?E["string"==typeof l?"string":"hash"]:E.map}},3436:(H,q,v)=>{var R=v(7304),B=v(1990);H.exports=function M(l,E){var k=B(l,E);return R(k)?k:void 0}},9519:(H,q,v)=>{var B=v(9385)(Object.getPrototypeOf,Object);H.exports=B},1318:(H,q,v)=>{var R=v(443),B=Object.prototype,M=B.hasOwnProperty,l=B.toString,E=R?R.toStringTag:void 0;H.exports=function k(z){var S=M.call(z,E),K=z[E];try{z[E]=void 0;var X=!0}catch{}var ne=l.call(z);return X&&(S?z[E]=K:delete z[E]),ne}},9383:(H,q,v)=>{var R=v(9779),B=v(9975),l=Object.prototype.propertyIsEnumerable,E=Object.getOwnPropertySymbols;H.exports=E?function(z){return null==z?[]:(z=Object(z),R(E(z),function(S){return l.call(z,S)}))}:B},3051:(H,q,v)=>{var R=v(5059),B=v(9519),M=v(9383),l=v(9975);H.exports=Object.getOwnPropertySymbols?function(z){for(var S=[];z;)R(S,M(z)),z=B(z);return S}:l},8794:(H,q,v)=>{var R=v(7244),B=v(1501),M=v(4267),l=v(6323),E=v(4243),k=v(3337),z=v(2827),S="[object Map]",X="[object Promise]",ne="[object Set]",ae="[object WeakMap]",ce="[object DataView]",V=z(R),Te=z(B),Ie=z(M),Me=z(l),Be=z(E),se=k;(R&&se(new R(new ArrayBuffer(1)))!=ce||B&&se(new B)!=S||M&&se(M.resolve())!=X||l&&se(new l)!=ne||E&&se(new E)!=ae)&&(se=function(ge){var te=k(ge),pe="[object Object]"==te?ge.constructor:void 0,Ae=pe?z(pe):"";if(Ae)switch(Ae){case V:return ce;case Te:return S;case Ie:return X;case Me:return ne;case Be:return ae}return te}),H.exports=se},1990:H=>{H.exports=function q(v,R){return v?.[R]}},4312:(H,q,v)=>{var R=v(862);H.exports=function B(){this.__data__=R?R(null):{},this.size=0}},6421:H=>{H.exports=function q(v){var R=this.has(v)&&delete this.__data__[v];return this.size-=R?1:0,R}},5764:(H,q,v)=>{var R=v(862),l=Object.prototype.hasOwnProperty;H.exports=function E(k){var z=this.__data__;if(R){var S=z[k];return"__lodash_hash_undefined__"===S?void 0:S}return l.call(z,k)?z[k]:void 0}},8685:(H,q,v)=>{var R=v(862),M=Object.prototype.hasOwnProperty;H.exports=function l(E){var k=this.__data__;return R?void 0!==k[E]:M.call(k,E)}},6676:(H,q,v)=>{var R=v(862);H.exports=function M(l,E){var k=this.__data__;return this.size+=this.has(l)?0:1,k[l]=R&&void 0===E?"__lodash_hash_undefined__":E,this}},6782:H=>{var v=Object.prototype.hasOwnProperty;H.exports=function R(B){var M=B.length,l=new B.constructor(M);return M&&"string"==typeof B[0]&&v.call(B,"index")&&(l.index=B.index,l.input=B.input),l}},7878:(H,q,v)=>{var R=v(3362),B=v(7e3),M=v(4098),l=v(2533),E=v(5208);H.exports=function he(ie,Pe,we){var de=ie.constructor;switch(Pe){case"[object ArrayBuffer]":return R(ie);case"[object Boolean]":case"[object Date]":return new de(+ie);case"[object DataView]":return B(ie,we);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return E(ie,we);case"[object Map]":case"[object Set]":return new de;case"[object Number]":case"[object String]":return new de(ie);case"[object RegExp]":return M(ie);case"[object Symbol]":return l(ie)}}},4264:(H,q,v)=>{var R=v(8858),B=v(9519),M=v(5488);H.exports=function l(E){return"function"!=typeof E.constructor||M(E)?{}:R(B(E))}},8442:H=>{var v=/^(?:0|[1-9]\d*)$/;H.exports=function R(B,M){var l=typeof B;return!!(M=M??9007199254740991)&&("number"==l||"symbol"!=l&&v.test(B))&&B>-1&&B%1==0&&B<M}},3342:(H,q,v)=>{var R=v(217),B=v(6507),M=v(8442),l=v(5940);H.exports=function E(k,z,S){if(!l(S))return!1;var K=typeof z;return!!("number"==K?B(S)&&M(z,S.length):"string"==K&&z in S)&&R(S[z],k)}},3819:H=>{H.exports=function q(v){var R=typeof v;return"string"==R||"number"==R||"symbol"==R||"boolean"==R?"__proto__"!==v:null===v}},1943:(H,q,v)=>{var l,R=v(4610),B=(l=/[^.]+$/.exec(R&&R.keys&&R.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"";H.exports=function M(l){return!!B&&B in l}},5488:H=>{var q=Object.prototype;H.exports=function v(R){var B=R&&R.constructor;return R===("function"==typeof B&&B.prototype||q)}},1840:H=>{H.exports=function q(){this.__data__=[],this.size=0}},4378:(H,q,v)=>{var R=v(3503),M=Array.prototype.splice;H.exports=function l(E){var k=this.__data__,z=R(k,E);return!(z<0||(z==k.length-1?k.pop():M.call(k,z,1),--this.size,0))}},4981:(H,q,v)=>{var R=v(3503);H.exports=function B(M){var l=this.__data__,E=R(l,M);return E<0?void 0:l[E][1]}},7343:(H,q,v)=>{var R=v(3503);H.exports=function B(M){return R(this.__data__,M)>-1}},8895:(H,q,v)=>{var R=v(3503);H.exports=function B(M,l){var E=this.__data__,k=R(E,M);return k<0?(++this.size,E.push([M,l])):E[k][1]=l,this}},638:(H,q,v)=>{var R=v(4994),B=v(9215),M=v(1501);H.exports=function l(){this.size=0,this.__data__={hash:new R,map:new(M||B),string:new R}}},1184:(H,q,v)=>{var R=v(4537);H.exports=function B(M){var l=R(this,M).delete(M);return this.size-=l?1:0,l}},866:(H,q,v)=>{var R=v(4537);H.exports=function B(M){return R(this,M).get(M)}},3771:(H,q,v)=>{var R=v(4537);H.exports=function B(M){return R(this,M).has(M)}},1772:(H,q,v)=>{var R=v(4537);H.exports=function B(M,l){var E=R(this,M),k=E.size;return E.set(M,l),this.size+=E.size==k?0:1,this}},862:(H,q,v)=>{var B=v(3436)(Object,"create");H.exports=B},5491:(H,q,v)=>{var B=v(9385)(Object.keys,Object);H.exports=B},2158:H=>{H.exports=function q(v){var R=[];if(null!=v)for(var B in Object(v))R.push(B);return R}},3597:(H,q,v)=>{H=v.nmd(H);var R=v(9122),B=q&&!q.nodeType&&q,M=B&&H&&!H.nodeType&&H,E=M&&M.exports===B&&R.process,k=function(){try{return M&&M.require&&M.require("util").types||E&&E.binding&&E.binding("util")}catch{}}();H.exports=k},2902:H=>{var v=Object.prototype.toString;H.exports=function R(B){return v.call(B)}},9385:H=>{H.exports=function q(v,R){return function(B){return v(R(B))}}},3983:(H,q,v)=>{var R=v(6999),B=Math.max;H.exports=function M(l,E,k){return E=B(void 0===E?l.length-1:E,0),function(){for(var z=arguments,S=-1,K=B(z.length-E,0),X=Array(K);++S<K;)X[S]=z[E+S];S=-1;for(var ne=Array(E+1);++S<E;)ne[S]=z[S];return ne[E]=k(X),R(l,this,ne)}}},2119:(H,q,v)=>{var R=v(9122),B="object"==typeof self&&self&&self.Object===Object&&self,M=R||B||Function("return this")();H.exports=M},9351:H=>{H.exports=function q(v,R){if(("constructor"!==R||"function"!=typeof v[R])&&"__proto__"!=R)return v[R]}},2185:(H,q,v)=>{var R=v(9510),M=v(29)(R);H.exports=M},29:H=>{var q=800,v=16,R=Date.now;H.exports=function B(M){var l=0,E=0;return function(){var k=R(),z=v-(k-E);if(E=k,z>0){if(++l>=q)return arguments[0]}else l=0;return M.apply(void 0,arguments)}}},3720:(H,q,v)=>{var R=v(9215);H.exports=function B(){this.__data__=new R,this.size=0}},4410:H=>{H.exports=function q(v){var R=this.__data__,B=R.delete(v);return this.size=R.size,B}},5576:H=>{H.exports=function q(v){return this.__data__.get(v)}},2247:H=>{H.exports=function q(v){return this.__data__.has(v)}},1585:(H,q,v)=>{var R=v(9215),B=v(1501),M=v(9850);H.exports=function E(k,z){var S=this.__data__;if(S instanceof R){var K=S.__data__;if(!B||K.length<199)return K.push([k,z]),this.size=++S.size,this;S=this.__data__=new M(K)}return S.set(k,z),this.size=S.size,this}},2827:H=>{var v=Function.prototype.toString;H.exports=function R(B){if(null!=B){try{return v.call(B)}catch{}try{return B+""}catch{}}return""}},733:(H,q,v)=>{var R=v(4462);H.exports=function l(E){return R(E,5)}},6684:H=>{H.exports=function q(v){return function(){return v}}},217:H=>{H.exports=function q(v,R){return v===R||v!=v&&R!=R}},2608:H=>{H.exports=function q(v){return v}},7151:(H,q,v)=>{var R=v(186),B=v(2671),M=Object.prototype,l=M.hasOwnProperty,E=M.propertyIsEnumerable,k=R(function(){return arguments}())?R:function(z){return B(z)&&l.call(z,"callee")&&!E.call(z,"callee")};H.exports=k},1503:H=>{H.exports=Array.isArray},6507:(H,q,v)=>{var R=v(5946),B=v(6231);H.exports=function M(l){return null!=l&&B(l.length)&&!R(l)}},1330:(H,q,v)=>{var R=v(6507),B=v(2671);H.exports=function M(l){return B(l)&&R(l)}},891:(H,q,v)=>{H=v.nmd(H);var R=v(2119),B=v(3580),M=q&&!q.nodeType&&q,l=M&&H&&!H.nodeType&&H,k=l&&l.exports===M?R.Buffer:void 0;H.exports=(k?k.isBuffer:void 0)||B},5946:(H,q,v)=>{var R=v(3337),B=v(5940);H.exports=function z(S){if(!B(S))return!1;var K=R(S);return"[object Function]"==K||"[object GeneratorFunction]"==K||"[object AsyncFunction]"==K||"[object Proxy]"==K}},6231:H=>{H.exports=function v(R){return"number"==typeof R&&R>-1&&R%1==0&&R<=9007199254740991}},3222:(H,q,v)=>{var R=v(7021),B=v(5647),M=v(3597),l=M&&M.isMap,E=l?B(l):R;H.exports=E},5940:H=>{H.exports=function q(v){var R=typeof v;return null!=v&&("object"==R||"function"==R)}},2671:H=>{H.exports=function q(v){return null!=v&&"object"==typeof v}},7614:(H,q,v)=>{var R=v(3337),B=v(9519),M=v(2671),z=Function.prototype.toString,S=Object.prototype.hasOwnProperty,K=z.call(Object);H.exports=function X(ne){if(!M(ne)||"[object Object]"!=R(ne))return!1;var ae=B(ne);if(null===ae)return!0;var ce=S.call(ae,"constructor")&&ae.constructor;return"function"==typeof ce&&ce instanceof ce&&z.call(ce)==K}},799:(H,q,v)=>{var R=v(771),B=v(5647),M=v(3597),l=M&&M.isSet,E=l?B(l):R;H.exports=E},8159:(H,q,v)=>{var R=v(1083),B=v(5647),M=v(3597),l=M&&M.isTypedArray,E=l?B(l):R;H.exports=E},118:(H,q,v)=>{var R=v(2271),B=v(1172),M=v(6507);H.exports=function l(E){return M(E)?R(E):B(E)}},6555:(H,q,v)=>{var R=v(2271),B=v(2809),M=v(6507);H.exports=function l(E){return M(E)?R(E,!0):B(E)}},567:(H,q,v)=>{var R=v(7316),M=v(4944)(function(l,E,k){R(l,E,k)});H.exports=M},9975:H=>{H.exports=function q(){return[]}},3580:H=>{H.exports=function q(){return!1}},8067:(H,q,v)=>{var R=v(1989),B=v(6555);H.exports=function M(l){return R(l,B(l))}},4366:H=>{var q=1e3,v=60*q,R=60*v,B=24*R;function S(K,X,ne,ae){var ce=X>=1.5*ne;return Math.round(K/ne)+" "+ae+(ce?"s":"")}H.exports=function(K,X){X=X||{};var ne=typeof K;if("string"===ne&&K.length>0)return function E(K){if(!((K=String(K)).length>100)){var X=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(K);if(X){var ne=parseFloat(X[1]);switch((X[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*ne;case"weeks":case"week":case"w":return 6048e5*ne;case"days":case"day":case"d":return ne*B;case"hours":case"hour":case"hrs":case"hr":case"h":return ne*R;case"minutes":case"minute":case"mins":case"min":case"m":return ne*v;case"seconds":case"second":case"secs":case"sec":case"s":return ne*q;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return ne;default:return}}}}(K);if("number"===ne&&isFinite(K))return X.long?function z(K){var X=Math.abs(K);return X>=B?S(K,X,B,"day"):X>=R?S(K,X,R,"hour"):X>=v?S(K,X,v,"minute"):X>=q?S(K,X,q,"second"):K+" ms"}(K):function k(K){var X=Math.abs(K);return X>=B?Math.round(K/B)+"d":X>=R?Math.round(K/R)+"h":X>=v?Math.round(K/v)+"m":X>=q?Math.round(K/q)+"s":K+"ms"}(K);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(K))}},3928:H=>{"use strict";function q(M){if("string"!=typeof M)throw new TypeError("Path must be a string. Received "+JSON.stringify(M))}function v(M,l){for(var K,E="",k=0,z=-1,S=0,X=0;X<=M.length;++X){if(X<M.length)K=M.charCodeAt(X);else{if(47===K)break;K=47}if(47===K){if(z!==X-1&&1!==S)if(z!==X-1&&2===S){if(E.length<2||2!==k||46!==E.charCodeAt(E.length-1)||46!==E.charCodeAt(E.length-2))if(E.length>2){var ne=E.lastIndexOf("/");if(ne!==E.length-1){-1===ne?(E="",k=0):k=(E=E.slice(0,ne)).length-1-E.lastIndexOf("/"),z=X,S=0;continue}}else if(2===E.length||1===E.length){E="",k=0,z=X,S=0;continue}l&&(E.length>0?E+="/..":E="..",k=2)}else E.length>0?E+="/"+M.slice(z+1,X):E=M.slice(z+1,X),k=X-z-1;z=X,S=0}else 46===K&&-1!==S?++S:S=-1}return E}var B={resolve:function(){for(var k,l="",E=!1,z=arguments.length-1;z>=-1&&!E;z--){var S;z>=0?S=arguments[z]:(void 0===k&&(k=process.cwd()),S=k),q(S),0!==S.length&&(l=S+"/"+l,E=47===S.charCodeAt(0))}return l=v(l,!E),E?l.length>0?"/"+l:"/":l.length>0?l:"."},normalize:function(l){if(q(l),0===l.length)return".";var E=47===l.charCodeAt(0),k=47===l.charCodeAt(l.length-1);return 0===(l=v(l,!E)).length&&!E&&(l="."),l.length>0&&k&&(l+="/"),E?"/"+l:l},isAbsolute:function(l){return q(l),l.length>0&&47===l.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var l,E=0;E<arguments.length;++E){var k=arguments[E];q(k),k.length>0&&(void 0===l?l=k:l+="/"+k)}return void 0===l?".":B.normalize(l)},relative:function(l,E){if(q(l),q(E),l===E||(l=B.resolve(l))===(E=B.resolve(E)))return"";for(var k=1;k<l.length&&47===l.charCodeAt(k);++k);for(var z=l.length,S=z-k,K=1;K<E.length&&47===E.charCodeAt(K);++K);for(var ne=E.length-K,ae=S<ne?S:ne,ce=-1,V=0;V<=ae;++V){if(V===ae){if(ne>ae){if(47===E.charCodeAt(K+V))return E.slice(K+V+1);if(0===V)return E.slice(K+V)}else S>ae&&(47===l.charCodeAt(k+V)?ce=V:0===V&&(ce=0));break}var Te=l.charCodeAt(k+V);if(Te!==E.charCodeAt(K+V))break;47===Te&&(ce=V)}var Me="";for(V=k+ce+1;V<=z;++V)(V===z||47===l.charCodeAt(V))&&(Me+=0===Me.length?"..":"/..");return Me.length>0?Me+E.slice(K+ce):(47===E.charCodeAt(K+=ce)&&++K,E.slice(K))},_makeLong:function(l){return l},dirname:function(l){if(q(l),0===l.length)return".";for(var E=l.charCodeAt(0),k=47===E,z=-1,S=!0,K=l.length-1;K>=1;--K)if(47===(E=l.charCodeAt(K))){if(!S){z=K;break}}else S=!1;return-1===z?k?"/":".":k&&1===z?"//":l.slice(0,z)},basename:function(l,E){if(void 0!==E&&"string"!=typeof E)throw new TypeError('"ext" argument must be a string');q(l);var K,k=0,z=-1,S=!0;if(void 0!==E&&E.length>0&&E.length<=l.length){if(E.length===l.length&&E===l)return"";var X=E.length-1,ne=-1;for(K=l.length-1;K>=0;--K){var ae=l.charCodeAt(K);if(47===ae){if(!S){k=K+1;break}}else-1===ne&&(S=!1,ne=K+1),X>=0&&(ae===E.charCodeAt(X)?-1==--X&&(z=K):(X=-1,z=ne))}return k===z?z=ne:-1===z&&(z=l.length),l.slice(k,z)}for(K=l.length-1;K>=0;--K)if(47===l.charCodeAt(K)){if(!S){k=K+1;break}}else-1===z&&(S=!1,z=K+1);return-1===z?"":l.slice(k,z)},extname:function(l){q(l);for(var E=-1,k=0,z=-1,S=!0,K=0,X=l.length-1;X>=0;--X){var ne=l.charCodeAt(X);if(47!==ne)-1===z&&(S=!1,z=X+1),46===ne?-1===E?E=X:1!==K&&(K=1):-1!==E&&(K=-1);else if(!S){k=X+1;break}}return-1===E||-1===z||0===K||1===K&&E===z-1&&E===k+1?"":l.slice(E,z)},format:function(l){if(null===l||"object"!=typeof l)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof l);return function R(M,l){var E=l.dir||l.root,k=l.base||(l.name||"")+(l.ext||"");return E?E===l.root?E+k:E+M+k:k}("/",l)},parse:function(l){q(l);var E={root:"",dir:"",base:"",ext:"",name:""};if(0===l.length)return E;var S,k=l.charCodeAt(0),z=47===k;z?(E.root="/",S=1):S=0;for(var K=-1,X=0,ne=-1,ae=!0,ce=l.length-1,V=0;ce>=S;--ce)if(47!==(k=l.charCodeAt(ce)))-1===ne&&(ae=!1,ne=ce+1),46===k?-1===K?K=ce:1!==V&&(V=1):-1!==K&&(V=-1);else if(!ae){X=ce+1;break}return-1===K||-1===ne||0===V||1===V&&K===ne-1&&K===X+1?-1!==ne&&(E.base=E.name=l.slice(0===X&&z?1:X,ne)):(0===X&&z?(E.name=l.slice(1,K),E.base=l.slice(1,ne)):(E.name=l.slice(X,K),E.base=l.slice(X,ne)),E.ext=l.slice(K,ne)),X>0?E.dir=l.slice(0,X-1):z&&(E.dir="/"),E},sep:"/",delimiter:":",win32:null,posix:null};B.posix=B,H.exports=B},516:H=>{"use strict";function q(v,R){return Object.prototype.hasOwnProperty.call(v,R)}H.exports=function(v,R,B,M){B=B||"=";var l={};if("string"!=typeof v||0===v.length)return l;var E=/\+/g;v=v.split(R=R||"&");var k=1e3;M&&"number"==typeof M.maxKeys&&(k=M.maxKeys);var z=v.length;k>0&&z>k&&(z=k);for(var S=0;S<z;++S){var ne,ae,ce,V,K=v[S].replace(E,"%20"),X=K.indexOf(B);X>=0?(ne=K.substr(0,X),ae=K.substr(X+1)):(ne=K,ae=""),ce=decodeURIComponent(ne),V=decodeURIComponent(ae),q(l,ce)?Array.isArray(l[ce])?l[ce].push(V):l[ce]=[l[ce],V]:l[ce]=V}return l}},5776:H=>{"use strict";var q=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};H.exports=function(v,R,B,M){return R=R||"&",B=B||"=",null===v&&(v=void 0),"object"==typeof v?Object.keys(v).map(function(l){var E=encodeURIComponent(q(l))+B;return Array.isArray(v[l])?v[l].map(function(k){return E+encodeURIComponent(q(k))}).join(R):E+encodeURIComponent(q(v[l]))}).filter(Boolean).join(R):M?encodeURIComponent(q(M))+B+encodeURIComponent(q(v)):""}},7137:(H,q,v)=>{"use strict";v(516),q.stringify=v(5776)},2858:(H,q)=>{"use strict";var v=Object.prototype.hasOwnProperty;function B(k){try{return decodeURIComponent(k.replace(/\+/g," "))}catch{return null}}function M(k){try{return encodeURIComponent(k)}catch{return null}}q.stringify=function E(k,z){z=z||"";var K,X,S=[];for(X in"string"!=typeof z&&(z="?"),k)if(v.call(k,X)){if(!(K=k[X])&&(null==K||isNaN(K))&&(K=""),X=M(X),K=M(K),null===X||null===K)continue;S.push(X+"="+K)}return S.length?z+S.join("&"):""},q.parse=function l(k){for(var K,z=/([^=?#&]+)=?([^&]*)/g,S={};K=z.exec(k);){var X=B(K[1]),ne=B(K[2]);null===X||null===ne||X in S||(S[X]=ne)}return S}},8237:H=>{"use strict";H.exports=function(v,R){if(R=R.split(":")[0],!(v=+v))return!1;switch(R){case"http":case"ws":return 80!==v;case"https":case"wss":return 443!==v;case"ftp":return 21!==v;case"gopher":return 70!==v;case"file":return!1}return 0!==v}},2648:H=>{var v=["Black","White","Gray","Brown","Red","Pink","Crimson","Carnelian","Orange","Yellow","Ivory","Cream","Green","Viridian","Aquamarine","Cyan","Blue","Cerulean","Azure","Indigo","Navy","Violet","Purple","Lavender","Magenta","Rainbow","Iridescent","Spectrum","Prism","Bold","Vivid","Pale","Clear","Glass","Translucent","Misty","Dark","Light","Gold","Silver","Copper","Bronze","Steel","Iron","Brass","Mercury","Zinc","Chrome","Platinum","Titanium","Nickel","Lead","Pewter","Rust","Metal","Stone","Quartz","Granite","Marble","Alabaster","Agate","Jasper","Pebble","Pyrite","Crystal","Geode","Obsidian","Mica","Flint","Sand","Gravel","Boulder","Basalt","Ruby","Beryl","Scarlet","Citrine","Sulpher","Topaz","Amber","Emerald","Malachite","Jade","Abalone","Lapis","Sapphire","Diamond","Peridot","Gem","Jewel","Bevel","Coral","Jet","Ebony","Wood","Tree","Cherry","Maple","Cedar","Branch","Bramble","Rowan","Ash","Fir","Pine","Cactus","Alder","Grove","Forest","Jungle","Palm","Bush","Mulberry","Juniper","Vine","Ivy","Rose","Lily","Tulip","Daffodil","Honeysuckle","Fuschia","Hazel","Walnut","Almond","Lime","Lemon","Apple","Blossom","Bloom","Crocus","Rose","Buttercup","Dandelion","Iris","Carnation","Fern","Root","Branch","Leaf","Seed","Flower","Petal","Pollen","Orchid","Mangrove","Cypress","Sequoia","Sage","Heather","Snapdragon","Daisy","Mountain","Hill","Alpine","Chestnut","Valley","Glacier","Forest","Grove","Glen","Tree","Thorn","Stump","Desert","Canyon","Dune","Oasis","Mirage","Well","Spring","Meadow","Field","Prairie","Grass","Tundra","Island","Shore","Sand","Shell","Surf","Wave","Foam","Tide","Lake","River","Brook","Stream","Pool","Pond","Sun","Sprinkle","Shade","Shadow","Rain","Cloud","Storm","Hail","Snow","Sleet","Thunder","Lightning","Wind","Hurricane","Typhoon","Dawn","Sunrise","Morning","Noon","Twilight","Evening","Sunset","Midnight","Night","Sky","Star","Stellar","Comet","Nebula","Quasar","Solar","Lunar","Planet","Meteor","Sprout","Pear","Plum","Kiwi","Berry","Apricot","Peach","Mango","Pineapple","Coconut","Olive","Ginger","Root","Plain","Fancy","Stripe","Spot","Speckle","Spangle","Ring","Band","Blaze","Paint","Pinto","Shade","Tabby","Brindle","Patch","Calico","Checker","Dot","Pattern","Glitter","Glimmer","Shimmer","Dull","Dust","Dirt","Glaze","Scratch","Quick","Swift","Fast","Slow","Clever","Fire","Flicker","Flash","Spark","Ember","Coal","Flame","Chocolate","Vanilla","Sugar","Spice","Cake","Pie","Cookie","Candy","Caramel","Spiral","Round","Jelly","Square","Narrow","Long","Short","Small","Tiny","Big","Giant","Great","Atom","Peppermint","Mint","Butter","Fringe","Rag","Quilt","Truth","Lie","Holy","Curse","Noble","Sly","Brave","Shy","Lava","Foul","Leather","Fantasy","Keen","Luminous","Feather","Sticky","Gossamer","Cotton","Rattle","Silk","Satin","Cord","Denim","Flannel","Plaid","Wool","Linen","Silent","Flax","Weak","Valiant","Fierce","Gentle","Rhinestone","Splash","North","South","East","West","Summer","Winter","Autumn","Spring","Season","Equinox","Solstice","Paper","Motley","Torch","Ballistic","Rampant","Shag","Freckle","Wild","Free","Chain","Sheer","Crazy","Mad","Candle","Ribbon","Lace","Notch","Wax","Shine","Shallow","Deep","Bubble","Harvest","Fluff","Venom","Boom","Slash","Rune","Cold","Quill","Love","Hate","Garnet","Zircon","Power","Bone","Void","Horn","Glory","Cyber","Nova","Hot","Helix","Cosmic","Quark","Quiver","Holly","Clover","Polar","Regal","Ripple","Ebony","Wheat","Phantom","Dew","Chisel","Crack","Chatter","Laser","Foil","Tin","Clever","Treasure","Maze","Twisty","Curly","Fortune","Fate","Destiny","Cute","Slime","Ink","Disco","Plume","Time","Psychadelic","Relic","Fossil","Water","Savage","Ancient","Rapid","Road","Trail","Stitch","Button","Bow","Nimble","Zest","Sour","Bitter","Phase","Fan","Frill","Plump","Pickle","Mud","Puddle","Pond","River","Spring","Stream","Battle","Arrow","Plume","Roan","Pitch","Tar","Cat","Dog","Horse","Lizard","Bird","Fish","Saber","Scythe","Sharp","Soft","Razor","Neon","Dandy","Weed","Swamp","Marsh","Bog","Peat","Moor","Muck","Mire","Grave","Fair","Just","Brick","Puzzle","Skitter","Prong","Fork","Dent","Dour","Warp","Luck","Coffee","Split","Chip","Hollow","Heavy","Legend","Hickory","Mesquite","Nettle","Rogue","Charm","Prickle","Bead","Sponge","Whip","Bald","Frost","Fog","Oil","Veil","Cliff","Volcano","Rift","Maze","Proud","Dew","Mirror","Shard","Salt","Pepper","Honey","Thread","Bristle","Ripple","Glow","Zenith"],R=["head","crest","crown","tooth","fang","horn","frill","skull","bone","tongue","throat","voice","nose","snout","chin","eye","sight","seer","speaker","singer","song","chanter","howler","chatter","shrieker","shriek","jaw","bite","biter","neck","shoulder","fin","wing","arm","lifter","grasp","grabber","hand","paw","foot","finger","toe","thumb","talon","palm","touch","racer","runner","hoof","fly","flier","swoop","roar","hiss","hisser","snarl","dive","diver","rib","chest","back","ridge","leg","legs","tail","beak","walker","lasher","swisher","carver","kicker","roarer","crusher","spike","shaker","charger","hunter","weaver","crafter","binder","scribe","muse","snap","snapper","slayer","stalker","track","tracker","scar","scarer","fright","killer","death","doom","healer","saver","friend","foe","guardian","thunder","lightning","cloud","storm","forger","scale","hair","braid","nape","belly","thief","stealer","reaper","giver","taker","dancer","player","gambler","twister","turner","painter","dart","drifter","sting","stinger","venom","spur","ripper","swallow","devourer","knight","lady","lord","queen","king","master","mistress","prince","princess","duke","dutchess","samurai","ninja","knave","slave","servant","sage","wizard","witch","warlock","warrior","jester","paladin","bard","trader","sword","shield","knife","dagger","arrow","bow","fighter","bane","follower","leader","scourge","watcher","cat","panther","tiger","cougar","puma","jaguar","ocelot","lynx","lion","leopard","ferret","weasel","wolverine","bear","raccoon","dog","wolf","kitten","puppy","cub","fox","hound","terrier","coyote","hyena","jackal","pig","horse","donkey","stallion","mare","zebra","antelope","gazelle","deer","buffalo","bison","boar","elk","whale","dolphin","shark","fish","minnow","salmon","ray","fisher","otter","gull","duck","goose","crow","raven","bird","eagle","raptor","hawk","falcon","moose","heron","owl","stork","crane","sparrow","robin","parrot","cockatoo","carp","lizard","gecko","iguana","snake","python","viper","boa","condor","vulture","spider","fly","scorpion","heron","oriole","toucan","bee","wasp","hornet","rabbit","bunny","hare","brow","mustang","ox","piper","soarer","flasher","moth","mask","hide","hero","antler","chill","chiller","gem","ogre","myth","elf","fairy","pixie","dragon","griffin","unicorn","pegasus","sprite","fancier","chopper","slicer","skinner","butterfly","legend","wanderer","rover","raver","loon","lancer","glass","glazer","flame","crystal","lantern","lighter","cloak","bell","ringer","keeper","centaur","bolt","catcher","whimsey","quester","rat","mouse","serpent","wyrm","gargoyle","thorn","whip","rider","spirit","sentry","bat","beetle","burn","cowl","stone","gem","collar","mark","grin","scowl","spear","razor","edge","seeker","jay","ape","monkey","gorilla","koala","kangaroo","yak","sloth","ant","roach","weed","seed","eater","razor","shirt","face","goat","mind","shift","rider","face","mole","vole","pirate","llama","stag","bug","cap","boot","drop","hugger","sargent","snagglefoot","carpet","curtain"];function B(E){return E=E||Math.random,R[Math.floor(E()*R.length)]}function M(E){return E=E||Math.random,v[Math.floor(E()*v.length)]}H.exports=function l(E){var k=B(E),z=B(E);return z=z.substr(0,1).toUpperCase()+z.substr(1),M(E)+k+" "+z},H.exports.randomNoun=B,H.exports.randomAdjective=M},7629:(H,q,v)=>{"use strict";var R=v(8237),B=v(2858),M=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,l=/[\n\r\t]/g,E=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,k=/:\d+$/,z=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,S=/^[a-zA-Z]:/;function K(se){return(se||"").toString().replace(M,"")}var X=[["#","hash"],["?","query"],function(ge,te){return ce(te.protocol)?ge.replace(/\\/g,"/"):ge},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ne={hash:1,query:1};function ae(se){var ge;ge=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ue,pe={},Ae=typeof(se=se||ge.location||{});if("blob:"===se.protocol)pe=new Ie(unescape(se.pathname),{});else if("string"===Ae)for(ue in pe=new Ie(se,{}),ne)delete pe[ue];else if("object"===Ae){for(ue in se)ue in ne||(pe[ue]=se[ue]);void 0===pe.slashes&&(pe.slashes=E.test(se.href))}return pe}function ce(se){return"file:"===se||"ftp:"===se||"http:"===se||"https:"===se||"ws:"===se||"wss:"===se}function V(se,ge){se=(se=K(se)).replace(l,""),ge=ge||{};var ie,te=z.exec(se),pe=te[1]?te[1].toLowerCase():"",Ae=!!te[2],ue=!!te[3],he=0;return Ae?ue?(ie=te[2]+te[3]+te[4],he=te[2].length+te[3].length):(ie=te[2]+te[4],he=te[2].length):ue?(ie=te[3]+te[4],he=te[3].length):ie=te[4],"file:"===pe?he>=2&&(ie=ie.slice(2)):ce(pe)?ie=te[4]:pe?Ae&&(ie=ie.slice(2)):he>=2&&ce(ge.protocol)&&(ie=te[4]),{protocol:pe,slashes:Ae||ce(pe),slashesCount:he,rest:ie}}function Ie(se,ge,te){if(se=(se=K(se)).replace(l,""),!(this instanceof Ie))return new Ie(se,ge,te);var pe,Ae,ue,he,ie,Pe,we=X.slice(),de=typeof ge,ve=this,be=0;for("object"!==de&&"string"!==de&&(te=ge,ge=null),te&&"function"!=typeof te&&(te=B.parse),pe=!(Ae=V(se||"",ge=ae(ge))).protocol&&!Ae.slashes,ve.slashes=Ae.slashes||pe&&ge.slashes,ve.protocol=Ae.protocol||ge.protocol||"",se=Ae.rest,("file:"===Ae.protocol&&(2!==Ae.slashesCount||S.test(se))||!Ae.slashes&&(Ae.protocol||Ae.slashesCount<2||!ce(ve.protocol)))&&(we[3]=[/(.*)/,"pathname"]);be<we.length;be++)"function"!=typeof(he=we[be])?(Pe=he[1],(ue=he[0])!=ue?ve[Pe]=se:"string"==typeof ue?~(ie="@"===ue?se.lastIndexOf(ue):se.indexOf(ue))&&("number"==typeof he[2]?(ve[Pe]=se.slice(0,ie),se=se.slice(ie+he[2])):(ve[Pe]=se.slice(ie),se=se.slice(0,ie))):(ie=ue.exec(se))&&(ve[Pe]=ie[1],se=se.slice(0,ie.index)),ve[Pe]=ve[Pe]||pe&&he[3]&&ge[Pe]||"",he[4]&&(ve[Pe]=ve[Pe].toLowerCase())):se=he(se,ve);te&&(ve.query=te(ve.query)),pe&&ge.slashes&&"/"!==ve.pathname.charAt(0)&&(""!==ve.pathname||""!==ge.pathname)&&(ve.pathname=function Te(se,ge){if(""===se)return ge;for(var te=(ge||"/").split("/").slice(0,-1).concat(se.split("/")),pe=te.length,Ae=te[pe-1],ue=!1,he=0;pe--;)"."===te[pe]?te.splice(pe,1):".."===te[pe]?(te.splice(pe,1),he++):he&&(0===pe&&(ue=!0),te.splice(pe,1),he--);return ue&&te.unshift(""),("."===Ae||".."===Ae)&&te.push(""),te.join("/")}(ve.pathname,ge.pathname)),"/"!==ve.pathname.charAt(0)&&ce(ve.protocol)&&(ve.pathname="/"+ve.pathname),R(ve.port,ve.protocol)||(ve.host=ve.hostname,ve.port=""),ve.username=ve.password="",ve.auth&&(~(ie=ve.auth.indexOf(":"))?(ve.username=ve.auth.slice(0,ie),ve.username=encodeURIComponent(decodeURIComponent(ve.username)),ve.password=ve.auth.slice(ie+1),ve.password=encodeURIComponent(decodeURIComponent(ve.password))):ve.username=encodeURIComponent(decodeURIComponent(ve.auth)),ve.auth=ve.password?ve.username+":"+ve.password:ve.username),ve.origin="file:"!==ve.protocol&&ce(ve.protocol)&&ve.host?ve.protocol+"//"+ve.host:"null",ve.href=ve.toString()}Ie.prototype={set:function Me(se,ge,te){var pe=this;switch(se){case"query":"string"==typeof ge&&ge.length&&(ge=(te||B.parse)(ge)),pe[se]=ge;break;case"port":pe[se]=ge,R(ge,pe.protocol)?ge&&(pe.host=pe.hostname+":"+ge):(pe.host=pe.hostname,pe[se]="");break;case"hostname":pe[se]=ge,pe.port&&(ge+=":"+pe.port),pe.host=ge;break;case"host":pe[se]=ge,k.test(ge)?(ge=ge.split(":"),pe.port=ge.pop(),pe.hostname=ge.join(":")):(pe.hostname=ge,pe.port="");break;case"protocol":pe.protocol=ge.toLowerCase(),pe.slashes=!te;break;case"pathname":case"hash":if(ge){var Ae="pathname"===se?"/":"#";pe[se]=ge.charAt(0)!==Ae?Ae+ge:ge}else pe[se]=ge;break;case"username":case"password":pe[se]=encodeURIComponent(ge);break;case"auth":var ue=ge.indexOf(":");~ue?(pe.username=ge.slice(0,ue),pe.username=encodeURIComponent(decodeURIComponent(pe.username)),pe.password=ge.slice(ue+1),pe.password=encodeURIComponent(decodeURIComponent(pe.password))):pe.username=encodeURIComponent(decodeURIComponent(ge))}for(var he=0;he<X.length;he++){var ie=X[he];ie[4]&&(pe[ie[1]]=pe[ie[1]].toLowerCase())}return pe.auth=pe.password?pe.username+":"+pe.password:pe.username,pe.origin="file:"!==pe.protocol&&ce(pe.protocol)&&pe.host?pe.protocol+"//"+pe.host:"null",pe.href=pe.toString(),pe},toString:function Be(se){(!se||"function"!=typeof se)&&(se=B.stringify);var ge,te=this,pe=te.host,Ae=te.protocol;Ae&&":"!==Ae.charAt(Ae.length-1)&&(Ae+=":");var ue=Ae+(te.protocol&&te.slashes||ce(te.protocol)?"//":"");return te.username?(ue+=te.username,te.password&&(ue+=":"+te.password),ue+="@"):te.password?(ue+=":"+te.password,ue+="@"):"file:"!==te.protocol&&ce(te.protocol)&&!pe&&"/"!==te.pathname&&(ue+="@"),(":"===pe[pe.length-1]||k.test(te.hostname)&&!te.port)&&(pe+=":"),ue+=pe+te.pathname,(ge="object"==typeof te.query?se(te.query):te.query)&&(ue+="?"!==ge.charAt(0)?"?"+ge:ge),te.hash&&(ue+=te.hash),ue}},Ie.extractProtocol=V,Ie.location=ae,Ie.trimLeft=K,Ie.qs=B,H.exports=Ie},1308:function(H,q,v){var R;H=v.nmd(H),function(B){"object"==typeof global&&global;var k,z=2147483647,S=36,K=1,X=26,ne=38,ae=700,ce=72,V=128,Te="-",Ie=/^xn--/,Me=/[^\x20-\x7E]/,Be=/[\x2E\u3002\uFF0E\uFF61]/g,se={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},ge=S-K,te=Math.floor,pe=String.fromCharCode;function ue(_e){throw RangeError(se[_e])}function he(_e,je){for(var Re=_e.length,tt=[];Re--;)tt[Re]=je(_e[Re]);return tt}function ie(_e,je){var Re=_e.split("@"),tt="";return Re.length>1&&(tt=Re[0]+"@",_e=Re[1]),tt+he((_e=_e.replace(Be,".")).split("."),je).join(".")}function Pe(_e){for(var Xe,Ot,je=[],Re=0,tt=_e.length;Re<tt;)(Xe=_e.charCodeAt(Re++))>=55296&&Xe<=56319&&Re<tt?56320==(64512&(Ot=_e.charCodeAt(Re++)))?je.push(((1023&Xe)<<10)+(1023&Ot)+65536):(je.push(Xe),Re--):je.push(Xe);return je}function we(_e){return he(_e,function(je){var Re="";return je>65535&&(Re+=pe((je-=65536)>>>10&1023|55296),je=56320|1023&je),Re+pe(je)}).join("")}function de(_e){return _e-48<10?_e-22:_e-65<26?_e-65:_e-97<26?_e-97:S}function ve(_e,je){return _e+22+75*(_e<26)-((0!=je)<<5)}function be(_e,je,Re){var tt=0;for(_e=Re?te(_e/ae):_e>>1,_e+=te(_e/je);_e>ge*X>>1;tt+=S)_e=te(_e/ge);return te(tt+(ge+1)*_e/(_e+ne))}function at(_e){var tt,nt,At,Pt,ot,Nt,gt,xt,Zt,on,je=[],Re=_e.length,Xe=0,Ot=V,He=ce;for((nt=_e.lastIndexOf(Te))<0&&(nt=0),At=0;At<nt;++At)_e.charCodeAt(At)>=128&&ue("not-basic"),je.push(_e.charCodeAt(At));for(Pt=nt>0?nt+1:0;Pt<Re;){for(ot=Xe,Nt=1,gt=S;Pt>=Re&&ue("invalid-input"),((xt=de(_e.charCodeAt(Pt++)))>=S||xt>te((z-Xe)/Nt))&&ue("overflow"),Xe+=xt*Nt,!(xt<(Zt=gt<=He?K:gt>=He+X?X:gt-He));gt+=S)Nt>te(z/(on=S-Zt))&&ue("overflow"),Nt*=on;He=be(Xe-ot,tt=je.length+1,0==ot),te(Xe/tt)>z-Ot&&ue("overflow"),Ot+=te(Xe/tt),Xe%=tt,je.splice(Xe++,0,Ot)}return we(je)}function Ke(_e){var je,Re,tt,Xe,Ot,He,nt,At,Pt,ot,Nt,xt,Zt,on,ut,gt=[];for(xt=(_e=Pe(_e)).length,je=V,Re=0,Ot=ce,He=0;He<xt;++He)(Nt=_e[He])<128&&gt.push(pe(Nt));for(tt=Xe=gt.length,Xe&&gt.push(Te);tt<xt;){for(nt=z,He=0;He<xt;++He)(Nt=_e[He])>=je&&Nt<nt&&(nt=Nt);for(nt-je>te((z-Re)/(Zt=tt+1))&&ue("overflow"),Re+=(nt-je)*Zt,je=nt,He=0;He<xt;++He)if((Nt=_e[He])<je&&++Re>z&&ue("overflow"),Nt==je){for(At=Re,Pt=S;!(At<(ot=Pt<=Ot?K:Pt>=Ot+X?X:Pt-Ot));Pt+=S)gt.push(pe(ve(ot+(ut=At-ot)%(on=S-ot),0))),At=te(ut/on);gt.push(pe(ve(At,0))),Ot=be(Re,Zt,tt==Xe),Re=0,++tt}++Re,++je}return gt.join("")}k={version:"1.3.2",ucs2:{decode:Pe,encode:we},decode:at,encode:Ke,toASCII:function Ut(_e){return ie(_e,function(je){return Me.test(je)?"xn--"+Ke(je):je})},toUnicode:function Je(_e){return ie(_e,function(je){return Ie.test(je)?at(je.slice(4).toLowerCase()):je})}},void 0!==(R=function(){return k}.call(q,v,q,H))&&(H.exports=R)}()},4327:H=>{"use strict";function q(v,R){return Object.prototype.hasOwnProperty.call(v,R)}H.exports=function(v,R,B,M){B=B||"=";var l={};if("string"!=typeof v||0===v.length)return l;var E=/\+/g;v=v.split(R=R||"&");var k=1e3;M&&"number"==typeof M.maxKeys&&(k=M.maxKeys);var z=v.length;k>0&&z>k&&(z=k);for(var S=0;S<z;++S){var ne,ae,ce,V,K=v[S].replace(E,"%20"),X=K.indexOf(B);X>=0?(ne=K.substr(0,X),ae=K.substr(X+1)):(ne=K,ae=""),ce=decodeURIComponent(ne),V=decodeURIComponent(ae),q(l,ce)?Array.isArray(l[ce])?l[ce].push(V):l[ce]=[l[ce],V]:l[ce]=V}return l}},5232:H=>{"use strict";var q=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};H.exports=function(v,R,B,M){return R=R||"&",B=B||"=",null===v&&(v=void 0),"object"==typeof v?Object.keys(v).map(function(l){var E=encodeURIComponent(q(l))+B;return Array.isArray(v[l])?v[l].map(function(k){return E+encodeURIComponent(q(k))}).join(R):E+encodeURIComponent(q(v[l]))}).join(R):M?encodeURIComponent(q(M))+B+encodeURIComponent(q(v)):""}},535:(H,q,v)=>{"use strict";q.decode=q.parse=v(4327),q.encode=q.stringify=v(5232)},8762:(H,q,v)=>{"use strict";var B=v(1308),M=v(796);function l(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}q.Qc=ge;var E=/^([a-z0-9.+-]+:)/i,k=/:[0-9]*$/,z=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,K=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),X=["'"].concat(K),ne=["%","/","?",";","#"].concat(X),ae=["/","?","#"],V=/^[+a-z0-9A-Z_-]{0,63}$/,Te=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Ie={javascript:!0,"javascript:":!0},Me={javascript:!0,"javascript:":!0},Be={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},se=v(535);function ge(ue,he,ie){if(ue&&M.isObject(ue)&&ue instanceof l)return ue;var Pe=new l;return Pe.parse(ue,he,ie),Pe}l.prototype.parse=function(ue,he,ie){if(!M.isString(ue))throw new TypeError("Parameter 'url' must be a string, not "+typeof ue);var Pe=ue.indexOf("?"),we=-1!==Pe&&Pe<ue.indexOf("#")?"?":"#",de=ue.split(we);de[0]=de[0].replace(/\\/g,"/");var be=ue=de.join(we);if(be=be.trim(),!ie&&1===ue.split("#").length){var at=z.exec(be);if(at)return this.path=be,this.href=be,this.pathname=at[1],at[2]?(this.search=at[2],this.query=he?se.parse(this.search.substr(1)):this.search.substr(1)):he&&(this.search="",this.query={}),this}var Ke=E.exec(be);if(Ke){var Je=(Ke=Ke[0]).toLowerCase();this.protocol=Je,be=be.substr(Ke.length)}if(ie||Ke||be.match(/^\/\/[^@\/]+@[^@\/]+/)){var Ut="//"===be.substr(0,2);Ut&&(!Ke||!Me[Ke])&&(be=be.substr(2),this.slashes=!0)}if(!Me[Ke]&&(Ut||Ke&&!Be[Ke])){for(var _e=-1,je=0;je<ae.length;je++)-1!==(Re=be.indexOf(ae[je]))&&(-1===_e||Re<_e)&&(_e=Re);var tt,Xe;for(-1!==(Xe=-1===_e?be.lastIndexOf("@"):be.lastIndexOf("@",_e))&&(tt=be.slice(0,Xe),be=be.slice(Xe+1),this.auth=decodeURIComponent(tt)),_e=-1,je=0;je<ne.length;je++){var Re;-1!==(Re=be.indexOf(ne[je]))&&(-1===_e||Re<_e)&&(_e=Re)}-1===_e&&(_e=be.length),this.host=be.slice(0,_e),be=be.slice(_e),this.parseHost(),this.hostname=this.hostname||"";var Ot="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!Ot)for(var He=this.hostname.split(/\./),nt=(je=0,He.length);je<nt;je++){var At=He[je];if(At&&!At.match(V)){for(var Pt="",ot=0,Nt=At.length;ot<Nt;ot++)At.charCodeAt(ot)>127?Pt+="x":Pt+=At[ot];if(!Pt.match(V)){var gt=He.slice(0,je),xt=He.slice(je+1),Zt=At.match(Te);Zt&&(gt.push(Zt[1]),xt.unshift(Zt[2])),xt.length&&(be="/"+xt.join(".")+be),this.hostname=gt.join(".");break}}}this.hostname=this.hostname.length>255?"":this.hostname.toLowerCase(),Ot||(this.hostname=B.toASCII(this.hostname)),this.host=(this.hostname||"")+(this.port?":"+this.port:""),this.href+=this.host,Ot&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==be[0]&&(be="/"+be))}if(!Ie[Je])for(je=0,nt=X.length;je<nt;je++){var $t=X[je];if(-1!==be.indexOf($t)){var st=encodeURIComponent($t);st===$t&&(st=escape($t)),be=be.split($t).join(st)}}var Nn=be.indexOf("#");-1!==Nn&&(this.hash=be.substr(Nn),be=be.slice(0,Nn));var fn=be.indexOf("?");return-1!==fn?(this.search=be.substr(fn),this.query=be.substr(fn+1),he&&(this.query=se.parse(this.query)),be=be.slice(0,fn)):he&&(this.search="",this.query={}),be&&(this.pathname=be),Be[Je]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(this.path=(this.pathname||"")+(this.search||"")),this.href=this.format(),this},l.prototype.format=function(){var ue=this.auth||"";ue&&(ue=(ue=encodeURIComponent(ue)).replace(/%3A/i,":"),ue+="@");var he=this.protocol||"",ie=this.pathname||"",Pe=this.hash||"",we=!1,de="";this.host?we=ue+this.host:this.hostname&&(we=ue+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(we+=":"+this.port)),this.query&&M.isObject(this.query)&&Object.keys(this.query).length&&(de=se.stringify(this.query));var ve=this.search||de&&"?"+de||"";return he&&":"!==he.substr(-1)&&(he+=":"),this.slashes||(!he||Be[he])&&!1!==we?(we="//"+(we||""),ie&&"/"!==ie.charAt(0)&&(ie="/"+ie)):we||(we=""),Pe&&"#"!==Pe.charAt(0)&&(Pe="#"+Pe),ve&&"?"!==ve.charAt(0)&&(ve="?"+ve),he+we+(ie=ie.replace(/[?#]/g,function(be){return encodeURIComponent(be)}))+(ve=ve.replace("#","%23"))+Pe},l.prototype.resolve=function(ue){return this.resolveObject(ge(ue,!1,!0)).format()},l.prototype.resolveObject=function(ue){if(M.isString(ue)){var he=new l;he.parse(ue,!1,!0),ue=he}for(var ie=new l,Pe=Object.keys(this),we=0;we<Pe.length;we++){var de=Pe[we];ie[de]=this[de]}if(ie.hash=ue.hash,""===ue.href)return ie.href=ie.format(),ie;if(ue.slashes&&!ue.protocol){for(var ve=Object.keys(ue),be=0;be<ve.length;be++){var at=ve[be];"protocol"!==at&&(ie[at]=ue[at])}return Be[ie.protocol]&&ie.hostname&&!ie.pathname&&(ie.path=ie.pathname="/"),ie.href=ie.format(),ie}if(ue.protocol&&ue.protocol!==ie.protocol){if(!Be[ue.protocol]){for(var Ke=Object.keys(ue),Je=0;Je<Ke.length;Je++){var Ut=Ke[Je];ie[Ut]=ue[Ut]}return ie.href=ie.format(),ie}if(ie.protocol=ue.protocol,ue.host||Me[ue.protocol])ie.pathname=ue.pathname;else{for(var nt=(ue.pathname||"").split("/");nt.length&&!(ue.host=nt.shift()););ue.host||(ue.host=""),ue.hostname||(ue.hostname=""),""!==nt[0]&&nt.unshift(""),nt.length<2&&nt.unshift(""),ie.pathname=nt.join("/")}return ie.search=ue.search,ie.query=ue.query,ie.host=ue.host||"",ie.auth=ue.auth,ie.hostname=ue.hostname||ue.host,ie.port=ue.port,(ie.pathname||ie.search)&&(ie.path=(ie.pathname||"")+(ie.search||"")),ie.slashes=ie.slashes||ue.slashes,ie.href=ie.format(),ie}var Re=ie.pathname&&"/"===ie.pathname.charAt(0),tt=ue.host||ue.pathname&&"/"===ue.pathname.charAt(0),Xe=tt||Re||ie.host&&ue.pathname,Ot=Xe,He=ie.pathname&&ie.pathname.split("/")||[],At=(nt=ue.pathname&&ue.pathname.split("/")||[],ie.protocol&&!Be[ie.protocol]);if(At&&(ie.hostname="",ie.port=null,ie.host&&(""===He[0]?He[0]=ie.host:He.unshift(ie.host)),ie.host="",ue.protocol&&(ue.hostname=null,ue.port=null,ue.host&&(""===nt[0]?nt[0]=ue.host:nt.unshift(ue.host)),ue.host=null),Xe=Xe&&(""===nt[0]||""===He[0])),tt)ie.host=ue.host||""===ue.host?ue.host:ie.host,ie.hostname=ue.hostname||""===ue.hostname?ue.hostname:ie.hostname,ie.search=ue.search,ie.query=ue.query,He=nt;else if(nt.length)He||(He=[]),He.pop(),He=He.concat(nt),ie.search=ue.search,ie.query=ue.query;else if(!M.isNullOrUndefined(ue.search))return At&&(ie.hostname=ie.host=He.shift(),(Pt=!!(ie.host&&ie.host.indexOf("@")>0)&&ie.host.split("@"))&&(ie.auth=Pt.shift(),ie.host=ie.hostname=Pt.shift())),ie.search=ue.search,ie.query=ue.query,(!M.isNull(ie.pathname)||!M.isNull(ie.search))&&(ie.path=(ie.pathname?ie.pathname:"")+(ie.search?ie.search:"")),ie.href=ie.format(),ie;if(!He.length)return ie.pathname=null,ie.path=ie.search?"/"+ie.search:null,ie.href=ie.format(),ie;for(var ot=He.slice(-1)[0],Nt=(ie.host||ue.host||He.length>1)&&("."===ot||".."===ot)||""===ot,gt=0,xt=He.length;xt>=0;xt--)"."===(ot=He[xt])?He.splice(xt,1):".."===ot?(He.splice(xt,1),gt++):gt&&(He.splice(xt,1),gt--);if(!Xe&&!Ot)for(;gt--;gt)He.unshift("..");Xe&&""!==He[0]&&(!He[0]||"/"!==He[0].charAt(0))&&He.unshift(""),Nt&&"/"!==He.join("/").substr(-1)&&He.push("");var Pt,Zt=""===He[0]||He[0]&&"/"===He[0].charAt(0);return At&&(ie.hostname=ie.host=Zt?"":He.length?He.shift():"",(Pt=!!(ie.host&&ie.host.indexOf("@")>0)&&ie.host.split("@"))&&(ie.auth=Pt.shift(),ie.host=ie.hostname=Pt.shift())),(Xe=Xe||ie.host&&He.length)&&!Zt&&He.unshift(""),He.length?ie.pathname=He.join("/"):(ie.pathname=null,ie.path=null),(!M.isNull(ie.pathname)||!M.isNull(ie.search))&&(ie.path=(ie.pathname?ie.pathname:"")+(ie.search?ie.search:"")),ie.auth=ue.auth||ie.auth,ie.slashes=ie.slashes||ue.slashes,ie.href=ie.format(),ie},l.prototype.parseHost=function(){var ue=this.host,he=k.exec(ue);he&&(":"!==(he=he[0])&&(this.port=he.substr(1)),ue=ue.substr(0,ue.length-he.length)),ue&&(this.hostname=ue)}},796:H=>{"use strict";H.exports={isString:function(q){return"string"==typeof q},isObject:function(q){return"object"==typeof q&&null!==q},isNull:function(q){return null===q},isNullOrUndefined:function(q){return null==q}}},5861:(H,q,v)=>{"use strict";function R(M,l,E,k,z,S,K){try{var X=M[S](K),ne=X.value}catch(ae){return void E(ae)}X.done?l(ne):Promise.resolve(ne).then(k,z)}function B(M){return function(){var l=this,E=arguments;return new Promise(function(k,z){var S=M.apply(l,E);function K(ne){R(S,k,z,K,X,"next",ne)}function X(ne){R(S,k,z,K,X,"throw",ne)}K(void 0)})}}v.d(q,{Z:()=>B})}}]);